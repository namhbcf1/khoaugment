import{j as e}from"./index-D0cJwDsb.js";import{r as c}from"./vendor-DD54NZMZ.js";import{F as a,f as te,T as se,u as F,e as m,C as i,l as p,I as k,$ as o,B as h,ag as q,y as A,b2 as ae,g as P,A as ie,b3 as ce,M as re,k as R,aP as T,H as oe,J as le,a7 as he,ak as K,a3 as de,aF as ue,ae as ge,am as I,b4 as me,ab as C,b5 as pe,a_ as z,ad as xe,b6 as je,b7 as ve,aI as ye,aK as ke}from"./antd-pmzi8FkM.js";import"./utils-Db1EesZb.js";const{Title:fe,Text:be,Paragraph:Re}=se,{TabPane:w}=F,{Option:r}=o,Te=[{id:1,name:"Chào mừng khách hàng mới",description:"Hiển thị thông báo chào mừng cho khách hàng lần đầu mua hàng",trigger:"first_purchase",action:"show_notification",content:"Chào mừng quý khách đến với Trường Phát Computer! Sử dụng mã WELCOME10 để được giảm 10% cho đơn hàng đầu tiên.",status:"active",segment:"new_customers",priority:1,createdAt:"2023-06-15",lastRun:"2023-07-20",performance:{impressions:124,engagements:98,conversions:45,conversionRate:36.3}},{id:2,name:"Đề xuất phụ kiện laptop",description:"Hiển thị phụ kiện liên quan khi khách hàng mua laptop",trigger:"product_category_view",action:"show_recommendations",content:"Laptop",status:"active",segment:"all",priority:2,createdAt:"2023-06-18",lastRun:"2023-07-20",performance:{impressions:256,engagements:120,conversions:68,conversionRate:26.6}},{id:3,name:"Nhắc nhở giỏ hàng bị bỏ quên",description:"Gửi email nhắc nhở khi khách hàng bỏ quên giỏ hàng sau 24h",trigger:"cart_abandonment",action:"send_email",content:"Quý khách có sản phẩm trong giỏ hàng đang chờ thanh toán. Hoàn tất đơn hàng ngay để không bỏ lỡ sản phẩm yêu thích!",status:"active",segment:"all",priority:3,createdAt:"2023-06-20",lastRun:"2023-07-19",performance:{impressions:87,engagements:32,conversions:18,conversionRate:20.7}},{id:4,name:"Khuyến mãi sinh nhật",description:"Gửi mã giảm giá vào ngày sinh nhật của khách hàng",trigger:"birthday",action:"send_coupon",content:"BIRTHDAY20",status:"active",segment:"registered_customers",priority:1,createdAt:"2023-06-25",lastRun:"2023-07-20",performance:{impressions:45,engagements:38,conversions:30,conversionRate:66.7}},{id:5,name:"Đề xuất nâng cấp PC",description:"Hiển thị đề xuất nâng cấp cho khách hàng đã mua PC trước đây",trigger:"previous_purchase",action:"show_recommendations",content:"PC",status:"inactive",segment:"returning_customers",priority:4,createdAt:"2023-07-05",lastRun:null,performance:{impressions:0,engagements:0,conversions:0,conversionRate:0}}],Ie=[{id:"all",name:"Tất cả khách hàng",description:"Tất cả khách hàng trong hệ thống",count:2450,createdAt:"2023-06-10"},{id:"new_customers",name:"Khách hàng mới",description:"Khách hàng lần đầu mua hàng trong 30 ngày qua",count:187,createdAt:"2023-06-10"},{id:"returning_customers",name:"Khách hàng quay lại",description:"Khách hàng đã mua hàng ít nhất 2 lần",count:780,createdAt:"2023-06-10"},{id:"registered_customers",name:"Khách hàng đã đăng ký",description:"Khách hàng đã tạo tài khoản",count:1842,createdAt:"2023-06-10"},{id:"vip_customers",name:"Khách hàng VIP",description:"Khách hàng chi tiêu trên 20 triệu VNĐ",count:245,createdAt:"2023-06-15"}],$=[{value:"first_purchase",label:"Lần đầu mua hàng",icon:e.jsx(C,{})},{value:"product_category_view",label:"Xem danh mục sản phẩm",icon:e.jsx(pe,{})},{value:"cart_abandonment",label:"Bỏ quên giỏ hàng",icon:e.jsx(C,{})},{value:"birthday",label:"Sinh nhật khách hàng",icon:e.jsx(z,{})},{value:"previous_purchase",label:"Mua hàng trước đây",icon:e.jsx(C,{})},{value:"login",label:"Đăng nhập",icon:e.jsx(P,{})},{value:"inactivity",label:"Không hoạt động",icon:e.jsx(xe,{})}],H=[{value:"show_notification",label:"Hiển thị thông báo",icon:e.jsx(je,{})},{value:"show_recommendations",label:"Hiển thị đề xuất",icon:e.jsx(ve,{})},{value:"send_email",label:"Gửi email",icon:e.jsx(ye,{})},{value:"send_coupon",label:"Gửi mã giảm giá",icon:e.jsx(z,{})},{value:"show_popup",label:"Hiển thị popup",icon:e.jsx(ke,{})}],qe=()=>{const[l,d]=c.useState([]),[x,V]=c.useState([]),[S,B]=c.useState(!0),[L,j]=c.useState(!1),[v,_]=c.useState(null),[u]=a.useForm(),[y,M]=c.useState(""),[f,N]=c.useState(null),[b,E]=c.useState(null);c.useEffect(()=>{setTimeout(()=>{d(Te),V(Ie),B(!1)},1e3)},[]);const O=n=>{_(n),u.setFieldsValue({name:n.name,description:n.description,trigger:n.trigger,action:n.action,content:n.content,status:n.status,segment:n.segment,priority:n.priority}),j(!0)},G=()=>{_(null),u.resetFields(),u.setFieldsValue({status:"active",priority:5,segment:"all"}),j(!0)},D=()=>{u.validateFields().then(n=>{if(v){const t=l.map(s=>s.id===v.id?{...s,...n,lastRun:s.lastRun}:s);d(t)}else{const t={id:l.length+1,...n,createdAt:new Date().toISOString().split("T")[0],lastRun:null,performance:{impressions:0,engagements:0,conversions:0,conversionRate:0}};d([...l,t])}j(!1)}).catch(n=>{console.log("Validate Failed:",n)})},Q=n=>{d(l.filter(t=>t.id!==n))},X=n=>{const t=n.status==="active"?"inactive":"active",s=l.map(g=>g.id===n.id?{...g,status:t}:g);d(s)},W=l.filter(n=>{const t=!y||n.name.toLowerCase().includes(y.toLowerCase())||n.description.toLowerCase().includes(y.toLowerCase()),s=!f||n.status===f,g=!b||n.segment===b;return t&&s&&g}),J=n=>{const t=$.find(s=>s.value===n);return t?t.label:n},Y=n=>{const t=H.find(s=>s.value===n);return t?t.label:n},U=n=>{const t=x.find(s=>s.id===n);return t?t.name:n},Z=n=>{switch(n){case"active":return e.jsx(I,{status:"success",text:"Đang hoạt động"});case"inactive":return e.jsx(I,{status:"default",text:"Không hoạt động"});default:return e.jsx(I,{status:"processing",text:n})}},ee=[{title:"Quy tắc",dataIndex:"name",key:"name",render:(n,t)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:n}),e.jsx(be,{type:"secondary",children:t.description})]})},{title:"Kích hoạt",dataIndex:"trigger",key:"trigger",render:n=>J(n)},{title:"Hành động",dataIndex:"action",key:"action",render:n=>Y(n)},{title:"Phân khúc",dataIndex:"segment",key:"segment",render:n=>e.jsx(oe,{color:"blue",children:U(n)})},{title:"Trạng thái",dataIndex:"status",key:"status",render:n=>Z(n)},{title:"Hiệu suất",key:"performance",render:(n,t)=>e.jsx(le,{title:`Tỷ lệ chuyển đổi: ${t.performance.conversionRate}%`,children:e.jsx(he,{percent:t.performance.conversionRate,size:"small",status:t.performance.conversionRate>0?"active":"exception",style:{width:100}})})},{title:"Thao tác",key:"operations",render:(n,t)=>e.jsxs(p,{size:"small",children:[e.jsx(h,{size:"small",icon:e.jsx(K,{}),onClick:()=>O(t),children:"Sửa"}),e.jsx(de,{size:"small",checked:t.status==="active",onChange:()=>X(t)}),e.jsx(ue,{title:"Bạn có chắc chắn muốn xóa quy tắc này?",onConfirm:()=>Q(t.id),okText:"Xóa",cancelText:"Hủy",children:e.jsx(h,{size:"small",danger:!0,icon:e.jsx(ge,{})})})]})}],ne=[{title:"Tên phân khúc",dataIndex:"name",key:"name"},{title:"Mô tả",dataIndex:"description",key:"description"},{title:"Số khách hàng",dataIndex:"count",key:"count",sorter:(n,t)=>n.count-t.count},{title:"Ngày tạo",dataIndex:"createdAt",key:"createdAt"},{title:"Thao tác",key:"operations",render:()=>e.jsxs(p,{size:"small",children:[e.jsx(h,{size:"small",icon:e.jsx(K,{}),children:"Sửa"}),e.jsx(h,{size:"small",icon:e.jsx(me,{}),children:"Xem khách hàng"})]})}];return e.jsx("div",{className:"personalization-engine",children:e.jsxs(te,{children:[e.jsx(fe,{level:2,children:"Công cụ cá nhân hóa"}),e.jsx(Re,{type:"secondary",children:"Tạo và quản lý các quy tắc cá nhân hóa để cung cấp trải nghiệm tùy chỉnh cho khách hàng"}),e.jsxs(F,{defaultActiveKey:"rules",children:[e.jsxs(w,{tab:e.jsxs("span",{children:[e.jsx(ae,{})," Quy tắc cá nhân hóa"]}),children:[e.jsxs(m,{gutter:16,style:{marginBottom:16},children:[e.jsx(i,{flex:"auto",children:e.jsxs(p,{children:[e.jsx(k,{placeholder:"Tìm kiếm quy tắc",value:y,onChange:n=>M(n.target.value),style:{width:200},allowClear:!0}),e.jsxs(o,{placeholder:"Trạng thái",style:{width:150},value:f,onChange:N,allowClear:!0,children:[e.jsx(r,{value:"active",children:"Đang hoạt động"}),e.jsx(r,{value:"inactive",children:"Không hoạt động"})]}),e.jsx(o,{placeholder:"Phân khúc",style:{width:180},value:b,onChange:E,allowClear:!0,children:x.map(n=>e.jsx(r,{value:n.id,children:n.name},n.id))})]})}),e.jsx(i,{children:e.jsx(h,{type:"primary",icon:e.jsx(q,{}),onClick:G,children:"Thêm quy tắc mới"})})]}),e.jsx(A,{columns:ee,dataSource:W,rowKey:"id",loading:S,pagination:{pageSize:5}})]},"rules"),e.jsxs(w,{tab:e.jsxs("span",{children:[e.jsx(P,{})," Phân khúc khách hàng"]}),children:[e.jsx("div",{style:{marginBottom:16,textAlign:"right"},children:e.jsx(h,{type:"primary",icon:e.jsx(q,{}),children:"Tạo phân khúc mới"})}),e.jsx(A,{columns:ne,dataSource:x,rowKey:"id",loading:S,pagination:!1})]},"segments"),e.jsx(w,{tab:e.jsxs("span",{children:[e.jsx(ce,{})," A/B Testing"]}),children:e.jsx(ie,{message:"Tính năng đang phát triển",description:"Tính năng A/B Testing đang được phát triển và sẽ sớm ra mắt.",type:"info",showIcon:!0})},"ab_testing")]}),e.jsx(re,{title:v?"Chỉnh sửa quy tắc":"Thêm quy tắc mới",open:L,onOk:D,onCancel:()=>j(!1),width:700,okText:v?"Cập nhật":"Thêm",cancelText:"Hủy",children:e.jsxs(a,{form:u,layout:"vertical",children:[e.jsxs(m,{gutter:16,children:[e.jsx(i,{span:24,children:e.jsx(a.Item,{name:"name",label:"Tên quy tắc",rules:[{required:!0,message:"Vui lòng nhập tên quy tắc"}],children:e.jsx(k,{placeholder:"Nhập tên quy tắc"})})}),e.jsx(i,{span:24,children:e.jsx(a.Item,{name:"description",label:"Mô tả",children:e.jsx(k.TextArea,{placeholder:"Mô tả ngắn về quy tắc này",rows:2})})})]}),e.jsx(R,{children:"Điều kiện"}),e.jsxs(m,{gutter:16,children:[e.jsx(i,{span:12,children:e.jsx(a.Item,{name:"trigger",label:"Kích hoạt khi",rules:[{required:!0,message:"Vui lòng chọn điều kiện kích hoạt"}],children:e.jsx(o,{placeholder:"Chọn điều kiện kích hoạt",children:$.map(n=>e.jsx(r,{value:n.value,children:e.jsxs(p,{children:[n.icon,e.jsx("span",{children:n.label})]})},n.value))})})}),e.jsx(i,{span:12,children:e.jsx(a.Item,{name:"segment",label:"Áp dụng cho phân khúc",rules:[{required:!0,message:"Vui lòng chọn phân khúc"}],children:e.jsx(o,{placeholder:"Chọn phân khúc khách hàng",children:x.map(n=>e.jsx(r,{value:n.id,children:n.name},n.id))})})})]}),e.jsx(R,{children:"Hành động"}),e.jsxs(m,{gutter:16,children:[e.jsx(i,{span:12,children:e.jsx(a.Item,{name:"action",label:"Thực hiện hành động",rules:[{required:!0,message:"Vui lòng chọn hành động"}],children:e.jsx(o,{placeholder:"Chọn hành động",children:H.map(n=>e.jsx(r,{value:n.value,children:e.jsxs(p,{children:[n.icon,e.jsx("span",{children:n.label})]})},n.value))})})}),e.jsx(i,{span:12,children:e.jsx(a.Item,{name:"content",label:"Nội dung",rules:[{required:!0,message:"Vui lòng nhập nội dung"}],children:e.jsx(k.TextArea,{placeholder:"Nội dung của hành động",rows:2})})})]}),e.jsx(R,{children:"Cài đặt"}),e.jsxs(m,{gutter:16,children:[e.jsx(i,{span:12,children:e.jsx(a.Item,{name:"status",label:"Trạng thái",children:e.jsxs(T.Group,{children:[e.jsx(T,{value:"active",children:"Hoạt động"}),e.jsx(T,{value:"inactive",children:"Không hoạt động"})]})})}),e.jsx(i,{span:12,children:e.jsx(a.Item,{name:"priority",label:"Độ ưu tiên (1-10, 1 là cao nhất)",rules:[{required:!0,message:"Vui lòng nhập độ ưu tiên"}],children:e.jsx(o,{placeholder:"Chọn độ ưu tiên",children:[1,2,3,4,5,6,7,8,9,10].map(n=>e.jsx(r,{value:n,children:n},n))})})})]})]})})]})})};export{qe as default};
