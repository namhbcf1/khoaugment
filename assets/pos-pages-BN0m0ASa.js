import{r as e,j as t,R as n,l as s,u as i}from"./react-vendor-D_ybsntB.js";import{A as l,P as r,u as a}from"./common-components-Cl8eBnCL.js";import{j as c,C as d,R as o,a as h,B as x,S as m,T as p,I as u,A as j,m as g,D as y,b as v,k as f,h as S,_ as T,s as b,E as C,t as k,F as I,z as A,p as w,c as E,L as N,l as _,f as P,d as D,g as O,W as M,x as R,$ as V,u as z,y as B,Y as H,v as F,q as L,a0 as q,e as G}from"./antd-core-DVlmEpkB.js";import{by as $,aO as U,I as K,aq as Y,L as W,a6 as X,a3 as Q,_ as Z,l as J,as as ee,b as te,U as ne,X as se,F as ie,D as le,au as re,bz as ae,C as ce,j as de,bA as oe,o as he,a2 as xe,a0 as me,aE as pe,z as ue,aR as je,i as ge,V as ye,d as ve,bB as fe,A as Se,aj as Te,a5 as be,bt as Ce,bx as ke,v as Ie,w as Ae,ag as we,P as Ee,aw as Ne,al as _e,bC as Pe,ar as De,f as Oe,B as Me,Q as Re,r as Ve,M as ze}from"./antd-icons-DMCzxaTm.js";import{e as Be}from"./ai-features-DMPRBddn.js";import{d as He}from"./datetime-CZsEG1Fw.js";import{Q as Fe}from"./vendor-qrcode.react-D2-ly9fM.js";const Le={ADMIN:"admin",CASHIER:"cashier",STAFF:"staff",CUSTOMER:"customer"},qe={DASHBOARD_VIEW:"dashboard.view",PRODUCTS_VIEW:"products.view",PRODUCTS_CREATE:"products.create",PRODUCTS_UPDATE:"products.update",PRODUCTS_DELETE:"products.delete",INVENTORY_VIEW:"inventory.view",INVENTORY_UPDATE:"inventory.update",ORDERS_VIEW:"orders.view",ORDERS_CREATE:"orders.create",ORDERS_UPDATE:"orders.update",ORDERS_DELETE:"orders.delete",CUSTOMERS_VIEW:"customers.view",CUSTOMERS_CREATE:"customers.create",CUSTOMERS_UPDATE:"customers.update",CUSTOMERS_DELETE:"customers.delete",STAFF_VIEW:"staff.view",STAFF_CREATE:"staff.create",STAFF_UPDATE:"staff.update",STAFF_DELETE:"staff.delete",REPORTS_VIEW:"reports.view",REPORTS_CREATE:"reports.create",SETTINGS_VIEW:"settings.view",SETTINGS_UPDATE:"settings.update",POS_USE:"pos.use",POS_DISCOUNT:"pos.discount",POS_REFUND:"pos.refund",POS_VOID:"pos.void",POS_CASH_DRAWER:"pos.cash_drawer",ANALYTICS_VIEW:"analytics.view",ANALYTICS_EXPORT:"analytics.export",FINANCIAL_REPORTS:"financial.reports",PROFIT_MARGINS:"profit.margins",AI_USE:"ai.use",AI_CONFIGURE:"ai.configure",AI_INSIGHTS:"ai.insights",GAMIFICATION_VIEW:"gamification.view",GAMIFICATION_MANAGE:"gamification.manage",ACHIEVEMENTS_VIEW:"achievements.view",ACHIEVEMENTS_MANAGE:"achievements.manage",SYSTEM_LOGS:"system.logs",BACKUP_RESTORE:"backup.restore",INTEGRATIONS_MANAGE:"integrations.manage",STAFF_PERFORMANCE:"staff.performance",STAFF_SCHEDULE:"staff.schedule",STAFF_PAYROLL:"staff.payroll"},Ge={[Le.ADMIN]:[qe.DASHBOARD_VIEW,qe.PRODUCTS_VIEW,qe.PRODUCTS_CREATE,qe.PRODUCTS_UPDATE,qe.PRODUCTS_DELETE,qe.INVENTORY_VIEW,qe.INVENTORY_UPDATE,qe.ORDERS_VIEW,qe.ORDERS_CREATE,qe.ORDERS_UPDATE,qe.ORDERS_DELETE,qe.CUSTOMERS_VIEW,qe.CUSTOMERS_CREATE,qe.CUSTOMERS_UPDATE,qe.CUSTOMERS_DELETE,qe.STAFF_VIEW,qe.STAFF_CREATE,qe.STAFF_UPDATE,qe.STAFF_DELETE,qe.REPORTS_VIEW,qe.REPORTS_CREATE,qe.SETTINGS_VIEW,qe.SETTINGS_UPDATE,qe.POS_USE,qe.POS_DISCOUNT,qe.POS_REFUND,qe.POS_VOID,qe.POS_CASH_DRAWER,qe.ANALYTICS_VIEW,qe.ANALYTICS_EXPORT,qe.FINANCIAL_REPORTS,qe.PROFIT_MARGINS,qe.AI_USE,qe.AI_CONFIGURE,qe.AI_INSIGHTS,qe.GAMIFICATION_VIEW,qe.GAMIFICATION_MANAGE,qe.ACHIEVEMENTS_VIEW,qe.ACHIEVEMENTS_MANAGE,qe.SYSTEM_LOGS,qe.BACKUP_RESTORE,qe.INTEGRATIONS_MANAGE,qe.STAFF_PERFORMANCE,qe.STAFF_SCHEDULE,qe.STAFF_PAYROLL],[Le.CASHIER]:[qe.DASHBOARD_VIEW,qe.POS_USE,qe.POS_DISCOUNT,qe.POS_CASH_DRAWER,qe.ORDERS_VIEW,qe.ORDERS_CREATE,qe.ORDERS_UPDATE,qe.CUSTOMERS_VIEW,qe.CUSTOMERS_CREATE,qe.CUSTOMERS_UPDATE,qe.PRODUCTS_VIEW,qe.INVENTORY_VIEW,qe.GAMIFICATION_VIEW,qe.ACHIEVEMENTS_VIEW],[Le.STAFF]:[qe.DASHBOARD_VIEW,qe.PRODUCTS_VIEW,qe.PRODUCTS_CREATE,qe.PRODUCTS_UPDATE,qe.INVENTORY_VIEW,qe.INVENTORY_UPDATE,qe.CUSTOMERS_VIEW,qe.CUSTOMERS_CREATE,qe.CUSTOMERS_UPDATE,qe.ORDERS_VIEW,qe.ORDERS_CREATE,qe.ANALYTICS_VIEW,qe.AI_USE,qe.AI_INSIGHTS,qe.GAMIFICATION_VIEW,qe.ACHIEVEMENTS_VIEW],[Le.CUSTOMER]:[qe.GAMIFICATION_VIEW,qe.ACHIEVEMENTS_VIEW]},$e=(e,t)=>e===t,Ue=(e,t)=>t.includes(e),Ke=(e,t)=>(Ge[e]||[]).includes(t),Ye=(e,t)=>{const n=Ge[e]||[];return t.some(e=>n.includes(e))},We=()=>{const t=e.useContext(l);if(!t)throw new Error("useAuth must be used within an AuthProvider");const{user:n,loading:s,login:i,logout:r,refreshToken:a,updateProfile:c,error:d,clearError:o}=t,h={hasRole:e=>$e(n,e),hasAnyRole:e=>Ue(n,e),hasAllRoles:e=>{return t=n,e.every(e=>t===e);var t},hasPermission:e=>Ke(n,e),hasAnyPermission:e=>Ye(n,e),hasAllPermissions:e=>((e,t)=>{const n=Ge[e]||[];return t.every(e=>n.includes(e))})(n,e),getUserPermissions:()=>Ge[n]||[],isFeatureEnabled:e=>!0,checkBusinessRule:(e,t)=>!0,isAdmin:$e(n,"admin"),isManager:Ue(n,["admin","manager"]),isCashier:Ue(n,["admin","manager","cashier"]),isStaff:Ue(n,["admin","manager","cashier","staff"]),isAuthenticated:!!n,isLoading:s};return{user:n,loading:s,error:d,login:i,logout:r,refreshToken:a,updateProfile:c,clearError:o,...h}},{Title:Xe,Text:Qe}=p,Ze=({visible:n,onClose:s,onScan:i})=>{const[l,r]=e.useState(!1),[a,p]=e.useState(!1),[g,y]=e.useState(""),[v,f]=e.useState(""),[S,T]=e.useState(""),b=e.useRef(null),C=e.useRef(null);e.useEffect(()=>(n&&!a&&k(),()=>{I()}),[n,a]);const k=async()=>{try{if(f(""),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera không được hỗ trợ trên trình duyệt này");const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:640},height:{ideal:480}}});b.current&&(b.current.srcObject=e,C.current=e,r(!0),A())}catch(e){f(e.message||"Không thể truy cập camera"),p(!0)}},I=()=>{C.current&&(C.current.getTracks().forEach(e=>e.stop()),C.current=null),r(!1)},A=()=>{setTimeout(()=>{if(l){w("8934673123456")}},3e3)},w=e=>{T(e),f(""),i(e),setTimeout(()=>{_()},1e3)},E=()=>{const e=g.trim();e?w(e):f("Vui lòng nhập mã vạch")},N=()=>{a?(p(!1),k()):(p(!0),I()),f(""),y("")},_=()=>{I(),y(""),f(""),T(""),s()};return t.jsxs(c,{title:t.jsxs(m,{children:[t.jsx(Y,{}),t.jsx("span",{children:"Quét mã vạch"})]}),open:n,onCancel:_,footer:null,width:600,destroyOnClose:!0,children:[t.jsxs("div",{style:{padding:"16px 0"},children:[a?t.jsx(d,{children:t.jsxs(m,{direction:"vertical",style:{width:"100%"},children:[t.jsx(Xe,{level:5,children:"Nhập mã vạch thủ công"}),t.jsx(u,{placeholder:"Nhập hoặc quét mã vạch...",value:g,onChange:e=>y(e.target.value),onPressEnter:E,size:"large",style:{fontFamily:"monospace"},autoFocus:!0}),t.jsxs(o,{gutter:[8,8],children:[t.jsx(h,{span:12,children:t.jsx(x,{type:"primary",icon:t.jsx(Y,{}),onClick:E,disabled:!g.trim(),block:!0,children:"Xử lý"})}),t.jsx(h,{span:12,children:t.jsx(x,{icon:t.jsx($,{}),onClick:N,block:!0,children:"Quét camera"})})]})]})}):t.jsxs(d,{children:[t.jsxs("div",{style:{position:"relative",marginBottom:16},children:[t.jsx("video",{ref:b,autoPlay:!0,playsInline:!0,style:{width:"100%",height:"300px",backgroundColor:"#000",borderRadius:"8px",objectFit:"cover"}}),l&&t.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80%",height:"2px",backgroundColor:"#ff4d4f",boxShadow:"0 0 10px #ff4d4f",animation:"scan 2s ease-in-out infinite"}})]}),t.jsxs(o,{gutter:[8,8],children:[t.jsx(h,{span:8,children:t.jsx(x,{type:"primary",icon:t.jsx($,{}),onClick:k,disabled:l,block:!0,children:l?"Đang quét...":"Bắt đầu quét"})}),t.jsx(h,{span:8,children:t.jsx(x,{icon:t.jsx(U,{}),onClick:I,disabled:!l,block:!0,children:"Dừng quét"})}),t.jsx(h,{span:8,children:t.jsx(x,{icon:t.jsx(K,{}),onClick:N,block:!0,children:"Nhập thủ công"})})]})]}),t.jsxs("div",{style:{marginTop:16},children:[l&&t.jsx(j,{message:"Đang quét mã vạch...",description:"Đặt mã vạch trong khung hình để quét tự động",type:"info",showIcon:!0,style:{marginBottom:8}}),S&&t.jsx(j,{message:`Đã quét thành công: ${S}`,type:"success",showIcon:!0,style:{marginBottom:8}}),v&&t.jsx(j,{message:"Lỗi",description:v,type:"error",showIcon:!0,style:{marginBottom:8}})]}),t.jsxs(d,{size:"small",style:{marginTop:16,backgroundColor:"#f6f6f6"},children:[t.jsx(Xe,{level:5,children:"Hướng dẫn sử dụng:"}),t.jsxs("ul",{style:{margin:0,paddingLeft:20},children:[t.jsx("li",{children:"Đặt mã vạch trong khung hình để quét tự động"}),t.jsx("li",{children:"Đảm bảo mã vạch rõ nét và đủ ánh sáng"}),t.jsx("li",{children:"Có thể nhập thủ công nếu không quét được"}),t.jsx("li",{children:"Nhấn Enter hoặc nút Xử lý để tìm sản phẩm"})]})]})]}),t.jsx("style",{jsx:!0,children:"\n        @keyframes scan {\n          0%, 100% { \n            transform: translate(-50%, -100px); \n            opacity: 0.5; \n          }\n          50% { \n            transform: translate(-50%, 100px); \n            opacity: 1; \n          }\n        }\n      "})]})},{Option:Je}=v,{TextArea:et}=u,tt=({visible:n,onClose:s,onCustomerCreated:i})=>{const[l]=g.useForm(),[r,a]=e.useState(!1),d=()=>{l.resetFields(),s()};return t.jsx(c,{title:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx(X,{}),t.jsx("span",{children:"Thêm khách hàng mới"})]}),open:n,onCancel:d,footer:null,width:600,destroyOnClose:!0,children:t.jsxs(g,{form:l,layout:"vertical",onFinish:async e=>{a(!0);try{const t={name:e.name,email:e.email||null,phone:e.phone||null,address:e.address||null,date_of_birth:e.date_of_birth?e.date_of_birth.format("YYYY-MM-DD"):null,gender:e.gender||null,segment:e.segment||"Regular"},n=await Be.post("/customers",t);n.data.success?(f.success("Tạo khách hàng thành công!"),i(n.data.data),l.resetFields(),s()):f.error(n.data.message||"Có lỗi xảy ra khi tạo khách hàng")}catch(t){f.error("Có lỗi xảy ra khi tạo khách hàng")}finally{a(!1)}},style:{marginTop:16},children:[t.jsx(o,{gutter:16,children:t.jsx(h,{span:24,children:t.jsx(g.Item,{name:"name",label:"Tên khách hàng",rules:[{required:!0,message:"Vui lòng nhập tên khách hàng"},{min:2,message:"Tên phải có ít nhất 2 ký tự"}],children:t.jsx(u,{placeholder:"Nhập tên khách hàng",size:"large"})})})}),t.jsxs(o,{gutter:16,children:[t.jsx(h,{span:12,children:t.jsx(g.Item,{name:"phone",label:"Số điện thoại",rules:[{pattern:/^[0-9+\-\s()]+$/,message:"Số điện thoại không hợp lệ"}],children:t.jsx(u,{placeholder:"Nhập số điện thoại",size:"large"})})}),t.jsx(h,{span:12,children:t.jsx(g.Item,{name:"email",label:"Email",rules:[{type:"email",message:"Email không hợp lệ"}],children:t.jsx(u,{placeholder:"Nhập email",size:"large"})})})]}),t.jsx(o,{gutter:16,children:t.jsx(h,{span:24,children:t.jsx(g.Item,{name:"address",label:"Địa chỉ",children:t.jsx(et,{placeholder:"Nhập địa chỉ",rows:3,size:"large"})})})}),t.jsxs(o,{gutter:16,children:[t.jsx(h,{span:12,children:t.jsx(g.Item,{name:"date_of_birth",label:"Ngày sinh",children:t.jsx(y,{placeholder:"Chọn ngày sinh",style:{width:"100%"},size:"large",format:"DD/MM/YYYY"})})}),t.jsx(h,{span:12,children:t.jsx(g.Item,{name:"gender",label:"Giới tính",children:t.jsxs(v,{placeholder:"Chọn giới tính",size:"large",children:[t.jsx(Je,{value:"male",children:"Nam"}),t.jsx(Je,{value:"female",children:"Nữ"}),t.jsx(Je,{value:"other",children:"Khác"})]})})})]}),t.jsx(o,{gutter:16,children:t.jsx(h,{span:24,children:t.jsx(g.Item,{name:"segment",label:"Phân khúc khách hàng",initialValue:"Regular",children:t.jsxs(v,{size:"large",children:[t.jsx(Je,{value:"Regular",children:"Khách hàng thường"}),t.jsx(Je,{value:"VIP",children:"Khách hàng VIP"}),t.jsx(Je,{value:"Premium",children:"Khách hàng Premium"}),t.jsx(Je,{value:"New",children:"Khách hàng mới"})]})})})}),t.jsxs(o,{gutter:16,style:{marginTop:24},children:[t.jsx(h,{span:12,children:t.jsx(x,{size:"large",block:!0,onClick:d,children:"Hủy"})}),t.jsx(h,{span:12,children:t.jsx(x,{type:"primary",size:"large",block:!0,htmlType:"submit",loading:r,icon:t.jsx(W,{}),children:r?"Đang tạo...":"Tạo khách hàng"})})]})]})})},{Title:nt,Text:st}=p,it=({visible:e,order:n,onClose:s,onPrintReceipt:i,onNewOrder:l})=>{if(!n)return null;const r=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e);return t.jsxs(c,{title:t.jsxs(m,{children:[t.jsx(te,{style:{color:"#52c41a"}}),t.jsx("span",{children:"Thanh toán thành công"})]}),open:e,onCancel:s,footer:null,width:500,className:"receipt-modal",children:[t.jsxs("div",{className:"receipt-content",style:{fontFamily:"monospace",lineHeight:1.6},children:[t.jsxs("div",{style:{textAlign:"center",marginBottom:24},children:[t.jsxs(nt,{level:3,style:{margin:0,color:"#1890ff"},children:[t.jsx(Q,{})," KhoChuan Store"]}),t.jsx(st,{type:"secondary",children:"123 Main Street, Ho Chi Minh City"}),t.jsx("br",{}),t.jsx(st,{type:"secondary",children:"Tel: +84 901 234 567"})]}),t.jsx(S,{style:{margin:"16px 0",borderStyle:"dashed"}}),t.jsxs(o,{gutter:[16,8],style:{marginBottom:16},children:[t.jsx(h,{span:12,children:t.jsxs(st,{strong:!0,children:["Hóa đơn: ",n.order_number]})}),t.jsx(h,{span:12,style:{textAlign:"right"},children:t.jsxs(st,{children:[t.jsx(Z,{})," ",He(n.created_at).format("DD/MM/YYYY HH:mm")]})}),t.jsx(h,{span:12,children:t.jsxs(st,{children:["Thu ngân: ",n.cashier_name]})}),t.jsx(h,{span:12,style:{textAlign:"right"},children:t.jsxs(st,{children:["Khu vực: ",n.location_name||"Main Store"]})})]}),n.customer_name&&t.jsxs(t.Fragment,{children:[t.jsx(S,{style:{margin:"12px 0"}}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsxs(st,{strong:!0,children:[t.jsx(J,{})," Khách hàng: ",n.customer_name]}),n.customer_phone&&t.jsx("div",{children:t.jsxs(st,{type:"secondary",children:["SĐT: ",n.customer_phone]})})]})]}),t.jsx(S,{style:{margin:"12px 0"}}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx(st,{strong:!0,children:"Chi tiết đơn hàng:"}),t.jsx("div",{style:{marginTop:8},children:n.items?.map((e,n)=>t.jsxs(o,{style:{marginBottom:8},children:[t.jsx(h,{span:12,children:t.jsxs("div",{children:[t.jsx(st,{strong:!0,children:e.product_name||e.name}),t.jsx("div",{children:t.jsx(st,{type:"secondary",style:{fontSize:"12px"},children:e.product_sku||e.sku})})]})}),t.jsx(h,{span:4,style:{textAlign:"center"},children:t.jsx(st,{children:e.quantity})}),t.jsx(h,{span:4,style:{textAlign:"right"},children:t.jsx(st,{children:r(e.unit_price||e.price)})}),t.jsx(h,{span:4,style:{textAlign:"right"},children:t.jsx(st,{strong:!0,children:r(e.total_price||e.price*e.quantity)})})]},n))})]}),t.jsx(S,{style:{margin:"12px 0",borderStyle:"dashed"}}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsxs(o,{justify:"space-between",style:{marginBottom:4},children:[t.jsx(h,{children:t.jsx(st,{children:"Tạm tính:"})}),t.jsx(h,{children:t.jsx(st,{children:r(n.subtotal)})})]}),n.tax_amount>0&&t.jsxs(o,{justify:"space-between",style:{marginBottom:4},children:[t.jsx(h,{children:t.jsx(st,{children:"Thuế VAT:"})}),t.jsx(h,{children:t.jsx(st,{children:r(n.tax_amount)})})]}),n.discount_amount>0&&t.jsxs(o,{justify:"space-between",style:{marginBottom:4},children:[t.jsx(h,{children:t.jsx(st,{children:"Giảm giá:"})}),t.jsx(h,{children:t.jsxs(st,{children:["-",r(n.discount_amount)]})})]}),t.jsx(S,{style:{margin:"8px 0"}}),t.jsxs(o,{justify:"space-between",children:[t.jsx(h,{children:t.jsx(st,{strong:!0,style:{fontSize:"16px"},children:"Tổng cộng:"})}),t.jsx(h,{children:t.jsx(st,{strong:!0,style:{fontSize:"16px"},children:r(n.total)})})]})]}),t.jsx(S,{style:{margin:"12px 0"}}),t.jsx("div",{style:{marginBottom:16},children:t.jsxs(o,{justify:"space-between",align:"middle",children:[t.jsx(h,{children:t.jsxs(m,{children:[t.jsx(ee,{}),t.jsxs(st,{children:[(a=n.payment_method,{cash:"💵",card:"💳",qr:"📱",mobile:"📲"}[a]||"💵")," ",(e=>({cash:"Tiền mặt",card:"Thẻ tín dụng",qr:"QR Code",mobile:"Ví điện tử"}[e]||"Tiền mặt"))(n.payment_method)]})]})}),t.jsx(h,{children:t.jsxs(m,{children:[t.jsx(te,{style:{color:"#52c41a"}}),t.jsx(st,{strong:!0,style:{color:"#52c41a"},children:"Đã thanh toán"})]})})]})}),t.jsx(S,{style:{margin:"12px 0",borderStyle:"dashed"}}),t.jsxs("div",{style:{textAlign:"center",marginBottom:16},children:[t.jsx(st,{type:"secondary",children:"Cảm ơn quý khách đã mua hàng!"}),t.jsx("br",{}),t.jsx(st,{type:"secondary",children:"Hẹn gặp lại quý khách lần sau."})]}),t.jsxs("div",{style:{textAlign:"center",marginBottom:16},children:[t.jsx(T,{value:`${window.location.origin}/receipt/${n.id}`,size:80}),t.jsx("div",{style:{marginTop:8},children:t.jsx(st,{type:"secondary",style:{fontSize:"12px"},children:"Quét QR để xem hóa đơn online"})})]})]}),t.jsx("div",{style:{marginTop:24},children:t.jsxs(o,{gutter:[8,8],children:[t.jsx(h,{span:8,children:t.jsx(x,{type:"primary",icon:t.jsx(ne,{}),onClick:()=>{i?.(n),window.print()},block:!0,children:"In hóa đơn"})}),n.customer_email&&t.jsx(h,{span:8,children:t.jsx(x,{icon:t.jsx(se,{}),onClick:()=>{c.info({title:"Gửi hóa đơn qua email",content:"Hóa đơn đã được gửi qua email thành công!"})},block:!0,children:"Gửi email"})}),t.jsx(h,{span:n.customer_email?8:16,children:t.jsx(x,{type:"default",icon:t.jsx(ie,{}),onClick:()=>{l?.(),s()},block:!0,children:"Đơn hàng mới"})})]})}),t.jsx("style",{jsx:!0,global:!0,children:"\n        @media print {\n          .receipt-modal .ant-modal-mask,\n          .receipt-modal .ant-modal-wrap {\n            position: static !important;\n          }\n          \n          .receipt-modal .ant-modal {\n            box-shadow: none !important;\n            padding: 0 !important;\n            margin: 0 !important;\n            max-width: none !important;\n            width: 100% !important;\n          }\n          \n          .receipt-modal .ant-modal-content {\n            box-shadow: none !important;\n            border-radius: 0 !important;\n          }\n          \n          .receipt-modal .ant-modal-header,\n          .receipt-modal .ant-modal-footer,\n          .receipt-modal .ant-btn {\n            display: none !important;\n          }\n          \n          .receipt-content {\n            padding: 0 !important;\n            font-size: 12px !important;\n          }\n        }\n      "})]});var a},{Search:lt}=u,{Option:rt}=v,{Title:at,Text:ct}=p,dt=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{user:s}=We(),[i,l]=e.useState(!1),[a,p]=e.useState([]),[j,y]=e.useState([]),[v,f]=e.useState([]),[T,E]=e.useState([]),[N,_]=e.useState([]),[P,D]=e.useState("all"),[O,M]=e.useState(""),[R,V]=e.useState(null),[z,B]=e.useState(!1),[H,F]=e.useState(!1),[L]=g.useForm(),[q,G]=e.useState(!1),[$,U]=e.useState(!1),[K,Y]=e.useState(!1),[W,Q]=e.useState(null);e.useEffect(()=>{Z(),te(),ne()},[]),e.useEffect(()=>{se()},[a,O,P]);const Z=async()=>{try{l(!0);const e=await Be.get("/products",{params:{page:1,limit:50}});e.data.success?p(e.data.data.products||[]):p(fe())}catch(e){p(fe())}finally{l(!1)}},te=async()=>{try{const e=await Be.get("/categories");e.data.success?f([{id:"all",name:"All Products"},...e.data.data.categories||[]]):f([{id:"all",name:"All Products"},...Se()])}catch(e){f([{id:"all",name:"All Products"},...Se()])}},ne=async()=>{try{const e=await Be.get("/customers",{params:{limit:100}});e.data.success?E(e.data.data.customers||[]):E(Te())}catch(e){E(Te())}},se=()=>{let e=a;O&&(e=e.filter(e=>e.name.toLowerCase().includes(O.toLowerCase())||e.sku?.toLowerCase().includes(O.toLowerCase())||e.barcode?.includes(O))),"all"!==P&&(e=e.filter(e=>e.category===P)),y(e)},xe=e.useCallback(e=>{_(t=>t.find(t=>t.id===e.id)?t.map(t=>t.id===e.id?{...t,quantity:t.quantity+1}:t):[...t,{...e,quantity:1}])},[]),me=e.useCallback((e,t)=>{t<=0?pe(e):_(n=>n.map(n=>n.id===e?{...n,quantity:t}:n))},[]),pe=e.useCallback(e=>{_(t=>t.filter(t=>t.id!==e))},[]),ue=e.useCallback(()=>{_([]),V(null)},[]),je=n.useMemo(()=>{const e=N.reduce((e,t)=>e+t.price*t.quantity,0),t=.1*e,n=R?.discount||0;return{subtotal:e,tax:t,discount:n,total:e+t-n}},[N,R]),ge=e.useCallback(async e=>{try{const t=a.find(t=>t.barcode===e||t.sku===e);if(t)return xe(t),void b.success({message:"Sản phẩm đã được thêm",description:`${t.name} đã được thêm vào giỏ hàng`});const n=await Be.get(`/products/${e}`);n.data.success?(xe(n.data.data),b.success({message:"Sản phẩm đã được thêm",description:`${n.data.data.name} đã được thêm vào giỏ hàng`})):b.error({message:"Không tìm thấy sản phẩm",description:"Không tìm thấy sản phẩm với mã vạch này"})}catch(t){b.error({message:"Lỗi",description:"Có lỗi xảy ra khi tìm sản phẩm"})}},[a,xe]),ye=e.useCallback(e=>{E(t=>[e,...t]),V(e),b.success({message:"Khách hàng đã được tạo",description:`${e.name} đã được thêm vào hệ thống`})},[]),ve=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e),fe=()=>[{id:1,name:"Coca Cola 330ml",price:12e3,category:"Beverages",stock:50,sku:"CC-330",barcode:"8934673123456"},{id:2,name:"Pepsi 330ml",price:11e3,category:"Beverages",stock:30,sku:"PP-330",barcode:"8934673123457"},{id:3,name:"Bánh mì sandwich",price:25e3,category:"Food",stock:20,sku:"BM-SW",barcode:"8934673123458"},{id:4,name:"Mì tôm Hảo Hảo",price:5e3,category:"Food",stock:100,sku:"MT-HH",barcode:"8934673123459"},{id:5,name:"Cà phê đen",price:2e4,category:"Beverages",stock:25,sku:"CF-BK",barcode:"8934673123460"}],Se=()=>[{id:1,name:"Beverages"},{id:2,name:"Food"},{id:3,name:"Snacks"}],Te=()=>[{id:1,name:"Nguyễn Văn A",phone:"0901234567",email:"nguyenvana@email.com"},{id:2,name:"Trần Thị B",phone:"0907654321",email:"tranthib@email.com"},{id:3,name:"Lê Văn C",phone:"0912345678",email:"levanc@email.com"}],be=[{title:"Name",dataIndex:"name",key:"name"},{title:"Phone",dataIndex:"phone",key:"phone"},{title:"Action",key:"action",render:e=>t.jsx(x,{type:"primary",size:"small",onClick:()=>{V(e),F(!1)},children:"Select"})}];return t.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column"},children:[t.jsx(r,{title:"KhoChuan POS Terminal",subtitle:`Cashier: ${s?.name} | ${(new Date).toLocaleString("vi-VN")}`,icon:"cart"}),t.jsxs("div",{style:{padding:"0 24px 24px",flex:1},children:[t.jsxs(o,{gutter:16,style:{flex:1},children:[t.jsx(h,{span:16,children:t.jsxs(d,{title:"Products",style:{height:"100%"},bodyStyle:{padding:0,height:"calc(100% - 57px)",display:"flex",flexDirection:"column"},children:[t.jsx("div",{style:{padding:"16px",borderBottom:"1px solid #f0f0f0"},children:t.jsxs(u.Group,{compact:!0,children:[t.jsx(lt,{placeholder:"Search products or scan barcode...",value:O,onChange:e=>M(e.target.value),onPressEnter:e=>{const t=e.target.value.trim();t.length>=8&&ge(t)},prefix:t.jsx(re,{}),enterButton:t.jsx(le,{}),size:"large",style:{width:"calc(100% - 50px)"}}),t.jsx(x,{type:"primary",icon:t.jsx(re,{}),size:"large",onClick:()=>G(!0),style:{width:"50px"},title:"Quét mã vạch"})]})}),t.jsx("div",{style:{padding:"16px",borderBottom:"1px solid #f0f0f0"},children:t.jsxs(m,{wrap:!0,children:[t.jsx(x,{type:"all"===P?"primary":"default",onClick:()=>D("all"),children:"All"}),v.map(e=>t.jsx(x,{type:P===e.name?"primary":"default",onClick:()=>D(e.name),children:e.name},e.id))]})}),t.jsx("div",{style:{flex:1,overflow:"auto",padding:"16px"},children:t.jsx(o,{gutter:[8,8],children:j.map(e=>t.jsx(h,{xs:12,sm:8,md:6,lg:4,children:t.jsxs(d,{hoverable:!0,size:"small",onClick:()=>xe(e),style:{height:"120px",cursor:"pointer",border:N.find(t=>t.id===e.id)?"2px solid #1890ff":"1px solid #d9d9d9"},bodyStyle:{padding:"8px",height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[t.jsx("div",{children:t.jsx(ct,{strong:!0,style:{fontSize:"12px",lineHeight:"14px"},children:e.name})}),t.jsxs("div",{children:[t.jsx(ct,{type:"primary",strong:!0,children:ve(e.price)}),t.jsx("div",{children:t.jsxs(ct,{type:"secondary",style:{fontSize:"10px"},children:["Stock: ",e.stock||0]})})]})]})},e.id))})})]})}),t.jsx(h,{span:8,children:t.jsxs(d,{title:t.jsxs(m,{children:[t.jsx(de,{}),t.jsxs("span",{children:["Cart (",N.length,")"]}),t.jsx(x,{icon:t.jsx(J,{}),onClick:()=>F(!0),type:R?"primary":"default",children:R?R.name:"Select Customer"}),t.jsx(x,{icon:t.jsx(oe,{}),onClick:ue,disabled:0===N.length,danger:!0,children:"Clear"})]}),style:{height:"100%"},bodyStyle:{padding:0,height:"calc(100% - 57px)",display:"flex",flexDirection:"column"},children:[t.jsx("div",{style:{flex:1,overflow:"auto",padding:"16px"},children:0===N.length?t.jsx(C,{description:"Cart is empty"}):N.map(e=>t.jsx(d,{size:"small",style:{marginBottom:8},children:t.jsxs(o,{align:"middle",children:[t.jsx(h,{span:12,children:t.jsxs("div",{children:[t.jsx(ct,{strong:!0,children:e.name}),t.jsx("div",{children:t.jsxs(ct,{type:"secondary",style:{fontSize:"12px"},children:[ve(e.price)," each"]})})]})}),t.jsx(h,{span:6,children:t.jsxs(m,{children:[t.jsx(x,{size:"small",icon:t.jsx(ae,{}),onClick:()=>me(e.id,e.quantity-1)}),t.jsx(ct,{children:e.quantity}),t.jsx(x,{size:"small",icon:t.jsx(ie,{}),onClick:()=>me(e.id,e.quantity+1)})]})}),t.jsx(h,{span:4,children:t.jsx(ct,{strong:!0,children:ve(e.price*e.quantity)})}),t.jsx(h,{span:2,children:t.jsx(x,{size:"small",icon:t.jsx(ce,{}),onClick:()=>pe(e.id),danger:!0})})]})},e.id))}),t.jsx("div",{style:{padding:"16px",borderTop:"1px solid #f0f0f0"},children:t.jsxs(m,{direction:"vertical",style:{width:"100%"},children:[t.jsxs(o,{justify:"space-between",children:[t.jsx(h,{children:"Subtotal:"}),t.jsx(h,{children:ve(je.subtotal)})]}),t.jsxs(o,{justify:"space-between",children:[t.jsx(h,{children:"Tax:"}),t.jsx(h,{children:ve(je.tax)})]}),t.jsxs(o,{justify:"space-between",children:[t.jsx(h,{children:"Discount:"}),t.jsx(h,{children:ve(je.discount)})]}),t.jsx(S,{style:{margin:"8px 0"}}),t.jsxs(o,{justify:"space-between",children:[t.jsx(h,{children:t.jsx(ct,{strong:!0,children:"Total:"})}),t.jsx(h,{children:t.jsx(ct,{strong:!0,style:{fontSize:"18px",color:"#1890ff"},children:ve(je.total)})})]})]})}),t.jsx("div",{style:{padding:"16px",borderTop:"1px solid #f0f0f0"},children:t.jsx(x,{type:"primary",size:"large",block:!0,icon:t.jsx(ee,{}),onClick:()=>B(!0),disabled:0===N.length,loading:i,children:"Checkout"})})]})})]}),t.jsx(k,{title:"Select Customer",placement:"right",onClose:()=>F(!1),open:H,width:400,children:t.jsxs(m,{direction:"vertical",style:{width:"100%"},children:[t.jsx(lt,{placeholder:"Search customers...",enterButton:"Search",size:"large"}),t.jsx(x,{type:"primary",icon:t.jsx(X,{}),onClick:()=>{U(!0),F(!1)},block:!0,style:{marginBottom:16},children:"Thêm khách hàng mới"}),t.jsx(I,{columns:be,dataSource:T,rowKey:"id",size:"small",pagination:{pageSize:10}}),t.jsx(x,{block:!0,onClick:()=>{V(null),F(!1)},children:"Continue without customer"})]})}),t.jsx(c,{title:"Payment",open:z,onCancel:()=>B(!1),footer:null,width:500,children:t.jsxs(g,{form:L,layout:"vertical",onFinish:async e=>{try{l(!0);const t={customer_id:R?.id||null,cashier_id:s.id,location_id:"loc-001",items:N.map(e=>({product_id:e.id,quantity:e.quantity,unit_price:e.price,discount_amount:0,total_price:e.price*e.quantity})),subtotal:je.subtotal,tax_amount:je.tax,discount_amount:je.discount,total:je.total,payment_method:e.method,notes:e.notes||"",metadata:{payment_method:e.method,cashier_name:s.name,customer_name:R?.name}},n=await Be.post("/orders",t);if(!n.data.success)throw new Error(n.data.message||"Có lỗi xảy ra khi xử lý đơn hàng");{const t={...n.data.data,items:N,customer_name:R?.name,customer_email:R?.email,customer_phone:R?.phone,cashier_name:s.name,location_name:"KhoChuan Store Main",payment_method:e.method};Q(t),Y(!0),ue(),B(!1),L.resetFields(),b.success({message:"Thanh toán thành công",description:`Đơn hàng #${n.data.data.order_number} đã được xử lý thành công!`})}}catch(t){b.error({message:"Payment Failed",description:t.message||"An error occurred while processing payment"})}finally{l(!1)}},children:[t.jsx(d,{size:"small",style:{marginBottom:16},children:t.jsxs(o,{justify:"space-between",children:[t.jsx(h,{children:t.jsx(ct,{strong:!0,children:"Total Amount:"})}),t.jsx(h,{children:t.jsx(ct,{strong:!0,style:{fontSize:"20px",color:"#1890ff"},children:ve(je.total)})})]})}),t.jsx(g.Item,{name:"method",label:"Payment Method",rules:[{required:!0,message:"Please select payment method"}],children:t.jsx(A.Group,{children:t.jsxs(m,{direction:"vertical",children:[t.jsx(A,{value:"cash",children:t.jsxs(m,{children:[t.jsx(he,{}),"Cash"]})}),t.jsx(A,{value:"card",children:t.jsxs(m,{children:[t.jsx(ee,{}),"Credit Card"]})}),t.jsx(A,{value:"qr",children:t.jsxs(m,{children:[t.jsx(re,{}),"QR Code"]})})]})})}),t.jsx(g.Item,{name:"amount",label:"Amount Received",rules:[{required:!0,message:"Please enter amount"}],initialValue:je.total,children:t.jsx(w,{style:{width:"100%"},formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),min:je.total})}),t.jsx(g.Item,{children:t.jsxs(m,{style:{width:"100%",justifyContent:"flex-end"},children:[t.jsx(x,{onClick:()=>B(!1),children:"Cancel"}),t.jsx(x,{type:"primary",htmlType:"submit",loading:i,children:"Process Payment"})]})})]})}),t.jsx(Ze,{visible:q,onClose:()=>G(!1),onScan:ge}),t.jsx(tt,{visible:$,onClose:()=>U(!1),onCustomerCreated:ye}),t.jsx(it,{visible:K,order:W,onClose:()=>Y(!1),onPrintReceipt:e=>{},onNewOrder:()=>{V(null),Q(null),setTimeout(()=>{const e=document.querySelector('.ant-input[placeholder*="Search"]');e&&e.focus()},100)}})]})]})}},Symbol.toStringTag,{value:"Module"})),{Title:ot,Text:ht}=p,{Search:xt}=u,{TabPane:mt}=O,pt=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[n,s]=e.useState([]),[i,l]=e.useState([]),[r,a]=e.useState([]),[p,u]=e.useState("all"),[j,g]=e.useState(""),[y,v]=e.useState([]),[T,b]=e.useState(!1),[C,A]=e.useState(null),[O,M]=e.useState("grid"),[R,V]=e.useState(!1),[z,B]=e.useState("cash"),[H,F]=e.useState(0),[L,q]=e.useState(!1);e.useEffect(()=>{setTimeout(()=>{const e=G(),t=[...new Set(e.map(e=>e.category))];l(e),v(e),a(t),q(!1)},1e3)},[]);const G=()=>[{id:1,name:"Laptop Dell Inspiron 15",price:15e6,category:"Laptop",image:"https://via.placeholder.com/80",barcode:"8935236799892",stock:25},{id:2,name:'Màn hình Dell 24"',price:35e5,category:"Màn hình",image:"https://via.placeholder.com/80",barcode:"8935236799893",stock:42},{id:3,name:"Chuột không dây Logitech",price:45e4,category:"Phụ kiện",image:"https://via.placeholder.com/80",barcode:"8935236799894",stock:78},{id:4,name:"Bàn phím cơ AKKO",price:12e5,category:"Phụ kiện",image:"https://via.placeholder.com/80",barcode:"8935236799895",stock:15},{id:5,name:"Laptop Acer Nitro 5",price:22e6,category:"Laptop",image:"https://via.placeholder.com/80",barcode:"8935236799896",stock:12},{id:6,name:"Tai nghe Sony WH-1000XM4",price:58e5,category:"Âm thanh",image:"https://via.placeholder.com/80",barcode:"8935236799897",stock:8},{id:7,name:"Máy tính để bàn HP Pavilion",price:18e6,category:"PC",image:"https://via.placeholder.com/80",barcode:"8935236799898",stock:10},{id:8,name:"SSD Samsung 1TB",price:25e5,category:"Linh kiện",image:"https://via.placeholder.com/80",barcode:"8935236799899",stock:35},{id:9,name:"RAM Kingston 16GB DDR4",price:15e5,category:"Linh kiện",image:"https://via.placeholder.com/80",barcode:"8935236799900",stock:28},{id:10,name:"Card đồ họa NVIDIA RTX 3060",price:95e5,category:"Linh kiện",image:"https://via.placeholder.com/80",barcode:"8935236799901",stock:5},{id:11,name:"Máy in HP LaserJet",price:42e5,category:"Máy in",image:"https://via.placeholder.com/80",barcode:"8935236799902",stock:7},{id:12,name:"Webcam Logitech C920",price:18e5,category:"Phụ kiện",image:"https://via.placeholder.com/80",barcode:"8935236799903",stock:15}];e.useEffect(()=>{let e=[...i];if("all"!==p&&(e=e.filter(e=>e.category===p)),j){const t=j.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.barcode.includes(t))}v(e)},[p,j,i]);const $=e=>{const t=n.find(t=>t.id===e.id);if(t){if(t.quantity>=e.stock)return void f.warning(`Chỉ còn ${e.stock} sản phẩm trong kho!`);s(n.map(t=>t.id===e.id?{...t,quantity:t.quantity+1}:t))}else{if(e.stock<=0)return void f.warning("Sản phẩm đã hết hàng!");s([...n,{...e,quantity:1}])}f.success(`Đã thêm ${e.name} vào giỏ hàng`)},U=(e,t)=>{const l=i.find(t=>t.id===e);t>l.stock?f.warning(`Chỉ còn ${l.stock} sản phẩm trong kho!`):s(t<=0?n.filter(t=>t.id!==e):n.map(n=>n.id===e?{...n,quantity:t}:n))},K=()=>n.reduce((e,t)=>e+t.price*t.quantity,0),Y=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e),X=[{title:"Sản phẩm",dataIndex:"name",key:"name",render:(e,n)=>t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx("img",{src:n.image,alt:e,style:{width:40,height:40,marginRight:10}}),t.jsxs("div",{children:[t.jsx("div",{children:e}),t.jsx("div",{style:{fontSize:"12px",color:"rgba(0, 0, 0, 0.45)"},children:n.barcode})]})]})},{title:"Giá",dataIndex:"price",key:"price",render:e=>Y(e)},{title:"Số lượng",dataIndex:"quantity",key:"quantity",render:(e,n)=>t.jsxs("div",{className:"quantity-control",children:[t.jsx(x,{icon:t.jsx(ae,{}),onClick:()=>U(n.id,n.quantity-1)}),t.jsx(w,{min:1,max:n.stock,value:e,onChange:e=>U(n.id,e)}),t.jsx(x,{icon:t.jsx(ie,{}),onClick:()=>U(n.id,n.quantity+1)})]})},{title:"Thành tiền",dataIndex:"price",key:"total",render:(e,t)=>Y(e*t.quantity)},{title:"",key:"action",render:(e,i)=>t.jsx(x,{type:"text",danger:!0,icon:t.jsx(ce,{}),onClick:()=>{return e=i.id,s(n.filter(t=>t.id!==e)),void f.success("Đã xóa sản phẩm khỏi giỏ hàng");var e}})}];return t.jsxs("div",{className:"pos-terminal",children:[t.jsxs(o,{gutter:[16,16],children:[t.jsx(h,{xs:24,lg:15,children:t.jsxs(d,{className:"full-height-card",children:[t.jsxs("div",{className:"pos-header",children:[t.jsx(ot,{level:4,children:"Bán hàng"}),t.jsxs(m,{children:[t.jsx(x,{icon:t.jsx(xe,{}),type:"grid"===O?"primary":"default",onClick:()=>M("grid")}),t.jsx(x,{icon:t.jsx(me,{}),type:"list"===O?"primary":"default",onClick:()=>M("list")})]})]}),t.jsx("div",{className:"pos-search-bar",children:t.jsx(xt,{placeholder:"Nhập tên hoặc quét mã vạch...",enterButton:t.jsx(le,{}),prefix:t.jsx(pe,{}),onChange:e=>g(e.target.value),value:j})}),t.jsxs("div",{className:"pos-categories",children:[t.jsx(x,{type:"all"===p?"primary":"default",onClick:()=>u("all"),children:"Tất cả"}),r.map(e=>t.jsx(x,{type:p===e?"primary":"default",onClick:()=>u(e),children:e},e))]}),t.jsx(S,{}),t.jsx("div",{className:"pos-products",children:"grid"===O?t.jsx(o,{gutter:[16,16],children:y.map(e=>t.jsx(h,{xs:12,sm:8,md:6,lg:6,xl:4,children:t.jsx(d,{hoverable:!0,cover:t.jsx("img",{alt:e.name,src:e.image,style:{height:100,objectFit:"contain"}}),onClick:()=>$(e),className:"product-card",children:t.jsxs("div",{className:"product-card-content",children:[t.jsx("div",{className:"product-card-title",children:e.name}),t.jsx("div",{className:"product-card-price",children:Y(e.price)}),t.jsx("div",{className:"product-card-stock",children:t.jsx(E,{status:e.stock>10?"success":e.stock>0?"warning":"error",text:`${e.stock} trong kho`})})]})})},e.id))}):(()=>{const e=[{title:"Sản phẩm",dataIndex:"name",key:"name",render:(e,n)=>t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx("img",{src:n.image,alt:e,style:{width:40,height:40,marginRight:10}}),t.jsxs("div",{children:[t.jsx("div",{children:e}),t.jsx("div",{style:{fontSize:"12px",color:"rgba(0, 0, 0, 0.45)"},children:n.barcode})]})]})},{title:"Danh mục",dataIndex:"category",key:"category",render:e=>t.jsx(D,{children:e})},{title:"Giá",dataIndex:"price",key:"price",render:e=>Y(e)},{title:"Tồn kho",dataIndex:"stock",key:"stock",render:e=>t.jsx(E,{status:e>10?"success":e>0?"warning":"error",text:e})},{title:"Thao tác",key:"action",render:(e,n)=>t.jsx(x,{type:"primary",size:"small",onClick:()=>$(n),disabled:n.stock<=0,children:"Thêm"})}];return t.jsx(I,{columns:e,dataSource:y,rowKey:"id",pagination:{pageSize:6}})})()})]})}),t.jsx(h,{xs:24,lg:9,children:t.jsxs(d,{className:"full-height-card cart-section",children:[t.jsxs("div",{className:"cart-header",children:[t.jsxs("div",{className:"cart-title",children:[t.jsx(de,{}),t.jsx("span",{children:"Giỏ hàng"}),t.jsx(E,{count:n.length,showZero:!0})]}),t.jsx("div",{className:"customer-section",children:t.jsx(x,{icon:t.jsx(J,{}),onClick:()=>b(!0),children:C?C.name:"Chọn khách hàng"})})]}),t.jsx("div",{className:"cart-content",children:0===n.length?t.jsxs("div",{className:"empty-cart",children:[t.jsx(ue,{style:{fontSize:48,color:"#d9d9d9"}}),t.jsx(ht,{type:"secondary",children:"Giỏ hàng trống"})]}):t.jsx(I,{columns:X,dataSource:n,rowKey:"id",pagination:!1,size:"small"})}),t.jsxs("div",{className:"cart-footer",children:[t.jsxs("div",{className:"cart-summary",children:[t.jsxs("div",{className:"cart-summary-row",children:[t.jsx(ht,{children:"Tổng sản phẩm:"}),t.jsxs(ht,{children:[n.reduce((e,t)=>e+t.quantity,0)," sản phẩm"]})]}),t.jsxs("div",{className:"cart-summary-row",children:[t.jsx(ht,{children:"Tổng tiền:"}),t.jsx(ht,{strong:!0,className:"total-amount",children:Y(K())})]}),C&&t.jsxs("div",{className:"cart-summary-row",children:[t.jsx(ht,{children:"Khách hàng:"}),t.jsxs(ht,{children:[C.name," (",C.points," điểm)"]})]})]}),t.jsxs("div",{className:"cart-actions",children:[t.jsx(x,{danger:!0,icon:t.jsx(ce,{}),onClick:()=>{c.confirm({title:"Xóa giỏ hàng",content:"Bạn có chắc chắn muốn xóa toàn bộ giỏ hàng?",okText:"Xóa",cancelText:"Hủy",onOk:()=>{s([]),f.success("Đã xóa toàn bộ giỏ hàng")}})},disabled:0===n.length,children:"Xóa tất cả"}),t.jsx(x,{type:"primary",icon:t.jsx(ee,{}),size:"large",onClick:()=>V(!0),disabled:0===n.length,children:"Thanh toán"})]})]})]})})]}),t.jsxs(k,{title:"Chọn khách hàng",placement:"right",onClose:()=>b(!1),visible:T,width:400,children:[t.jsx("div",{style:{marginBottom:16},children:t.jsx(xt,{placeholder:"Tìm kiếm theo tên hoặc SĐT",enterButton:!0})}),t.jsx(N,{itemLayout:"horizontal",dataSource:[{id:1,name:"Nguyễn Văn A",phone:"0912345678",points:120},{id:2,name:"Trần Thị B",phone:"0923456789",points:85},{id:3,name:"Lê Văn C",phone:"0934567890",points:210},{id:4,name:"Phạm Thị D",phone:"0945678901",points:45},{id:5,name:"Hoàng Văn E",phone:"0956789012",points:150}],renderItem:e=>t.jsx(N.Item,{actions:[t.jsx(x,{type:"primary",size:"small",onClick:()=>{return A(t=e),b(!1),void f.success(`Đã chọn khách hàng: ${t.name}`);var t},children:"Chọn"})],children:t.jsx(N.Item.Meta,{avatar:t.jsx(_,{icon:t.jsx(J,{})}),title:e.name,description:t.jsxs("div",{children:[t.jsxs("div",{children:["SĐT: ",e.phone]}),t.jsxs("div",{children:["Điểm tích lũy: ",e.points]})]})})})})]}),t.jsx(c,{title:"Thanh toán",visible:R,onCancel:()=>V(!1),footer:null,width:600,children:t.jsxs("div",{className:"checkout-modal",children:[t.jsxs("div",{className:"checkout-summary",children:[t.jsx(ot,{level:4,children:"Tổng quan đơn hàng"}),t.jsxs("div",{className:"checkout-items",children:[t.jsxs("div",{className:"checkout-item-header",children:[t.jsx(ht,{strong:!0,children:"Sản phẩm"}),t.jsx(ht,{strong:!0,children:"SL"}),t.jsx(ht,{strong:!0,children:"Thành tiền"})]}),n.map(e=>t.jsxs("div",{className:"checkout-item",children:[t.jsx(ht,{children:e.name}),t.jsx(ht,{children:e.quantity}),t.jsx(ht,{children:Y(e.price*e.quantity)})]},e.id))]}),t.jsx(S,{}),t.jsxs("div",{className:"checkout-total",children:[t.jsx(ht,{strong:!0,children:"Tổng tiền:"}),t.jsx(ht,{strong:!0,className:"checkout-total-amount",children:Y(K())})]}),C&&t.jsxs("div",{className:"checkout-customer",children:[t.jsxs(ht,{children:["Khách hàng: ",C.name]}),t.jsxs(ht,{children:["Điểm tích lũy: ",C.points]})]})]}),t.jsxs("div",{className:"payment-section",children:[t.jsx(ot,{level:4,children:"Phương thức thanh toán"}),t.jsxs("div",{className:"payment-methods",children:[t.jsxs("div",{className:"payment-method-selection",children:[t.jsx(x,{type:"cash"===z?"primary":"default",icon:t.jsx(he,{}),size:"large",onClick:()=>B("cash"),children:"Tiền mặt"}),t.jsx(x,{type:"card"===z?"primary":"default",icon:t.jsx(ee,{}),size:"large",onClick:()=>B("card"),children:"Thẻ"})]}),"cash"===z&&t.jsxs("div",{className:"cash-payment",children:[t.jsxs("div",{className:"amount-input",children:[t.jsx(ht,{children:"Tiền khách đưa:"}),t.jsx(w,{style:{width:"100%"},formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),size:"large",min:K(),onChange:F})]}),t.jsxs("div",{className:"change-amount",children:[t.jsx(ht,{children:"Tiền thối lại:"}),t.jsx(ht,{strong:!0,children:Y((()=>{const e=K();return H>e?H-e:0})())})]})]})]}),t.jsxs("div",{className:"payment-actions",children:[t.jsx(x,{onClick:()=>V(!1),children:"Hủy"}),t.jsx(x,{type:"primary",icon:t.jsx(je,{}),size:"large",loading:L,onClick:()=>{q(!0),setTimeout(()=>{f.success("Thanh toán thành công!"),s([]),A(null),V(!1),q(!1)},1500)},children:"Hoàn tất thanh toán"}),t.jsx(P,{title:"Lưu đơn chờ",children:t.jsx(x,{icon:t.jsx(W,{}),onClick:()=>{f.success("Đã lưu đơn hàng chờ"),V(!1)},children:"Lưu"})}),t.jsx(P,{title:"In hóa đơn",children:t.jsx(x,{icon:t.jsx(ne,{}),onClick:()=>f.info("Đang in hóa đơn..."),children:"In"})})]})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),{Text:ut,Title:jt}=p,{TabPane:gt}=O,{useBreakpoint:yt}=M,vt=Object.freeze(Object.defineProperty({__proto__:null,default:({onAddToCart:n,suggestions:s=[]})=>{const[i,l]=e.useState([]),[r,a]=e.useState([]),[c,p]=e.useState(!1),[j,g]=e.useState(""),[y,S]=e.useState("all"),[T,b]=e.useState("name"),[k,I]=e.useState("grid"),[A,N]=e.useState([0,1e6]),[_,P]=e.useState({}),[M,z]=e.useState(new Set);yt();const B=[{id:"all",name:"Tất cả",icon:t.jsx(xe,{}),color:"#1890ff"},{id:"food",name:"Thực phẩm",icon:"🍎",color:"#52c41a"},{id:"drinks",name:"Đồ uống",icon:"🥤",color:"#13c2c2"},{id:"snacks",name:"Snacks",icon:"🍿",color:"#faad14"},{id:"personal",name:"Cá nhân",icon:"🧴",color:"#722ed1"},{id:"household",name:"Gia dụng",icon:"🏠",color:"#fa541c"},{id:"electronics",name:"Điện tử",icon:"📱",color:"#2f54eb"},{id:"hot",name:"Bán chạy",icon:t.jsx(ge,{}),color:"#f5222d"}],H=[{id:1,name:"Coca Cola 330ml",price:15e3,category:"drinks",image:"/api/placeholder/200/200",barcode:"8934567890123",stock:150,description:"Nước ngọt có ga Coca Cola",tags:["Bán chạy","Mới"],discount:0,rating:4.5,isHot:!0},{id:2,name:"Bánh mì sandwich",price:25e3,category:"food",image:"/api/placeholder/200/200",barcode:"8934567890124",stock:50,description:"Bánh mì sandwich thịt nguội",tags:["Tươi sống"],discount:10,rating:4.2},{id:3,name:"Nước suối Lavie 500ml",price:8e3,category:"drinks",image:"/api/placeholder/200/200",barcode:"8934567890125",stock:200,description:"Nước suối tinh khiết Lavie",tags:[],discount:0,rating:4},{id:4,name:"Snack khoai tây Lays",price:12e3,category:"snacks",image:"/api/placeholder/200/200",barcode:"8934567890126",stock:80,description:"Snack khoai tây chiên vị tự nhiên",tags:["Giòn tan"],discount:5,rating:4.3,isHot:!0},{id:5,name:"Dầu gội Head & Shoulders",price:85e3,category:"personal",image:"/api/placeholder/200/200",barcode:"8934567890127",stock:25,description:"Dầu gội chống gàu 400ml",tags:["Chăm sóc"],discount:15,rating:4.4},{id:6,name:"iPhone Lightning Cable",price:45e4,category:"electronics",image:"/api/placeholder/200/200",barcode:"8934567890128",stock:15,description:"Cáp sạc iPhone Lightning chính hãng",tags:["Chính hãng"],discount:0,rating:4.8}];e.useEffect(()=>{F(),L()},[]);const F=async()=>{p(!0);try{setTimeout(()=>{l(H),p(!1)},500)}catch(e){f.error("Lỗi khi tải sản phẩm"),p(!1)}},L=()=>{a(B)},q=e.useMemo(()=>{let e=i;return"all"!==y&&(e="hot"===y?e.filter(e=>e.isHot):e.filter(e=>e.category===y)),j&&(e=e.filter(e=>e.name.toLowerCase().includes(j.toLowerCase())||e.barcode.includes(j)||e.description.toLowerCase().includes(j.toLowerCase()))),e=e.filter(e=>e.price>=A[0]&&e.price<=A[1]),e.sort((e,t)=>{switch(T){case"name":return e.name.localeCompare(t.name);case"price-low":return e.price-t.price;case"price-high":return t.price-e.price;case"stock":return t.stock-e.stock;case"rating":return(t.rating||0)-(e.rating||0);case"hot":return(t.isHot?1:0)-(e.isHot?1:0);default:return 0}}),e},[i,y,j,A,T]),G=({product:e})=>{const s=_[e.id]||1,i=e.discount>0?e.price*(1-e.discount/100):e.price;return t.jsx(d,{className:"product-card",hoverable:!0,cover:t.jsxs("div",{className:"product-image-container",children:[t.jsx(V,{src:e.image,alt:e.name,preview:!1,fallback:"/api/placeholder/200/200"}),t.jsxs("div",{className:"product-badges",children:[e.isHot&&t.jsx(E,{count:t.jsx(ge,{style:{color:"#f5222d"}})}),e.discount>0&&t.jsxs(D,{color:"red",className:"discount-tag",children:["-",e.discount,"%"]})]}),t.jsx("div",{className:"product-overlay",children:t.jsxs(m,{children:[t.jsx(x,{type:"primary",ghost:!0,icon:t.jsx(ve,{}),size:"small",onClick:e=>{e.stopPropagation(),f.info("Chi tiết sản phẩm")}}),t.jsx(x,{type:M.has(e.id)?"primary":"default",ghost:!0,icon:t.jsx(fe,{}),size:"small",onClick:t=>{var n;t.stopPropagation(),n=e.id,z(e=>{const t=new Set(e);return t.has(n)?(t.delete(n),f.info("Đã xóa khỏi yêu thích")):(t.add(n),f.success("Đã thêm vào yêu thích")),t})}})]})})]}),actions:[t.jsx("div",{className:"quantity-selector",children:t.jsx(w,{min:1,max:e.stock,value:s,onChange:t=>((e,t)=>{P(n=>({...n,[e]:t||1}))})(e.id,t),size:"small",style:{width:60}})},"quantity"),t.jsx(x,{type:"primary",icon:t.jsx(de,{}),onClick:()=>((e,t=1)=>{e.stock<t?f.warning("Không đủ tồn kho!"):(n(e,t),P(t=>({...t,[e.id]:1})))})(e,s),disabled:0===e.stock,block:!0,children:"Thêm"},"add")],children:t.jsx(d.Meta,{title:t.jsxs("div",{children:[t.jsx(ut,{strong:!0,ellipsis:{tooltip:e.name},children:e.name}),e.rating&&t.jsx("div",{style:{marginTop:4},children:t.jsxs(m,{size:"small",children:[t.jsx(ye,{style:{color:"#faad14"}}),t.jsx(ut,{type:"secondary",style:{fontSize:"12px"},children:e.rating})]})})]}),description:t.jsxs("div",{children:[t.jsx("div",{className:"product-price",children:e.discount>0?t.jsxs(m,{children:[t.jsxs(ut,{strong:!0,style:{color:"#f5222d"},children:[i.toLocaleString("vi-VN")," ₫"]}),t.jsxs(ut,{delete:!0,type:"secondary",style:{fontSize:"12px"},children:[e.price.toLocaleString("vi-VN")," ₫"]})]}):t.jsxs(ut,{strong:!0,style:{color:"#52c41a"},children:[e.price.toLocaleString("vi-VN")," ₫"]})}),t.jsx("div",{className:"product-stock",children:t.jsxs(ut,{type:"secondary",style:{fontSize:"12px"},children:["Tồn: ",e.stock]})}),e.tags.length>0&&t.jsx("div",{className:"product-tags",style:{marginTop:4},children:e.tags.slice(0,2).map(e=>t.jsx(D,{size:"small",color:"blue",children:e},e))})]})})})};return t.jsxs("div",{className:"product-selector",children:[t.jsx(d,{size:"small",className:"product-filters",children:t.jsxs(o,{gutter:[16,16],align:"middle",children:[t.jsx(h,{xs:24,sm:12,md:8,children:t.jsx(u,{placeholder:"Tìm sản phẩm...",prefix:t.jsx(le,{}),value:j,onChange:e=>g(e.target.value),allowClear:!0})}),t.jsx(h,{xs:12,sm:6,md:4,children:t.jsxs(v,{placeholder:"Sắp xếp",value:T,onChange:b,style:{width:"100%"},children:[t.jsx(v.Option,{value:"name",children:"Tên A-Z"}),t.jsx(v.Option,{value:"price-low",children:"Giá thấp"}),t.jsx(v.Option,{value:"price-high",children:"Giá cao"}),t.jsx(v.Option,{value:"stock",children:"Tồn kho"}),t.jsx(v.Option,{value:"rating",children:"Đánh giá"}),t.jsx(v.Option,{value:"hot",children:"Bán chạy"})]})}),t.jsx(h,{xs:12,sm:6,md:4,children:t.jsxs(x.Group,{children:[t.jsx(x,{type:"grid"===k?"primary":"default",icon:t.jsx(xe,{}),onClick:()=>I("grid")}),t.jsx(x,{type:"list"===k?"primary":"default",icon:t.jsx(me,{}),onClick:()=>I("list")})]})}),t.jsx(h,{xs:24,md:8,children:t.jsxs(ut,{type:"secondary",children:["Hiển thị ",q.length," / ",i.length," sản phẩm"]})})]})}),t.jsx(d,{size:"small",style:{marginTop:16},children:t.jsx("div",{className:"category-tabs",children:t.jsx(O,{activeKey:y,onChange:S,type:"card",size:"small",children:r.map(e=>t.jsx(gt,{tab:t.jsxs(m,{children:["string"==typeof e.icon?t.jsx("span",{style:{fontSize:"16px"},children:e.icon}):e.icon,e.name]})},e.id))})})}),t.jsx("div",{style:{marginTop:16},children:c?t.jsxs("div",{style:{textAlign:"center",padding:"50px 0"},children:[t.jsx(R,{size:"large"}),t.jsx("div",{style:{marginTop:16},children:t.jsx(ut,{children:"Đang tải sản phẩm..."})})]}):0===q.length?t.jsx(C,{description:"Không tìm thấy sản phẩm",image:C.PRESENTED_IMAGE_SIMPLE}):t.jsx(o,{gutter:[16,16],children:q.map(e=>t.jsx(h,{xs:12,sm:8,md:6,lg:6,xl:4,children:t.jsx(G,{product:e})},e.id))})}),t.jsx("div",{className:"product-quick-stats",style:{marginTop:16},children:t.jsxs(o,{gutter:16,children:[t.jsx(h,{span:6,children:t.jsx(d,{size:"small",children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(ut,{type:"secondary",children:"Tổng sản phẩm"}),t.jsx("div",{children:t.jsx(ut,{strong:!0,style:{fontSize:"18px"},children:i.length})})]})})}),t.jsx(h,{span:6,children:t.jsx(d,{size:"small",children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(ut,{type:"secondary",children:"Bán chạy"}),t.jsx("div",{children:t.jsx(ut,{strong:!0,style:{fontSize:"18px",color:"#f5222d"},children:i.filter(e=>e.isHot).length})})]})})}),t.jsx(h,{span:6,children:t.jsx(d,{size:"small",children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(ut,{type:"secondary",children:"Giảm giá"}),t.jsx("div",{children:t.jsx(ut,{strong:!0,style:{fontSize:"18px",color:"#faad14"},children:i.filter(e=>e.discount>0).length})})]})})}),t.jsx(h,{span:6,children:t.jsx(d,{size:"small",children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(ut,{type:"secondary",children:"Sắp hết"}),t.jsx("div",{children:t.jsx(ut,{strong:!0,style:{fontSize:"18px",color:"#ff7875"},children:i.filter(e=>e.stock<10).length})})]})})})]})})]})}},Symbol.toStringTag,{value:"Module"})),ft=e.createContext(),St=(e,t={})=>{const{currency:n="VND",locale:s="vi-VN",maximumFractionDigits:i=0,minimumFractionDigits:l=0}=t;return new Intl.NumberFormat(s,{style:"currency",currency:n,maximumFractionDigits:i,minimumFractionDigits:l}).format(e||0)};const Tt=new class{constructor(){this.connected=!1,this.callbacks=[],this.mockScannerInterval=null,this.testBarcodes=["8900001","8900002","8900003","8900004","8900005"]}connect(){return this.connected||setTimeout(()=>{this.connected=!0},500),!0}disconnect(){return!!this.connected&&(this.connected=!1,this.mockScannerInterval&&(clearInterval(this.mockScannerInterval),this.mockScannerInterval=null),!0)}onScan(e){if("function"!=typeof e)throw new Error("Callback must be a function");return this.callbacks.push(e),this.callbacks.length-1}offScan(e){return!(e<0||e>=this.callbacks.length)&&(this.callbacks.splice(e,1),!0)}mockScan(e){this.connected&&this.callbacks.forEach(t=>{try{t(e)}catch(n){}})}startDemo(e=5e3){this.mockScannerInterval&&clearInterval(this.mockScannerInterval),this.connect(),this.mockScannerInterval=setInterval(()=>{const e=Math.floor(Math.random()*this.testBarcodes.length);this.mockScan(this.testBarcodes[e])},e)}stopDemo(){this.mockScannerInterval&&(clearInterval(this.mockScannerInterval),this.mockScannerInterval=null)}},{Title:bt,Text:Ct}=p,{Search:kt}=u,{Option:It}=v,At=Object.freeze(Object.defineProperty({__proto__:null,default:({onCheckout:n,onCustomerSelect:s})=>{const{items:i,addItem:l,removeItem:r,updateQuantity:a,clearCart:c,applyDiscount:p,totalAmount:u,totalItems:j,totalDiscount:g,netAmount:y}=(()=>{const t=e.useContext(ft);if(void 0===t)throw new Error("useCartContext must be used within a CartProvider");return t})(),[T,b]=e.useState(""),[k,A]=e.useState(""),[E,N]=e.useState("percent"),[_,O]=e.useState(0),[M,R]=e.useState([]),[V,B]=e.useState(!1),[H,F]=e.useState(!1);e.useEffect(()=>{const e=e=>{f.info(`Đã quét mã: ${e}`),q(e)};return V?(Tt.connect(),Tt.onScan(e)):Tt.disconnect(),()=>{Tt.disconnect()}},[V]);const L=[{id:"1",name:"Laptop Dell XPS 13",price:25e6,barcode:"8900001",inStock:15},{id:"2",name:"Chuột không dây Logitech",price:45e4,barcode:"8900002",inStock:45},{id:"3",name:"Bàn phím cơ AKKO",price:12e5,barcode:"8900003",inStock:23},{id:"4",name:"Tai nghe Sony WH-1000XM4",price:45e5,barcode:"8900004",inStock:8},{id:"5",name:"Màn hình LG 27 inch 4K",price:65e5,barcode:"8900005",inStock:12}],q=e=>{F(!0),b(e),setTimeout(()=>{const t=L.filter(t=>t.barcode===e||t.name.toLowerCase().includes(e.toLowerCase()));R(t),F(!1),V&&1===t.length&&G(t[0])},500)},G=e=>{e.inStock<=0?f.error(`Sản phẩm ${e.name} đã hết hàng!`):(l({id:e.id,name:e.name,price:e.price,quantity:1,discount:0,maxQuantity:e.inStock}),f.success(`Đã thêm ${e.name} vào giỏ hàng`))},$=[{title:"Sản phẩm",dataIndex:"name",key:"name",ellipsis:!0},{title:"Đơn giá",dataIndex:"price",key:"price",render:e=>St(e),width:120},{title:"SL",dataIndex:"quantity",key:"quantity",width:80,render:(e,n)=>t.jsx(w,{min:1,max:n.maxQuantity,value:e,onChange:e=>((e,t)=>{const n=i.find(t=>t.id===e);if(n){if(t<=0)return void f.error("Số lượng phải lớn hơn 0");t>n.maxQuantity&&(f.warning(`Chỉ còn ${n.maxQuantity} sản phẩm trong kho!`),t=n.maxQuantity),a(e,t)}})(n.id,e),size:"small"})},{title:"Thành tiền",key:"total",width:120,render:(e,t)=>St(t.price*t.quantity)},{title:"",key:"action",width:60,render:(e,n)=>t.jsx(m,{children:t.jsx(z,{title:"Xóa sản phẩm này?",onConfirm:()=>r(n.id),okText:"Xóa",cancelText:"Hủy",children:t.jsx(x,{type:"text",danger:!0,icon:t.jsx(ce,{}),size:"small"})})})}],K=[{title:"Sản phẩm",dataIndex:"name",key:"name",ellipsis:!0},{title:"Giá",dataIndex:"price",key:"price",render:e=>St(e),width:120},{title:"Tồn kho",dataIndex:"inStock",key:"inStock",width:80,render:e=>t.jsx(D,{color:e>0?"green":"red",children:e})},{title:"",key:"action",width:60,render:(e,n)=>t.jsx(x,{type:"primary",size:"small",icon:t.jsx(ie,{}),onClick:()=>G(n),disabled:n.inStock<=0,children:"Thêm"})}];return t.jsx("div",{className:"cart-manager",children:t.jsxs(o,{gutter:[16,16],children:[t.jsx(h,{xs:24,md:16,children:t.jsxs(d,{title:t.jsxs(m,{children:[t.jsx(de,{}),t.jsx("span",{children:"Giỏ hàng"}),t.jsxs(D,{color:"blue",children:[j," sản phẩm"]})]}),extra:t.jsxs(m,{children:[t.jsx(x,{type:"primary",danger:!0,icon:t.jsx(ce,{}),onClick:()=>(c(),void f.info("Đã xóa giỏ hàng")),disabled:0===i.length,children:"Xóa giỏ hàng"}),t.jsx(x,{type:"primary",icon:t.jsx(W,{}),disabled:0===i.length,children:"Lưu giỏ hàng"})]}),children:[0===i.length?t.jsx(C,{description:"Giỏ hàng trống"}):t.jsx(I,{columns:$,dataSource:i.map(e=>({...e,key:e.id})),pagination:!1,size:"small",scroll:{y:300}}),t.jsx("div",{style:{marginTop:16},children:t.jsx(o,{justify:"end",children:t.jsx(h,{xs:24,md:12,lg:8,children:t.jsx(d,{size:"small",children:t.jsxs(m,{direction:"vertical",style:{width:"100%"},children:[t.jsxs(o,{justify:"space-between",children:[t.jsx(h,{children:"Tổng tiền:"}),t.jsx(h,{children:t.jsx(Ct,{strong:!0,children:St(u)})})]}),t.jsxs(o,{justify:"space-between",children:[t.jsx(h,{children:"Chiết khấu:"}),t.jsx(h,{children:t.jsxs(Ct,{type:"danger",children:["- ",St(g)]})})]}),t.jsx(S,{style:{margin:"8px 0"}}),t.jsxs(o,{justify:"space-between",children:[t.jsx(h,{children:t.jsx(Ct,{strong:!0,children:"Thành tiền:"})}),t.jsx(h,{children:t.jsx(Ct,{strong:!0,style:{fontSize:18},children:St(y)})})]}),t.jsx(S,{style:{margin:"8px 0"}}),t.jsxs(o,{gutter:8,children:[t.jsx(h,{span:8,children:t.jsxs(v,{value:E,onChange:N,style:{width:"100%"},size:"small",children:[t.jsx(It,{value:"percent",children:"%"}),t.jsx(It,{value:"amount",children:"VND"})]})}),t.jsx(h,{span:10,children:t.jsx(w,{min:0,max:"percent"===E?100:void 0,value:_,onChange:O,style:{width:"100%"},size:"small",addonAfter:"percent"===E?"%":void 0,formatter:"amount"===E?e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","):void 0,parser:"amount"===E?e=>e.replace(/\$\s?|(,*)/g,""):void 0})}),t.jsx(h,{span:6,children:t.jsx(x,{type:"primary",size:"small",icon:t.jsx(Se,{}),onClick:()=>{_<0?f.error("Giá trị chiết khấu không hợp lệ"):"percent"===E&&_>100?f.error("Giá trị chiết khấu không được vượt quá 100%"):"amount"===E&&_>u?f.error("Giá trị chiết khấu không được vượt quá tổng số tiền"):(p({type:E,value:_}),f.success("Đã áp dụng chiết khấu"))},style:{width:"100%"},disabled:0===i.length,children:"Áp dụng"})})]}),t.jsx(x,{type:"primary",block:!0,size:"large",onClick:()=>{0!==i.length?"function"==typeof n&&n({items:i,totalAmount:u,totalDiscount:g,netAmount:y}):f.error("Giỏ hàng trống!")},disabled:0===i.length,style:{marginTop:16},children:"Thanh toán"})]})})})})})]})}),t.jsx(h,{xs:24,md:8,children:t.jsx(d,{title:t.jsxs(m,{children:[t.jsx(Te,{}),t.jsx("span",{children:"Tìm kiếm sản phẩm"})]}),extra:t.jsx(P,{title:V?"Tắt máy quét":"Bật máy quét",children:t.jsx(x,{type:V?"primary":"default",icon:V?t.jsx(U,{}):t.jsx(Te,{}),onClick:()=>B(!V)})}),children:t.jsxs(m,{direction:"vertical",style:{width:"100%"},children:[t.jsx(kt,{placeholder:"Nhập tên hoặc mã vạch",enterButton:"Tìm kiếm",value:T,onChange:e=>b(e.target.value),onSearch:q,loading:H,allowClear:!0}),t.jsx(I,{columns:K,dataSource:M.map(e=>({...e,key:e.id})),pagination:!1,size:"small",scroll:{y:300},locale:{emptyText:"Không có sản phẩm"}})]})})})]})})}},Symbol.toStringTag,{value:"Module"}));const wt=new class{constructor(){this.connected=!1,this.printers=[{id:"thermal1",name:"EPSON TM-T82 (Thermal)",type:"thermal",status:"ready",default:!0},{id:"thermal2",name:"XPRINTER XP-58 (Thermal)",type:"thermal",status:"ready",default:!1},{id:"laser1",name:"HP LaserJet Pro",type:"laser",status:"ready",default:!1}],this.selectedPrinter=this.printers[0]}getAvailablePrinters(){return this.printers}selectPrinter(e){const t=this.printers.find(t=>t.id===e);return t?(this.selectedPrinter=t,t):null}getSelectedPrinter(){return this.selectedPrinter}connect(){return new Promise(e=>{setTimeout(()=>{this.connected=!0,e(!0)},800)})}disconnect(){return new Promise(e=>{this.connected?setTimeout(()=>{this.connected=!1,e(!0)},500):e(!1)})}print(e={}){return new Promise((t,n)=>{const{content:s,type:i="receipt"}=e;this.connected?this._doPrint(s,i).then(t).catch(n):this.connect().then(()=>this._doPrint(s,i)).then(t).catch(n)})}_doPrint(e,t){return new Promise((t,n)=>{e?setTimeout(()=>{if(Math.random()>.1)t({success:!0,printerId:this.selectedPrinter.id,timestamp:(new Date).toISOString()});else{const e=["Paper jam","Out of paper","Low ink","Connection lost","Printer busy"],t=e[Math.floor(Math.random()*e.length)];n(new Error(`Print failed: ${t}`))}},2e3):n(new Error("No content to print"))})}checkStatus(){return new Promise(e=>{setTimeout(()=>{const t=["ready","ready","ready","ready","low_paper","low_ink","ready"],n=t[Math.floor(Math.random()*t.length)],s={...this.selectedPrinter,status:n};this.selectedPrinter=s,this.printers=this.printers.map(e=>e.id===s.id?s:e),e(s)},500)})}},{Title:Et,Text:Nt}=p,{Step:_t}=B,{Option:Pt}=v,Dt=Object.freeze(Object.defineProperty({__proto__:null,default:({orderData:n,onComplete:s,onCancel:i})=>{const[l]=g.useForm(),[r,a]=e.useState(0),[c,p]=e.useState(!1),[j,y]=e.useState("idle"),[v,T]=e.useState("cash"),[b,C]=e.useState(0),[k,I]=e.useState("idle"),[E,N]=e.useState(null),_=[{value:"cash",label:"Tiền mặt",icon:t.jsx(he,{})},{value:"card",label:"Thẻ tín dụng/ghi nợ",icon:t.jsx(ee,{})},{value:"momo",label:"Ví MoMo",icon:t.jsx(be,{})},{value:"vnpay",label:"VNPay",icon:t.jsx(re,{})},{value:"zalopay",label:"ZaloPay",icon:t.jsx(be,{})},{value:"bank_transfer",label:"Chuyển khoản",icon:t.jsx(pe,{})}],P=[1e4,2e4,5e4,1e5,2e5,5e5];e.useEffect(()=>{n&&n.netAmount&&(C(n.netAmount),l.setFieldsValue({amount:n.netAmount,paymentMethod:"cash"}))},[n,l]);const D=e=>{C(e);const t=e-(n?.netAmount||0);l.setFieldsValue({changeAmount:t>0?t:0})},O=()=>{const e=n?.netAmount||0;C(e),D(e)},M=async e=>{y("processing"),p(!0);try{await new Promise(e=>setTimeout(e,1500));const t={id:`HD${Date.now().toString().slice(-6)}`,date:(new Date).toLocaleString(),items:n.items,totalAmount:n.totalAmount,totalDiscount:n.totalDiscount,netAmount:n.netAmount,paymentMethod:e.paymentMethod,cashAmount:e.cashAmount,changeAmount:e.changeAmount,customerName:e.customerName||"Khách lẻ",customerPhone:e.customerPhone||"",cashier:"Nguyễn Văn A"};N(t),y("success"),a(1),f.success("Thanh toán thành công!")}catch(t){y("error"),f.error("Có lỗi xảy ra khi xử lý thanh toán!")}finally{p(!1)}},R=async()=>{if(E){I("printing");try{await wt.connect(),await new Promise(e=>setTimeout(e,1500)),await wt.printReceipt(E),I("success"),f.success("Đã in hóa đơn thành công!")}catch(e){I("error"),f.error("Có lỗi xảy ra khi in hóa đơn!")}}},V=()=>{"function"==typeof s&&s({...E,status:"completed"})},z=()=>{"function"==typeof i&&i()};return t.jsxs("div",{className:"payment-processor",children:[t.jsxs(B,{current:r,style:{marginBottom:24},children:[t.jsx(_t,{title:"Thanh toán",description:"Nhập thông tin thanh toán"}),t.jsx(_t,{title:"Hoàn thành",description:"Xử lý hóa đơn"})]}),t.jsx("div",{className:"steps-content",children:(()=>{switch(r){case 0:return t.jsxs(g,{form:l,layout:"vertical",onFinish:M,initialValues:{paymentMethod:"cash",amount:n?.netAmount||0},children:[t.jsxs(d,{className:"order-summary",size:"small",style:{marginBottom:16},children:[t.jsxs(F,{title:"Thông tin đơn hàng",size:"small",column:2,children:[t.jsx(F.Item,{label:"Số sản phẩm",children:n?.items?.length||0}),t.jsx(F.Item,{label:"Tổng số lượng",children:n?.items?.reduce((e,t)=>e+t.quantity,0)||0}),t.jsx(F.Item,{label:"Tổng tiền",children:St(n?.totalAmount||0)}),t.jsx(F.Item,{label:"Chiết khấu",children:St(n?.totalDiscount||0)})]}),t.jsx(S,{style:{margin:"12px 0"}}),t.jsxs("div",{style:{textAlign:"right"},children:[t.jsx(Nt,{type:"secondary",children:"Thành tiền:"}),t.jsx(Et,{level:3,style:{margin:0},children:St(n?.netAmount||0)})]})]}),t.jsx(d,{title:"Thông tin khách hàng",size:"small",style:{marginBottom:16},children:t.jsxs(o,{gutter:16,children:[t.jsx(h,{span:12,children:t.jsx(g.Item,{name:"customerName",label:"Tên khách hàng",children:t.jsx(u,{prefix:t.jsx(J,{}),placeholder:"Khách lẻ"})})}),t.jsx(h,{span:12,children:t.jsx(g.Item,{name:"customerPhone",label:"Số điện thoại",children:t.jsx(u,{prefix:t.jsx(be,{}),placeholder:"Số điện thoại"})})})]})}),t.jsxs(d,{title:"Phương thức thanh toán",size:"small",style:{marginBottom:16},children:[t.jsx(g.Item,{name:"paymentMethod",rules:[{required:!0,message:"Vui lòng chọn phương thức thanh toán!"}],children:t.jsx(A.Group,{onChange:e=>{return t=e.target.value,T(t),void("cash"===t?l.setFieldsValue({cashAmount:n?.netAmount||0,cardNumber:void 0,cardHolderName:void 0,cardExpiry:void 0,cardCVC:void 0}):l.setFieldsValue({cashAmount:void 0,changeAmount:void 0}));var t},buttonStyle:"solid",style:{width:"100%"},children:t.jsx(m,{direction:"vertical",style:{width:"100%"},children:_.map(e=>t.jsxs(A.Button,{value:e.value,style:{width:"100%",height:"40px",lineHeight:"32px"},children:[e.icon," ",e.label]},e.value))})})}),t.jsxs("div",{className:"payment-details",children:["cash"===v&&t.jsxs(t.Fragment,{children:[t.jsxs(o,{gutter:16,children:[t.jsx(h,{span:12,children:t.jsx(g.Item,{label:"Số tiền khách đưa",name:"cashAmount",rules:[{required:!0,message:"Vui lòng nhập số tiền khách đưa!"},{validator:(e,t)=>t<(n?.netAmount||0)?Promise.reject("Số tiền không đủ!"):Promise.resolve()}],children:t.jsx(w,{style:{width:"100%"},formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),min:n?.netAmount||0,step:1e4,value:b,onChange:D})})}),t.jsx(h,{span:12,children:t.jsx(g.Item,{label:"Tiền thừa",name:"changeAmount",children:t.jsx(w,{style:{width:"100%"},formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),disabled:!0})})})]}),t.jsxs("div",{style:{marginTop:16},children:[t.jsx(Nt,{strong:!0,children:"Chọn mệnh giá:"}),t.jsx("div",{style:{marginTop:8},children:t.jsxs(m,{wrap:!0,children:[P.map(e=>t.jsx(x,{onClick:()=>(e=>{const t=(b||0)+e;C(t),D(t)})(e),children:St(e)},e)),t.jsx(x,{type:"primary",ghost:!0,onClick:O,children:"Tiền chẵn"})]})})]})]}),"card"===v&&t.jsxs(o,{gutter:16,children:[t.jsx(h,{span:24,children:t.jsx(g.Item,{label:"Số thẻ",name:"cardNumber",rules:[{required:!0,message:"Vui lòng nhập số thẻ!"}],children:t.jsx(u,{placeholder:"Số thẻ",maxLength:19})})}),t.jsx(h,{span:24,children:t.jsx(g.Item,{label:"Tên chủ thẻ",name:"cardHolderName",rules:[{required:!0,message:"Vui lòng nhập tên chủ thẻ!"}],children:t.jsx(u,{placeholder:"Tên chủ thẻ"})})}),t.jsx(h,{span:12,children:t.jsx(g.Item,{label:"Hạn thẻ",name:"cardExpiry",rules:[{required:!0,message:"Vui lòng nhập hạn thẻ!"}],children:t.jsx(u,{placeholder:"MM/YY",maxLength:5})})}),t.jsx(h,{span:12,children:t.jsx(g.Item,{label:"CVC/CVV",name:"cardCVC",rules:[{required:!0,message:"Vui lòng nhập mã CVC/CVV!"}],children:t.jsx(u,{placeholder:"CVC/CVV",maxLength:4})})})]}),("momo"===v||"vnpay"===v||"zalopay"===v)&&t.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[t.jsx(re,{style:{fontSize:100,marginBottom:16}}),t.jsx(Et,{level:4,children:"Quét mã QR để thanh toán"}),t.jsxs(Nt,{type:"secondary",children:["Số tiền: ",St(n?.netAmount||0)]}),t.jsx("br",{}),t.jsxs(Nt,{type:"secondary",children:["Sử dụng ứng dụng ","momo"===v?"MoMo":"vnpay"===v?"VNPay":"ZaloPay"," để quét mã"]}),t.jsx(g.Item,{name:"transactionId",label:"Mã giao dịch",style:{marginTop:16},children:t.jsx(u,{placeholder:"Nhập mã giao dịch (nếu có)"})})]}),"bank_transfer"===v&&t.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:t.jsxs(m,{direction:"vertical",children:[t.jsx(Nt,{strong:!0,children:"Thông tin chuyển khoản"}),t.jsxs(F,{column:1,children:[t.jsx(F.Item,{label:"Tên tài khoản",children:"CONG TY TNHH TRUONG PHAT"}),t.jsx(F.Item,{label:"Số tài khoản",children:"0123456789"}),t.jsx(F.Item,{label:"Ngân hàng",children:"Vietcombank - CN Hòa Bình"}),t.jsx(F.Item,{label:"Số tiền",children:St(n?.netAmount||0)}),t.jsxs(F.Item,{label:"Nội dung",children:["THANHTOAN HD",Date.now().toString().slice(-6)]})]}),t.jsx(re,{style:{fontSize:100,margin:"16px 0"}}),t.jsx(g.Item,{name:"transactionId",label:"Mã giao dịch",children:t.jsx(u,{placeholder:"Nhập mã giao dịch ngân hàng"})})]})})]})]}),t.jsx(d,{title:"Ghi chú",size:"small",style:{marginBottom:16},children:t.jsx(g.Item,{name:"note",children:t.jsx(u.TextArea,{rows:2,placeholder:"Ghi chú cho đơn hàng (nếu có)"})})}),t.jsx(g.Item,{children:t.jsxs(m,{style:{width:"100%",justifyContent:"space-between"},children:[t.jsx(x,{type:"default",onClick:z,icon:t.jsx(Ce,{}),children:"Quay lại"}),t.jsx(x,{type:"primary",htmlType:"submit",loading:"processing"===j,icon:t.jsx(te,{}),children:"Xác nhận thanh toán"})]})})]});case 1:return t.jsx("div",{className:"payment-completion",children:t.jsx(H,{status:"success",title:"Thanh toán thành công!",subTitle:`Mã hóa đơn: ${E?.id||"HD000000"} - ${E?.date||(new Date).toLocaleString()}`,extra:[t.jsx(x,{type:"primary",onClick:R,loading:"printing"===k,icon:t.jsx(ne,{}),children:"In hóa đơn"},"print"),t.jsx(x,{onClick:V,icon:t.jsx(te,{}),children:"Hoàn thành"},"complete"),t.jsx(x,{type:"default",icon:t.jsx(de,{}),onClick:V,children:"Đơn hàng mới"},"new")],children:t.jsx("div",{className:"receipt-summary",children:t.jsxs(d,{title:"Chi tiết hóa đơn",style:{marginTop:16},children:[t.jsxs(F,{column:2,children:[t.jsx(F.Item,{label:"Khách hàng",children:E?.customerName||"Khách lẻ"}),t.jsx(F.Item,{label:"Số điện thoại",children:E?.customerPhone||"N/A"}),t.jsx(F.Item,{label:"Phương thức thanh toán",children:_.find(e=>e.value===E?.paymentMethod)?.label||"Tiền mặt"}),t.jsx(F.Item,{label:"Thu ngân",children:E?.cashier||"N/A"})]}),t.jsx(S,{style:{margin:"12px 0"}}),t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:[t.jsx("th",{style:{padding:"8px",textAlign:"left"},children:"Sản phẩm"}),t.jsx("th",{style:{padding:"8px",textAlign:"right"},children:"SL"}),t.jsx("th",{style:{padding:"8px",textAlign:"right"},children:"Đơn giá"}),t.jsx("th",{style:{padding:"8px",textAlign:"right"},children:"Thành tiền"})]})}),t.jsx("tbody",{children:E?.items?.map((e,n)=>t.jsxs("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:[t.jsx("td",{style:{padding:"8px",textAlign:"left"},children:e.name}),t.jsx("td",{style:{padding:"8px",textAlign:"right"},children:e.quantity}),t.jsx("td",{style:{padding:"8px",textAlign:"right"},children:St(e.price)}),t.jsx("td",{style:{padding:"8px",textAlign:"right"},children:St(e.price*e.quantity)})]},n))})]}),t.jsx(S,{style:{margin:"12px 0"}}),t.jsx(o,{children:t.jsx(h,{span:12,offset:12,children:t.jsxs(m,{direction:"vertical",style:{width:"100%"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(Nt,{children:"Tổng tiền:"}),t.jsx(Nt,{children:St(E?.totalAmount||0)})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(Nt,{children:"Chiết khấu:"}),t.jsxs(Nt,{type:"danger",children:["- ",St(E?.totalDiscount||0)]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(Nt,{strong:!0,children:"Thành tiền:"}),t.jsx(Nt,{strong:!0,children:St(E?.netAmount||0)})]}),"cash"===E?.paymentMethod&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(Nt,{children:"Tiền khách đưa:"}),t.jsx(Nt,{children:St(E?.cashAmount||0)})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(Nt,{children:"Tiền thừa:"}),t.jsx(Nt,{children:St(E?.changeAmount||0)})]})]})]})})})]})})})});default:return null}})()})]})}},Symbol.toStringTag,{value:"Module"})),{Title:Ot,Text:Mt,Paragraph:Rt}=p,{Option:Vt}=v,zt=Object.freeze(Object.defineProperty({__proto__:null,default:({orderData:n,visible:i,onClose:l,customerInfo:r})=>{const[a,p]=e.useState("thermal"),[u,j]=e.useState(!1),[y,T]=e.useState(!1),[b,C]=e.useState(!1),[k,I]=e.useState(!1),[w,E]=e.useState([{label:"Máy in nhiệt EPSON TM-T82",value:"thermal1"},{label:"Máy in nhiệt XPRINTER XP-58",value:"thermal2"},{label:"Máy in thường HP LaserJet Pro",value:"laser1"}]),[N,_]=e.useState("thermal1"),D=e.useRef(),O=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e),M=e=>{const t=new Date(e);return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},V=()=>n?.items?.reduce((e,t)=>e+t.price*t.quantity,0)||0,z=s.useReactToPrint({content:()=>D.current,onBeforeprint:()=>{T(!0),C(!1),I(!1)},onAfterPrint:()=>{setTimeout(()=>{T(!1),C(!0),u&&n?.customer?.email&&f.success(`Đã gửi hóa đơn điện tử đến ${n.customer.email}`)},1500)},onError:()=>{T(!1),I(!0)}});e.useEffect(()=>{i||(T(!1),C(!1),I(!1))},[i]);return t.jsx(c,{title:t.jsxs(t.Fragment,{children:[t.jsx(ne,{})," In hóa đơn"]}),open:i,onCancel:l,width:800,footer:null,destroyOnClose:!0,children:b?t.jsx(H,{status:"success",title:"In hóa đơn thành công!",subTitle:"Hóa đơn đã được gửi đến máy in",extra:[t.jsx(x,{onClick:()=>C(!1),children:"In hóa đơn khác"},"print-another"),t.jsx(x,{type:"primary",onClick:l,children:"Đóng"},"close")]}):k?t.jsx(H,{status:"error",title:"Lỗi khi in hóa đơn!",subTitle:"Không thể kết nối với máy in. Vui lòng kiểm tra lại kết nối máy in.",extra:[t.jsx(x,{onClick:()=>I(!1),children:"Thử lại"},"try-again"),t.jsx(x,{type:"primary",onClick:l,children:"Đóng"},"close")]}):y?t.jsxs("div",{style:{textAlign:"center",padding:"50px 0"},children:[t.jsx(R,{size:"large"}),t.jsx("p",{style:{marginTop:20},children:"Đang in hóa đơn..."})]}):t.jsx("div",{style:{padding:"0 20px"},children:t.jsxs(o,{gutter:[24,24],children:[t.jsx(h,{span:8,children:t.jsxs(d,{title:"Tùy chọn in",size:"small",children:[t.jsxs(g,{layout:"vertical",children:[t.jsx(g.Item,{label:"Loại hóa đơn",children:t.jsx(A.Group,{value:a,onChange:e=>p(e.target.value),style:{width:"100%"},children:t.jsxs(m,{direction:"vertical",style:{width:"100%"},children:[t.jsx(A,{value:"thermal",children:t.jsx(Mt,{children:"Hóa đơn nhiệt (80mm)"})}),t.jsx(A,{value:"a4",children:t.jsx(Mt,{children:"Hóa đơn A4"})})]})})}),t.jsx(g.Item,{label:"Máy in",children:t.jsx(v,{value:N,onChange:e=>_(e),style:{width:"100%"},children:w.map(e=>t.jsx(Vt,{value:e.value,children:e.label},e.value))})}),t.jsx(g.Item,{label:"Tùy chọn khác",children:t.jsxs(m,{direction:"vertical",style:{width:"100%"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(Mt,{children:"Gửi qua email"}),t.jsx(L,{checked:u,onChange:j,disabled:!n?.customer?.email})]}),!n?.customer?.email&&t.jsx(Mt,{type:"secondary",style:{fontSize:"12px"},children:"Khách hàng không có email"})]})})]}),t.jsx(S,{style:{margin:"12px 0"}}),t.jsx(m,{style:{width:"100%"},children:t.jsx(x,{type:"primary",icon:t.jsx(ne,{}),onClick:z,block:!0,children:"In hóa đơn"})}),t.jsxs(m,{style:{width:"100%",marginTop:"10px"},children:[t.jsx(P,{title:"Lưu dưới dạng PDF",children:t.jsx(x,{icon:t.jsx(ke,{}),children:"PDF"})}),t.jsx(P,{title:"Gửi qua email",children:t.jsx(x,{icon:t.jsx(se,{}),disabled:!n?.customer?.email,children:"Email"})}),t.jsx(P,{title:"Lưu về máy tính",children:t.jsx(x,{icon:t.jsx(Ie,{}),children:"Lưu"})})]})]})}),t.jsx(h,{span:16,children:t.jsx(d,{title:"Xem trước hóa đơn",size:"small",style:{maxHeight:"600px",overflow:"auto"},children:t.jsx("div",{style:{background:"#f0f2f5",padding:"20px",display:"flex",justifyContent:"center"},children:"thermal"===a?t.jsxs("div",{ref:D,className:"thermal-receipt",style:{width:"80mm",padding:"10mm 5mm",margin:"0 auto",backgroundColor:"white",fontFamily:"monospace",fontSize:"12px",boxShadow:"0 0 10px rgba(0,0,0,0.1)"},children:[t.jsxs("div",{style:{textAlign:"center",marginBottom:"10px"},children:[t.jsx("h1",{style:{margin:"0",fontSize:"16px",fontWeight:"bold"},children:"TRƯỜNG PHÁT COMPUTER"}),t.jsx("p",{style:{margin:"5px 0"},children:"Hòa Bình, Việt Nam"}),t.jsx("p",{style:{margin:"5px 0"},children:"Hotline: 0836.768.597"}),t.jsx("p",{style:{margin:"5px 0"},children:"MST: 5400 111 222"})]}),t.jsxs("div",{style:{textAlign:"center",marginBottom:"10px",borderBottom:"1px dashed #000",paddingBottom:"10px"},children:[t.jsx("h2",{style:{margin:"0",fontSize:"14px",fontWeight:"bold"},children:"HÓA ĐƠN BÁN HÀNG"}),t.jsxs("p",{style:{margin:"5px 0"},children:["Số: ",n?.id||"POS-00001"]}),t.jsxs("p",{style:{margin:"5px 0"},children:["Ngày: ",M(n?.date||new Date)]})]}),n?.customer&&t.jsxs("div",{style:{marginBottom:"10px",borderBottom:"1px dashed #000",paddingBottom:"10px"},children:[t.jsxs("p",{style:{margin:"3px 0"},children:[t.jsx("strong",{children:"Khách hàng:"})," ",n.customer.name]}),t.jsxs("p",{style:{margin:"3px 0"},children:[t.jsx("strong",{children:"SĐT:"})," ",n.customer.phone]}),n.customer.address&&t.jsxs("p",{style:{margin:"3px 0"},children:[t.jsx("strong",{children:"Địa chỉ:"})," ",n.customer.address]})]}),t.jsx("div",{style:{marginBottom:"10px"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{borderBottom:"1px dashed #000"},children:[t.jsx("th",{style:{textAlign:"left",paddingBottom:"5px"},children:"Mặt hàng"}),t.jsx("th",{style:{textAlign:"right",paddingBottom:"5px"},children:"SL"}),t.jsx("th",{style:{textAlign:"right",paddingBottom:"5px"},children:"Đ.Giá"}),t.jsx("th",{style:{textAlign:"right",paddingBottom:"5px"},children:"T.Tiền"})]})}),t.jsx("tbody",{children:n?.items?.map((e,n)=>t.jsxs("tr",{style:{borderBottom:"1px dotted #ccc"},children:[t.jsx("td",{style:{textAlign:"left",paddingTop:"5px",paddingBottom:"5px"},children:e.name}),t.jsx("td",{style:{textAlign:"right",paddingTop:"5px",paddingBottom:"5px"},children:e.quantity}),t.jsx("td",{style:{textAlign:"right",paddingTop:"5px",paddingBottom:"5px"},children:O(e.price)}),t.jsx("td",{style:{textAlign:"right",paddingTop:"5px",paddingBottom:"5px"},children:O(e.price*e.quantity)})]},n))})]})}),t.jsxs("div",{style:{marginBottom:"10px",borderBottom:"1px dashed #000",paddingBottom:"10px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",margin:"5px 0"},children:[t.jsx("span",{children:"Tổng tiền hàng:"}),t.jsx("span",{children:O(V())})]}),n?.discount>0&&t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",margin:"5px 0"},children:[t.jsx("span",{children:"Giảm giá:"}),t.jsxs("span",{children:["-",O(n.discount)]})]}),n?.tax>0&&t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",margin:"5px 0"},children:[t.jsx("span",{children:"Thuế (VAT 10%):"}),t.jsx("span",{children:O(n.tax)})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",margin:"5px 0",fontWeight:"bold"},children:[t.jsx("span",{children:"Thanh toán:"}),t.jsx("span",{children:O(n?.total||0)})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",margin:"5px 0"},children:[t.jsx("span",{children:"Tiền khách đưa:"}),t.jsx("span",{children:O(n?.amountPaid||0)})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",margin:"5px 0"},children:[t.jsx("span",{children:"Tiền thừa:"}),t.jsx("span",{children:O((n?.amountPaid||0)-(n?.total||0))})]})]}),t.jsxs("div",{style:{marginBottom:"10px",borderBottom:"1px dashed #000",paddingBottom:"10px"},children:[t.jsxs("p",{style:{margin:"3px 0"},children:[t.jsx("strong",{children:"Phương thức:"})," ",n?.paymentMethod||"Tiền mặt"]}),t.jsxs("p",{style:{margin:"3px 0"},children:[t.jsx("strong",{children:"Thu ngân:"})," ",n?.cashier||"Nguyễn Văn A"]})]}),t.jsxs("div",{style:{textAlign:"center",marginBottom:"10px"},children:[t.jsx("p",{style:{margin:"5px 0"},children:"Cảm ơn Quý khách đã mua hàng!"}),t.jsx("p",{style:{margin:"5px 0"},children:"Hẹn gặp lại quý khách!"}),n?.id&&t.jsx("div",{style:{margin:"10px auto",width:"100px",height:"100px"},children:t.jsx(Fe,{value:`https://truongphat.com/invoice/${n.id}`,size:100,renderAs:"svg",level:"H"})}),t.jsx("p",{style:{margin:"5px 0",fontSize:"10px"},children:"Truy cập website: truongphat.com"}),t.jsx("p",{style:{margin:"5px 0",fontSize:"10px"},children:"Hotline: 0836.768.597"})]})]}):t.jsxs("div",{ref:D,className:"a4-receipt",style:{width:"210mm",padding:"20mm",margin:"0 auto",backgroundColor:"white",fontFamily:"Arial, sans-serif",boxShadow:"0 0 10px rgba(0,0,0,0.1)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"20px"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{margin:"0",fontSize:"24px"},children:"TRƯỜNG PHÁT COMPUTER"}),t.jsx("p",{style:{margin:"5px 0"},children:"Địa chỉ: Hòa Bình, Việt Nam"}),t.jsx("p",{style:{margin:"5px 0"},children:"Hotline: 0836.768.597"}),t.jsx("p",{style:{margin:"5px 0"},children:"Email: contact@truongphat.com"}),t.jsx("p",{style:{margin:"5px 0"},children:"MST: 5400 111 222"})]}),t.jsxs("div",{style:{textAlign:"right"},children:[t.jsx("h2",{style:{margin:"0",fontSize:"20px",color:"#1890ff"},children:"HÓA ĐƠN"}),t.jsxs("p",{style:{margin:"5px 0"},children:[t.jsx("strong",{children:"Số:"})," ",n?.id||"POS-00001"]}),t.jsxs("p",{style:{margin:"5px 0"},children:[t.jsx("strong",{children:"Ngày:"})," ",M(n?.date||new Date)]})]})]}),t.jsx(S,{style:{margin:"10px 0"}}),t.jsxs("div",{style:{marginBottom:"20px"},children:[t.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Thông tin khách hàng"}),t.jsxs("div",{style:{display:"flex"},children:[t.jsxs("div",{style:{flex:"1"},children:[t.jsxs("p",{style:{margin:"5px 0"},children:[t.jsx("strong",{children:"Khách hàng:"})," ",n?.customer?.name||"Khách lẻ"]}),t.jsxs("p",{style:{margin:"5px 0"},children:[t.jsx("strong",{children:"SĐT:"})," ",n?.customer?.phone||"N/A"]})]}),t.jsxs("div",{style:{flex:"1"},children:[t.jsxs("p",{style:{margin:"5px 0"},children:[t.jsx("strong",{children:"Địa chỉ:"})," ",n?.customer?.address||"N/A"]}),t.jsxs("p",{style:{margin:"5px 0"},children:[t.jsx("strong",{children:"Email:"})," ",n?.customer?.email||"N/A"]})]})]})]}),t.jsxs("div",{style:{marginBottom:"20px"},children:[t.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Chi tiết đơn hàng"}),t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:"#f0f0f0"},children:[t.jsx("th",{style:{border:"1px solid #ddd",padding:"8px",textAlign:"left"},children:"STT"}),t.jsx("th",{style:{border:"1px solid #ddd",padding:"8px",textAlign:"left"},children:"Mặt hàng"}),t.jsx("th",{style:{border:"1px solid #ddd",padding:"8px",textAlign:"right"},children:"Đơn giá"}),t.jsx("th",{style:{border:"1px solid #ddd",padding:"8px",textAlign:"center"},children:"SL"}),t.jsx("th",{style:{border:"1px solid #ddd",padding:"8px",textAlign:"right"},children:"Thành tiền"})]})}),t.jsx("tbody",{children:n?.items?.map((e,n)=>t.jsxs("tr",{children:[t.jsx("td",{style:{border:"1px solid #ddd",padding:"8px",textAlign:"left"},children:n+1}),t.jsx("td",{style:{border:"1px solid #ddd",padding:"8px",textAlign:"left"},children:e.name}),t.jsx("td",{style:{border:"1px solid #ddd",padding:"8px",textAlign:"right"},children:O(e.price)}),t.jsx("td",{style:{border:"1px solid #ddd",padding:"8px",textAlign:"center"},children:e.quantity}),t.jsx("td",{style:{border:"1px solid #ddd",padding:"8px",textAlign:"right"},children:O(e.price*e.quantity)})]},n))})]})]}),t.jsxs("div",{style:{marginBottom:"20px",textAlign:"right"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",margin:"5px 0"},children:[t.jsx("span",{style:{width:"150px",textAlign:"left"},children:"Tổng tiền hàng:"}),t.jsx("span",{style:{width:"150px"},children:O(V())})]}),n?.discount>0&&t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",margin:"5px 0"},children:[t.jsx("span",{style:{width:"150px",textAlign:"left"},children:"Giảm giá:"}),t.jsxs("span",{style:{width:"150px"},children:["-",O(n.discount)]})]}),n?.tax>0&&t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",margin:"5px 0"},children:[t.jsx("span",{style:{width:"150px",textAlign:"left"},children:"Thuế (VAT 10%):"}),t.jsx("span",{style:{width:"150px"},children:O(n.tax)})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",margin:"5px 0",fontWeight:"bold",fontSize:"16px"},children:[t.jsx("span",{style:{width:"150px",textAlign:"left"},children:"Thanh toán:"}),t.jsx("span",{style:{width:"150px"},children:O(n?.total||0)})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",margin:"5px 0"},children:[t.jsx("span",{style:{width:"150px",textAlign:"left"},children:"Tiền khách đưa:"}),t.jsx("span",{style:{width:"150px"},children:O(n?.amountPaid||0)})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",margin:"5px 0"},children:[t.jsx("span",{style:{width:"150px",textAlign:"left"},children:"Tiền thừa:"}),t.jsx("span",{style:{width:"150px"},children:O((n?.amountPaid||0)-(n?.total||0))})]})]}),t.jsx(S,{style:{margin:"10px 0"}}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"30px"},children:[t.jsxs("div",{style:{textAlign:"center",flex:"1"},children:[t.jsx("p",{style:{fontWeight:"bold"},children:"Người mua hàng"}),t.jsx("p",{style:{fontStyle:"italic",fontSize:"12px"},children:"(Ký, ghi rõ họ tên)"}),t.jsx("div",{style:{height:"70px"}}),t.jsx("p",{children:n?.customer?.name||""})]}),t.jsxs("div",{style:{textAlign:"center",flex:"1"},children:[t.jsx("p",{style:{fontWeight:"bold"},children:"Người bán hàng"}),t.jsx("p",{style:{fontStyle:"italic",fontSize:"12px"},children:"(Ký, ghi rõ họ tên)"}),t.jsx("div",{style:{height:"70px"}}),t.jsx("p",{children:n?.cashier||"Nguyễn Văn A"})]})]}),t.jsxs("div",{style:{marginTop:"30px",borderTop:"1px dashed #ddd",paddingTop:"10px",textAlign:"center"},children:[t.jsx("p",{style:{margin:"5px 0"},children:"Cảm ơn Quý khách đã mua hàng tại Trường Phát Computer!"}),t.jsx("p",{style:{margin:"5px 0"},children:"Mọi thắc mắc vui lòng liên hệ: 0836.768.597 | contact@truongphat.com"}),t.jsx("p",{style:{margin:"5px 0"},children:"Website: truongphat.com"}),t.jsx("div",{style:{margin:"10px auto",display:"flex",justifyContent:"center"},children:n?.id&&t.jsx("div",{style:{margin:"0 auto",width:"100px",height:"100px"},children:t.jsx(Fe,{value:`https://truongphat.com/invoice/${n.id}`,size:100,renderAs:"svg",level:"H"})})})]})]})})})})]})})})}},Symbol.toStringTag,{value:"Module"})),{Title:Bt,Text:Ht,Paragraph:Ft}=p,Lt=Object.freeze(Object.defineProperty({__proto__:null,default:({currentCart:n=[],onAddItem:s,customerData:i=null,visible:l=!0,refreshSuggestions:r=()=>{},loading:a=!1})=>{const[c,p]=e.useState([]),[u,j]=e.useState([]),[g,y]=e.useState(!0),[v,f]=e.useState("cart"),T={cart:[{id:101,name:"Chuột không dây Logitech M185",image:"https://via.placeholder.com/50",price:25e4,originalPrice:29e4,rating:4.5,reason:"Người mua laptop thường mua thêm",inStock:15},{id:102,name:"Bàn di chuột size L",image:"https://via.placeholder.com/50",price:9e4,originalPrice:12e4,rating:4.2,reason:"Phụ kiện đi kèm phổ biến",inStock:22},{id:103,name:'Túi đựng laptop 15.6"',image:"https://via.placeholder.com/50",price:35e4,originalPrice:4e5,rating:4.8,reason:"Bảo vệ laptop của bạn",inStock:8},{id:104,name:"Đèn LED USB",image:"https://via.placeholder.com/50",price:7e4,originalPrice:9e4,rating:4,reason:"Tiện dụng khi làm việc đêm",inStock:30}],customer:[{id:201,name:"SSD Samsung 250GB",image:"https://via.placeholder.com/50",price:12e5,originalPrice:15e5,rating:4.9,reason:"Dựa trên lịch sử mua hàng",inStock:12},{id:202,name:"Bàn phím cơ E-DRA EK387",image:"https://via.placeholder.com/50",price:85e4,originalPrice:95e4,rating:4.7,reason:"Khách hàng quan tâm gần đây",inStock:5},{id:203,name:"Webcam Logitech C270",image:"https://via.placeholder.com/50",price:55e4,originalPrice:7e5,rating:4.3,reason:"Sản phẩm tương tự đã mua",inStock:9}],trending:[{id:301,name:"Tai nghe gaming Logitech G Pro X",image:"https://via.placeholder.com/50",price:28e5,originalPrice:32e5,rating:4.8,reason:"Bán chạy tuần này",inStock:7},{id:302,name:"USB Kingston 64GB",image:"https://via.placeholder.com/50",price:18e4,originalPrice:22e4,rating:4.5,reason:"Sản phẩm phổ biến",inStock:42},{id:303,name:"Dây cáp HDMI 2.0",image:"https://via.placeholder.com/50",price:12e4,originalPrice:15e4,rating:4.6,reason:"Đang giảm giá",inStock:20}]},b=[{id:"bundle1",name:"Bộ phụ kiện laptop cơ bản",discount:15,items:[{id:101,name:"Chuột không dây Logitech M185",image:"https://via.placeholder.com/50",price:25e4},{id:102,name:"Bàn di chuột size L",image:"https://via.placeholder.com/50",price:9e4},{id:103,name:'Túi đựng laptop 15.6"',image:"https://via.placeholder.com/50",price:35e4}],originalPrice:69e4,bundlePrice:586500},{id:"bundle2",name:"Bộ nâng cấp hiệu suất",discount:10,items:[{id:201,name:"SSD Samsung 250GB",image:"https://via.placeholder.com/50",price:12e5},{id:501,name:"RAM Kingston 8GB DDR4",image:"https://via.placeholder.com/50",price:85e4}],originalPrice:205e4,bundlePrice:1845e3}],k=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e);e.useEffect(()=>{y(!0),setTimeout(()=>{let e="cart",t=[...T.cart];i?.id?(e="customer",t=[...T.customer,...T.cart.slice(0,2)]):n.length||(e="trending",t=[...T.trending]),p(t),j(b),f(e),y(!1)},800)},[n,i,a]);return l?t.jsx("div",{className:"smart-suggestions",children:t.jsx(q,{loading:g,active:!0,paragraph:{rows:8},title:!0,children:c.length>0||u.length>0?t.jsxs("div",{children:[t.jsxs(d,{title:t.jsxs(m,{children:[(()=>{switch(v){case"customer":return t.jsx(ye,{style:{color:"#722ed1"}});case"cart":default:return t.jsx(_e,{style:{color:"#faad14"}});case"trending":return t.jsx(ge,{style:{color:"#f5222d"}})}})(),t.jsx("span",{children:(()=>{switch(v){case"customer":return"Đề xuất riêng cho khách hàng";case"cart":return"Khách hàng thường mua cùng";case"trending":return"Sản phẩm phổ biến hiện nay";default:return"Đề xuất cho bạn"}})()})]}),extra:t.jsx(x,{type:"text",icon:t.jsx(Ee,{}),onClick:r,size:"small",children:"Làm mới"}),size:"small",className:"suggestion-card",children:[t.jsx(N,{grid:{gutter:16,xs:1,sm:2,md:3,lg:4},dataSource:c,renderItem:e=>t.jsx(N.Item,{children:t.jsxs(d,{size:"small",hoverable:!0,cover:t.jsx("div",{style:{padding:"10px",textAlign:"center",background:"#f5f5f5"},children:t.jsx("img",{alt:e.name,src:e.image,style:{maxHeight:"60px",maxWidth:"100%",objectFit:"contain"}})}),actions:[t.jsx(P,{title:"Thêm vào giỏ hàng",children:t.jsx(x,{type:"primary",size:"small",icon:t.jsx(ie,{}),onClick:()=>s(e),children:"Thêm"})})],children:[t.jsx("div",{style:{height:"45px",overflow:"hidden"},children:t.jsx(P,{title:e.name,children:t.jsx(Ht,{strong:!0,style:{fontSize:"13px"},ellipsis:{tooltip:e.name},children:e.name})})}),t.jsxs(m,{direction:"vertical",size:0,style:{width:"100%"},children:[t.jsxs(m,{align:"center",children:[t.jsx(Ht,{style:{fontSize:"14px",color:"#f50",fontWeight:"bold"},children:k(e.price)}),e.originalPrice>e.price&&t.jsx(Ht,{delete:!0,style:{fontSize:"12px",color:"#999"},children:k(e.originalPrice)})]}),e.originalPrice>e.price&&t.jsxs(D,{color:"red",style:{marginTop:"4px"},children:["-",Math.round((e.originalPrice-e.price)/e.originalPrice*100),"%"]}),t.jsxs(Ht,{type:"secondary",style:{fontSize:"12px"},children:[t.jsx(Ae,{})," ",e.reason]})]})]})})}),u.length>0&&t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx(S,{orientation:"left",children:t.jsxs(m,{children:[t.jsx(we,{style:{color:"#1890ff"}}),t.jsx("span",{children:"Combo tiết kiệm"})]})}),t.jsx(N,{dataSource:u,renderItem:e=>t.jsx(N.Item,{children:t.jsx(d,{size:"small",title:t.jsxs(m,{children:[t.jsx(Ht,{strong:!0,children:e.name}),t.jsxs(D,{color:"red",children:["Tiết kiệm ",e.discount,"%"]})]}),style:{width:"100%"},children:t.jsxs(o,{gutter:[16,16],align:"middle",children:[t.jsx(h,{xs:24,sm:16,children:t.jsx(N,{dataSource:e.items,renderItem:e=>t.jsx(N.Item,{style:{padding:"8px 0"},children:t.jsx(N.Item.Meta,{avatar:t.jsx(_,{src:e.image,shape:"square"}),title:e.name,description:k(e.price)})})})}),t.jsx(h,{xs:24,sm:8,style:{textAlign:"center"},children:t.jsxs("div",{children:[t.jsx(G,{title:"Giá gốc",value:e.originalPrice,formatter:e=>t.jsx(Ht,{delete:!0,children:k(e)})}),t.jsx(G,{title:"Giá combo",value:e.bundlePrice,valueStyle:{color:"#cf1322",fontWeight:"bold"},formatter:e=>k(e),suffix:t.jsx(Se,{style:{fontSize:"0.7em"}})}),t.jsx(x,{type:"primary",icon:t.jsx(de,{}),style:{marginTop:"16px"},onClick:()=>e.items.forEach(e=>s(e)),children:"Thêm tất cả"})]})})]})})})})]})]}),t.jsx("div",{style:{textAlign:"center",padding:"10px"},children:t.jsxs(Ht,{type:"secondary",style:{fontSize:"12px"},children:[t.jsx(Ne,{})," Đề xuất thông minh bằng AI dựa trên dữ liệu bán hàng và hành vi khách hàng"]})})]}):t.jsx(C,{description:"Không có đề xuất nào",image:C.PRESENTED_IMAGE_SIMPLE})})}):null}},Symbol.toStringTag,{value:"Module"})),qt=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Gt=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),$t=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Ut=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Kt=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Yt=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),{Title:Wt,Text:Xt}=p,{Option:Qt}=v,{Step:Zt}=B,Jt=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[n]=g.useForm(),s=i(),{user:l}=a(),[r,c]=e.useState(!1),[p,y]=e.useState(0),[T,b]=e.useState(null),[C,k]=e.useState(0),[I,A]=e.useState({5e5:0,2e5:0,1e5:0,5e4:0,2e4:0,1e4:0,5e3:0,2e3:0,1e3:0,coins:0});e.useEffect(()=>{let e=0;Object.entries(I).forEach(([t,n])=>{e+="coins"===t?n:parseInt(t)*n}),k(e),n.setFieldsValue({drawerAmount:e})},[I,n]);const E=(e,t)=>{A(n=>({...n,[e]:t}))},N=()=>{n.validateFields().then(()=>{y(p+1)}).catch(e=>{})},_=()=>{y(p-1)},P=async e=>{c(!0);try{await new Promise(e=>setTimeout(e,1500));const t={shiftId:`SHIFT-${Date.now().toString().slice(-6)}`,cashier:l?.name||"Nhân viên thu ngân",cashierId:l?.id,startTime:(new Date).toISOString(),startAmount:e.drawerAmount,posTerminal:e.posTerminal,register:e.register,note:e.note,status:"active",denominations:I};b(t),y(p+1),f.success("Mở ca làm việc thành công!")}catch(t){f.error("Có lỗi xảy ra khi mở ca làm việc!")}finally{c(!1)}},D=()=>{s("/cashier/pos")};return t.jsx("div",{style:{maxWidth:1e3,margin:"0 auto"},children:t.jsxs(d,{children:[t.jsx(Wt,{level:2,style:{textAlign:"center",margin:"0 0 24px 0"},children:"Mở ca làm việc"}),t.jsxs(B,{current:p,style:{marginBottom:24},children:[t.jsx(Zt,{title:"Thông tin ca",description:"Nhập thông tin ca làm việc"}),t.jsx(Zt,{title:"Khai báo tiền",description:"Khai báo tiền đầu ca"}),t.jsx(Zt,{title:"Hoàn thành",description:"Xác nhận thông tin"})]}),t.jsx(g,{form:n,layout:"vertical",initialValues:{shiftType:"morning",drawerAmount:0},children:(()=>{switch(p){case 0:return t.jsxs(d,{title:"Thông tin ca làm việc",children:[t.jsx(g.Item,{name:"posTerminal",label:"Máy POS",rules:[{required:!0,message:"Vui lòng chọn máy POS!"}],children:t.jsxs(v,{placeholder:"Chọn máy POS",children:[t.jsx(Qt,{value:"POS-01",children:"POS-01 (Quầy chính)"}),t.jsx(Qt,{value:"POS-02",children:"POS-02 (Quầy phụ)"}),t.jsx(Qt,{value:"POS-03",children:"POS-03 (Tầng 2)"})]})}),t.jsx(g.Item,{name:"register",label:"Quầy thu ngân",rules:[{required:!0,message:"Vui lòng chọn quầy thu ngân!"}],children:t.jsxs(v,{placeholder:"Chọn quầy thu ngân",children:[t.jsx(Qt,{value:"REGISTER-01",children:"Quầy 1"}),t.jsx(Qt,{value:"REGISTER-02",children:"Quầy 2"}),t.jsx(Qt,{value:"REGISTER-03",children:"Quầy 3"})]})}),t.jsx(g.Item,{name:"shiftType",label:"Loại ca",rules:[{required:!0,message:"Vui lòng chọn loại ca!"}],initialValue:"morning",children:t.jsxs(v,{placeholder:"Chọn loại ca",children:[t.jsx(Qt,{value:"morning",children:"Ca sáng (8:00 - 14:00)"}),t.jsx(Qt,{value:"afternoon",children:"Ca chiều (14:00 - 20:00)"}),t.jsx(Qt,{value:"evening",children:"Ca tối (20:00 - 23:00)"}),t.jsx(Qt,{value:"full",children:"Ca đầy đủ (8:00 - 20:00)"})]})}),t.jsx(g.Item,{name:"note",label:"Ghi chú",children:t.jsx(u.TextArea,{rows:2,placeholder:"Ghi chú (nếu có)"})}),t.jsx(g.Item,{children:t.jsx(x,{type:"primary",onClick:N,children:"Tiếp tục"})})]});case 1:return t.jsxs(d,{title:"Khai báo tiền đầu ca",children:[t.jsx(j,{message:"Hướng dẫn khai báo tiền đầu ca",description:"Vui lòng nhập chính xác số lượng của từng mệnh giá tiền trong két. Hệ thống sẽ tự động tính tổng số tiền.",type:"info",showIcon:!0,style:{marginBottom:16}}),t.jsxs(o,{gutter:[16,16],children:[t.jsx(h,{span:16,children:t.jsx(d,{title:"Chi tiết mệnh giá",size:"small",children:t.jsxs(o,{gutter:[16,16],children:[t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"500,000 VND",children:t.jsx(w,{min:0,value:I[5e5],onChange:e=>E("500000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"200,000 VND",children:t.jsx(w,{min:0,value:I[2e5],onChange:e=>E("200000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"100,000 VND",children:t.jsx(w,{min:0,value:I[1e5],onChange:e=>E("100000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"50,000 VND",children:t.jsx(w,{min:0,value:I[5e4],onChange:e=>E("50000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"20,000 VND",children:t.jsx(w,{min:0,value:I[2e4],onChange:e=>E("20000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"10,000 VND",children:t.jsx(w,{min:0,value:I[1e4],onChange:e=>E("10000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"5,000 VND",children:t.jsx(w,{min:0,value:I[5e3],onChange:e=>E("5000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"2,000 VND",children:t.jsx(w,{min:0,value:I[2e3],onChange:e=>E("2000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"1,000 VND",children:t.jsx(w,{min:0,value:I[1e3],onChange:e=>E("1000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"Tiền xu (VND)",children:t.jsx(w,{min:0,value:I.coins,onChange:e=>E("coins",e),style:{width:"100%"}})})})]})})}),t.jsx(h,{span:8,children:t.jsxs(d,{title:"Tổng tiền",size:"small",children:[t.jsx(g.Item,{name:"drawerAmount",label:"Tổng tiền trong két",children:t.jsx(w,{style:{width:"100%"},formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),disabled:!0})}),t.jsxs("div",{style:{marginTop:"20px",textAlign:"center"},children:[t.jsx(Wt,{level:3,children:St(C)}),t.jsx(Xt,{type:"secondary",children:"Tổng tiền đầu ca"})]})]})})]}),t.jsx(S,{}),t.jsx(g.Item,{children:t.jsxs(m,{children:[t.jsx(x,{onClick:_,children:"Quay lại"}),t.jsx(x,{type:"primary",onClick:P,loading:r,children:"Mở ca làm việc"})]})})]});case 2:return t.jsx(d,{children:t.jsx(H,{status:"success",title:"Mở ca làm việc thành công!",subTitle:`Mã ca: ${T?.shiftId||"N/A"} - Thời gian bắt đầu: ${He(T?.startTime).format("DD/MM/YYYY HH:mm:ss")}`,extra:[t.jsx(x,{type:"primary",onClick:D,icon:t.jsx(je,{}),children:"Bắt đầu bán hàng"},"console")],children:t.jsxs(F,{title:"Thông tin ca làm việc",children:[t.jsx(F.Item,{label:"Nhân viên",children:T?.cashier}),t.jsx(F.Item,{label:"Máy POS",children:T?.posTerminal}),t.jsx(F.Item,{label:"Quầy thu ngân",children:T?.register}),t.jsx(F.Item,{label:"Tiền đầu ca",children:St(T?.startAmount)}),t.jsx(F.Item,{label:"Trạng thái",children:t.jsx("span",{style:{color:"#52c41a"},children:"Đang hoạt động"})})]})})});default:return null}})()})]})})}},Symbol.toStringTag,{value:"Module"})),{Title:en,Text:tn,Paragraph:nn}=p,{Step:sn}=B,{Option:ln}=v,rn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[n]=g.useForm(),s=i(),{user:l}=a(),[r,c]=e.useState(!1),[p,y]=e.useState(0),[v,T]=e.useState(null),[b,C]=e.useState(0),[k,I]=e.useState(0),[A,E]=e.useState(0),[N,_]=e.useState({5e5:0,2e5:0,1e5:0,5e4:0,2e4:0,1e4:0,5e3:0,2e3:0,1e3:0,coins:0}),[P,D]=e.useState("idle");e.useEffect(()=>{(async()=>{c(!0);try{await new Promise(e=>setTimeout(e,800));const e={shiftId:"SHIFT-235689",cashier:l?.name||"Nguyễn Văn A",cashierId:l?.id||"STAFF-001",posTerminal:"POS-01",register:"REGISTER-01",startTime:new Date(Date.now()-288e5).toISOString(),endTime:null,startAmount:5e6,status:"active",sales:{totalOrders:48,totalSales:2385e4,cashPayments:15e6,cardPayments:45e5,momoPayments:25e5,vnpayPayments:185e4,returns:2,returnAmount:45e4,discounts:75e4},transactions:[{id:"TXN-001",type:"sale",amount:85e4,paymentMethod:"cash",time:"09:15",orderId:"ORD-001"},{id:"TXN-002",type:"sale",amount:125e4,paymentMethod:"card",time:"09:45",orderId:"ORD-002"},{id:"TXN-003",type:"sale",amount:75e4,paymentMethod:"momo",time:"10:20",orderId:"ORD-003"},{id:"TXN-004",type:"return",amount:-25e4,paymentMethod:"cash",time:"11:05",orderId:"ORD-004"},{id:"TXN-005",type:"sale",amount:235e4,paymentMethod:"cash",time:"12:30",orderId:"ORD-005"}]};T(e);const t=e.startAmount+e.sales.cashPayments-e.sales.returnAmount;I(t),n.setFieldsValue({shiftId:e.shiftId,posTerminal:e.posTerminal,register:e.register,startTime:He(e.startTime).format("DD/MM/YYYY HH:mm"),startAmount:e.startAmount,expectedDrawerAmount:t})}catch(e){f.error("Không thể tải dữ liệu ca làm việc!")}finally{c(!1)}})()},[n,l]),e.useEffect(()=>{let e=0;Object.entries(N).forEach(([t,n])=>{e+="coins"===t?n:parseInt(t)*n}),C(e),E(e-k),n.setFieldsValue({drawerAmount:e,discrepancy:e-k})},[N,k,n]);const O=(e,t)=>{_(n=>({...n,[e]:t}))},M=()=>{n.validateFields().then(()=>{y(p+1)}).catch(e=>{})},V=()=>{y(p-1)},z=async e=>{c(!0);try{await new Promise(e=>setTimeout(e,1500));const t={...v,endTime:(new Date).toISOString(),drawerAmount:e.drawerAmount,expectedDrawerAmount:e.expectedDrawerAmount,discrepancy:e.discrepancy,note:e.note,status:"closed",denominations:N};T(t),y(p+1),f.success("Đóng ca làm việc thành công!")}catch(t){f.error("Có lỗi xảy ra khi đóng ca làm việc!")}finally{c(!1)}},L=async()=>{D("printing");try{await new Promise(e=>setTimeout(e,1500)),f.success("Đã in báo cáo ca làm việc!"),D("success")}catch(e){f.error("Có lỗi xảy ra khi in báo cáo!"),D("error")}},q=()=>{s("/cashier")};return t.jsx("div",{style:{maxWidth:1e3,margin:"0 auto"},children:t.jsxs(d,{children:[t.jsx(en,{level:2,style:{textAlign:"center",margin:"0 0 24px 0"},children:"Đóng ca làm việc"}),t.jsxs(B,{current:p,style:{marginBottom:24},children:[t.jsx(sn,{title:"Thông tin doanh thu",description:"Thống kê doanh thu"}),t.jsx(sn,{title:"Kiểm kê tiền mặt",description:"Đếm tiền trong két"}),t.jsx(sn,{title:"Hoàn thành",description:"Xác nhận thông tin"})]}),t.jsx(g,{form:n,layout:"vertical",children:(()=>{switch(p){case 0:return t.jsx(d,{title:"Thông tin ca làm việc",children:r?t.jsxs("div",{style:{textAlign:"center",padding:"30px"},children:[t.jsx(R,{size:"large"}),t.jsx("div",{style:{marginTop:"16px"},children:"Đang tải thông tin ca làm việc..."})]}):t.jsxs(t.Fragment,{children:[t.jsxs(o,{gutter:[16,16],children:[t.jsx(h,{span:12,children:t.jsx(g.Item,{name:"shiftId",label:"Mã ca làm việc",children:t.jsx(u,{disabled:!0})})}),t.jsx(h,{span:12,children:t.jsx(g.Item,{name:"startTime",label:"Thời gian bắt đầu",children:t.jsx(u,{disabled:!0})})}),t.jsx(h,{span:12,children:t.jsx(g.Item,{name:"posTerminal",label:"Máy POS",children:t.jsx(u,{disabled:!0})})}),t.jsx(h,{span:12,children:t.jsx(g.Item,{name:"register",label:"Quầy thu ngân",children:t.jsx(u,{disabled:!0})})})]}),t.jsx(S,{orientation:"left",children:"Thống kê doanh thu"}),t.jsxs(o,{gutter:16,children:[t.jsx(h,{span:6,children:t.jsx(G,{title:"Tổng đơn hàng",value:v?.sales?.totalOrders,prefix:t.jsx(Pe,{})})}),t.jsx(h,{span:6,children:t.jsx(G,{title:"Tổng doanh thu",value:St(v?.sales?.totalSales),prefix:t.jsx(he,{}),valueStyle:{color:"#3f8600"}})}),t.jsx(h,{span:6,children:t.jsx(G,{title:"Đơn hoàn trả",value:v?.sales?.returns,prefix:t.jsx(De,{}),valueStyle:{color:"#cf1322"}})}),t.jsx(h,{span:6,children:t.jsx(G,{title:"Tiền hoàn trả",value:St(v?.sales?.returnAmount),prefix:t.jsx(he,{}),valueStyle:{color:"#cf1322"}})})]}),t.jsx(S,{orientation:"left",children:"Thống kê theo phương thức thanh toán"}),t.jsxs(o,{gutter:16,children:[t.jsx(h,{span:6,children:t.jsx(G,{title:"Tiền mặt",value:St(v?.sales?.cashPayments)})}),t.jsx(h,{span:6,children:t.jsx(G,{title:"Thẻ",value:St(v?.sales?.cardPayments)})}),t.jsx(h,{span:6,children:t.jsx(G,{title:"MoMo",value:St(v?.sales?.momoPayments)})}),t.jsx(h,{span:6,children:t.jsx(G,{title:"VNPay",value:St(v?.sales?.vnpayPayments)})})]}),t.jsx(S,{}),t.jsx(g.Item,{children:t.jsx(x,{type:"primary",onClick:M,children:"Tiếp tục"})})]})});case 1:return t.jsxs(d,{title:"Kiểm kê tiền mặt",children:[t.jsx(j,{message:"Hướng dẫn kiểm kê tiền",description:"Vui lòng đếm và nhập chính xác số lượng của từng mệnh giá tiền trong két. Hệ thống sẽ tự động tính toán số tiền chênh lệch.",type:"info",showIcon:!0,style:{marginBottom:16}}),t.jsxs(o,{gutter:[16,16],children:[t.jsx(h,{span:16,children:t.jsx(d,{title:"Chi tiết mệnh giá",size:"small",children:t.jsxs(o,{gutter:[16,16],children:[t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"500,000 VND",children:t.jsx(w,{min:0,value:N[5e5],onChange:e=>O("500000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"200,000 VND",children:t.jsx(w,{min:0,value:N[2e5],onChange:e=>O("200000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"100,000 VND",children:t.jsx(w,{min:0,value:N[1e5],onChange:e=>O("100000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"50,000 VND",children:t.jsx(w,{min:0,value:N[5e4],onChange:e=>O("50000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"20,000 VND",children:t.jsx(w,{min:0,value:N[2e4],onChange:e=>O("20000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"10,000 VND",children:t.jsx(w,{min:0,value:N[1e4],onChange:e=>O("10000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"5,000 VND",children:t.jsx(w,{min:0,value:N[5e3],onChange:e=>O("5000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"2,000 VND",children:t.jsx(w,{min:0,value:N[2e3],onChange:e=>O("2000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"1,000 VND",children:t.jsx(w,{min:0,value:N[1e3],onChange:e=>O("1000",e),style:{width:"100%"}})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"Tiền xu (VND)",children:t.jsx(w,{min:0,value:N.coins,onChange:e=>O("coins",e),style:{width:"100%"}})})})]})})}),t.jsx(h,{span:8,children:t.jsxs(d,{title:"Kết quả kiểm kê",size:"small",children:[t.jsx(g.Item,{name:"startAmount",label:"Tiền đầu ca",children:t.jsx(w,{style:{width:"100%"},formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),disabled:!0})}),t.jsx(g.Item,{name:"expectedDrawerAmount",label:"Tiền mặt dự kiến",children:t.jsx(w,{style:{width:"100%"},formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),disabled:!0})}),t.jsx(g.Item,{name:"drawerAmount",label:"Tiền mặt thực tế",children:t.jsx(w,{style:{width:"100%"},formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),disabled:!0})}),t.jsx(g.Item,{name:"discrepancy",label:"Chênh lệch",children:t.jsx(w,{style:{width:"100%"},formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),disabled:!0})}),t.jsx("div",{style:{textAlign:"center",marginTop:16},children:t.jsx(tn,{type:0===A?"success":A>0?"warning":"danger",strong:!0,style:{fontSize:16},children:0===A?"Khớp đúng":A>0?`Thừa ${St(A)}`:`Thiếu ${St(Math.abs(A))}`})})]})})]}),t.jsx(S,{}),t.jsx(g.Item,{name:"note",label:"Ghi chú",rules:[{required:0!==A,message:"Vui lòng ghi chú lý do chênh lệch!"}],children:t.jsx(u.TextArea,{rows:3,placeholder:0!==A?"Vui lòng giải thích lý do chênh lệch...":"Ghi chú (nếu có)"})}),t.jsx(g.Item,{children:t.jsxs(m,{children:[t.jsx(x,{onClick:V,children:"Quay lại"}),t.jsx(x,{type:"primary",onClick:z,loading:r,children:"Đóng ca làm việc"})]})})]});case 2:return t.jsx(d,{children:t.jsx(H,{status:"success",title:"Đóng ca làm việc thành công!",subTitle:`Mã ca: ${v?.shiftId||"N/A"} - Thời gian kết thúc: ${He().format("DD/MM/YYYY HH:mm:ss")}`,extra:[t.jsx(x,{type:"primary",onClick:L,loading:"printing"===P,icon:t.jsx(ne,{}),children:"In báo cáo"},"print"),t.jsx(x,{onClick:q,icon:t.jsx(je,{}),children:"Hoàn thành"},"complete")],children:t.jsxs(F,{title:"Thông tin ca làm việc",column:2,children:[t.jsx(F.Item,{label:"Nhân viên",children:v?.cashier}),t.jsx(F.Item,{label:"Máy POS",children:v?.posTerminal}),t.jsx(F.Item,{label:"Thời gian bắt đầu",children:He(v?.startTime).format("DD/MM/YYYY HH:mm")}),t.jsx(F.Item,{label:"Thời gian kết thúc",children:He(v?.endTime).format("DD/MM/YYYY HH:mm")}),t.jsx(F.Item,{label:"Tiền đầu ca",children:St(v?.startAmount)}),t.jsx(F.Item,{label:"Tiền cuối ca",children:St(v?.drawerAmount)}),t.jsx(F.Item,{label:"Tổng doanh thu",children:St(v?.sales?.totalSales)}),t.jsx(F.Item,{label:"Tổng đơn hàng",children:v?.sales?.totalOrders}),0!==v?.discrepancy&&t.jsx(F.Item,{label:"Chênh lệch",span:2,children:t.jsx(tn,{type:v?.discrepancy>0?"warning":"danger",children:v?.discrepancy>0?`Thừa ${St(v?.discrepancy)}`:`Thiếu ${St(Math.abs(v?.discrepancy))}`})}),v?.note&&t.jsx(F.Item,{label:"Ghi chú",span:2,children:v?.note})]})})});default:return null}})()})]})})}},Symbol.toStringTag,{value:"Module"})),{Title:an,Text:cn,Paragraph:dn}=p,{Option:on}=v,hn=[{value:5e5,label:"500,000₫",type:"bill"},{value:2e5,label:"200,000₫",type:"bill"},{value:1e5,label:"100,000₫",type:"bill"},{value:5e4,label:"50,000₫",type:"bill"},{value:2e4,label:"20,000₫",type:"bill"},{value:1e4,label:"10,000₫",type:"bill"},{value:5e3,label:"5,000₫",type:"bill"},{value:2e3,label:"2,000₫",type:"bill"},{value:1e3,label:"1,000₫",type:"bill"},{value:5e3,label:"5,000₫",type:"coin"},{value:2e3,label:"2,000₫",type:"coin"},{value:1e3,label:"1,000₫",type:"coin"},{value:500,label:"500₫",type:"coin"},{value:200,label:"200₫",type:"coin"},{value:100,label:"100₫",type:"coin"}],xn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[n]=g.useForm(),[s,i]=e.useState({}),[l,r]=e.useState(0),[a,p]=e.useState(0),[y,f]=e.useState(0),[T,b]=e.useState(!1),[C,k]=e.useState(!1),[A,E]=e.useState("shift_start"),[N,_]=e.useState(!1),[P,D]=e.useState(""),[O,M]=e.useState("Nguyễn Văn A"),[R,V]=e.useState("Ca sáng (8:00 - 14:00)");e.useEffect(()=>{let e=0;Object.entries(s).forEach(([t,n])=>{e+=parseInt(t)*(n||0)}),r(e),f(e-a)},[s,a]);const z=()=>{_(!0),setTimeout(()=>{b(!0),_(!1)},1e3)},B=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e),F=hn.map(e=>({key:e.value.toString(),denomination:e.label,type:"bill"===e.type?"Tiền giấy":"Tiền xu",count:s[e.value]||0,value:(s[e.value]||0)*e.value})),L=[{title:"Mệnh giá",dataIndex:"denomination",key:"denomination"},{title:"Loại",dataIndex:"type",key:"type"},{title:"Số lượng",dataIndex:"count",key:"count",render:(e,n)=>t.jsx(w,{min:0,value:s[n.key],onChange:e=>{return t=n.key,s=e,void i(e=>({...e,[t]:s}));var t,s},disabled:T,style:{width:"100%"}})},{title:"Thành tiền",dataIndex:"value",key:"value",render:e=>B(e)}];return t.jsx("div",{className:"cash-count",children:t.jsxs(d,{children:[t.jsx(an,{level:2,children:"Kiểm đếm tiền"}),t.jsx(dn,{type:"secondary",children:"Kiểm đếm tiền mặt trong quầy thu ngân để đảm bảo tính chính xác"}),!T&&t.jsxs(t.Fragment,{children:[t.jsxs(o,{gutter:16,style:{marginBottom:16},children:[t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"Loại kiểm đếm",children:t.jsxs(v,{value:A,onChange:E,disabled:Object.keys(s).length>0,children:[t.jsx(on,{value:"shift_start",children:"Đầu ca"}),t.jsx(on,{value:"shift_end",children:"Cuối ca"}),t.jsx(on,{value:"mid_day",children:"Giữa ngày"})]})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"Thu ngân",children:t.jsxs(v,{value:O,onChange:M,children:[t.jsx(on,{value:"Nguyễn Văn A",children:"Nguyễn Văn A"}),t.jsx(on,{value:"Trần Thị B",children:"Trần Thị B"}),t.jsx(on,{value:"Lê Văn C",children:"Lê Văn C"})]})})}),t.jsx(h,{span:8,children:t.jsx(g.Item,{label:"Ca làm việc",children:t.jsxs(v,{value:R,onChange:V,children:[t.jsx(on,{value:"Ca sáng (8:00 - 14:00)",children:"Ca sáng (8:00 - 14:00)"}),t.jsx(on,{value:"Ca chiều (14:00 - 20:00)",children:"Ca chiều (14:00 - 20:00)"}),t.jsx(on,{value:"Ca tối (20:00 - 22:00)",children:"Ca tối (20:00 - 22:00)"})]})})})]}),"shift_end"===A&&t.jsx(o,{gutter:16,style:{marginBottom:16},children:t.jsx(h,{span:24,children:t.jsx(j,{message:"Số tiền dự kiến trong quầy",description:t.jsxs(m,{direction:"vertical",style:{width:"100%"},children:[t.jsx(cn,{children:"Nhập số tiền dự kiến dựa trên báo cáo hệ thống:"}),t.jsx(w,{style:{width:"100%"},min:0,step:1e4,formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),onChange:e=>{p(e||0)},addonAfter:"VND",placeholder:"Nhập số tiền dự kiến"})]}),type:"info",showIcon:!0})})}),t.jsx(S,{orientation:"left",children:"Nhập số lượng theo mệnh giá"}),t.jsx(I,{columns:L,dataSource:F,pagination:!1,summary:()=>t.jsxs(I.Summary.Row,{children:[t.jsx(I.Summary.Cell,{index:0,colSpan:2,children:t.jsx(cn,{strong:!0,children:"Tổng cộng"})}),t.jsx(I.Summary.Cell,{index:2,children:t.jsxs(cn,{strong:!0,children:[Object.values(s).reduce((e,t)=>e+(t||0),0)," tờ/đồng"]})}),t.jsx(I.Summary.Cell,{index:3,children:t.jsx(cn,{strong:!0,children:B(l)})})]})}),t.jsx(S,{}),t.jsxs(o,{gutter:16,children:[t.jsx(h,{span:12,children:t.jsx(d,{children:t.jsx(G,{title:"Tổng tiền đếm được",value:l,precision:0,valueStyle:{color:"#3f8600"},prefix:t.jsx(he,{}),suffix:"VND",formatter:e=>B(e)})})}),"shift_end"===A&&t.jsx(h,{span:12,children:t.jsxs(d,{children:[t.jsx(G,{title:"Chênh lệch",value:y,precision:0,valueStyle:{color:0===y?"#3f8600":Math.abs(y)<1e4?"#faad14":"#cf1322"},prefix:0===y?t.jsx(te,{}):y>0?t.jsx(Oe,{}):t.jsx(Me,{}),suffix:"VND",formatter:e=>`${e>=0?"+":"-"} ${B(Math.abs(e))}`}),0!==y&&t.jsx("div",{style:{marginTop:8},children:t.jsx(cn,{type:y>0?"success":"danger",children:y>0?"Thừa tiền":"Thiếu tiền"})})]})})]}),t.jsx("div",{style:{marginTop:16},children:t.jsx(g.Item,{label:"Ghi chú",children:t.jsx(u.TextArea,{rows:4,placeholder:"Nhập ghi chú về việc đếm tiền (nếu có)",value:P,onChange:e=>D(e.target.value)})})}),t.jsx("div",{style:{marginTop:16,textAlign:"right"},children:t.jsxs(m,{children:[t.jsx(x,{icon:t.jsx(Ee,{}),onClick:()=>i({}),children:"Đặt lại"}),t.jsx(x,{type:"primary",icon:t.jsx(Re,{}),onClick:"shift_end"===A&&0!==y?()=>{k(!0)}:z,loading:N,disabled:0===Object.keys(s).length,children:"Hoàn tất đếm tiền"})]})})]}),(()=>{if(!T)return null;const e=Math.abs(y)>1e4;return t.jsx(d,{style:{marginTop:16},children:t.jsx(H,{status:e?"warning":"success",title:e?"Có sự chênh lệch đáng kể trong kết quả đếm tiền":"Đếm tiền hoàn tất",subTitle:t.jsxs("div",{children:[t.jsx("p",{children:e?`Chênh lệch: ${B(y)} (${y>0?"thừa":"thiếu"})`:"Kết quả đếm tiền đã được lưu thành công"}),t.jsxs("p",{children:["Thời gian: ",(new Date).toLocaleString()]}),t.jsxs("p",{children:["Thu ngân: ",O]}),t.jsxs("p",{children:["Ca làm việc: ",R]}),P&&t.jsxs("p",{children:["Ghi chú: ",P]})]}),extra:[t.jsx(x,{icon:t.jsx(ne,{}),type:"primary",children:"In báo cáo"},"print"),t.jsx(x,{onClick:()=>window.location.reload(),children:"Đếm tiền mới"},"new")]})})})(),t.jsxs(c,{title:"Xác nhận chênh lệch",open:C,onOk:()=>{k(!1),z()},onCancel:()=>{k(!1)},okText:"Xác nhận",cancelText:"Hủy",children:[t.jsx(j,{message:`Chênh lệch: ${B(y)} (${y>0?"thừa":"thiếu"})`,description:"Có sự chênh lệch giữa số tiền đếm được và số tiền dự kiến. Vui lòng kiểm tra lại hoặc ghi chú lý do chênh lệch.",type:Math.abs(y)<1e4?"warning":"error",showIcon:!0,style:{marginBottom:16}}),t.jsx(g,{layout:"vertical",children:t.jsx(g.Item,{label:"Lý do chênh lệch",children:t.jsx(u.TextArea,{rows:4,placeholder:"Nhập lý do chênh lệch",value:P,onChange:e=>D(e.target.value)})})})]})]})})}},Symbol.toStringTag,{value:"Module"})),{Title:mn,Text:pn,Paragraph:un}=p,{Option:jn}=v,{RangePicker:gn}=y,{TabPane:yn}=O,{Search:vn}=u,fn={currentSession:{id:"S2023072001",cashier:"Nguyễn Văn A",startTime:"2023-07-20 08:00:00",endTime:null,startAmount:2e6,currentAmount:585e4,expectedAmount:585e4,difference:0,status:"active",orderCount:18,totalSales:385e4,cashSales:285e4,cardSales:1e6,otherSales:0,refunds:0,discounts:15e4},recentSessions:[{id:"S2023071902",cashier:"Nguyễn Văn A",startTime:"2023-07-19 14:00:00",endTime:"2023-07-19 20:00:00",startAmount:2e6,endAmount:675e4,expectedAmount:68e5,difference:-5e4,status:"closed",orderCount:25,totalSales:475e4,cashSales:325e4,cardSales:15e5,otherSales:0,refunds:0,discounts:2e5},{id:"S2023071901",cashier:"Trần Thị B",startTime:"2023-07-19 08:00:00",endTime:"2023-07-19 14:00:00",startAmount:2e6,endAmount:52e5,expectedAmount:52e5,difference:0,status:"closed",orderCount:16,totalSales:32e5,cashSales:22e5,cardSales:1e6,otherSales:0,refunds:0,discounts:12e4},{id:"S2023071802",cashier:"Nguyễn Văn A",startTime:"2023-07-18 14:00:00",endTime:"2023-07-18 20:00:00",startAmount:2e6,endAmount:72e5,expectedAmount:715e4,difference:5e4,status:"closed",orderCount:28,totalSales:52e5,cashSales:37e5,cardSales:15e5,otherSales:0,refunds:0,discounts:25e4}],orders:[{id:"ORD2023072001",time:"2023-07-20 08:45:12",customer:"Khách lẻ",items:3,total:85e4,payment:"cash",status:"completed"},{id:"ORD2023072002",time:"2023-07-20 09:20:35",customer:"Lê Văn C",items:2,total:12e5,payment:"card",status:"completed"},{id:"ORD2023072003",time:"2023-07-20 10:05:48",customer:"Khách lẻ",items:1,total:35e4,payment:"cash",status:"completed"},{id:"ORD2023072004",time:"2023-07-20 10:30:22",customer:"Phạm Thị D",items:4,total:145e4,payment:"cash",status:"completed"}],cashMovements:[{id:"CM2023072001",time:"2023-07-20 08:00:00",type:"cash_in",amount:2e6,reason:"Tiền đầu ca",approvedBy:"Hoàng Văn E"},{id:"CM2023072002",time:"2023-07-20 08:45:12",type:"cash_in",amount:85e4,reason:"Thanh toán đơn hàng ORD2023072001",approvedBy:null},{id:"CM2023072003",time:"2023-07-20 10:05:48",type:"cash_in",amount:35e4,reason:"Thanh toán đơn hàng ORD2023072003",approvedBy:null},{id:"CM2023072004",time:"2023-07-20 10:30:22",type:"cash_in",amount:145e4,reason:"Thanh toán đơn hàng ORD2023072004",approvedBy:null},{id:"CM2023072005",time:"2023-07-20 11:15:00",type:"cash_out",amount:5e5,reason:"Rút tiền mặt",approvedBy:"Hoàng Văn E"}]},Sn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[n,s]=e.useState(!0),[i,l]=e.useState(null),[r,a]=e.useState([He().startOf("week"),He()]),[c,p]=e.useState("all"),[u,j]=e.useState("all"),g=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e),y=e=>He(e).format("DD/MM/YYYY HH:mm");e.useEffect(()=>{setTimeout(()=>{l(fn),s(!1)},1e3)},[]);const f=[{title:"Mã ca",dataIndex:"id",key:"id"},{title:"Thu ngân",dataIndex:"cashier",key:"cashier"},{title:"Thời gian bắt đầu",dataIndex:"startTime",key:"startTime",render:e=>y(e)},{title:"Thời gian kết thúc",dataIndex:"endTime",key:"endTime",render:e=>e?y(e):"Chưa kết thúc"},{title:"Trạng thái",dataIndex:"status",key:"status",render:e=>"active"===e?t.jsx(E,{status:"processing",text:"Đang hoạt động"}):"closed"===e?t.jsx(E,{status:"success",text:"Đã đóng"}):t.jsx(E,{status:"default",text:e})},{title:"Đơn hàng",dataIndex:"orderCount",key:"orderCount"},{title:"Doanh thu",dataIndex:"totalSales",key:"totalSales",render:e=>g(e)},{title:"Chênh lệch",dataIndex:"difference",key:"difference",render:e=>{const n=0===e?"":e>0?"#52c41a":"#f5222d";return t.jsx("span",{style:{color:n},children:0===e?"0":`${e>0?"+":""}${g(e)}`})}},{title:"Thao tác",key:"action",render:(e,n)=>t.jsxs(m,{size:"small",children:[t.jsx(x,{size:"small",icon:t.jsx(le,{}),children:"Chi tiết"}),t.jsx(x,{size:"small",icon:t.jsx(ne,{}),children:"In"})]})}],T=[{title:"Mã đơn",dataIndex:"id",key:"id"},{title:"Thời gian",dataIndex:"time",key:"time",render:e=>y(e)},{title:"Khách hàng",dataIndex:"customer",key:"customer"},{title:"Số mặt hàng",dataIndex:"items",key:"items"},{title:"Tổng tiền",dataIndex:"total",key:"total",render:e=>g(e)},{title:"Thanh toán",dataIndex:"payment",key:"payment",render:e=>{switch(e){case"cash":return t.jsx(D,{color:"green",children:"Tiền mặt"});case"card":return t.jsx(D,{color:"blue",children:"Thẻ"});default:return t.jsx(D,{children:e})}}},{title:"Trạng thái",dataIndex:"status",key:"status",render:e=>{switch(e){case"completed":return t.jsx(E,{status:"success",text:"Hoàn thành"});case"refunded":return t.jsx(E,{status:"warning",text:"Hoàn tiền"});case"cancelled":return t.jsx(E,{status:"error",text:"Đã hủy"});default:return t.jsx(E,{status:"default",text:e})}}}],b=[{title:"Mã giao dịch",dataIndex:"id",key:"id"},{title:"Thời gian",dataIndex:"time",key:"time",render:e=>y(e)},{title:"Loại",dataIndex:"type",key:"type",render:e=>{switch(e){case"cash_in":return t.jsx(D,{color:"green",children:"Tiền vào"});case"cash_out":return t.jsx(D,{color:"red",children:"Tiền ra"});default:return t.jsx(D,{children:e})}}},{title:"Số tiền",dataIndex:"amount",key:"amount",render:(e,n)=>{const s="cash_in"===n.type?"#52c41a":"#f5222d",i="cash_in"===n.type?"+":"-";return t.jsxs("span",{style:{color:s},children:[i," ",g(e)]})}},{title:"Lý do",dataIndex:"reason",key:"reason"},{title:"Người duyệt",dataIndex:"approvedBy",key:"approvedBy",render:e=>e||"N/A"}];return t.jsx("div",{className:"session-reports",children:t.jsxs(d,{loading:n,children:[t.jsx(mn,{level:2,children:"Báo cáo ca làm việc"}),t.jsx(un,{type:"secondary",children:"Xem thông tin chi tiết về ca làm việc, đơn hàng và giao dịch tiền mặt"}),i?.currentSession&&t.jsxs(d,{title:t.jsxs(m,{children:[t.jsx(Ve,{}),t.jsx("span",{children:"Ca làm việc hiện tại"}),t.jsx(E,{status:"processing",text:i.currentSession.id})]}),style:{marginBottom:16},children:[t.jsxs(o,{gutter:16,children:[t.jsx(h,{xs:24,sm:12,md:6,children:t.jsx(G,{title:"Thu ngân",value:i.currentSession.cashier,prefix:t.jsx(J,{})})}),t.jsx(h,{xs:24,sm:12,md:6,children:t.jsx(G,{title:"Thời gian bắt đầu",value:y(i.currentSession.startTime),prefix:t.jsx(Ve,{})})}),t.jsx(h,{xs:24,sm:12,md:6,children:t.jsx(G,{title:"Số đơn hàng",value:i.currentSession.orderCount,prefix:t.jsx(de,{})})}),t.jsx(h,{xs:24,sm:12,md:6,children:t.jsx(G,{title:"Doanh thu",value:i.currentSession.totalSales,prefix:t.jsx(he,{}),formatter:e=>g(e)})})]}),t.jsx(S,{}),t.jsxs(o,{gutter:16,children:[t.jsx(h,{xs:24,sm:12,md:8,children:t.jsx(d,{size:"small",title:"Tiền mặt",children:t.jsxs(o,{gutter:16,children:[t.jsx(h,{span:12,children:t.jsx(G,{title:"Tiền đầu ca",value:i.currentSession.startAmount,formatter:e=>g(e),valueStyle:{fontSize:"14px"}})}),t.jsx(h,{span:12,children:t.jsx(G,{title:"Tiền hiện tại",value:i.currentSession.currentAmount,formatter:e=>g(e),valueStyle:{fontSize:"14px"}})})]})})}),t.jsx(h,{xs:24,sm:12,md:8,children:t.jsx(d,{size:"small",title:"Doanh thu theo phương thức",children:t.jsxs(o,{gutter:16,children:[t.jsx(h,{span:12,children:t.jsx(G,{title:"Tiền mặt",value:i.currentSession.cashSales,formatter:e=>g(e),valueStyle:{fontSize:"14px"}})}),t.jsx(h,{span:12,children:t.jsx(G,{title:"Thẻ",value:i.currentSession.cardSales,formatter:e=>g(e),valueStyle:{fontSize:"14px"}})})]})})}),t.jsx(h,{xs:24,sm:12,md:8,children:t.jsx(d,{size:"small",title:"Khác",children:t.jsxs(o,{gutter:16,children:[t.jsx(h,{span:12,children:t.jsx(G,{title:"Giảm giá",value:i.currentSession.discounts,formatter:e=>g(e),valueStyle:{fontSize:"14px"}})}),t.jsx(h,{span:12,children:t.jsx(G,{title:"Hoàn tiền",value:i.currentSession.refunds,formatter:e=>g(e),valueStyle:{fontSize:"14px"}})})]})})})]})]}),t.jsx(d,{style:{marginBottom:16},children:t.jsxs(o,{gutter:16,align:"middle",children:[t.jsx(h,{xs:24,sm:24,md:8,children:t.jsxs("div",{style:{marginBottom:16},children:[t.jsx(pn,{strong:!0,children:"Thời gian:"}),t.jsx("div",{children:t.jsx(gn,{style:{width:"100%"},value:r,onChange:e=>{a(e)},format:"DD/MM/YYYY"})})]})}),t.jsx(h,{xs:12,sm:12,md:4,children:t.jsxs("div",{style:{marginBottom:16},children:[t.jsx(pn,{strong:!0,children:"Thu ngân:"}),t.jsx("div",{children:t.jsxs(v,{style:{width:"100%"},value:c,onChange:e=>{p(e)},children:[t.jsx(jn,{value:"all",children:"Tất cả"}),t.jsx(jn,{value:"Nguyễn Văn A",children:"Nguyễn Văn A"}),t.jsx(jn,{value:"Trần Thị B",children:"Trần Thị B"}),t.jsx(jn,{value:"Lê Văn C",children:"Lê Văn C"})]})})]})}),t.jsx(h,{xs:12,sm:12,md:4,children:t.jsxs("div",{style:{marginBottom:16},children:[t.jsx(pn,{strong:!0,children:"Trạng thái:"}),t.jsx("div",{children:t.jsxs(v,{style:{width:"100%"},value:u,onChange:e=>{j(e)},children:[t.jsx(jn,{value:"all",children:"Tất cả"}),t.jsx(jn,{value:"active",children:"Đang hoạt động"}),t.jsx(jn,{value:"closed",children:"Đã đóng"})]})})]})}),t.jsx(h,{xs:24,sm:24,md:8,style:{textAlign:"right"},children:t.jsxs(m,{children:[t.jsx(x,{icon:t.jsx(le,{}),onClick:()=>{s(!0),setTimeout(()=>{l(fn),s(!1)},1e3)},children:"Tìm kiếm"}),t.jsx(x,{icon:t.jsx(ze,{}),children:"Xuất Excel"}),t.jsx(x,{icon:t.jsx(ke,{}),children:"Xuất PDF"}),t.jsx(x,{type:"primary",icon:t.jsx(ne,{}),children:"In báo cáo"})]})})]})}),t.jsxs(O,{defaultActiveKey:"sessions",children:[t.jsx(yn,{tab:t.jsxs("span",{children:[t.jsx(Ve,{})," Ca làm việc"]}),children:t.jsx(I,{columns:f,dataSource:i?.recentSessions||[],rowKey:"id",loading:n,pagination:{pageSize:5}})},"sessions"),t.jsx(yn,{tab:t.jsxs("span",{children:[t.jsx(de,{})," Đơn hàng"]}),children:t.jsx(I,{columns:T,dataSource:i?.orders||[],rowKey:"id",loading:n,pagination:{pageSize:5}})},"orders"),t.jsx(yn,{tab:t.jsxs("span",{children:[t.jsx(he,{})," Giao dịch tiền mặt"]}),children:t.jsx(I,{columns:b,dataSource:i?.cashMovements||[],rowKey:"id",loading:n,pagination:{pageSize:5},summary:e=>{let n=0,s=0;return e.forEach(({type:e,amount:t})=>{"cash_in"===e?n+=t:"cash_out"===e&&(s+=t)}),t.jsxs(I.Summary.Row,{children:[t.jsx(I.Summary.Cell,{index:0,colSpan:3,children:t.jsx(pn,{strong:!0,children:"Tổng cộng"})}),t.jsx(I.Summary.Cell,{index:3,children:t.jsxs(m,{direction:"vertical",children:[t.jsxs(pn,{type:"success",children:["Tiền vào: ",g(n)]}),t.jsxs(pn,{type:"danger",children:["Tiền ra: ",g(s)]}),t.jsx(S,{style:{margin:"4px 0"}}),t.jsxs(pn,{strong:!0,children:["Chênh lệch: ",g(n-s)]})]})}),t.jsx(I.Summary.Cell,{index:4,colSpan:2})]})}})},"cash_movements")]})]})})}},Symbol.toStringTag,{value:"Module"}));export{At as C,Kt as L,Yt as M,qt as O,qe as P,Le as R,Lt as S,Ye as a,dt as b,pt as c,vt as d,Dt as e,zt as f,Gt as g,Ke as h,$t as i,Ut as j,Jt as k,rn as l,xn as m,Sn as n,We as u};
