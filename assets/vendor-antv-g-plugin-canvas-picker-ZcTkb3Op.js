import{_ as t,a as n,j as r,b as e,c as i,p as a,h as o,n as s,q as u,o as c}from"./polyfills-BjGv5uaK.js";import{S as v,k as d,n as f,o as h,q as l,t as p}from"./vendor-antv-g-lite-BsxRpwbw.js";import{e as y,f as x,g as m,h as g}from"./vendor-antv-g-math-B2LDBClw.js";import{h as P,L as k}from"./vendor-antv-util-BIOdtugi.js";import{C as M,y as I,k as C,e as E,D as L}from"./vendor-gl-matrix-DC4KmxQg.js";
/*!
 * @antv/g-plugin-canvas-picker
 * @description A G plugin for picking in canvas
 * @version 2.1.23
 * @date 5/30/2025, 2:56:22 AM
 * @author AntVis
 * @docs https://g.antv.antgroup.com/
 */var S=I(),W=I(),b=I(),F=E(),T=function(){function t(){var n=this;e(this,t),this.isHit=function(t,r,e,i){var a=n.context.pointInPathPickerFactory[t.nodeName];if(a){var o=C(F,e),s=L(W,M(b,r[0],r[1],0),o);if(a(t,new p(s[0],s[1]),i,n.isPointInPath,n.context,n.runtime))return!0}return!1},this.isPointInPath=function(t,r){var e=n.runtime.offscreenCanvasCreator.getOrCreateContext(n.context.config.offscreenCanvas),i=n.context.pathGeneratorFactory[t.nodeName];return i&&(e.beginPath(),i(e,t.parsedStyle),e.closePath()),e.isPointInPath(r.x,r.y)}}return n(t,[{key:"apply",value:function(n,r){var e,i=this,a=n.renderingService,o=n.renderingContext;this.context=n,this.runtime=r;var u=null===(e=o.root)||void 0===e?void 0:e.ownerDocument;a.hooks.pick.tapPromise(t.tag,function(){var t=s(c().mark(function t(n){return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",i.pick(u,n));case 1:case"end":return t.stop()}},t)}));return function(n){return t.apply(this,arguments)}}()),a.hooks.pickSync.tap(t.tag,function(t){return i.pick(u,t)})}},{key:"pick",value:function(t,n){var r,e=n.topmost,i=n.position,a=i.x,o=i.y,s=M(S,a,o,0),c=t.elementsFromBBox(s[0],s[1],s[0],s[1]),v=[],d=u(c);try{for(d.s();!(r=d.n()).done;){var f=r.value,h=f.getWorldTransform();if(this.isHit(f,s,h,!1)){var p=l(f);if(p){var y=p.parsedStyle.clipPath;if(this.isHit(y,s,y.getWorldTransform(),!0)){if(e)return n.picked=[f],n;v.push(f)}}else{if(e)return n.picked=[f],n;v.push(f)}}}}catch(x){d.e(x)}finally{d.f()}return n.picked=v,n}}])}();function H(t,n,r){var e=t.parsedStyle,i=e.cx,a=void 0===i?0:i,s=e.cy,u=void 0===s?0:s,c=e.r,v=e.fill,d=e.stroke,h=e.lineWidth,l=void 0===h?1:h,p=e.increasedLineWidthForHitTesting,x=void 0===p?0:p,m=e.pointerEvents,g=void 0===m?"auto":m,P=(l+x)/2,k=y(a,u,n.x,n.y),M=f(g,v,d),I=o(M,2),C=I[0],E=I[1];return C&&E||r?k<=c+P:C?k<=c:!!E&&(k>=c-P&&k<=c+P)}function w(t,n,r,e){return t/(r*r)+n/(e*e)}function A(t,n,r){var e=t.parsedStyle,i=e.cx,a=void 0===i?0:i,s=e.cy,u=void 0===s?0:s,c=e.rx,v=e.ry,d=e.fill,h=e.stroke,l=e.lineWidth,p=void 0===l?1:l,y=e.increasedLineWidthForHitTesting,x=void 0===y?0:y,m=e.pointerEvents,g=void 0===m?"auto":m,P=n.x,k=n.y,M=f(g,d,h),I=o(M,2),C=I[0],E=I[1],L=(p+x)/2,S=(P-a)*(P-a),W=(k-u)*(k-u);return C&&E||r?w(S,W,c+L,v+L)<=1:C?w(S,W,c,v)<=1:!!E&&(w(S,W,c-L,v-L)>=1&&w(S,W,c+L,v+L)<=1)}function O(t,n,r,e,i,a){return i>=t&&i<=t+r&&a>=n&&a<=n+e}function R(t,n,r,e,i,a,o,s){var u=(Math.atan2(s-n,o-t)+2*Math.PI)%(2*Math.PI),c={x:t+r*Math.cos(u),y:n+r*Math.sin(u)};return y(c.x,c.y,o,s)<=a/2}function j(t,n,r,e,i,a,o){var s=Math.min(t,r),u=Math.max(t,r),c=Math.min(n,e),v=Math.max(n,e),d=i/2;return a>=s-d&&a<=u+d&&o>=c-d&&o<=v+d&&x(t,n,r,e,a,o)<=i/2}function G(t,n,r,e,i){var a=t.length;if(a<2)return!1;for(var o=0;o<a-1;o++){if(j(t[o][0],t[o][1],t[o+1][0],t[o+1][1],n,r,e))return!0}if(i){var s=t[0],u=t[a-1];if(j(s[0],s[1],u[0],u[1],n,r,e))return!0}return!1}T.tag="CanvasPicker";function N(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function q(t,n,r){return(r[0]-t[0])*(n[1]-t[1])===(n[0]-t[0])*(r[1]-t[1])&&Math.min(t[0],n[0])<=r[0]&&r[0]<=Math.max(t[0],n[0])&&Math.min(t[1],n[1])<=r[1]&&r[1]<=Math.max(t[1],n[1])}function B(t,n,r){var e=!1,i=t.length;if(i<=2)return!1;for(var a=0;a<i;a++){var o=t[a],s=t[(a+1)%i];if(q(o,s,[n,r]))return!0;N(o[1]-r)>0!=N(s[1]-r)>0&&N(n-(r-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])<0&&(e=!e)}return e}function D(t,n,r){for(var e=!1,i=0;i<t.length;i++){if(e=B(t[i],n,r))break}return e}function Y(t,n,r){var e=t.parsedStyle,i=e.x1,a=e.y1,s=e.x2,u=e.y2,c=e.lineWidth,v=void 0===c?1:c,d=e.increasedLineWidthForHitTesting,h=void 0===d?0:d,l=e.pointerEvents,p=void 0===l?"auto":l,y=e.fill,x=e.stroke,m=f(p,y,x);return!(!o(m,2)[1]&&!r||!v)&&j(i,a,s,u,v+h,n.x,n.y)}function Q(t,n,r,e,i,a){var s=t.parsedStyle,u=s.lineWidth,c=void 0===u?1:u,v=s.increasedLineWidthForHitTesting,d=void 0===v?0:v,l=s.stroke,p=s.fill,y=s.d,x=s.pointerEvents,P=void 0===x?"auto":x,M=y.segments,I=y.hasArc,C=y.polylines,E=y.polygons,L=f(P,(null==E?void 0:E.length)&&p,l),S=o(L,2),W=S[0],b=S[1],F=h(t),T=!1;return W||r?T=I?e(t,n):D(E,n.x,n.y)||D(C,n.x,n.y):((b||r)&&(T=function(t,n,r,e,i){for(var a=!1,o=n/2,s=0;s<t.length;s++){var u=t[s],c=u.currentPoint,v=u.params,d=u.prePoint,f=u.box;if(!f||O(f.x-o,f.y-o,f.width+n,f.height+n,r,e))switch(u.command){case"L":case"Z":if(a=j(d[0],d[1],c[0],c[1],n,r,e))return!0;break;case"Q":if(a=g(d[0],d[1],v[1],v[2],v[3],v[4],r,e)<=n/2)return!0;break;case"C":if(a=m(d[0],d[1],v[1],v[2],v[3],v[4],v[5],v[6],r,e,i)<=n/2)return!0;break;case"A":u.cubicParams||(u.cubicParams=k(d[0],d[1],v[1],v[2],v[3],v[4],v[5],v[6],v[7],void 0));for(var h=u.cubicParams,l=d,p=0;p<h.length;p+=6){var y=m(l[0],l[1],h[p],h[p+1],h[p+2],h[p+3],h[p+4],h[p+5],r,e,i);if(l=[h[p+4],h[p+5]],a=y<=n/2)return!0}}}return a}(M,c+d,n.x,n.y,F)),T)}function U(t,n,r){var e=t.parsedStyle,i=e.stroke,a=e.fill,s=e.lineWidth,u=void 0===s?1:s,c=e.increasedLineWidthForHitTesting,v=void 0===c?0:c,d=e.points,h=e.pointerEvents,l=f(void 0===h?"auto":h,a,i),p=o(l,2),y=p[0],x=!1;return(p[1]||r)&&(x=G(d.points,u+v,n.x,n.y,!0)),x||!y&&!r||(x=B(d.points,n.x,n.y)),x}function X(t,n,r){var e=t.parsedStyle,i=e.lineWidth,a=void 0===i?1:i,s=e.increasedLineWidthForHitTesting,u=void 0===s?0:s,c=e.points,v=e.pointerEvents,d=void 0===v?"auto":v,h=e.fill,l=e.stroke,p=f(d,h,l);return!(!o(p,2)[1]&&!r||!a)&&G(c.points,a+u,n.x,n.y,!1)}function Z(t,n,r,e,i){var a=t.parsedStyle,s=a.radius,u=a.fill,c=a.stroke,v=a.lineWidth,d=void 0===v?1:v,h=a.increasedLineWidthForHitTesting,l=void 0===h?0:h,p=a.x,y=void 0===p?0:p,x=a.y,m=void 0===x?0:x,g=a.width,k=a.height,M=a.pointerEvents,I=f(void 0===M?"auto":M,u,c),C=o(I,2),E=C[0],L=C[1],S=d+l;if(s&&s.some(function(t){return 0!==t})){var W=!1;return(L||r)&&(W=function(t,n,r,e,i,a,s,u){var c=o(i,4),v=c[0],d=c[1],f=c[2],h=c[3];return j(t+v,n,t+r-d,n,a,s,u)||j(t+r,n+d,t+r,n+e-f,a,s,u)||j(t+r-f,n+e,t+h,n+e,a,s,u)||j(t,n+e-h,t,n+v,a,s,u)||R(t+r-d,n+d,d,Math.PI,Math.PI,a,s,u)||R(t+r-f,n+e-f,f,0,Math.PI,a,s,u)||R(t+h,n+e-h,h,Math.PI,Math.PI,a,s,u)||R(t+v,n+v,v,Math.PI,Math.PI,a,s,u)}(y,m,g,k,s.map(function(t){return P(t,0,Math.min(Math.abs(g)/2,Math.abs(k)/2))}),S,n.x,n.y)),W||!E&&!r||(W=e(t,n)),W}var b=S/2;return E&&L||r?O(y-b,m-b,g+b,k+b,n.x,n.y):E?O(y,m,g,k,n.x,n.y):!!L&&function(t,n,r,e,i,a,o){var s=i/2;return O(t-s,n-s,r,i,a,o)||O(t+r-s,n-s,i,e,a,o)||O(t+s,n+e-s,r,i,a,o)||O(t-s,n+s,i,e,a,o)}(y,m,g,k,S,n.x,n.y)}function _(t,n,r,e,i,o){var s=t.parsedStyle,u=s.pointerEvents,c=void 0===u?"auto":u,d=s.x,f=void 0===d?0:d,h=s.y,l=void 0===h?0:h,p=s.width,y=s.height;if("non-transparent-pixel"===c){var x=i.config.offscreenCanvas,m=o.offscreenCanvasCreator.getOrCreateCanvas(x),g=o.offscreenCanvasCreator.getOrCreateContext(x,{willReadFrequently:!0});return m.width=p,m.height=y,i.defaultStyleRendererFactory[v.IMAGE].render(g,a(a({},t.parsedStyle),{},{x:0,y:0}),t,void 0,void 0,void 0),g.getImageData(n.x-f,n.y-l,1,1).data.every(function(t){return 0!==t})}return!0}function z(t,n,r,e){var i=t.getGeometryBounds();return n.x>=i.min[0]&&n.y>=i.min[1]&&n.x<=i.max[0]&&n.y<=i.max[1]}var J=function(){function a(){var t;e(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=i(this,a,[].concat(r))).name="canvas-picker",t}return t(a,d),n(a,[{key:"init",value:function(){var t,n=(r(r(r(r(r(r(r(r(r(r(t={},v.CIRCLE,H),v.ELLIPSE,A),v.RECT,Z),v.LINE,Y),v.POLYLINE,X),v.POLYGON,U),v.PATH,Q),v.TEXT,z),v.GROUP,null),v.IMAGE,_),r(r(t,v.HTML,null),v.MESH,null));this.context.pointInPathPickerFactory=n,this.addRenderingPlugin(new T)}},{key:"destroy",value:function(){delete this.context.pointInPathPickerFactory,this.removeAllRenderingPlugins()}}])}();export{J as P};
