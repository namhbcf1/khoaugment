import{j as e}from"./index-D0cJwDsb.js";import{r as i}from"./vendor-DD54NZMZ.js";import{F as h,T as Q,e as A,C as l,f as d,m as f,aA as J,ay as W,O as X,q as Z,l as D,I as K,x as ee,$ as T,a0 as te,B as v,R as ne,y as u,D as re,H,k as R,_ as E,s as se,Y as ie}from"./antd-pmzi8FkM.js";import"./utils-Db1EesZb.js";const{Title:ae,Text:o}=Q,{Option:s}=T,{TextArea:oe}=K,{Step:me}=ie,xe=()=>{const[O,Y]=i.useState(!0),[a,w]=i.useState([]),[_,S]=i.useState([]),[c,k]=i.useState(""),[p,I]=i.useState("all"),[m,N]=i.useState([]),[$,b]=i.useState(!1),[r,V]=i.useState(null),[ce,le]=i.useState("overview"),[x]=h.useForm(),M=[{id:"RET-001",orderNumber:"ORD-12345",customer:"Nguyễn Văn A",products:[{id:1,name:"Laptop Dell Inspiron",quantity:1,reason:"Lỗi màn hình",price:15e6}],totalAmount:15e6,status:"pending",requestDate:"2023-05-15",processedBy:null,approvalDate:null,notes:"Khách hàng phàn nàn về màn hình bị chớp",returnMethod:"store",refundMethod:"original_payment",history:[{time:"2023-05-15 10:30",action:"Yêu cầu hoàn trả được tạo",user:"Nguyễn Văn A"},{time:"2023-05-15 14:45",action:"Yêu cầu được tiếp nhận",user:"Hệ thống"}]},{id:"RET-002",orderNumber:"ORD-12346",customer:"Trần Thị B",products:[{id:2,name:"Tai nghe Sony",quantity:1,reason:"Sản phẩm không đúng mô tả",price:25e5}],totalAmount:25e5,status:"approved",requestDate:"2023-05-10",processedBy:"Lê Văn C",approvalDate:"2023-05-12",notes:"Đã kiểm tra và xác nhận sản phẩm không đúng với mô tả",returnMethod:"store",refundMethod:"store_credit",history:[{time:"2023-05-10 09:15",action:"Yêu cầu hoàn trả được tạo",user:"Trần Thị B"},{time:"2023-05-11 11:30",action:"Sản phẩm đã được nhận tại cửa hàng",user:"Phạm Minh D"},{time:"2023-05-12 14:20",action:"Yêu cầu hoàn trả được chấp nhận",user:"Lê Văn C"}]},{id:"RET-003",orderNumber:"ORD-12350",customer:"Lê Văn E",products:[{id:3,name:"Chuột không dây Logitech",quantity:1,reason:"Đổi ý",price:45e4},{id:4,name:"Bàn phím cơ AKKO",quantity:1,reason:"Đổi ý",price:12e5}],totalAmount:165e4,status:"completed",requestDate:"2023-05-05",processedBy:"Lê Văn C",approvalDate:"2023-05-07",notes:"Khách hàng đổi ý trong thời gian cho phép",returnMethod:"shipping",refundMethod:"original_payment",history:[{time:"2023-05-05 16:45",action:"Yêu cầu hoàn trả được tạo",user:"Lê Văn E"},{time:"2023-05-06 10:20",action:"Sản phẩm đã được gửi trả",user:"Lê Văn E"},{time:"2023-05-07 09:30",action:"Sản phẩm đã được nhận",user:"Kho"},{time:"2023-05-07 14:15",action:"Yêu cầu hoàn trả được chấp nhận",user:"Lê Văn C"},{time:"2023-05-08 11:00",action:"Hoàn tiền thành công",user:"Hệ thống"}]},{id:"RET-004",orderNumber:"ORD-12355",customer:"Hoàng Thị F",products:[{id:5,name:'Màn hình Dell 24"',quantity:1,reason:"Sản phẩm bị lỗi",price:35e5}],totalAmount:35e5,status:"rejected",requestDate:"2023-05-08",processedBy:"Nguyễn Văn G",approvalDate:"2023-05-09",notes:"Sản phẩm đã quá thời gian đổi trả (30 ngày)",returnMethod:"store",refundMethod:null,history:[{time:"2023-05-08 13:30",action:"Yêu cầu hoàn trả được tạo",user:"Hoàng Thị F"},{time:"2023-05-09 10:45",action:"Yêu cầu hoàn trả bị từ chối",user:"Nguyễn Văn G"}]}];i.useEffect(()=>{setTimeout(()=>{w(M),S(M),Y(!1)},1e3)},[]),i.useEffect(()=>{let t=[...a];if(c&&(t=t.filter(n=>n.id.toLowerCase().includes(c.toLowerCase())||n.orderNumber.toLowerCase().includes(c.toLowerCase())||n.customer.toLowerCase().includes(c.toLowerCase()))),p!=="all"&&(t=t.filter(n=>n.status===p)),m&&m.length===2){const[n,j]=m;t=t.filter(y=>{const B=new Date(y.requestDate);return B>=n&&B<=j})}S(t)},[c,p,m,a]);const q=t=>{V(t),b(!0),x.setFieldsValue({status:t.status,notes:t.notes||"",refundMethod:t.refundMethod||""})},C=()=>{b(!1),V(null),x.resetFields()},P=()=>{x.validateFields().then(t=>{const n={...r,status:t.status,notes:t.notes,refundMethod:t.refundMethod,processedBy:"Current User",approvalDate:new Date().toISOString().split("T")[0]},j=a.map(y=>y.id===r.id?n:y);w(j),S(j),se.success(`Cập nhật trạng thái yêu cầu ${r.id} thành công!`),C()})},L=t=>({pending:"orange",approved:"blue",processing:"purple",completed:"green",rejected:"red",cancelled:"default"})[t]||"default",F=t=>({pending:"Chờ xử lý",approved:"Đã phê duyệt",processing:"Đang xử lý",completed:"Hoàn thành",rejected:"Từ chối",cancelled:"Đã hủy"})[t]||t,G=t=>({store:"Tại cửa hàng",shipping:"Gửi qua bưu điện"})[t]||t,z=t=>({original_payment:"Hoàn tiền theo phương thức thanh toán gốc",store_credit:"Tín dụng cửa hàng",exchange:"Đổi sản phẩm khác"})[t]||"Chưa xác định",U=[{title:"Mã yêu cầu",dataIndex:"id",key:"id",render:t=>e.jsx("a",{onClick:()=>q(a.find(n=>n.id===t)),children:t})},{title:"Đơn hàng",dataIndex:"orderNumber",key:"orderNumber"},{title:"Khách hàng",dataIndex:"customer",key:"customer"},{title:"Ngày yêu cầu",dataIndex:"requestDate",key:"requestDate",sorter:(t,n)=>new Date(t.requestDate)-new Date(n.requestDate)},{title:"Giá trị",dataIndex:"totalAmount",key:"totalAmount",render:t=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t)},{title:"Trạng thái",dataIndex:"status",key:"status",render:t=>e.jsx(H,{color:L(t),children:F(t)})},{title:"Thao tác",key:"actions",render:(t,n)=>e.jsx(D,{size:"small",children:e.jsx(v,{type:"primary",size:"small",onClick:()=>q(n),children:"Chi tiết"})})}],g={total:a.length,pending:a.filter(t=>t.status==="pending").length,completed:a.filter(t=>t.status==="completed").length,rejected:a.filter(t=>t.status==="rejected").length,totalValue:a.reduce((t,n)=>t+n.totalAmount,0)};return e.jsxs("div",{children:[e.jsx(ae,{level:2,children:"Quản lý đơn hoàn trả"}),e.jsxs(A,{gutter:16,style:{marginBottom:16},children:[e.jsx(l,{xs:24,sm:12,md:6,children:e.jsx(d,{children:e.jsx(f,{title:"Tổng số đơn hoàn trả",value:g.total,prefix:e.jsx(J,{style:{color:"#1890ff"}})})})}),e.jsx(l,{xs:24,sm:12,md:6,children:e.jsx(d,{children:e.jsx(f,{title:"Chờ xử lý",value:g.pending,prefix:e.jsx(W,{style:{color:"#faad14"}})})})}),e.jsx(l,{xs:24,sm:12,md:6,children:e.jsx(d,{children:e.jsx(f,{title:"Hoàn thành",value:g.completed,prefix:e.jsx(X,{style:{color:"#52c41a"}})})})}),e.jsx(l,{xs:24,sm:12,md:6,children:e.jsx(d,{children:e.jsx(f,{title:"Tổng giá trị hoàn trả",value:g.totalValue,precision:0,formatter:t=>`${new Intl.NumberFormat("vi-VN").format(t)} VND`,prefix:e.jsx(Z,{style:{color:"#722ed1"}})})})})]}),e.jsx(d,{style:{marginBottom:16},children:e.jsxs(D,{wrap:!0,children:[e.jsx(K,{placeholder:"Tìm kiếm theo mã, đơn hàng, khách hàng",prefix:e.jsx(ee,{}),value:c,onChange:t=>k(t.target.value),style:{width:300}}),e.jsxs(T,{placeholder:"Trạng thái",style:{width:150},value:p,onChange:t=>I(t),children:[e.jsx(s,{value:"all",children:"Tất cả trạng thái"}),e.jsx(s,{value:"pending",children:"Chờ xử lý"}),e.jsx(s,{value:"approved",children:"Đã phê duyệt"}),e.jsx(s,{value:"processing",children:"Đang xử lý"}),e.jsx(s,{value:"completed",children:"Hoàn thành"}),e.jsx(s,{value:"rejected",children:"Từ chối"}),e.jsx(s,{value:"cancelled",children:"Đã hủy"})]}),e.jsx(te.RangePicker,{onChange:t=>N(t)}),e.jsx(v,{icon:e.jsx(ne,{}),onClick:()=>{k(""),I("all"),N([])},children:"Làm mới"})]})}),e.jsx(u,{columns:U,dataSource:_,rowKey:"id",loading:O,pagination:{pageSize:10,showSizeChanger:!0,pageSizeOptions:["10","20","50"]}}),e.jsx(re,{title:`Chi tiết yêu cầu hoàn trả: ${r?.id}`,placement:"right",width:720,onClose:C,visible:$,footer:e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(D,{children:[e.jsx(v,{onClick:C,children:"Đóng"}),e.jsx(v,{type:"primary",onClick:P,children:"Cập nhật"})]})}),children:r&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{gutter:[16,16],children:[e.jsxs(l,{span:12,children:[e.jsxs("div",{children:[e.jsx(o,{strong:!0,children:"Mã đơn hàng:"})," ",r.orderNumber]}),e.jsxs("div",{children:[e.jsx(o,{strong:!0,children:"Khách hàng:"})," ",r.customer]}),e.jsxs("div",{children:[e.jsx(o,{strong:!0,children:"Ngày yêu cầu:"})," ",r.requestDate]}),e.jsxs("div",{children:[e.jsx(o,{strong:!0,children:"Phương thức hoàn trả:"})," ",G(r.returnMethod)]})]}),e.jsxs(l,{span:12,children:[e.jsxs("div",{children:[e.jsx(o,{strong:!0,children:"Trạng thái:"})," ",e.jsx(H,{color:L(r.status),children:F(r.status)})]}),r.processedBy&&e.jsxs("div",{children:[e.jsx(o,{strong:!0,children:"Người xử lý:"})," ",r.processedBy]}),r.approvalDate&&e.jsxs("div",{children:[e.jsx(o,{strong:!0,children:"Ngày xử lý:"})," ",r.approvalDate]}),r.refundMethod&&e.jsxs("div",{children:[e.jsx(o,{strong:!0,children:"Phương thức hoàn tiền:"})," ",z(r.refundMethod)]})]})]}),e.jsx(R,{children:"Sản phẩm hoàn trả"}),e.jsx(u,{dataSource:r.products,rowKey:"id",pagination:!1,columns:[{title:"Sản phẩm",dataIndex:"name",key:"name"},{title:"Số lượng",dataIndex:"quantity",key:"quantity"},{title:"Lý do",dataIndex:"reason",key:"reason"},{title:"Giá trị",dataIndex:"price",key:"price",render:t=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t)}],summary:()=>e.jsxs(u.Summary.Row,{children:[e.jsx(u.Summary.Cell,{colSpan:3,children:e.jsx("strong",{children:"Tổng cộng"})}),e.jsx(u.Summary.Cell,{children:e.jsx(o,{type:"danger",strong:!0,children:new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(r.totalAmount)})})]})}),e.jsx(R,{children:"Cập nhật trạng thái"}),e.jsxs(h,{form:x,layout:"vertical",children:[e.jsx(h.Item,{name:"status",label:"Trạng thái",rules:[{required:!0,message:"Vui lòng chọn trạng thái"}],children:e.jsxs(T,{children:[e.jsx(s,{value:"pending",children:"Chờ xử lý"}),e.jsx(s,{value:"approved",children:"Đã phê duyệt"}),e.jsx(s,{value:"processing",children:"Đang xử lý"}),e.jsx(s,{value:"completed",children:"Hoàn thành"}),e.jsx(s,{value:"rejected",children:"Từ chối"}),e.jsx(s,{value:"cancelled",children:"Đã hủy"})]})}),e.jsx(h.Item,{name:"refundMethod",label:"Phương thức hoàn tiền",children:e.jsxs(T,{children:[e.jsx(s,{value:"",children:"-- Chọn phương thức --"}),e.jsx(s,{value:"original_payment",children:"Hoàn tiền theo phương thức thanh toán gốc"}),e.jsx(s,{value:"store_credit",children:"Tín dụng cửa hàng"}),e.jsx(s,{value:"exchange",children:"Đổi sản phẩm khác"})]})}),e.jsx(h.Item,{name:"notes",label:"Ghi chú",children:e.jsx(oe,{rows:4})})]}),e.jsx(R,{children:"Lịch sử xử lý"}),e.jsx(E,{mode:"left",children:r.history.map((t,n)=>e.jsxs(E.Item,{label:t.time,children:[e.jsx("p",{children:e.jsx("strong",{children:t.action})}),e.jsxs("p",{children:["Bởi: ",t.user]})]},n))})]})})]})};export{xe as default};
