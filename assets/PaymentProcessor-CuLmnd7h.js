import{j as e}from"./index-D0cJwDsb.js";import{r as j}from"./vendor-DD54NZMZ.js";import{f as d}from"./formatters-zHPZYAEt.js";import{F as c,Y as O,W as te,f as P,Z as i,k as N,e as T,C as x,l as b,T as ne,B as f,aE as se,O as B,n as ie,I as p,g as re,aS as V,aP as E,as as q,X as k,bE as le,q as ae,b9 as ce,w as oe,s as C,$ as he}from"./antd-pmzi8FkM.js";import"./utils-Db1EesZb.js";class de{constructor(){this.connected=!1,this.printers=[{id:"thermal1",name:"EPSON TM-T82 (Thermal)",type:"thermal",status:"ready",default:!0},{id:"thermal2",name:"XPRINTER XP-58 (Thermal)",type:"thermal",status:"ready",default:!1},{id:"laser1",name:"HP LaserJet Pro",type:"laser",status:"ready",default:!1}],this.selectedPrinter=this.printers[0]}getAvailablePrinters(){return this.printers}selectPrinter(r){const l=this.printers.find(a=>a.id===r);return l?(this.selectedPrinter=l,console.log(`Selected printer: ${l.name}`),l):null}getSelectedPrinter(){return this.selectedPrinter}connect(){return new Promise(r=>{console.log(`Connecting to printer: ${this.selectedPrinter.name}`),setTimeout(()=>{this.connected=!0,console.log(`Printer ${this.selectedPrinter.name} connected successfully`),r(!0)},800)})}disconnect(){return new Promise(r=>{if(!this.connected){r(!1);return}console.log(`Disconnecting from printer: ${this.selectedPrinter.name}`),setTimeout(()=>{this.connected=!1,console.log(`Printer ${this.selectedPrinter.name} disconnected`),r(!0)},500)})}print(r={}){return new Promise((l,a)=>{const{content:h,type:u="receipt"}=r;if(!this.connected){this.connect().then(()=>this._doPrint(h,u)).then(l).catch(a);return}this._doPrint(h,u).then(l).catch(a)})}_doPrint(r,l){return new Promise((a,h)=>{if(!r){h(new Error("No content to print"));return}console.log(`Printing ${l} on ${this.selectedPrinter.name}...`),setTimeout(()=>{if(Math.random()>.1)console.log(`Print job completed successfully on ${this.selectedPrinter.name}`),a({success:!0,printerId:this.selectedPrinter.id,timestamp:new Date().toISOString()});else{const u=["Paper jam","Out of paper","Low ink","Connection lost","Printer busy"],S=u[Math.floor(Math.random()*u.length)];console.error(`Print error: ${S}`),h(new Error(`Print failed: ${S}`))}},2e3)})}checkStatus(){return new Promise(r=>{setTimeout(()=>{const l=["ready","ready","ready","ready","low_paper","low_ink","ready"],a=l[Math.floor(Math.random()*l.length)],h={...this.selectedPrinter,status:a};this.selectedPrinter=h,this.printers=this.printers.map(u=>u.id===h.id?h:u),r(h)},500)})}}const F=new de,{Title:z,Text:o}=ne,{Step:L}=O,{Option:je}=he,ye=({orderData:n,onComplete:r,onCancel:l})=>{const[a]=c.useForm(),[h,u]=j.useState(0),[S,M]=j.useState(!1),[_,I]=j.useState("idle"),[g,G]=j.useState("cash"),[$,A]=j.useState(0),[X,w]=j.useState("idle"),[s,K]=j.useState(null),R=[{value:"cash",label:"Tiền mặt",icon:e.jsx(ae,{})},{value:"card",label:"Thẻ tín dụng/ghi nợ",icon:e.jsx(ce,{})},{value:"momo",label:"Ví MoMo",icon:e.jsx(V,{})},{value:"vnpay",label:"VNPay",icon:e.jsx(k,{})},{value:"zalopay",label:"ZaloPay",icon:e.jsx(V,{})},{value:"bank_transfer",label:"Chuyển khoản",icon:e.jsx(oe,{})}],Y=[1e4,2e4,5e4,1e5,2e5,5e5];j.useEffect(()=>{n&&n.netAmount&&(A(n.netAmount),a.setFieldsValue({amount:n.netAmount,paymentMethod:"cash"}))},[n,a]);const Q=t=>{G(t),t==="cash"?a.setFieldsValue({cashAmount:n?.netAmount||0,cardNumber:void 0,cardHolderName:void 0,cardExpiry:void 0,cardCVC:void 0}):a.setFieldsValue({cashAmount:void 0,changeAmount:void 0})},v=t=>{A(t);const m=n?.netAmount||0,y=t-m;a.setFieldsValue({changeAmount:y>0?y:0})},Z=t=>{const y=($||0)+t;A(y),v(y)},J=()=>{const t=n?.netAmount||0;A(t),v(t)},U=async t=>{I("processing"),M(!0);try{await new Promise(y=>setTimeout(y,1500));const m={id:`HD${Date.now().toString().slice(-6)}`,date:new Date().toLocaleString(),items:n.items,totalAmount:n.totalAmount,totalDiscount:n.totalDiscount,netAmount:n.netAmount,paymentMethod:t.paymentMethod,cashAmount:t.cashAmount,changeAmount:t.changeAmount,customerName:t.customerName||"Khách lẻ",customerPhone:t.customerPhone||"",cashier:"Nguyễn Văn A"};K(m),I("success"),u(1),C.success("Thanh toán thành công!")}catch(m){console.error("Payment error:",m),I("error"),C.error("Có lỗi xảy ra khi xử lý thanh toán!")}finally{M(!1)}},W=async()=>{if(s){w("printing");try{await F.connect(),await new Promise(t=>setTimeout(t,1500)),await F.printReceipt(s),w("success"),C.success("Đã in hóa đơn thành công!")}catch(t){console.error("Printing error:",t),w("error"),C.error("Có lỗi xảy ra khi in hóa đơn!")}}},H=()=>{typeof r=="function"&&r({...s,status:"completed"})},D=()=>{typeof l=="function"&&l()},ee=()=>{switch(h){case 0:return e.jsxs(c,{form:a,layout:"vertical",onFinish:U,initialValues:{paymentMethod:"cash",amount:n?.netAmount||0},children:[e.jsxs(P,{className:"order-summary",size:"small",style:{marginBottom:16},children:[e.jsxs(i,{title:"Thông tin đơn hàng",size:"small",column:2,children:[e.jsx(i.Item,{label:"Số sản phẩm",children:n?.items?.length||0}),e.jsx(i.Item,{label:"Tổng số lượng",children:n?.items?.reduce((t,m)=>t+m.quantity,0)||0}),e.jsx(i.Item,{label:"Tổng tiền",children:d(n?.totalAmount||0)}),e.jsx(i.Item,{label:"Chiết khấu",children:d(n?.totalDiscount||0)})]}),e.jsx(N,{style:{margin:"12px 0"}}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(o,{type:"secondary",children:"Thành tiền:"}),e.jsx(z,{level:3,style:{margin:0},children:d(n?.netAmount||0)})]})]}),e.jsx(P,{title:"Thông tin khách hàng",size:"small",style:{marginBottom:16},children:e.jsxs(T,{gutter:16,children:[e.jsx(x,{span:12,children:e.jsx(c.Item,{name:"customerName",label:"Tên khách hàng",children:e.jsx(p,{prefix:e.jsx(re,{}),placeholder:"Khách lẻ"})})}),e.jsx(x,{span:12,children:e.jsx(c.Item,{name:"customerPhone",label:"Số điện thoại",children:e.jsx(p,{prefix:e.jsx(V,{}),placeholder:"Số điện thoại"})})})]})}),e.jsxs(P,{title:"Phương thức thanh toán",size:"small",style:{marginBottom:16},children:[e.jsx(c.Item,{name:"paymentMethod",rules:[{required:!0,message:"Vui lòng chọn phương thức thanh toán!"}],children:e.jsx(E.Group,{onChange:t=>Q(t.target.value),buttonStyle:"solid",style:{width:"100%"},children:e.jsx(b,{direction:"vertical",style:{width:"100%"},children:R.map(t=>e.jsxs(E.Button,{value:t.value,style:{width:"100%",height:"40px",lineHeight:"32px"},children:[t.icon," ",t.label]},t.value))})})}),e.jsxs("div",{className:"payment-details",children:[g==="cash"&&e.jsxs(e.Fragment,{children:[e.jsxs(T,{gutter:16,children:[e.jsx(x,{span:12,children:e.jsx(c.Item,{label:"Số tiền khách đưa",name:"cashAmount",rules:[{required:!0,message:"Vui lòng nhập số tiền khách đưa!"},{validator:(t,m)=>m<(n?.netAmount||0)?Promise.reject("Số tiền không đủ!"):Promise.resolve()}],children:e.jsx(q,{style:{width:"100%"},formatter:t=>`${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,""),min:n?.netAmount||0,step:1e4,value:$,onChange:v})})}),e.jsx(x,{span:12,children:e.jsx(c.Item,{label:"Tiền thừa",name:"changeAmount",children:e.jsx(q,{style:{width:"100%"},formatter:t=>`${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,""),disabled:!0})})})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsx(o,{strong:!0,children:"Chọn mệnh giá:"}),e.jsx("div",{style:{marginTop:8},children:e.jsxs(b,{wrap:!0,children:[Y.map(t=>e.jsx(f,{onClick:()=>Z(t),children:d(t)},t)),e.jsx(f,{type:"primary",ghost:!0,onClick:J,children:"Tiền chẵn"})]})})]})]}),g==="card"&&e.jsxs(T,{gutter:16,children:[e.jsx(x,{span:24,children:e.jsx(c.Item,{label:"Số thẻ",name:"cardNumber",rules:[{required:!0,message:"Vui lòng nhập số thẻ!"}],children:e.jsx(p,{placeholder:"Số thẻ",maxLength:19})})}),e.jsx(x,{span:24,children:e.jsx(c.Item,{label:"Tên chủ thẻ",name:"cardHolderName",rules:[{required:!0,message:"Vui lòng nhập tên chủ thẻ!"}],children:e.jsx(p,{placeholder:"Tên chủ thẻ"})})}),e.jsx(x,{span:12,children:e.jsx(c.Item,{label:"Hạn thẻ",name:"cardExpiry",rules:[{required:!0,message:"Vui lòng nhập hạn thẻ!"}],children:e.jsx(p,{placeholder:"MM/YY",maxLength:5})})}),e.jsx(x,{span:12,children:e.jsx(c.Item,{label:"CVC/CVV",name:"cardCVC",rules:[{required:!0,message:"Vui lòng nhập mã CVC/CVV!"}],children:e.jsx(p,{placeholder:"CVC/CVV",maxLength:4})})})]}),(g==="momo"||g==="vnpay"||g==="zalopay")&&e.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[e.jsx(k,{style:{fontSize:100,marginBottom:16}}),e.jsx(z,{level:4,children:"Quét mã QR để thanh toán"}),e.jsxs(o,{type:"secondary",children:["Số tiền: ",d(n?.netAmount||0)]}),e.jsx("br",{}),e.jsxs(o,{type:"secondary",children:["Sử dụng ứng dụng ",g==="momo"?"MoMo":g==="vnpay"?"VNPay":"ZaloPay"," để quét mã"]}),e.jsx(c.Item,{name:"transactionId",label:"Mã giao dịch",style:{marginTop:16},children:e.jsx(p,{placeholder:"Nhập mã giao dịch (nếu có)"})})]}),g==="bank_transfer"&&e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsxs(b,{direction:"vertical",children:[e.jsx(o,{strong:!0,children:"Thông tin chuyển khoản"}),e.jsxs(i,{column:1,children:[e.jsx(i.Item,{label:"Tên tài khoản",children:"CONG TY TNHH TRUONG PHAT"}),e.jsx(i.Item,{label:"Số tài khoản",children:"0123456789"}),e.jsx(i.Item,{label:"Ngân hàng",children:"Vietcombank - CN Hòa Bình"}),e.jsx(i.Item,{label:"Số tiền",children:d(n?.netAmount||0)}),e.jsxs(i.Item,{label:"Nội dung",children:["THANHTOAN HD",Date.now().toString().slice(-6)]})]}),e.jsx(k,{style:{fontSize:100,margin:"16px 0"}}),e.jsx(c.Item,{name:"transactionId",label:"Mã giao dịch",children:e.jsx(p,{placeholder:"Nhập mã giao dịch ngân hàng"})})]})})]})]}),e.jsx(P,{title:"Ghi chú",size:"small",style:{marginBottom:16},children:e.jsx(c.Item,{name:"note",children:e.jsx(p.TextArea,{rows:2,placeholder:"Ghi chú cho đơn hàng (nếu có)"})})}),e.jsx(c.Item,{children:e.jsxs(b,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsx(f,{type:"default",onClick:D,icon:e.jsx(le,{}),children:"Quay lại"}),e.jsx(f,{type:"primary",htmlType:"submit",loading:_==="processing",icon:e.jsx(B,{}),children:"Xác nhận thanh toán"})]})})]});case 1:return e.jsx("div",{className:"payment-completion",children:e.jsx(te,{status:"success",title:"Thanh toán thành công!",subTitle:`Mã hóa đơn: ${s?.id||"HD000000"} - ${s?.date||new Date().toLocaleString()}`,extra:[e.jsx(f,{type:"primary",onClick:W,loading:X==="printing",icon:e.jsx(se,{}),children:"In hóa đơn"},"print"),e.jsx(f,{onClick:H,icon:e.jsx(B,{}),children:"Hoàn thành"},"complete"),e.jsx(f,{type:"default",icon:e.jsx(ie,{}),onClick:H,children:"Đơn hàng mới"},"new")],children:e.jsx("div",{className:"receipt-summary",children:e.jsxs(P,{title:"Chi tiết hóa đơn",style:{marginTop:16},children:[e.jsxs(i,{column:2,children:[e.jsx(i.Item,{label:"Khách hàng",children:s?.customerName||"Khách lẻ"}),e.jsx(i.Item,{label:"Số điện thoại",children:s?.customerPhone||"N/A"}),e.jsx(i.Item,{label:"Phương thức thanh toán",children:R.find(t=>t.value===s?.paymentMethod)?.label||"Tiền mặt"}),e.jsx(i.Item,{label:"Thu ngân",children:s?.cashier||"N/A"})]}),e.jsx(N,{style:{margin:"12px 0"}}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:[e.jsx("th",{style:{padding:"8px",textAlign:"left"},children:"Sản phẩm"}),e.jsx("th",{style:{padding:"8px",textAlign:"right"},children:"SL"}),e.jsx("th",{style:{padding:"8px",textAlign:"right"},children:"Đơn giá"}),e.jsx("th",{style:{padding:"8px",textAlign:"right"},children:"Thành tiền"})]})}),e.jsx("tbody",{children:s?.items?.map((t,m)=>e.jsxs("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:[e.jsx("td",{style:{padding:"8px",textAlign:"left"},children:t.name}),e.jsx("td",{style:{padding:"8px",textAlign:"right"},children:t.quantity}),e.jsx("td",{style:{padding:"8px",textAlign:"right"},children:d(t.price)}),e.jsx("td",{style:{padding:"8px",textAlign:"right"},children:d(t.price*t.quantity)})]},m))})]}),e.jsx(N,{style:{margin:"12px 0"}}),e.jsx(T,{children:e.jsx(x,{span:12,offset:12,children:e.jsxs(b,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(o,{children:"Tổng tiền:"}),e.jsx(o,{children:d(s?.totalAmount||0)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(o,{children:"Chiết khấu:"}),e.jsxs(o,{type:"danger",children:["- ",d(s?.totalDiscount||0)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(o,{strong:!0,children:"Thành tiền:"}),e.jsx(o,{strong:!0,children:d(s?.netAmount||0)})]}),s?.paymentMethod==="cash"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(o,{children:"Tiền khách đưa:"}),e.jsx(o,{children:d(s?.cashAmount||0)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(o,{children:"Tiền thừa:"}),e.jsx(o,{children:d(s?.changeAmount||0)})]})]})]})})})]})})})});default:return null}};return e.jsxs("div",{className:"payment-processor",children:[e.jsxs(O,{current:h,style:{marginBottom:24},children:[e.jsx(L,{title:"Thanh toán",description:"Nhập thông tin thanh toán"}),e.jsx(L,{title:"Hoàn thành",description:"Xử lý hóa đơn"})]}),e.jsx("div",{className:"steps-content",children:ee()})]})};export{ye as default};
