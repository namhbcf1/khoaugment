import{r as e,j as t,i as n,u as s,L as a,g as i,O as r}from"./react-vendor-BmR3b86j.js";import{k as o,b as c,S as l,T as d,c as h,j as u,A as m,P as p,h as g,B as y,M as x,Q as b,I as f,i as j,l as v,t as k,R as S,a as w,V as C,W as T,x as N,X as P,C as O}from"./antd-core-DmtdYCMe.js";import{aD as D,P as I,ax as A,an as R,c as L,bi as M,l as E,m as _,bj as B,bk as z,bl as q,ak as F,aG as K,a7 as U,X as G,a4 as H,bm as V,bn as $,bo as W,bp as X,bq as Q,a2 as Y,o as J,aw as Z,al as ee,br as te,bs as ne,bt as se,ac as ae,_ as ie,bu as re,q as oe,r as ce,at as le,Z as de,a5 as he,a3 as ue,u as me,p as pe,j as ge,z as ye,R as xe,aO as be,D as fe,K as je,bv as ve,J as ke,aq as Se,F as we,a as Ce,bw as Te,w as Ne,B as Pe,b as Oe}from"./antd-icons-CM8WQBCd.js";import{a as De}from"./http-ztdpVPaQ.js";import{i as Ie}from"./i18n-Bumj-RJR.js";import{B as Ae}from"./vendor-i18next-browser-languagedetector-F0gxWJsw.js";const Re=[{id:1,email:"admin@truongphat.com",password:"admin123",name:"Admin User",role:"admin",avatar_url:null,permissions:["all"],total_points:1500,current_level:5,department:"Management"},{id:2,email:"cashier@truongphat.com",password:"cashier123",name:"Cashier User",role:"cashier",avatar_url:null,permissions:["pos","customers"],total_points:800,current_level:3,department:"Sales"},{id:3,email:"staff@truongphat.com",password:"staff123",name:"Staff User",role:"staff",avatar_url:null,permissions:["inventory","products"],total_points:600,current_level:2,department:"Warehouse"}],Le=[{id:1,name:"iPhone 15 Pro",sku:"IP15P-128",barcode:"1234567890123",price:2999e4,cost_price:25e6,stock_quantity:15,category_id:1,category_name:"Điện thoại",description:"iPhone 15 Pro 128GB",image_url:null,is_active:!0},{id:2,name:"Samsung Galaxy S24",sku:"SGS24-256",barcode:"1234567890124",price:2299e4,cost_price:19e6,stock_quantity:8,category_id:1,category_name:"Điện thoại",description:"Samsung Galaxy S24 256GB",image_url:null,is_active:!0},{id:3,name:"MacBook Air M3",sku:"MBA-M3-512",barcode:"1234567890125",price:3499e4,cost_price:3e7,stock_quantity:5,category_id:2,category_name:"Laptop",description:"MacBook Air M3 512GB",image_url:null,is_active:!0}],Me=[{id:1,order_number:"ORD-001",customer_id:1,customer_name:"Nguyễn Văn A",total_amount:2999e4,status:"completed",payment_method:"cash",created_at:(new Date).toISOString(),items:[{id:1,product_id:1,product_name:"iPhone 15 Pro",quantity:1,unit_price:2999e4,total_price:2999e4}]}],Ee=(e=500)=>new Promise(t=>setTimeout(t,e)),_e={async login(e,t){await Ee();const n=Re.find(n=>n.email===e&&n.password===t);if(!n)throw new Error("Invalid credentials");const s=`mock-jwt-token-${n.id}`,{password:a,...i}=n;return{success:!0,data:{user:i,token:s,refresh_token:`mock-refresh-token-${n.id}`}}},logout:async()=>(await Ee(200),{success:!0}),async getProfile(){await Ee();const e=localStorage.getItem("access_token");if(!e||!e.startsWith("mock-jwt-token-"))throw new Error("Unauthorized");const t=parseInt(e.split("-").pop()),n=Re.find(e=>e.id===t);if(!n)throw new Error("User not found");const{password:s,...a}=n;return{success:!0,data:{user:a}}},async getProducts(e={}){await Ee();let t=[...Le];return e.search&&(t=t.filter(t=>t.name.toLowerCase().includes(e.search.toLowerCase())||t.sku.toLowerCase().includes(e.search.toLowerCase()))),e.category_id&&(t=t.filter(t=>t.category_id===parseInt(e.category_id))),{success:!0,data:t,pagination:{total:t.length,page:1,limit:20}}},async getProduct(e){await Ee();const t=Le.find(t=>t.id===parseInt(e));if(!t)throw new Error("Product not found");return{success:!0,data:t}},getOrders:async(e={})=>(await Ee(),{success:!0,data:Me,pagination:{total:Me.length,page:1,limit:20}}),async createOrder(e){await Ee();const t={id:Me.length+1,order_number:`ORD-${String(Me.length+1).padStart(3,"0")}`,...e,status:"completed",created_at:(new Date).toISOString()};return Me.push(t),{success:!0,data:t}},getDashboardStats:async()=>(await Ee(),{success:!0,data:{today_sales:5299e4,today_orders:3,total_products:Le.length,low_stock_products:2,monthly_revenue:125e7,monthly_growth:15.5,top_products:Le.slice(0,3),recent_orders:Me.slice(0,5)}}),getCategories:async()=>(await Ee(),{success:!0,data:[{id:1,name:"Điện thoại",description:"Smartphone và phụ kiện"},{id:2,name:"Laptop",description:"Máy tính xách tay"},{id:3,name:"Phụ kiện",description:"Phụ kiện điện tử"}]})},Be=()=>{const e="https://khochuan-pos-api.bangachieu2.workers.dev"?.includes("localhost:8787"),t=!navigator.onLine;return e||t||!1},ze=De.create({baseURL:"https://khochuan-pos-api.bangachieu2.workers.dev",headers:{"Content-Type":"application/json"}}),qe="/auth/login",Fe="/auth/logout",Ke=async e=>{if(Be())try{const t=await _e.login(e.email,e.password);return{success:!0,user:t.data.user,token:t.data.token}}catch(t){return{success:!1,message:t.message||"Email hoặc mật khẩu không đúng!"}}try{return(await ze.post(qe,e)).data}catch(t){try{const t=await _e.login(e.email,e.password);return{success:!0,user:t.data.user,token:t.data.token}}catch(n){return t.response?{success:!1,message:t.response.data.message||"Đăng nhập thất bại"}:{success:!1,message:"Email hoặc mật khẩu không đúng!"}}}},Ue=async()=>{if(Be())return await _e.logout();try{const e=localStorage.getItem("khochuan_token");if(e){return(await ze.post(Fe,{},{headers:{Authorization:`Bearer ${e}`}})).data}return{success:!0,message:"Đã đăng xuất"}}catch(e){return{success:!0,message:"Đã đăng xuất"}}},Ge=e=>{e?ze.defaults.headers.common.Authorization=`Bearer ${e}`:delete ze.defaults.headers.common.Authorization},He={user:null,token:null,loading:!0,isAuthenticated:!1,permissions:[],role:null,lastActivity:null,expiresAt:null},Ve="LOGIN_START",$e="LOGIN_SUCCESS",We="LOGIN_FAILURE",Xe="LOGOUT",Qe="SET_LOADING",Ye="UPDATE_USER",Je="SET_PERMISSIONS",Ze="UPDATE_LAST_ACTIVITY",et="SESSION_EXPIRED",tt=18e5,nt="khochuan_token",st="khochuan_user",at="khochuan_expires",it="khochuan_last_activity",rt=(e,t)=>{switch(t.type){case Ve:return{...e,loading:!0};case $e:return{...e,user:t.payload.user,token:t.payload.token,role:t.payload.user.role,permissions:t.payload.permissions||[],isAuthenticated:!0,loading:!1,lastActivity:t.payload.lastActivity||Date.now(),expiresAt:t.payload.expiresAt||null};case We:return{...e,user:null,token:null,role:null,permissions:[],isAuthenticated:!1,loading:!1,lastActivity:null,expiresAt:null};case Xe:case et:return{...He,loading:!1};case Qe:return{...e,loading:t.payload};case Ye:return{...e,user:{...e.user,...t.payload}};case Je:return{...e,permissions:t.payload};case Ze:return{...e,lastActivity:t.payload};default:return e}},ot=e.createContext(),ct=({children:n})=>{const[s,a]=e.useReducer(rt,He),i=e.useCallback(()=>!!(s.expiresAt&&Date.now()>s.expiresAt)&&(o.warning("Phiên đăng nhập đã hết hạn. Vui lòng đăng nhập lại."),d(!0),!0),[s.expiresAt]),r=e.useCallback(()=>!!(s.lastActivity&&Date.now()-s.lastActivity>tt)&&(o.warning("Phiên làm việc đã hết hạn do không hoạt động. Vui lòng đăng nhập lại."),d(!0),!0),[s.lastActivity]),c=e.useCallback(()=>{if(s.isAuthenticated){const e=Date.now();a({type:Ze,payload:e}),localStorage.setItem(it,e.toString())}},[s.isAuthenticated]);e.useEffect(()=>{if(!s.isAuthenticated)return;const e=["mousedown","keydown","touchstart","scroll"],t=()=>c();e.forEach(e=>{window.addEventListener(e,t)});const n=setInterval(()=>{i()||r()},6e4);return()=>{e.forEach(e=>{window.removeEventListener(e,t)}),clearInterval(n)}},[s.isAuthenticated,c,i,r]),e.useEffect(()=>{const e=localStorage.getItem(nt),t=localStorage.getItem(st),n=localStorage.getItem(at),s=localStorage.getItem(it);if(e&&t)try{const i=JSON.parse(t),r=n?parseInt(n,10):null,o=s?parseInt(s,10):Date.now();r&&Date.now()>r?d(!0):(Ge(e),a({type:$e,payload:{user:i,token:e,permissions:i.permissions||[],expiresAt:r,lastActivity:o}}))}catch(i){l()}a({type:Qe,payload:!1})},[]);const l=()=>{localStorage.removeItem(nt),localStorage.removeItem(st),localStorage.removeItem(at),localStorage.removeItem(it),Ge(null)},d=async(e=!1)=>{e||await Ue(),l(),a({type:e?et:Xe}),e||o.success("Đăng xuất thành công!")},h={...s,login:async e=>{a({type:Ve});try{const t=await Ke(e);if(t.success){const{user:e,token:n}=t.data||t;Ge(n);const s=Date.now()+864e5,i=Date.now();return localStorage.setItem(nt,n),localStorage.setItem(st,JSON.stringify(e)),localStorage.setItem(at,s.toString()),localStorage.setItem(it,i.toString()),a({type:$e,payload:{user:e,token:n,permissions:dt(e.role),expiresAt:s,lastActivity:i}}),o.success("Đăng nhập thành công!"),{success:!0,user:e}}return a({type:We}),o.error(t.message||"Email hoặc mật khẩu không đúng!"),{success:!1,error:t.message}}catch(t){return a({type:We}),o.error("Đăng nhập thất bại!"),{success:!1,error:t.message}}},logout:()=>d(),updateUser:e=>{if(a({type:Ye,payload:e}),s.user){const t={...s.user,...e};localStorage.setItem(st,JSON.stringify(t))}},hasPermission:e=>s.permissions.includes(e),hasRole:e=>Array.isArray(e)?e.includes(s.role):s.role===e,updateLastActivity:c,getAccessibleMenus:()=>{if(!s.user)return[];return{admin:[{key:"dashboard",label:"Dashboard",path:"/admin/dashboard",icon:"DashboardOutlined"},{key:"pos",label:"POS Terminal",path:"/admin/pos",icon:"ShopOutlined"},{key:"customers",label:"Khách hàng",path:"/admin/customers",icon:"UserOutlined"},{key:"inventory",label:"Quản lý kho",path:"/admin/inventory-management",icon:"ShoppingOutlined"},{key:"analytics",label:"Analytics & BI",path:"/admin/analytics",icon:"BarChartOutlined"},{key:"gamification",label:"Gamification",path:"/admin/gamification",icon:"TrophyOutlined"},{key:"ai-features",label:"AI & ML",path:"/admin/ai-features",icon:"BulbOutlined"},{key:"products",label:"Sản phẩm",path:"/admin/products",icon:"ShoppingCartOutlined",children:[{key:"products-list",label:"Danh sách sản phẩm",path:"/admin/products",icon:"AppstoreOutlined"},{key:"products-bulk",label:"Thao tác hàng loạt",path:"/admin/products/bulk",icon:"FileTextOutlined"},{key:"products-price",label:"Tối ưu giá",path:"/admin/products/price-optimization",icon:"DollarOutlined"}]},{key:"orders",label:"Đơn hàng",path:"/admin/orders",icon:"ShoppingCartOutlined",children:[{key:"orders-list",label:"Quản lý đơn hàng",path:"/admin/orders",icon:"ShoppingCartOutlined"},{key:"orders-analytics",label:"Phân tích đơn hàng",path:"/admin/orders/analytics",icon:"BarChartOutlined"},{key:"orders-returns",label:"Xử lý trả hàng",path:"/admin/orders/returns",icon:"RollbackOutlined"}]},{key:"staff",label:"Nhân viên",path:"/admin/staff",icon:"TeamOutlined",children:[{key:"staff-management",label:"Quản lý nhân viên",path:"/admin/staff",icon:"TeamOutlined"},{key:"staff-performance",label:"Hiệu suất",path:"/admin/staff/performance",icon:"TrophyOutlined"},{key:"staff-gamification",label:"Gamification",path:"/admin/staff/gamification",icon:"TrophyOutlined"}]},{key:"reports",label:"Báo cáo",path:"/admin/reports",icon:"FileTextOutlined",children:[{key:"reports-center",label:"Trung tâm báo cáo",path:"/admin/reports",icon:"FileTextOutlined"},{key:"reports-custom",label:"Báo cáo tùy chỉnh",path:"/admin/reports/custom",icon:"SettingOutlined"},{key:"reports-bi",label:"Business Intelligence",path:"/admin/reports/business-intelligence",icon:"BarChartOutlined"}]},{key:"settings",label:"Cài đặt",path:"/admin/settings",icon:"SettingOutlined"}],cashier:[{key:"pos",label:"POS Terminal",path:"/admin/pos",icon:"ShopOutlined"},{key:"customers",label:"Khách hàng",path:"/admin/customers",icon:"UserOutlined"},{key:"orders",label:"Đơn hàng",path:"/admin/orders",icon:"ShoppingCartOutlined"}],staff:[{key:"dashboard",label:"Dashboard",path:"/admin/dashboard",icon:"DashboardOutlined"},{key:"gamification",label:"Gamification",path:"/admin/gamification",icon:"TrophyOutlined"}]}[s.user.role]||[]}};return t.jsx(ot.Provider,{value:h,children:n})},lt=()=>{const t=e.useContext(ot);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},dt=e=>({admin:["dashboard.view","products.view","products.create","products.update","products.delete","inventory.view","inventory.update","orders.view","orders.create","orders.update","orders.delete","customers.view","customers.create","customers.update","customers.delete","staff.view","staff.create","staff.update","staff.delete","reports.view","reports.create","settings.view","settings.update","pos.use"],cashier:["pos.use","orders.view","orders.create","customers.view","customers.create","customers.update","products.view","inventory.view"],staff:["dashboard.view","sales.view","gamification.view","training.view","profile.view","profile.update"]}[e]||[]),ht={vi:{translation:{common:{save:"Lưu",cancel:"Hủy",delete:"Xóa",edit:"Sửa",add:"Thêm",search:"Tìm kiếm",filter:"Lọc",export:"Xuất",import:"Nhập",refresh:"Làm mới",loading:"Đang tải...",success:"Thành công",error:"Lỗi",warning:"Cảnh báo",info:"Thông tin",confirm:"Xác nhận",yes:"Có",no:"Không",ok:"Đồng ý",close:"Đóng",back:"Quay lại",next:"Tiếp theo",previous:"Trước",submit:"Gửi",reset:"Đặt lại",clear:"Xóa",select:"Chọn",all:"Tất cả",none:"Không có",total:"Tổng",subtotal:"Tạm tính",discount:"Giảm giá",tax:"Thuế",amount:"Số tiền",quantity:"Số lượng",price:"Giá",date:"Ngày",time:"Thời gian",status:"Trạng thái",active:"Hoạt động",inactive:"Không hoạt động",enabled:"Bật",disabled:"Tắt",online:"Trực tuyến",offline:"Ngoại tuyến"},auth:{login:"Đăng nhập",logout:"Đăng xuất",username:"Tên đăng nhập",password:"Mật khẩu",email:"Email",forgotPassword:"Quên mật khẩu?",rememberMe:"Ghi nhớ đăng nhập",loginSuccess:"Đăng nhập thành công",loginFailed:"Đăng nhập thất bại",invalidCredentials:"Thông tin đăng nhập không đúng",sessionExpired:"Phiên đăng nhập đã hết hạn",accessDenied:"Không có quyền truy cập",pleaseLogin:"Vui lòng đăng nhập"},navigation:{dashboard:"Trang chủ",pos:"Bán hàng",inventory:"Kho hàng",products:"Sản phẩm",orders:"Đơn hàng",customers:"Khách hàng",reports:"Báo cáo",analytics:"Phân tích",settings:"Cài đặt",users:"Người dùng",roles:"Vai trò",integrations:"Tích hợp",hardware:"Phần cứng",gamification:"Trò chơi hóa",ai:"Trí tuệ nhân tạo"},pos:{terminal:"Máy bán hàng",cart:"Giỏ hàng",addToCart:"Thêm vào giỏ",removeFromCart:"Xóa khỏi giỏ",clearCart:"Xóa giỏ hàng",checkout:"Thanh toán",payment:"Thanh toán",cash:"Tiền mặt",card:"Thẻ",transfer:"Chuyển khoản",change:"Tiền thối",receipt:"Hóa đơn",printReceipt:"In hóa đơn",customer:"Khách hàng",selectCustomer:"Chọn khách hàng",newCustomer:"Khách hàng mới",barcode:"Mã vạch",scanBarcode:"Quét mã vạch",productNotFound:"Không tìm thấy sản phẩm",insufficientStock:"Không đủ hàng trong kho",transactionComplete:"Giao dịch hoàn tất",openDrawer:"Mở ngăn kéo tiền"},products:{product:"Sản phẩm",products:"Sản phẩm",productName:"Tên sản phẩm",productCode:"Mã sản phẩm",category:"Danh mục",brand:"Thương hiệu",supplier:"Nhà cung cấp",costPrice:"Giá vốn",sellingPrice:"Giá bán",stock:"Tồn kho",minStock:"Tồn kho tối thiểu",maxStock:"Tồn kho tối đa",description:"Mô tả",images:"Hình ảnh",addProduct:"Thêm sản phẩm",editProduct:"Sửa sản phẩm",deleteProduct:"Xóa sản phẩm",productAdded:"Đã thêm sản phẩm",productUpdated:"Đã cập nhật sản phẩm",productDeleted:"Đã xóa sản phẩm",lowStock:"Sắp hết hàng",outOfStock:"Hết hàng",inStock:"Còn hàng"},customers:{customer:"Khách hàng",customers:"Khách hàng",customerName:"Tên khách hàng",customerCode:"Mã khách hàng",phone:"Số điện thoại",address:"Địa chỉ",birthday:"Ngày sinh",gender:"Giới tính",male:"Nam",female:"Nữ",other:"Khác",loyaltyPoints:"Điểm tích lũy",membershipLevel:"Cấp độ thành viên",totalSpent:"Tổng chi tiêu",lastVisit:"Lần ghé thăm cuối",addCustomer:"Thêm khách hàng",editCustomer:"Sửa khách hàng",deleteCustomer:"Xóa khách hàng",customerAdded:"Đã thêm khách hàng",customerUpdated:"Đã cập nhật khách hàng",customerDeleted:"Đã xóa khách hàng",vip:"VIP",regular:"Thường",new:"Mới"},orders:{order:"Đơn hàng",orders:"Đơn hàng",orderNumber:"Số đơn hàng",orderDate:"Ngày đặt hàng",orderStatus:"Trạng thái đơn hàng",pending:"Chờ xử lý",processing:"Đang xử lý",completed:"Hoàn thành",cancelled:"Đã hủy",refunded:"Đã hoàn tiền",orderTotal:"Tổng đơn hàng",orderItems:"Sản phẩm trong đơn",paymentMethod:"Phương thức thanh toán",paymentStatus:"Trạng thái thanh toán",paid:"Đã thanh toán",unpaid:"Chưa thanh toán",partiallyPaid:"Thanh toán một phần",viewOrder:"Xem đơn hàng",editOrder:"Sửa đơn hàng",cancelOrder:"Hủy đơn hàng",refundOrder:"Hoàn tiền đơn hàng"},inventory:{inventory:"Kho hàng",stockIn:"Nhập kho",stockOut:"Xuất kho",stockAdjustment:"Điều chỉnh kho",stockTransfer:"Chuyển kho",warehouse:"Kho",location:"Vị trí",batch:"Lô hàng",expiryDate:"Ngày hết hạn",serialNumber:"Số serial",stockLevel:"Mức tồn kho",reorderPoint:"Điểm đặt hàng lại",stockValue:"Giá trị tồn kho",stockMovement:"Biến động kho",stockReport:"Báo cáo kho",lowStockAlert:"Cảnh báo sắp hết hàng",stockTaking:"Kiểm kê kho"},reports:{reports:"Báo cáo",salesReport:"Báo cáo bán hàng",inventoryReport:"Báo cáo kho hàng",customerReport:"Báo cáo khách hàng",productReport:"Báo cáo sản phẩm",financialReport:"Báo cáo tài chính",dailyReport:"Báo cáo ngày",weeklyReport:"Báo cáo tuần",monthlyReport:"Báo cáo tháng",yearlyReport:"Báo cáo năm",customReport:"Báo cáo tùy chỉnh",generateReport:"Tạo báo cáo",exportReport:"Xuất báo cáo",printReport:"In báo cáo",revenue:"Doanh thu",profit:"Lợi nhuận",loss:"Lỗ",growth:"Tăng trưởng",performance:"Hiệu suất"},settings:{settings:"Cài đặt",generalSettings:"Cài đặt chung",systemSettings:"Cài đặt hệ thống",userSettings:"Cài đặt người dùng",companyInfo:"Thông tin công ty",companyName:"Tên công ty",companyAddress:"Địa chỉ công ty",companyPhone:"Điện thoại công ty",companyEmail:"Email công ty",taxNumber:"Mã số thuế",currency:"Tiền tệ",language:"Ngôn ngữ",timezone:"Múi giờ",dateFormat:"Định dạng ngày",timeFormat:"Định dạng giờ",theme:"Giao diện",notifications:"Thông báo",emailNotifications:"Thông báo email",smsNotifications:"Thông báo SMS",pushNotifications:"Thông báo đẩy",backup:"Sao lưu",restore:"Khôi phục",security:"Bảo mật",privacy:"Quyền riêng tư"},gamification:{gamification:"Trò chơi hóa",points:"Điểm",level:"Cấp độ",badge:"Huy hiệu",achievement:"Thành tựu",leaderboard:"Bảng xếp hạng",challenge:"Thử thách",reward:"Phần thưởng",experience:"Kinh nghiệm",rank:"Xếp hạng",progress:"Tiến độ",unlock:"Mở khóa",complete:"Hoàn thành",earned:"Đã kiếm được",nextLevel:"Cấp độ tiếp theo",dailyChallenge:"Thử thách hàng ngày",weeklyChallenge:"Thử thách hàng tuần",monthlyChallenge:"Thử thách hàng tháng"},hardware:{hardware:"Phần cứng",printer:"Máy in",scanner:"Máy quét",cashDrawer:"Ngăn kéo tiền",paymentTerminal:"Máy thanh toán",customerDisplay:"Màn hình khách hàng",scale:"Cân điện tử",connected:"Đã kết nối",disconnected:"Chưa kết nối",connecting:"Đang kết nối",error:"Lỗi",testDevice:"Kiểm tra thiết bị",deviceSettings:"Cài đặt thiết bị",port:"Cổng",baudRate:"Tốc độ baud",paperWidth:"Độ rộng giấy",autoScan:"Quét tự động",merchantId:"Mã thương gia",terminalId:"Mã terminal"},integrations:{integrations:"Tích hợp",marketplace:"Sàn thương mại",paymentGateway:"Cổng thanh toán",thirdPartyApps:"Ứng dụng bên thứ ba",api:"API",webhook:"Webhook",sync:"Đồng bộ",connect:"Kết nối",disconnect:"Ngắt kết nối",configure:"Cấu hình",status:"Trạng thái",lastSync:"Đồng bộ lần cuối",syncNow:"Đồng bộ ngay",autoSync:"Tự động đồng bộ",syncHistory:"Lịch sử đồng bộ",apiKey:"Khóa API",secretKey:"Khóa bí mật",endpoint:"Điểm cuối"},ai:{artificialIntelligence:"Trí tuệ nhân tạo",smartSuggestions:"Gợi ý thông minh",priceOptimization:"Tối ưu giá",demandForecasting:"Dự báo nhu cầu",customerInsights:"Hiểu biết khách hàng",inventoryOptimization:"Tối ưu kho hàng",salesPrediction:"Dự đoán bán hàng",recommendation:"Khuyến nghị",analysis:"Phân tích",prediction:"Dự đoán",optimization:"Tối ưu hóa",insights:"Hiểu biết",trends:"Xu hướng",patterns:"Mẫu",anomaly:"Bất thường",confidence:"Độ tin cậy",accuracy:"Độ chính xác",model:"Mô hình",training:"Huấn luyện",learning:"Học tập"},messages:{confirmDelete:"Bạn có chắc chắn muốn xóa?",deleteSuccess:"Xóa thành công",saveSuccess:"Lưu thành công",updateSuccess:"Cập nhật thành công",createSuccess:"Tạo thành công",operationFailed:"Thao tác thất bại",networkError:"Lỗi mạng",serverError:"Lỗi máy chủ",validationError:"Lỗi xác thực",requiredField:"Trường này là bắt buộc",invalidFormat:"Định dạng không hợp lệ",duplicateEntry:"Dữ liệu đã tồn tại",noDataFound:"Không tìm thấy dữ liệu",loadingData:"Đang tải dữ liệu...",processingRequest:"Đang xử lý yêu cầu...",operationComplete:"Thao tác hoàn tất",sessionTimeout:"Phiên làm việc hết hạn",accessDenied:"Không có quyền truy cập",featureNotAvailable:"Tính năng chưa khả dụng",maintenanceMode:"Hệ thống đang bảo trì"},validation:{required:"Trường này là bắt buộc",email:"Email không hợp lệ",phone:"Số điện thoại không hợp lệ",minLength:"Tối thiểu {{min}} ký tự",maxLength:"Tối đa {{max}} ký tự",minValue:"Giá trị tối thiểu là {{min}}",maxValue:"Giá trị tối đa là {{max}}",numeric:"Chỉ được nhập số",alphanumeric:"Chỉ được nhập chữ và số",passwordMismatch:"Mật khẩu không khớp",invalidDate:"Ngày không hợp lệ",futureDate:"Ngày phải trong tương lai",pastDate:"Ngày phải trong quá khứ",invalidUrl:"URL không hợp lệ",fileSize:"Kích thước file quá lớn",fileType:"Loại file không được hỗ trợ"}}},en:{translation:{common:{save:"Save",cancel:"Cancel",delete:"Delete",edit:"Edit",add:"Add",search:"Search",filter:"Filter",export:"Export",import:"Import",refresh:"Refresh",loading:"Loading...",success:"Success",error:"Error",warning:"Warning",info:"Information",confirm:"Confirm",yes:"Yes",no:"No",ok:"OK",close:"Close",back:"Back",next:"Next",previous:"Previous",submit:"Submit",reset:"Reset",clear:"Clear",select:"Select",all:"All",none:"None",total:"Total",subtotal:"Subtotal",discount:"Discount",tax:"Tax",amount:"Amount",quantity:"Quantity",price:"Price",date:"Date",time:"Time",status:"Status",active:"Active",inactive:"Inactive",enabled:"Enabled",disabled:"Disabled",online:"Online",offline:"Offline"},auth:{login:"Login",logout:"Logout",username:"Username",password:"Password",email:"Email",forgotPassword:"Forgot Password?",rememberMe:"Remember Me",loginSuccess:"Login successful",loginFailed:"Login failed",invalidCredentials:"Invalid credentials",sessionExpired:"Session expired",accessDenied:"Access denied",pleaseLogin:"Please login"},navigation:{dashboard:"Dashboard",pos:"POS",inventory:"Inventory",products:"Products",orders:"Orders",customers:"Customers",reports:"Reports",analytics:"Analytics",settings:"Settings",users:"Users",roles:"Roles",integrations:"Integrations",hardware:"Hardware",gamification:"Gamification",ai:"Artificial Intelligence"},pos:{terminal:"POS Terminal",cart:"Cart",addToCart:"Add to Cart",removeFromCart:"Remove from Cart",clearCart:"Clear Cart",checkout:"Checkout",payment:"Payment",cash:"Cash",card:"Card",transfer:"Transfer",change:"Change",receipt:"Receipt",printReceipt:"Print Receipt",customer:"Customer",selectCustomer:"Select Customer",newCustomer:"New Customer",barcode:"Barcode",scanBarcode:"Scan Barcode",productNotFound:"Product not found",insufficientStock:"Insufficient stock",transactionComplete:"Transaction complete",openDrawer:"Open Cash Drawer"},products:{product:"Product",products:"Products",productName:"Product Name",productCode:"Product Code",category:"Category",brand:"Brand",supplier:"Supplier",costPrice:"Cost Price",sellingPrice:"Selling Price",stock:"Stock",minStock:"Min Stock",maxStock:"Max Stock",description:"Description",images:"Images",addProduct:"Add Product",editProduct:"Edit Product",deleteProduct:"Delete Product",productAdded:"Product added",productUpdated:"Product updated",productDeleted:"Product deleted",lowStock:"Low Stock",outOfStock:"Out of Stock",inStock:"In Stock"},customers:{customer:"Customer",customers:"Customers",customerName:"Customer Name",customerCode:"Customer Code",phone:"Phone",address:"Address",birthday:"Birthday",gender:"Gender",male:"Male",female:"Female",other:"Other",loyaltyPoints:"Loyalty Points",membershipLevel:"Membership Level",totalSpent:"Total Spent",lastVisit:"Last Visit",addCustomer:"Add Customer",editCustomer:"Edit Customer",deleteCustomer:"Delete Customer",customerAdded:"Customer added",customerUpdated:"Customer updated",customerDeleted:"Customer deleted",vip:"VIP",regular:"Regular",new:"New"},orders:{order:"Order",orders:"Orders",orderNumber:"Order Number",orderDate:"Order Date",orderStatus:"Order Status",pending:"Pending",processing:"Processing",completed:"Completed",cancelled:"Cancelled",refunded:"Refunded",orderTotal:"Order Total",orderItems:"Order Items",paymentMethod:"Payment Method",paymentStatus:"Payment Status",paid:"Paid",unpaid:"Unpaid",partiallyPaid:"Partially Paid",viewOrder:"View Order",editOrder:"Edit Order",cancelOrder:"Cancel Order",refundOrder:"Refund Order"},inventory:{inventory:"Inventory",stockIn:"Stock In",stockOut:"Stock Out",stockAdjustment:"Stock Adjustment",stockTransfer:"Stock Transfer",warehouse:"Warehouse",location:"Location",batch:"Batch",expiryDate:"Expiry Date",serialNumber:"Serial Number",stockLevel:"Stock Level",reorderPoint:"Reorder Point",stockValue:"Stock Value",stockMovement:"Stock Movement",stockReport:"Stock Report",lowStockAlert:"Low Stock Alert",stockTaking:"Stock Taking"},reports:{reports:"Reports",salesReport:"Sales Report",inventoryReport:"Inventory Report",customerReport:"Customer Report",productReport:"Product Report",financialReport:"Financial Report",dailyReport:"Daily Report",weeklyReport:"Weekly Report",monthlyReport:"Monthly Report",yearlyReport:"Yearly Report",customReport:"Custom Report",generateReport:"Generate Report",exportReport:"Export Report",printReport:"Print Report",revenue:"Revenue",profit:"Profit",loss:"Loss",growth:"Growth",performance:"Performance"},settings:{settings:"Settings",generalSettings:"General Settings",systemSettings:"System Settings",userSettings:"User Settings",companyInfo:"Company Information",companyName:"Company Name",companyAddress:"Company Address",companyPhone:"Company Phone",companyEmail:"Company Email",taxNumber:"Tax Number",currency:"Currency",language:"Language",timezone:"Timezone",dateFormat:"Date Format",timeFormat:"Time Format",theme:"Theme",notifications:"Notifications",emailNotifications:"Email Notifications",smsNotifications:"SMS Notifications",pushNotifications:"Push Notifications",backup:"Backup",restore:"Restore",security:"Security",privacy:"Privacy"},gamification:{gamification:"Gamification",points:"Points",level:"Level",badge:"Badge",achievement:"Achievement",leaderboard:"Leaderboard",challenge:"Challenge",reward:"Reward",experience:"Experience",rank:"Rank",progress:"Progress",unlock:"Unlock",complete:"Complete",earned:"Earned",nextLevel:"Next Level",dailyChallenge:"Daily Challenge",weeklyChallenge:"Weekly Challenge",monthlyChallenge:"Monthly Challenge"},hardware:{hardware:"Hardware",printer:"Printer",scanner:"Scanner",cashDrawer:"Cash Drawer",paymentTerminal:"Payment Terminal",customerDisplay:"Customer Display",scale:"Scale",connected:"Connected",disconnected:"Disconnected",connecting:"Connecting",error:"Error",testDevice:"Test Device",deviceSettings:"Device Settings",port:"Port",baudRate:"Baud Rate",paperWidth:"Paper Width",autoScan:"Auto Scan",merchantId:"Merchant ID",terminalId:"Terminal ID"},integrations:{integrations:"Integrations",marketplace:"Marketplace",paymentGateway:"Payment Gateway",thirdPartyApps:"Third Party Apps",api:"API",webhook:"Webhook",sync:"Sync",connect:"Connect",disconnect:"Disconnect",configure:"Configure",status:"Status",lastSync:"Last Sync",syncNow:"Sync Now",autoSync:"Auto Sync",syncHistory:"Sync History",apiKey:"API Key",secretKey:"Secret Key",endpoint:"Endpoint"},ai:{artificialIntelligence:"Artificial Intelligence",smartSuggestions:"Smart Suggestions",priceOptimization:"Price Optimization",demandForecasting:"Demand Forecasting",customerInsights:"Customer Insights",inventoryOptimization:"Inventory Optimization",salesPrediction:"Sales Prediction",recommendation:"Recommendation",analysis:"Analysis",prediction:"Prediction",optimization:"Optimization",insights:"Insights",trends:"Trends",patterns:"Patterns",anomaly:"Anomaly",confidence:"Confidence",accuracy:"Accuracy",model:"Model",training:"Training",learning:"Learning"},messages:{confirmDelete:"Are you sure you want to delete?",deleteSuccess:"Delete successful",saveSuccess:"Save successful",updateSuccess:"Update successful",createSuccess:"Create successful",operationFailed:"Operation failed",networkError:"Network error",serverError:"Server error",validationError:"Validation error",requiredField:"This field is required",invalidFormat:"Invalid format",duplicateEntry:"Duplicate entry",noDataFound:"No data found",loadingData:"Loading data...",processingRequest:"Processing request...",operationComplete:"Operation complete",sessionTimeout:"Session timeout",accessDenied:"Access denied",featureNotAvailable:"Feature not available",maintenanceMode:"System under maintenance"},validation:{required:"This field is required",email:"Invalid email",phone:"Invalid phone number",minLength:"Minimum {{min}} characters",maxLength:"Maximum {{max}} characters",minValue:"Minimum value is {{min}}",maxValue:"Maximum value is {{max}}",numeric:"Numbers only",alphanumeric:"Letters and numbers only",passwordMismatch:"Passwords do not match",invalidDate:"Invalid date",futureDate:"Date must be in the future",pastDate:"Date must be in the past",invalidUrl:"Invalid URL",fileSize:"File size too large",fileType:"File type not supported"}}},zh:{translation:{common:{save:"保存",cancel:"取消",delete:"删除",edit:"编辑",add:"添加",search:"搜索",filter:"筛选",export:"导出",import:"导入",refresh:"刷新",loading:"加载中...",success:"成功",error:"错误",warning:"警告",info:"信息",confirm:"确认",yes:"是",no:"否",ok:"确定",close:"关闭",back:"返回",next:"下一步",previous:"上一步",submit:"提交",reset:"重置",clear:"清除",select:"选择",all:"全部",none:"无",total:"总计",subtotal:"小计",discount:"折扣",tax:"税费",amount:"金额",quantity:"数量",price:"价格",date:"日期",time:"时间",status:"状态",active:"活跃",inactive:"非活跃",enabled:"启用",disabled:"禁用",online:"在线",offline:"离线"},auth:{login:"登录",logout:"登出",username:"用户名",password:"密码",email:"邮箱",forgotPassword:"忘记密码？",rememberMe:"记住我",loginSuccess:"登录成功",loginFailed:"登录失败",invalidCredentials:"凭据无效",sessionExpired:"会话已过期",accessDenied:"访问被拒绝",pleaseLogin:"请登录"},navigation:{dashboard:"仪表板",pos:"收银台",inventory:"库存",products:"产品",orders:"订单",customers:"客户",reports:"报告",analytics:"分析",settings:"设置",users:"用户",roles:"角色",integrations:"集成",hardware:"硬件",gamification:"游戏化",ai:"人工智能"},pos:{terminal:"收银终端",cart:"购物车",addToCart:"加入购物车",removeFromCart:"从购物车移除",clearCart:"清空购物车",checkout:"结账",payment:"付款",cash:"现金",card:"银行卡",transfer:"转账",change:"找零",receipt:"收据",printReceipt:"打印收据",customer:"客户",selectCustomer:"选择客户",newCustomer:"新客户",barcode:"条形码",scanBarcode:"扫描条形码",productNotFound:"未找到产品",insufficientStock:"库存不足",transactionComplete:"交易完成",openDrawer:"打开钱箱"},products:{product:"产品",products:"产品",productName:"产品名称",productCode:"产品代码",category:"类别",brand:"品牌",supplier:"供应商",costPrice:"成本价",sellingPrice:"售价",stock:"库存",minStock:"最小库存",maxStock:"最大库存",description:"描述",images:"图片",addProduct:"添加产品",editProduct:"编辑产品",deleteProduct:"删除产品",productAdded:"产品已添加",productUpdated:"产品已更新",productDeleted:"产品已删除",lowStock:"库存不足",outOfStock:"缺货",inStock:"有库存"},customers:{customer:"客户",customers:"客户",customerName:"客户姓名",customerCode:"客户代码",phone:"电话",address:"地址",birthday:"生日",gender:"性别",male:"男",female:"女",other:"其他",loyaltyPoints:"积分",membershipLevel:"会员等级",totalSpent:"总消费",lastVisit:"最后访问",addCustomer:"添加客户",editCustomer:"编辑客户",deleteCustomer:"删除客户",customerAdded:"客户已添加",customerUpdated:"客户已更新",customerDeleted:"客户已删除",vip:"VIP",regular:"普通",new:"新客户"},orders:{order:"订单",orders:"订单",orderNumber:"订单号",orderDate:"订单日期",orderStatus:"订单状态",pending:"待处理",processing:"处理中",completed:"已完成",cancelled:"已取消",refunded:"已退款",orderTotal:"订单总额",orderItems:"订单项目",paymentMethod:"付款方式",paymentStatus:"付款状态",paid:"已付款",unpaid:"未付款",partiallyPaid:"部分付款",viewOrder:"查看订单",editOrder:"编辑订单",cancelOrder:"取消订单",refundOrder:"退款订单"},inventory:{inventory:"库存",stockIn:"入库",stockOut:"出库",stockAdjustment:"库存调整",stockTransfer:"库存转移",warehouse:"仓库",location:"位置",batch:"批次",expiryDate:"到期日期",serialNumber:"序列号",stockLevel:"库存水平",reorderPoint:"再订购点",stockValue:"库存价值",stockMovement:"库存变动",stockReport:"库存报告",lowStockAlert:"低库存警报",stockTaking:"盘点"},reports:{reports:"报告",salesReport:"销售报告",inventoryReport:"库存报告",customerReport:"客户报告",productReport:"产品报告",financialReport:"财务报告",dailyReport:"日报",weeklyReport:"周报",monthlyReport:"月报",yearlyReport:"年报",customReport:"自定义报告",generateReport:"生成报告",exportReport:"导出报告",printReport:"打印报告",revenue:"收入",profit:"利润",loss:"亏损",growth:"增长",performance:"绩效"},settings:{settings:"设置",generalSettings:"常规设置",systemSettings:"系统设置",userSettings:"用户设置",companyInfo:"公司信息",companyName:"公司名称",companyAddress:"公司地址",companyPhone:"公司电话",companyEmail:"公司邮箱",taxNumber:"税号",currency:"货币",language:"语言",timezone:"时区",dateFormat:"日期格式",timeFormat:"时间格式",theme:"主题",notifications:"通知",emailNotifications:"邮件通知",smsNotifications:"短信通知",pushNotifications:"推送通知",backup:"备份",restore:"恢复",security:"安全",privacy:"隐私"},gamification:{gamification:"游戏化",points:"积分",level:"等级",badge:"徽章",achievement:"成就",leaderboard:"排行榜",challenge:"挑战",reward:"奖励",experience:"经验",rank:"排名",progress:"进度",unlock:"解锁",complete:"完成",earned:"已获得",nextLevel:"下一级",dailyChallenge:"每日挑战",weeklyChallenge:"每周挑战",monthlyChallenge:"每月挑战"},hardware:{hardware:"硬件",printer:"打印机",scanner:"扫描仪",cashDrawer:"钱箱",paymentTerminal:"支付终端",customerDisplay:"客户显示器",scale:"电子秤",connected:"已连接",disconnected:"未连接",connecting:"连接中",error:"错误",testDevice:"测试设备",deviceSettings:"设备设置",port:"端口",baudRate:"波特率",paperWidth:"纸张宽度",autoScan:"自动扫描",merchantId:"商户ID",terminalId:"终端ID"},integrations:{integrations:"集成",marketplace:"市场",paymentGateway:"支付网关",thirdPartyApps:"第三方应用",api:"API",webhook:"Webhook",sync:"同步",connect:"连接",disconnect:"断开连接",configure:"配置",status:"状态",lastSync:"最后同步",syncNow:"立即同步",autoSync:"自动同步",syncHistory:"同步历史",apiKey:"API密钥",secretKey:"密钥",endpoint:"端点"},ai:{artificialIntelligence:"人工智能",smartSuggestions:"智能建议",priceOptimization:"价格优化",demandForecasting:"需求预测",customerInsights:"客户洞察",inventoryOptimization:"库存优化",salesPrediction:"销售预测",recommendation:"推荐",analysis:"分析",prediction:"预测",optimization:"优化",insights:"洞察",trends:"趋势",patterns:"模式",anomaly:"异常",confidence:"置信度",accuracy:"准确性",model:"模型",training:"训练",learning:"学习"},messages:{confirmDelete:"您确定要删除吗？",deleteSuccess:"删除成功",saveSuccess:"保存成功",updateSuccess:"更新成功",createSuccess:"创建成功",operationFailed:"操作失败",networkError:"网络错误",serverError:"服务器错误",validationError:"验证错误",requiredField:"此字段为必填项",invalidFormat:"格式无效",duplicateEntry:"重复条目",noDataFound:"未找到数据",loadingData:"正在加载数据...",processingRequest:"正在处理请求...",operationComplete:"操作完成",sessionTimeout:"会话超时",accessDenied:"访问被拒绝",featureNotAvailable:"功能不可用",maintenanceMode:"系统维护中"},validation:{required:"此字段为必填项",email:"邮箱无效",phone:"电话号码无效",minLength:"最少{{min}}个字符",maxLength:"最多{{max}}个字符",minValue:"最小值为{{min}}",maxValue:"最大值为{{max}}",numeric:"仅限数字",alphanumeric:"仅限字母和数字",passwordMismatch:"密码不匹配",invalidDate:"日期无效",futureDate:"日期必须在未来",pastDate:"日期必须在过去",invalidUrl:"URL无效",fileSize:"文件大小过大",fileType:"不支持的文件类型"}}}};Ie.use(Ae).use(n).init({resources:ht,fallbackLng:"vi",debug:!1,interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator","htmlTag"],caches:["localStorage"],lookupLocalStorage:"i18nextLng"},react:{useSuspense:!1}});const ut=[{code:"vi",name:"Tiếng Việt",flag:"🇻🇳",direction:"ltr"},{code:"en",name:"English",flag:"🇺🇸",direction:"ltr"},{code:"zh",name:"中文",flag:"🇨🇳",direction:"ltr"}],{Text:mt}=d,{Option:pt}=c,gt=({style:e={}})=>{const n=Ie.language||"vi";ut.find(e=>e.code===n)||ut[0];return t.jsx(c,{value:n,onChange:e=>{var t;t=e,Ie.changeLanguage(t)},size:"small",style:{minWidth:80,...e},bordered:!1,dropdownMatchSelectWidth:!1,children:ut.map(e=>t.jsx(pt,{value:e.code,children:t.jsxs(l,{size:4,children:[t.jsx("span",{style:{fontSize:"14px"},children:e.flag}),t.jsx("span",{style:{fontSize:"12px"},children:e.code.toUpperCase()})]})},e.code))})};const yt=new class{constructor(){this.dbName="KhoAugmentDB",this.dbVersion=1,this.db=null,this.isOnline=navigator.onLine,this.syncQueue=[],this.init(),this.setupEventListeners()}async init(){try{if(this.db=await this.openDatabase(),"serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype){await navigator.serviceWorker.ready}}catch(e){}}openDatabase(){return new Promise((e,t)=>{const n=indexedDB.open(this.dbName,this.dbVersion);n.onerror=()=>t(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains("transactions")){const e=t.createObjectStore("transactions",{keyPath:"id",autoIncrement:!0});e.createIndex("timestamp","timestamp",{unique:!1}),e.createIndex("status","status",{unique:!1})}if(!t.objectStoreNames.contains("products")){const e=t.createObjectStore("products",{keyPath:"id"});e.createIndex("sku","sku",{unique:!0}),e.createIndex("category","category",{unique:!1})}if(!t.objectStoreNames.contains("customers")){const e=t.createObjectStore("customers",{keyPath:"id"});e.createIndex("phone","phone",{unique:!1}),e.createIndex("email","email",{unique:!1})}if(!t.objectStoreNames.contains("inventory")){const e=t.createObjectStore("inventory",{keyPath:"id",autoIncrement:!0});e.createIndex("productId","productId",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1})}}})}setupEventListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.syncOfflineData()}),window.addEventListener("offline",()=>{this.isOnline=!1})}async saveTransaction(e){try{const t=this.db.transaction(["transactions"],"readwrite").objectStore("transactions"),n={...e,timestamp:(new Date).toISOString(),status:"pending",offline:!0},s=await this.promisifyRequest(t.add(n));return this.scheduleBackgroundSync("pos-transaction"),s}catch(t){throw t}}async getOfflineTransactions(){try{const e=this.db.transaction(["transactions"],"readonly"),t=e.objectStore("transactions").index("status");return await this.promisifyRequest(t.getAll("pending"))}catch(e){return[]}}async markTransactionSynced(e){try{const t=this.db.transaction(["transactions"],"readwrite").objectStore("transactions"),n=await this.promisifyRequest(t.get(e));n&&(n.status="synced",n.syncedAt=(new Date).toISOString(),await this.promisifyRequest(t.put(n)))}catch(t){}}async cacheProducts(e){try{const t=this.db.transaction(["products"],"readwrite").objectStore("products");for(const n of e)await this.promisifyRequest(t.put({...n,cachedAt:(new Date).toISOString()}))}catch(t){}}async getCachedProducts(){try{const e=this.db.transaction(["products"],"readonly").objectStore("products");return await this.promisifyRequest(e.getAll())}catch(e){return[]}}async searchCachedProducts(e){try{const t=await this.getCachedProducts(),n=e.toLowerCase();return t.filter(e=>e.name.toLowerCase().includes(n)||e.sku.toLowerCase().includes(n)||e.barcode&&e.barcode.includes(n))}catch(t){return[]}}async cacheCustomers(e){try{const t=this.db.transaction(["customers"],"readwrite").objectStore("customers");for(const n of e)await this.promisifyRequest(t.put({...n,cachedAt:(new Date).toISOString()}))}catch(t){}}async getCachedCustomers(){try{const e=this.db.transaction(["customers"],"readonly").objectStore("customers");return await this.promisifyRequest(e.getAll())}catch(e){return[]}}async findCustomerByPhone(e){try{const t=this.db.transaction(["customers"],"readonly"),n=t.objectStore("customers").index("phone");return await this.promisifyRequest(n.get(e))}catch(t){return null}}async saveInventoryUpdate(e){try{const t=this.db.transaction(["inventory"],"readwrite").objectStore("inventory"),n={...e,timestamp:(new Date).toISOString(),status:"pending"},s=await this.promisifyRequest(t.add(n));return this.scheduleBackgroundSync("inventory-update"),s}catch(t){throw t}}async syncOfflineData(){if(this.isOnline)try{await this.syncTransactions(),await this.syncInventoryUpdates()}catch(e){}}async syncTransactions(){const e=await this.getOfflineTransactions();for(const n of e)try{(await fetch("/api/pos/transactions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(n)})).ok&&await this.markTransactionSynced(n.id)}catch(t){}}async syncInventoryUpdates(){try{const t=this.db.transaction(["inventory"],"readonly"),n=t.objectStore("inventory").index("status"),s=await this.promisifyRequest(n.getAll("pending"));for(const a of s)try{if((await fetch("/api/inventory/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(a)})).ok){const e=this.db.transaction(["inventory"],"readwrite").objectStore("inventory");a.status="synced",a.syncedAt=(new Date).toISOString(),await this.promisifyRequest(e.put(a))}}catch(e){}}catch(e){}}async scheduleBackgroundSync(e){if("serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype)try{const t=await navigator.serviceWorker.ready;await t.sync.register(e)}catch(t){}}promisifyRequest(e){return new Promise((t,n)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>n(e.error)})}isOffline(){return!this.isOnline}async clearOfflineData(){try{const e=this.db.transaction(["transactions","inventory"],"readwrite");await Promise.all([this.promisifyRequest(e.objectStore("transactions").clear()),this.promisifyRequest(e.objectStore("inventory").clear())])}catch(e){}}async getStorageUsage(){if("storage"in navigator&&"estimate"in navigator.storage)try{const e=await navigator.storage.estimate();return{used:e.usage,available:e.quota,percentage:Math.round(e.usage/e.quota*100)}}catch(e){}return null}},{Text:xt,Title:bt}=d,ft=()=>{const[n,s]=e.useState(navigator.onLine),[a,i]=e.useState(!1),[r,o]=e.useState("idle"),[c,d]=e.useState({transactions:0,inventoryUpdates:0,customers:0,products:0}),[x,b]=e.useState(null);e.useEffect(()=>{const e=()=>{s(!0),f()},t=()=>{s(!1),f()};return window.addEventListener("online",e),window.addEventListener("offline",t),f(),j(),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]);const f=async()=>{try{const[e,t,n]=await Promise.all([yt.getOfflineTransactions(),yt.getCachedCustomers(),yt.getCachedProducts()]);d({transactions:e.length,inventoryUpdates:0,customers:t.length,products:n.length})}catch(e){}},j=async()=>{try{const e=await yt.getStorageUsage();b(e)}catch(e){}},v=async()=>{o("syncing");try{await yt.syncOfflineData(),o("success"),f(),setTimeout(()=>o("idle"),2e3)}catch(e){o("error"),setTimeout(()=>o("idle"),3e3)}},k=async()=>{u.confirm({title:"Xóa dữ liệu offline",content:"Bạn có chắc chắn muốn xóa tất cả dữ liệu offline? Hành động này không thể hoàn tác.",okText:"Xóa",cancelText:"Hủy",okType:"danger",onOk:async()=>{try{await yt.clearOfflineData(),f(),j()}catch(e){}}})},S=()=>n?c.transactions>0?t.jsx(L,{}):t.jsx(M,{}):t.jsx(R,{});return t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{cursor:"pointer",display:"flex",alignItems:"center",padding:"4px 8px",borderRadius:"4px",backgroundColor:n?"transparent":"rgba(255, 77, 79, 0.1)"},onClick:()=>i(!0),children:[t.jsx(h,{dot:c.transactions>0,status:n?"success":"error",children:S()}),!n&&t.jsx(xt,{style:{marginLeft:8,color:"#ff4d4f",fontSize:"12px",fontWeight:500},children:"Offline"}),n&&c.transactions>0&&t.jsx(h,{count:c.transactions,size:"small",style:{marginLeft:4}})]}),t.jsx(u,{title:t.jsxs(l,{children:[t.jsx(A,{}),t.jsx("span",{children:"Trạng thái kết nối & Dữ liệu offline"})]}),open:a,onCancel:()=>i(!1),footer:[t.jsx(y,{onClick:()=>i(!1),children:"Đóng"},"close"),t.jsx(y,{type:"primary",icon:t.jsx(I,{}),loading:"syncing"===r,disabled:!n||0===c.transactions,onClick:v,children:"Đồng bộ ngay"},"sync")],width:600,children:t.jsxs(l,{direction:"vertical",style:{width:"100%"},size:"large",children:[t.jsxs("div",{children:[t.jsx(bt,{level:5,children:"Trạng thái kết nối"}),t.jsx(m,{message:t.jsxs(l,{children:[S(),t.jsx("span",{children:n?c.transactions>0?"Có dữ liệu chưa đồng bộ":"Online":"Offline"})]}),type:n?c.transactions>0?"warning":"success":"error",showIcon:!1})]}),t.jsxs("div",{children:[t.jsx(bt,{level:5,children:"Dữ liệu offline"}),t.jsxs(l,{direction:"vertical",style:{width:"100%"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(xt,{children:"Giao dịch chưa đồng bộ:"}),t.jsx(h,{count:c.transactions,showZero:!0})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(xt,{children:"Sản phẩm đã lưu:"}),t.jsx(h,{count:c.products,showZero:!0,style:{backgroundColor:"#1890ff"}})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(xt,{children:"Khách hàng đã lưu:"}),t.jsx(h,{count:c.customers,showZero:!0,style:{backgroundColor:"#52c41a"}})]})]})]}),x&&t.jsxs("div",{children:[t.jsx(bt,{level:5,children:"Sử dụng bộ nhớ"}),t.jsx(p,{percent:x.percentage,format:()=>`${x.percentage}%`,status:x.percentage>80?"exception":"normal"}),t.jsxs(xt,{type:"secondary",style:{fontSize:"12px"},children:["Đã sử dụng: ",Math.round(x.used/1024/1024)," MB / Có sẵn: ",Math.round(x.available/1024/1024)," MB"]})]}),"idle"!==r&&t.jsxs("div",{children:[t.jsx(g,{}),t.jsx(m,{message:"syncing"===r?"Đang đồng bộ dữ liệu...":"success"===r?"Đồng bộ thành công!":"Đồng bộ thất bại!",type:"syncing"===r?"info":"success"===r?"success":"error",showIcon:!0})]}),t.jsxs("div",{children:[t.jsx(g,{}),t.jsx(l,{children:t.jsx(y,{icon:t.jsx(D,{}),onClick:k,disabled:0===c.transactions&&0===c.products,children:"Xóa dữ liệu offline"})})]})]})})]})},{Header:jt}=b,{Search:vt}=f,{Text:kt}=d,{Option:St}=c,wt=({collapsed:n,onCollapse:i,title:r="Trường Phát POS",showSearch:c=!0,showNotifications:l=!0})=>{const d=s(),{user:u,logout:m}=lt(),[p,g]=e.useState(!1),[b,f]=e.useState(!1),S=[{id:1,title:"Đơn hàng mới",message:"Đơn hàng #123456 vừa được tạo",time:"5 phút trước",read:!1},{id:2,title:"Sản phẩm sắp hết hàng",message:"Laptop Dell XPS 13 sắp hết hàng (còn 2)",time:"30 phút trước",read:!1},{id:3,title:"Cập nhật hệ thống",message:"Hệ thống sẽ bảo trì lúc 22:00 tối nay",time:"2 giờ trước",read:!0}],w=t.jsxs(x,{children:[t.jsx(x.Item,{icon:t.jsx(E,{}),onClick:()=>d("/profile"),children:"Thông tin cá nhân"},"profile"),t.jsx(x.Item,{icon:t.jsx(_,{}),onClick:()=>d("/settings"),children:"Cài đặt"},"settings"),t.jsx(x.Divider,{}),t.jsx(x.Item,{icon:t.jsx(B,{}),onClick:async()=>{try{await m(),o.success("Đăng xuất thành công"),d("/login")}catch(e){o.error("Có lỗi xảy ra khi đăng xuất")}},danger:!0,children:"Đăng xuất"},"logout")]}),C=t.jsxs(x,{style:{width:320},children:[t.jsx(x.Item,{disabled:!0,style:{cursor:"default"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(kt,{strong:!0,children:"Thông báo"}),t.jsx(y,{type:"link",size:"small",children:"Đánh dấu tất cả đã đọc"})]})},"header"),t.jsx(x.Divider,{}),S.length>0?S.map(e=>t.jsx(x.Item,{style:{opacity:e.read?.7:1},children:t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[!e.read&&t.jsx(h,{color:"blue",style:{marginRight:8}}),t.jsx(kt,{strong:!0,children:e.title})]}),t.jsx("div",{style:{marginTop:4},children:t.jsx(kt,{type:"secondary",children:e.message})}),t.jsx("div",{style:{marginTop:4},children:t.jsx(kt,{type:"secondary",style:{fontSize:"12px"},children:e.time})})]})},e.id)):t.jsx(x.Item,{children:t.jsx("div",{style:{textAlign:"center",padding:"10px"},children:t.jsx(kt,{type:"secondary",children:"Không có thông báo mới"})})},"empty"),t.jsx(x.Divider,{}),t.jsx(x.Item,{children:t.jsx("div",{style:{textAlign:"center"},children:t.jsx(y,{type:"link",onClick:()=>d("/notifications"),children:"Xem tất cả"})})},"footer")]});return t.jsxs(jt,{className:"app-header",children:[t.jsxs("div",{className:"header-left",children:[t.jsx(y,{type:"text",icon:n?t.jsx(z,{}):t.jsx(q,{}),onClick:()=>i(!n),style:{fontSize:"16px",width:64,height:64}}),t.jsx("div",{className:"logo-title",children:t.jsx(a,{to:"/",children:t.jsx("h1",{children:r})})})]}),t.jsxs("div",{className:"header-right",children:[c&&t.jsx("div",{className:"header-search",children:t.jsx(vt,{placeholder:"Tìm kiếm...",allowClear:!0,onSearch:e=>{},style:{width:250}})}),t.jsxs("div",{className:"header-actions",children:[l&&t.jsx(j,{overlay:C,trigger:["click"],placement:"bottomRight",arrow:{pointAtCenter:!0},children:t.jsx(h,{count:S.filter(e=>!e.read).length,size:"small",children:t.jsx(y,{type:"text",icon:t.jsx(F,{}),style:{fontSize:"16px"}})})}),t.jsx(ft,{}),t.jsx(gt,{style:{marginRight:8}}),t.jsx(j,{overlay:w,trigger:["click"],placement:"bottomRight",children:t.jsxs("div",{className:"user-profile",children:[t.jsx(v,{icon:t.jsx(E,{}),src:u?.avatar,style:{cursor:"pointer"}}),t.jsx("span",{className:"username",children:u?.name||"User"})]})})]})]}),t.jsx(k,{title:"Tìm kiếm",placement:"top",onClose:()=>f(!1),visible:b,height:120,children:t.jsx(vt,{placeholder:"Tìm kiếm...",allowClear:!0,enterButton:!0,onSearch:e=>{f(!1)},size:"large"})})]})},{Footer:Ct}=b,{Title:Tt,Text:Nt,Link:Pt}=d,Ot=({minimal:e=!1})=>{const n=(new Date).getFullYear();return e?t.jsx(Ct,{className:"app-footer minimal",children:t.jsx("div",{className:"copyright",children:t.jsxs(Nt,{type:"secondary",children:["© ",n," Trường Phát Computer. Tất cả quyền được bảo lưu."]})})}):t.jsxs(Ct,{className:"app-footer",children:[t.jsx("div",{className:"footer-content",children:t.jsxs(S,{gutter:[32,24],children:[t.jsx(w,{xs:24,sm:24,md:8,lg:8,children:t.jsxs("div",{className:"company-info",children:[t.jsx(Tt,{level:4,children:"Trường Phát Computer"}),t.jsxs(l,{direction:"vertical",size:"small",children:[t.jsxs("div",{className:"contact-item",children:[t.jsx(K,{})," Hòa Bình, Việt Nam"]}),t.jsxs("div",{className:"contact-item",children:[t.jsx(U,{})," 0836.768.597"]}),t.jsxs("div",{className:"contact-item",children:[t.jsx(G,{})," contact@truongphat.com"]}),t.jsxs("div",{className:"contact-item",children:[t.jsx(H,{})," www.truongphat.com"]})]}),t.jsxs(l,{className:"social-links",size:"middle",children:[t.jsx("a",{href:"https://facebook.com",target:"_blank",rel:"noopener noreferrer",children:t.jsx(V,{})}),t.jsx("a",{href:"https://twitter.com",target:"_blank",rel:"noopener noreferrer",children:t.jsx($,{})}),t.jsx("a",{href:"https://instagram.com",target:"_blank",rel:"noopener noreferrer",children:t.jsx(W,{})}),t.jsx("a",{href:"https://youtube.com",target:"_blank",rel:"noopener noreferrer",children:t.jsx(X,{})})]})]})}),t.jsxs(w,{xs:12,sm:12,md:8,lg:8,children:[t.jsx(Tt,{level:4,children:"Liên kết"}),t.jsxs(S,{gutter:[16,8],children:[t.jsx(w,{span:12,children:t.jsxs("ul",{className:"footer-links",children:[t.jsx("li",{children:t.jsx(a,{to:"/about",children:"Về chúng tôi"})}),t.jsx("li",{children:t.jsx(a,{to:"/products",children:"Sản phẩm"})}),t.jsx("li",{children:t.jsx(a,{to:"/services",children:"Dịch vụ"})}),t.jsx("li",{children:t.jsx(a,{to:"/contact",children:"Liên hệ"})})]})}),t.jsx(w,{span:12,children:t.jsxs("ul",{className:"footer-links",children:[t.jsx("li",{children:t.jsx(a,{to:"/faq",children:"FAQ"})}),t.jsx("li",{children:t.jsx(a,{to:"/terms",children:"Điều khoản"})}),t.jsx("li",{children:t.jsx(a,{to:"/privacy",children:"Chính sách"})}),t.jsx("li",{children:t.jsx(a,{to:"/sitemap",children:"Sitemap"})})]})})]})]}),t.jsxs(w,{xs:12,sm:12,md:8,lg:8,children:[t.jsx(Tt,{level:4,children:"Giờ làm việc"}),t.jsxs("ul",{className:"business-hours",children:[t.jsxs("li",{children:[t.jsx("span",{children:"Thứ 2 - Thứ 6:"}),t.jsx("span",{children:"8:00 - 20:00"})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Thứ 7:"}),t.jsx("span",{children:"8:00 - 18:00"})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Chủ nhật:"}),t.jsx("span",{children:"9:00 - 17:00"})]}),t.jsxs("li",{className:"note",children:[t.jsx("span",{children:"Lễ tết:"}),t.jsx("span",{children:"Vui lòng liên hệ"})]})]})]})]})}),t.jsx(g,{style:{margin:"24px 0 16px"}}),t.jsxs("div",{className:"footer-bottom",children:[t.jsx("div",{className:"copyright",children:t.jsxs(Nt,{type:"secondary",children:["© ",n," Trường Phát Computer. Tất cả quyền được bảo lưu."]})}),t.jsx("div",{className:"powered-by",children:t.jsxs(Nt,{type:"secondary",children:["Phát triển bởi ",t.jsx(Pt,{href:"https://truongphat.com",children:"Trường Phát"})," với ",t.jsx(Q,{style:{color:"#ff4d4f"}})]})})]})]})},{Sider:Dt}=b,{SubMenu:It}=x,{Text:At}=d,Rt=({collapsed:n,onCollapse:a,isMobile:r=!1,visible:o,onClose:c})=>{const l=s(),u=i(),{user:m,hasRole:p,hasPermission:g,getAccessibleMenus:y}=lt(),[b,f]=e.useState([]),[j,S]=e.useState([]),[w,C]=e.useState([]);e.useEffect(()=>{const e=u.pathname.split("/").filter(e=>e),t="/"+e.join("/");f([t]),e.length>1&&S(t=>{const n=[`/${e[0]}`];return[...new Set([...t,...n])]})},[u.pathname]),e.useEffect(()=>{const e=y?y():[];C(e)},[m,y]);const T=e=>({DashboardOutlined:t.jsx(xe,{}),ShoppingOutlined:t.jsx(ye,{}),ShoppingCartOutlined:t.jsx(ge,{}),UserOutlined:t.jsx(E,{}),TeamOutlined:t.jsx(pe,{}),BarChartOutlined:t.jsx(me,{}),SettingOutlined:t.jsx(_,{}),ShopOutlined:t.jsx(ue,{}),MobileOutlined:t.jsx(he,{}),AppstoreOutlined:t.jsx(Y,{}),FileTextOutlined:t.jsx(de,{}),BankOutlined:t.jsx(le,{}),ClockCircleOutlined:t.jsx(ce,{}),TrophyOutlined:t.jsx(oe,{}),BookOutlined:t.jsx(re,{}),MailOutlined:t.jsx(G,{}),BellOutlined:t.jsx(F,{}),CalendarOutlined:t.jsx(ie,{}),LogoutOutlined:t.jsx(B,{}),HomeOutlined:t.jsx(ae,{}),RollbackOutlined:t.jsx(se,{}),LaptopOutlined:t.jsx(ne,{}),DesktopOutlined:t.jsx(te,{}),BulbOutlined:t.jsx(ee,{}),RobotOutlined:t.jsx(Z,{}),DollarOutlined:t.jsx(J,{})}[e]||t.jsx(Y,{})),N=e=>e.map(e=>e.children?t.jsx(It,{icon:T(e.icon),title:e.label,children:N(e.children)},e.key):t.jsxs(x.Item,{icon:T(e.icon),children:[e.label,e.badge&&t.jsx(h,{count:e.badge,size:"small",offset:[10,0]})]},e.path)),P=t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"logo",children:!n&&t.jsx(d.Title,{level:4,style:{margin:0,color:"#fff"},children:"Trường Phát"})}),t.jsxs("div",{className:"sidebar-user",children:[t.jsx(v,{size:n?"default":"large",icon:t.jsx(E,{}),src:m?.avatar}),!n&&t.jsxs("div",{className:"user-info",children:[t.jsx(At,{strong:!0,style:{color:"#fff"},children:m?.name||"Người dùng"}),t.jsx(At,{type:"secondary",style:{fontSize:"12px"},children:m?.role?m.role.charAt(0).toUpperCase()+m.role.slice(1):"Khách"})]})]}),t.jsxs(x,{theme:"dark",mode:"inline",selectedKeys:b,openKeys:j,onOpenChange:S,onClick:e=>{l(e.key),r&&c&&c()},children:[N([{key:"home",label:"Trang chủ",path:"/",icon:"HomeOutlined"}]),w.length>0&&t.jsx(x.Divider,{}),N(w)]})]});return r?t.jsx(k,{placement:"left",closable:!0,onClose:c,open:o,className:"sidebar-drawer",width:256,bodyStyle:{padding:0,backgroundColor:"#001529"},children:P}):t.jsx(Dt,{collapsible:!0,collapsed:n,onCollapse:a,width:256,className:"app-sidebar",children:P})},Lt=(e,t={})=>{const{onEnter:n,onEscape:s,onArrowUp:a,onArrowDown:i,onTab:r}=t;switch(e.key){case"Enter":n&&(e.preventDefault(),n(e));break;case"Escape":s&&(e.preventDefault(),s(e));break;case"ArrowUp":a&&(e.preventDefault(),a(e));break;case"ArrowDown":i&&(e.preventDefault(),i(e));break;case"Tab":r&&r(e)}},Mt=(e,t="polite")=>{const n=document.createElement("div");n.setAttribute("aria-live",t),n.setAttribute("aria-atomic","true"),n.setAttribute("class","sr-only"),n.textContent=e,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n)},1e3)},{Text:Et,Title:_t}=d,{Panel:Bt}=C,zt=({visible:n,onClose:a,menuItems:r=[],notifications:o=[],quickActions:c=[],showSearch:d=!0,showNotifications:u=!0,showQuickActions:m=!0})=>{const p=s(),g=i(),{user:x,logout:b}=lt(),[j,S]=e.useState(""),[w,T]=e.useState(r),[N,P]=e.useState(["navigation"]),O=e.useRef(null);e.useEffect(()=>{if(!j.trim())return void T(r);const e=r.filter(e=>e.label.toLowerCase().includes(j.toLowerCase())||e.children&&e.children.some(e=>e.label.toLowerCase().includes(j.toLowerCase())));T(e)},[j,r]);const D=e=>{p(e),a(),Mt(`Đã chuyển đến ${e}`,"polite")};return t.jsxs(k,{ref:O,title:null,placement:"left",closable:!1,onClose:a,open:n,bodyStyle:{padding:0},className:"enhanced-mobile-navigation",width:320,"aria-label":"Menu điều hướng chính",children:[t.jsxs("div",{className:"mobile-nav-header",children:[t.jsxs("div",{className:"mobile-nav-header-top",children:[t.jsx("div",{className:"mobile-nav-logo",children:t.jsx(_t,{level:4,style:{margin:0,color:"#fff"},children:"KhoAugment"})}),t.jsx(y,{type:"text",icon:t.jsx(be,{}),onClick:a,className:"mobile-nav-close",size:"large","aria-label":"Đóng menu"})]}),t.jsxs("div",{className:"mobile-nav-user",children:[t.jsx(v,{size:"large",icon:t.jsx(E,{}),src:x?.avatar}),t.jsxs("div",{className:"mobile-nav-user-info",children:[t.jsx(Et,{strong:!0,style:{color:"#fff"},children:x?.name||"Người dùng"}),t.jsx(Et,{style:{color:"rgba(255,255,255,0.8)",fontSize:"12px"},children:x?.role?x.role.charAt(0).toUpperCase()+x.role.slice(1):"Khách"})]})]})]}),d&&t.jsx("div",{className:"mobile-nav-search",children:t.jsx(f,{placeholder:"Tìm kiếm menu...",prefix:t.jsx(fe,{}),value:j,onChange:e=>{return t=e.target.value,S(t),void(t&&Mt(`Tìm thấy ${w.length} kết quả`,"polite"));var t},allowClear:!0,"aria-label":"Tìm kiếm trong menu"})}),m&&c.length>0&&t.jsxs("div",{className:"mobile-nav-quick-actions",children:[t.jsx(Et,{strong:!0,className:"section-title",children:"Thao tác nhanh"}),t.jsx("div",{className:"quick-actions-grid",children:c.map(e=>t.jsx(y,{type:"text",icon:e.icon,onClick:()=>(e=>{e.onClick?e.onClick():e.path&&p(e.path),a()})(e),className:"quick-action-btn","aria-label":e.label,children:t.jsx(Et,{className:"quick-action-text",children:e.label})},e.key))})]}),t.jsx("div",{className:"mobile-nav-content",children:t.jsxs(C,{activeKey:N,onChange:P,ghost:!0,expandIconPosition:"end",className:"mobile-nav-collapse",children:[t.jsx(Bt,{header:t.jsxs(l,{children:[t.jsx(ae,{}),t.jsx(Et,{strong:!0,children:"Điều hướng"})]}),children:t.jsx("div",{className:"navigation-items",children:(I=w,I.map(e=>e.children?t.jsx(Bt,{header:t.jsxs(l,{children:[e.icon,t.jsx(Et,{children:e.label}),e.badge&&t.jsx(h,{count:e.badge,size:"small"})]}),children:t.jsx("div",{className:"submenu-items",children:e.children.map(e=>t.jsx("div",{className:"menu-item "+(g.pathname===e.path?"active":""),onClick:()=>D(e.path),onKeyDown:t=>Lt(t,{onEnter:()=>D(e.path)}),tabIndex:0,role:"button","aria-label":`Chuyển đến ${e.label}`,children:t.jsxs(l,{children:[e.icon,t.jsx(Et,{children:e.label}),e.badge&&t.jsx(h,{count:e.badge,size:"small"})]})},e.key))})},e.key):t.jsx("div",{className:"menu-item "+(g.pathname===e.path?"active":""),onClick:()=>D(e.path),onKeyDown:t=>Lt(t,{onEnter:()=>D(e.path)}),tabIndex:0,role:"button","aria-label":`Chuyển đến ${e.label}`,children:t.jsxs(l,{children:[e.icon,t.jsx(Et,{children:e.label}),e.badge&&t.jsx(h,{count:e.badge,size:"small"})]})},e.key)))})},"navigation"),u&&o.length>0&&t.jsx(Bt,{header:t.jsxs(l,{children:[t.jsx(F,{}),t.jsx(Et,{strong:!0,children:"Thông báo"}),t.jsx(h,{count:o.length,size:"small"})]}),children:t.jsx("div",{className:"notification-items",children:o.slice(0,5).map(e=>t.jsxs("div",{className:"notification-item",children:[t.jsx(Et,{strong:!0,children:e.title}),t.jsx(Et,{type:"secondary",className:"notification-message",children:e.message}),t.jsx(Et,{type:"secondary",className:"notification-time",children:e.time})]},e.id))})},"notifications"),t.jsx(Bt,{header:t.jsxs(l,{children:[t.jsx(_,{}),t.jsx(Et,{strong:!0,children:"Cài đặt"})]}),children:t.jsxs("div",{className:"settings-items",children:[t.jsx("div",{className:"menu-item",onClick:()=>D("/profile"),tabIndex:0,role:"button",children:t.jsxs(l,{children:[t.jsx(E,{}),t.jsx(Et,{children:"Hồ sơ cá nhân"})]})}),t.jsx("div",{className:"menu-item",onClick:()=>D("/settings"),tabIndex:0,role:"button",children:t.jsxs(l,{children:[t.jsx(_,{}),t.jsx(Et,{children:"Cài đặt hệ thống"})]})})]})},"settings")]})}),t.jsx("div",{className:"mobile-nav-footer",children:t.jsx(y,{type:"primary",danger:!0,icon:t.jsx(B,{}),onClick:()=>{b(),a(),Mt("Đã đăng xuất","polite")},block:!0,size:"large","aria-label":"Đăng xuất khỏi hệ thống",children:"Đăng xuất"})})]});var I},{Text:qt}=d,Ft=({title:n,showBack:a=!1,showMenu:r=!0,showSearch:o=!1,showNotifications:c=!0,showProfile:d=!0,onMenuClick:u,onBackClick:m,actions:p=[],searchPlaceholder:g="Tìm kiếm...",onSearch:x,className:b=""})=>{const S=s(),w=i(),{user:C,notifications:T=[]}=lt(),[N,P]=e.useState(!1),[O,D]=e.useState(""),I=()=>{P(!N),N||Mt("Đã mở tìm kiếm","polite")},A=e=>{D(e),x&&x(e),e&&Mt(`Đang tìm kiếm: ${e}`,"polite")},R=[{key:"profile",label:"Hồ sơ cá nhân",icon:t.jsx(E,{}),onClick:()=>S("/profile")},{key:"settings",label:"Cài đặt",icon:t.jsx(ke,{}),onClick:()=>S("/settings")},{type:"divider"},{key:"logout",label:"Đăng xuất",danger:!0,onClick:()=>{Mt("Đã đăng xuất","polite")}}],L=(()=>{const e=w.pathname,n=[...p];return e.includes("/pos")&&n.unshift({key:"scan",icon:t.jsx(Se,{}),label:"Quét mã",onClick:()=>{Mt("Đã mở máy quét mã vạch","polite")}}),(e.includes("/inventory")||e.includes("/products"))&&n.unshift({key:"add",icon:t.jsx(we,{}),label:"Thêm",onClick:()=>S(`${e}/add`)}),n})();return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`mobile-header ${b}`,children:[t.jsxs("div",{className:"mobile-header-main",children:[t.jsx("div",{className:"mobile-header-left",children:a?t.jsx(y,{type:"text",icon:t.jsx(je,{}),onClick:()=>{m?m():S(-1),Mt("Đã quay lại trang trước","polite")},className:"mobile-header-btn",size:"large","aria-label":"Quay lại"}):r?t.jsx(y,{type:"text",icon:t.jsx(ve,{}),onClick:u,className:"mobile-header-btn",size:"large","aria-label":"Mở menu"}):null}),t.jsx("div",{className:"mobile-header-center",children:!N&&t.jsx(qt,{className:"mobile-header-title",strong:!0,children:n})}),t.jsx("div",{className:"mobile-header-right",children:t.jsxs(l,{size:"small",children:[L.slice(0,2).map(e=>t.jsx(y,{type:"text",icon:e.icon,onClick:e.onClick,className:"mobile-header-btn",size:"large","aria-label":e.label},e.key)),o&&t.jsx(y,{type:"text",icon:t.jsx(fe,{}),onClick:I,className:"mobile-header-btn",size:"large","aria-label":"Tìm kiếm"}),c&&t.jsx(h,{count:T.length,size:"small",children:t.jsx(y,{type:"text",icon:t.jsx(F,{}),onClick:()=>S("/notifications"),className:"mobile-header-btn",size:"large","aria-label":`Thông báo (${T.length})`})}),d&&t.jsx(j,{menu:{items:R},trigger:["click"],placement:"bottomRight",children:t.jsx(y,{type:"text",className:"mobile-header-btn mobile-header-profile",size:"large","aria-label":"Menu người dùng",children:t.jsx(v,{size:"small",icon:t.jsx(E,{}),src:C?.avatar})})}),L.length>2&&t.jsx(j,{menu:{items:L.slice(2).map(e=>({key:e.key,label:e.label,icon:e.icon,onClick:e.onClick}))},trigger:["click"],placement:"bottomRight",children:t.jsx(y,{type:"text",icon:t.jsx(ke,{}),className:"mobile-header-btn",size:"large","aria-label":"Thêm hành động"})})]})})]}),N&&t.jsxs("div",{className:"mobile-header-search",children:[t.jsx(f,{placeholder:g,prefix:t.jsx(fe,{}),value:O,onChange:e=>A(e.target.value),onPressEnter:()=>A(O),autoFocus:!0,allowClear:!0,className:"mobile-search-input","aria-label":"Nhập từ khóa tìm kiếm"}),t.jsx(y,{type:"text",onClick:I,className:"mobile-search-close","aria-label":"Đóng tìm kiếm",children:"Hủy"})]})]}),t.jsx(k,{title:"Tìm kiếm",placement:"top",height:"100%",open:N&&O.length>0,onClose:()=>P(!1),className:"mobile-search-drawer",bodyStyle:{padding:0},children:t.jsx("div",{className:"mobile-search-results",children:t.jsxs(qt,{type:"secondary",children:['Kết quả tìm kiếm cho "',O,'"']})})})]})},Kt=()=>{const t=s();(({onSwipeLeft:t,onSwipeRight:n,onSwipeUp:a,onSwipeDown:i,onPullToRefresh:r,enableBackSwipe:o=!0,enablePullToRefresh:c=!1,swipeThreshold:l=50,velocityThreshold:d=.3}={})=>{const h=s(),u=e.useRef(null),m=e.useRef(null),p=e.useRef(!1),g=e.useRef(0),y=e.useCallback(e=>{u.current={x:e.touches[0].clientX,y:e.touches[0].clientY,time:Date.now()},m.current=null,p.current=!1,g.current=0},[]),x=e.useCallback(e=>{if(!u.current)return;const t=e.touches[0].clientX,n=e.touches[0].clientY,s=t-u.current.x,a=n-u.current.y;(Math.abs(s)>10||Math.abs(a)>10)&&(p.current=!0),c&&a>0&&0===window.scrollY&&(g.current=a,a>20&&e.preventDefault(),a>80&&document.body.style.setProperty("--pull-distance",`${Math.min(a,120)}px`))},[c]),b=e.useCallback(e=>{if(!u.current)return;m.current={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY,time:Date.now()};const s=m.current.x-u.current.x,y=m.current.y-u.current.y,x=m.current.time-u.current.time,b=Math.abs(s)/x,f=Math.abs(y)/x;document.body.style.removeProperty("--pull-distance"),c&&g.current>80&&y>0?r&&(r(),Mt("Đang làm mới dữ liệu","polite")):!p.current||Math.abs(s)<l&&Math.abs(y)<l||b<d&&f<d||(Math.abs(s)>Math.abs(y)?s>0?n?n():o&&s>2*l&&(h(-1),Mt("Đã quay lại trang trước","polite")):t&&t():y>0?i&&i():a&&a(),u.current=null,m.current=null,p.current=!1,g.current=0)},[h,t,n,a,i,r,o,c,l,d]);e.useEffect(()=>{const e=document.body;return e.addEventListener("touchstart",y,{passive:!1}),e.addEventListener("touchmove",x,{passive:!1}),e.addEventListener("touchend",b,{passive:!1}),()=>{e.removeEventListener("touchstart",y),e.removeEventListener("touchmove",x),e.removeEventListener("touchend",b)}},[y,x,b])})({onSwipeRight:e.useCallback(()=>{t(-1),Mt("Đã quay lại trang trước","polite")},[t]),onSwipeLeft:e.useCallback(()=>{Mt("Vuốt trái được phát hiện","polite")},[]),enableBackSwipe:!0,swipeThreshold:100,velocityThreshold:.5})},{Header:Ut,Sider:Gt,Content:Ht}=b,{useBreakpoint:Vt}=T,$t=({children:n,sidebar:s,header:a,className:i="",siderWidth:r=256,collapsedWidth:o=80,title:c="KhoAugment POS",showBack:l=!1,showSearch:d=!1,quickActions:h=[],notifications:u=[],...m})=>{const[p,g]=e.useState(!1),[y,x]=e.useState(!1),f=Vt(),{isMobile:j}=(()=>{const e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),t="ontouchstart"in window||navigator.maxTouchPoints>0;return{isMobile:e,isTouchDevice:t,isIOS:/iPad|iPhone|iPod/.test(navigator.userAgent),isAndroid:/Android/.test(navigator.userAgent),supportsTouch:t}})(),v=!f.md;Kt(),e.useEffect(()=>{f.md&&!f.lg?x(!0):f.lg&&x(!1)},[f]),e.useEffect(()=>{v||g(!1)},[v]);const k=()=>{g(!p)},S=()=>{g(!1)};return v||j?t.jsxs(b,{className:`responsive-layout mobile-layout ${i}`,...m,children:[t.jsx(Ft,{title:c,showBack:l,showSearch:d,onMenuClick:k,actions:h,notifications:u}),t.jsx(Ht,{className:"mobile-content",children:t.jsx("div",{className:"mobile-content-wrapper",children:n})}),t.jsx(zt,{visible:p,onClose:S,menuItems:s?.props?.menuItems||[],notifications:u,quickActions:h,showSearch:d})]}):t.jsxs(b,{className:`responsive-layout desktop-layout ${i}`,...m,children:[s&&t.jsx(Gt,{width:r,collapsedWidth:o,collapsed:y,onCollapse:()=>{x(!y)},className:"desktop-sidebar",breakpoint:"lg",collapsible:!0,children:t.jsx("div",{className:"desktop-sidebar-content",children:s})}),t.jsxs(b,{className:"desktop-main-layout",children:[t.jsx(Ut,{className:"desktop-header",children:t.jsx("div",{className:"desktop-header-content",children:a})}),t.jsx(Ht,{className:"desktop-content",children:t.jsx("div",{className:"desktop-content-wrapper",children:n})})]})]})},{Content:Wt}=b,{useBreakpoint:Xt}=T,Qt=Object.freeze(Object.defineProperty({__proto__:null,default:({showHeader:n=!0,showSidebar:a=!0,showFooter:c=!0,fullWidth:l=!1})=>{const d=s(),h=i(),{user:u,isAuthenticated:m,loading:p}=lt(),g=Xt(),[y,x]=e.useState(!g.lg),[b,f]=e.useState(!1);e.useEffect(()=>{p||(m?u&&"admin"!==u.role&&(o.error("Bạn không có quyền truy cập trang quản trị"),d("/")):d("/login",{state:{from:h.pathname}}))},[m,u,p,d,h.pathname]);const j=!g.lg;return p?t.jsxs("div",{className:"loading-container",children:[t.jsx(N,{size:"large"}),t.jsx("div",{className:"loading-text",children:"Đang tải..."})]}):t.jsx($t,{sidebar:a?t.jsx(Rt,{collapsed:y,onCollapse:x,isMobile:j,visible:b,onClose:()=>f(!1)}):null,header:n?t.jsx(wt,{collapsed:y,onCollapse:e=>{j?f(!b):x(e)},title:"KhoAugment POS - Quản trị"}):null,className:"admin-layout",children:t.jsxs("div",{className:"admin-content "+(l?"full-width":""),style:l?0:{padding:"24px"},children:[t.jsx(r,{}),c&&t.jsx(Ot,{minimal:!0})]})})}},Symbol.toStringTag,{value:"Module"})),{Content:Yt}=b,{useBreakpoint:Jt}=T,Zt=Object.freeze(Object.defineProperty({__proto__:null,default:({showHeader:n=!0,showSidebar:a=!0,showFooter:c=!1,fullWidth:l=!1})=>{const d=s(),h=i(),{user:m,isAuthenticated:p,loading:g,logout:x}=lt(),f=Jt(),[j,v]=e.useState(!f.lg),[k,S]=e.useState(!1),[w,C]=e.useState(null);e.useEffect(()=>{g||(p?m&&"cashier"!==m.role?(o.error("Bạn không có quyền truy cập trang này"),d("/")):T():d("/login",{state:{from:h.pathname}}))},[p,m,g,d,h.pathname]);const T=async()=>{try{const e=localStorage.getItem("activeShift");e?C(JSON.parse(e)):"/cashier/session/start"!==h.pathname&&u.confirm({title:"Chưa mở ca",content:"Bạn cần mở ca làm việc trước khi sử dụng hệ thống POS. Chuyển đến trang mở ca?",okText:"Đến trang mở ca",cancelText:"Hủy",onOk(){d("/cashier/session/start")}})}catch(e){}},P=!f.lg;return g?t.jsxs("div",{className:"loading-container",children:[t.jsx(N,{size:"large"}),t.jsx("div",{className:"loading-text",children:"Đang tải..."})]}):t.jsxs(b,{className:"site-layout",children:[a&&t.jsx(t.Fragment,{children:P?t.jsx(Rt,{collapsed:j,onCollapse:v,isMobile:!0,visible:k,onClose:()=>S(!1)}):t.jsx(Rt,{collapsed:j,onCollapse:v})}),t.jsxs(b,{className:"site-layout-content "+(a?j?"content-collapsed":"content-expanded":"content-no-sidebar"),children:[n&&t.jsx(wt,{collapsed:j,onCollapse:e=>{P?S(!k):v(e)},title:"Trường Phát POS - Thu Ngân"}),w&&t.jsx("div",{className:"shift-info",children:t.jsxs("div",{className:"shift-status",children:[t.jsxs("span",{children:["Ca làm việc: ",t.jsx("strong",{children:w.name})]}),t.jsxs("span",{children:["Bắt đầu: ",t.jsx("strong",{children:new Date(w.startTime).toLocaleString()})]}),t.jsx(y,{type:"link",icon:t.jsx(Ce,{}),onClick:T,children:"Làm mới"})]})}),t.jsx(Yt,{className:"site-content",style:l?0:{padding:"24px"},children:t.jsx(r,{})}),c&&t.jsx(Ot,{minimal:!0})]})]})}},Symbol.toStringTag,{value:"Module"})),{Content:en}=b,{useBreakpoint:tn}=T,nn=Object.freeze(Object.defineProperty({__proto__:null,default:({showHeader:n=!0,showSidebar:a=!0,showFooter:c=!1,fullWidth:l=!1})=>{const d=s(),h=i(),{user:u,isAuthenticated:m,loading:p}=lt(),g=tn(),[y,x]=e.useState(!g.lg),[f,j]=e.useState(!1);e.useEffect(()=>{p||(m?u&&"staff"!==u.role&&(o.error("Bạn không có quyền truy cập trang này"),d("/")):d("/login",{state:{from:h.pathname}}))},[m,u,p,d,h.pathname]);const v=!g.lg;return p?t.jsxs("div",{className:"loading-container",children:[t.jsx(N,{size:"large"}),t.jsx("div",{className:"loading-text",children:"Đang tải..."})]}):t.jsxs(b,{className:"site-layout",children:[a&&t.jsx(t.Fragment,{children:v?t.jsx(Rt,{collapsed:y,onCollapse:x,isMobile:!0,visible:f,onClose:()=>j(!1)}):t.jsx(Rt,{collapsed:y,onCollapse:x})}),t.jsxs(b,{className:"site-layout-content "+(a?y?"content-collapsed":"content-expanded":"content-no-sidebar"),children:[n&&t.jsx(wt,{collapsed:y,onCollapse:e=>{v?j(!f):x(e)},title:"Trường Phát POS - Nhân viên"}),t.jsx(en,{className:"site-content staff-content",style:l?0:{padding:"24px"},children:t.jsx(r,{})}),c&&t.jsx(Ot,{minimal:!0})]})]})}},Symbol.toStringTag,{value:"Module"})),{Header:sn,Content:an,Footer:rn}=b,{Title:on,Text:cn}=d,ln=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[n,s]=e.useState(!1),o=i();P.useToken();const c=[{key:"/customer-lookup",icon:t.jsx(Te,{}),label:t.jsx(a,{to:"/customer-lookup",children:"Tra cứu sản phẩm"})},{key:"/terms",icon:t.jsx(Ne,{}),label:t.jsx(a,{to:"/terms",children:"Điều khoản bảo hành"})}],l=()=>{s(!n)};return t.jsxs(b,{className:"min-h-screen",children:[t.jsxs(sn,{className:"flex items-center justify-between px-4 sm:px-6 bg-white shadow-sm z-10",children:[t.jsx("div",{className:"flex items-center",children:t.jsxs(a,{to:"/",className:"flex items-center",children:[t.jsx("img",{src:"/logo.png",alt:"Trường Phát Computer",className:"h-8 mr-2",onError:e=>{e.target.onerror=null,e.target.src="https://placehold.co/40x40?text=TP"}}),t.jsx(on,{level:4,style:{margin:0,display:"none","@media (min-width: 640px)":{display:"block"}},children:"Trường Phát Computer"})]})}),t.jsx("div",{className:"hidden sm:block",children:t.jsx(x,{mode:"horizontal",selectedKeys:[o.pathname],items:c,style:{border:"none",backgroundColor:"transparent"}})}),t.jsx(y,{type:"text",icon:t.jsx(ve,{}),onClick:l,className:"sm:hidden"}),t.jsx(k,{title:"Menu",placement:"right",onClose:l,open:n,width:250,children:t.jsx(x,{mode:"vertical",selectedKeys:[o.pathname],items:c,style:{border:"none"}})})]}),t.jsx(an,{className:"p-4 sm:p-6",children:t.jsx("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-sm",children:t.jsx(r,{})})}),t.jsx(rn,{className:"text-center",children:t.jsxs(cn,{type:"secondary",children:["© ",(new Date).getFullYear()," Trường Phát Computer. Tất cả quyền được bảo lưu."]})})]})}},Symbol.toStringTag,{value:"Module"})),{Title:dn,Text:hn,Paragraph:un}=d,mn=({name:e,size:n="base",color:s="default",className:a="",...i})=>{const r={user:E,cart:ge,dollar:J,chart:me,success:Oe,warning:L,info:Ne,error:Pe}[e]||E,o=`icon-${n}`,c="default"!==s?`text-${s}`:"";return t.jsx(r,{className:`${o} ${c} ${a}`,...i})},pn=({title:e,value:n,icon:s,trend:a,trendValue:i,color:r="primary",loading:o=!1,onClick:c,...l})=>{const d=()=>"up"===a?"success":"down"===a?"error":"secondary",h=()=>"up"===a?`tăng ${i}`:"down"===a?`giảm ${i}`:"",u=`${e}: ${n}${a?`, ${h()}`:""}`;return t.jsx(O,{className:"metric-card",loading:o,tabIndex:c?0:-1,role:c?"button":"region","aria-label":u,onClick:c,onKeyDown:e=>{Lt(e,{onEnter:()=>c&&c()})},...l,children:t.jsxs("div",{className:"metric-card-content",children:[t.jsxs("div",{className:"metric-header",children:[t.jsx(hn,{className:"metric-title text-secondary",id:`metric-title-${e.replace(/\s+/g,"-").toLowerCase()}`,children:e}),s&&t.jsx(mn,{name:s,size:"lg",color:r,"aria-hidden":"true"})]}),t.jsxs("div",{className:"metric-value",children:[t.jsx(dn,{level:2,className:"metric-number","aria-describedby":`metric-title-${e.replace(/\s+/g,"-").toLowerCase()}`,children:n}),a&&i&&t.jsxs("div",{className:`metric-trend text-${d()}`,"aria-label":`Xu hướng: ${h()}`,children:["up"===a?t.jsx(mn,{name:"success",size:"sm"}):"down"===a?t.jsx(mn,{name:"error",size:"sm"}):null,t.jsx(hn,{className:`text-${d()}`,children:i})]})]})]})})},gn=({title:e,subtitle:n,icon:s,actions:a,breadcrumb:i,...r})=>t.jsxs("header",{className:"page-header",role:"banner",...r,children:[i&&t.jsx("nav",{className:"page-breadcrumb","aria-label":"Breadcrumb navigation",children:i}),t.jsxs("div",{className:"page-header-content",children:[t.jsx("div",{className:"page-header-main",children:t.jsxs("div",{className:"page-title-wrapper",children:[s&&t.jsx(mn,{name:s,size:"xl",className:"page-icon","aria-hidden":"true"}),t.jsxs("div",{className:"page-title-content",children:[t.jsx(dn,{level:1,className:"page-title",id:"page-title",children:e}),n&&t.jsx(hn,{className:"page-subtitle text-secondary","aria-describedby":"page-title",children:n})]})]})}),a&&t.jsx("div",{className:"page-actions",role:"toolbar","aria-label":"Page actions",children:t.jsx(l,{size:"middle",children:a})})]})]});export{ot as A,Zt as C,pn as M,gn as P,nn as S,ct as a,Qt as b,ln as c,lt as u};
