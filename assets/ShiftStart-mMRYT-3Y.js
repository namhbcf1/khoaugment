import{u as Q,j as e}from"./index-DPVYnWcF.js";import{u as B,r as d}from"./vendor-DD54NZMZ.js";import{f as T}from"./formatters-zHPZYAEt.js";import{F as t,f as u,T as H,Y as w,W as $,z as q,Z as m,B as g,bs as G,A as Y,e as f,C as i,as as l,k as z,l as K,$ as p,I as L,s as b}from"./antd-pmzi8FkM.js";const{Title:C,Text:W}=H,{Option:r}=p,{Step:v}=w,_=()=>{const[j]=t.useForm(),D=B(),{user:I}=Q(),[V,S]=d.useState(!1),[x,y]=d.useState(0),[h,A]=d.useState(null),[N,O]=d.useState(0),[s,P]=d.useState({5e5:0,2e5:0,1e5:0,5e4:0,2e4:0,1e4:0,5e3:0,2e3:0,1e3:0,coins:0});d.useEffect(()=>{let n=0;Object.entries(s).forEach(([c,o])=>{c==="coins"?n+=o:n+=parseInt(c)*o}),O(n),j.setFieldsValue({drawerAmount:n})},[s,j]);const a=(n,c)=>{P(o=>({...o,[n]:c}))},E=()=>{j.validateFields().then(()=>{y(x+1)}).catch(n=>{console.error("Validate Failed:",n)})},M=()=>{y(x-1)},R=async n=>{S(!0);try{await new Promise(o=>setTimeout(o,1500));const c={shiftId:`SHIFT-${Date.now().toString().slice(-6)}`,cashier:I?.name||"Nhân viên thu ngân",cashierId:I?.id,startTime:new Date().toISOString(),startAmount:n.drawerAmount,posTerminal:n.posTerminal,register:n.register,note:n.note,status:"active",denominations:s};A(c),y(x+1),b.success("Mở ca làm việc thành công!")}catch(c){console.error("Error starting shift:",c),b.error("Có lỗi xảy ra khi mở ca làm việc!")}finally{S(!1)}},k=()=>{D("/cashier/pos")},F=()=>{switch(x){case 0:return e.jsxs(u,{title:"Thông tin ca làm việc",children:[e.jsx(t.Item,{name:"posTerminal",label:"Máy POS",rules:[{required:!0,message:"Vui lòng chọn máy POS!"}],children:e.jsxs(p,{placeholder:"Chọn máy POS",children:[e.jsx(r,{value:"POS-01",children:"POS-01 (Quầy chính)"}),e.jsx(r,{value:"POS-02",children:"POS-02 (Quầy phụ)"}),e.jsx(r,{value:"POS-03",children:"POS-03 (Tầng 2)"})]})}),e.jsx(t.Item,{name:"register",label:"Quầy thu ngân",rules:[{required:!0,message:"Vui lòng chọn quầy thu ngân!"}],children:e.jsxs(p,{placeholder:"Chọn quầy thu ngân",children:[e.jsx(r,{value:"REGISTER-01",children:"Quầy 1"}),e.jsx(r,{value:"REGISTER-02",children:"Quầy 2"}),e.jsx(r,{value:"REGISTER-03",children:"Quầy 3"})]})}),e.jsx(t.Item,{name:"shiftType",label:"Loại ca",rules:[{required:!0,message:"Vui lòng chọn loại ca!"}],initialValue:"morning",children:e.jsxs(p,{placeholder:"Chọn loại ca",children:[e.jsx(r,{value:"morning",children:"Ca sáng (8:00 - 14:00)"}),e.jsx(r,{value:"afternoon",children:"Ca chiều (14:00 - 20:00)"}),e.jsx(r,{value:"evening",children:"Ca tối (20:00 - 23:00)"}),e.jsx(r,{value:"full",children:"Ca đầy đủ (8:00 - 20:00)"})]})}),e.jsx(t.Item,{name:"note",label:"Ghi chú",children:e.jsx(L.TextArea,{rows:2,placeholder:"Ghi chú (nếu có)"})}),e.jsx(t.Item,{children:e.jsx(g,{type:"primary",onClick:E,children:"Tiếp tục"})})]});case 1:return e.jsxs(u,{title:"Khai báo tiền đầu ca",children:[e.jsx(Y,{message:"Hướng dẫn khai báo tiền đầu ca",description:"Vui lòng nhập chính xác số lượng của từng mệnh giá tiền trong két. Hệ thống sẽ tự động tính tổng số tiền.",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsxs(f,{gutter:[16,16],children:[e.jsx(i,{span:16,children:e.jsx(u,{title:"Chi tiết mệnh giá",size:"small",children:e.jsxs(f,{gutter:[16,16],children:[e.jsx(i,{span:8,children:e.jsx(t.Item,{label:"500,000 VND",children:e.jsx(l,{min:0,value:s[5e5],onChange:n=>a("500000",n),style:{width:"100%"}})})}),e.jsx(i,{span:8,children:e.jsx(t.Item,{label:"200,000 VND",children:e.jsx(l,{min:0,value:s[2e5],onChange:n=>a("200000",n),style:{width:"100%"}})})}),e.jsx(i,{span:8,children:e.jsx(t.Item,{label:"100,000 VND",children:e.jsx(l,{min:0,value:s[1e5],onChange:n=>a("100000",n),style:{width:"100%"}})})}),e.jsx(i,{span:8,children:e.jsx(t.Item,{label:"50,000 VND",children:e.jsx(l,{min:0,value:s[5e4],onChange:n=>a("50000",n),style:{width:"100%"}})})}),e.jsx(i,{span:8,children:e.jsx(t.Item,{label:"20,000 VND",children:e.jsx(l,{min:0,value:s[2e4],onChange:n=>a("20000",n),style:{width:"100%"}})})}),e.jsx(i,{span:8,children:e.jsx(t.Item,{label:"10,000 VND",children:e.jsx(l,{min:0,value:s[1e4],onChange:n=>a("10000",n),style:{width:"100%"}})})}),e.jsx(i,{span:8,children:e.jsx(t.Item,{label:"5,000 VND",children:e.jsx(l,{min:0,value:s[5e3],onChange:n=>a("5000",n),style:{width:"100%"}})})}),e.jsx(i,{span:8,children:e.jsx(t.Item,{label:"2,000 VND",children:e.jsx(l,{min:0,value:s[2e3],onChange:n=>a("2000",n),style:{width:"100%"}})})}),e.jsx(i,{span:8,children:e.jsx(t.Item,{label:"1,000 VND",children:e.jsx(l,{min:0,value:s[1e3],onChange:n=>a("1000",n),style:{width:"100%"}})})}),e.jsx(i,{span:8,children:e.jsx(t.Item,{label:"Tiền xu (VND)",children:e.jsx(l,{min:0,value:s.coins,onChange:n=>a("coins",n),style:{width:"100%"}})})})]})})}),e.jsx(i,{span:8,children:e.jsxs(u,{title:"Tổng tiền",size:"small",children:[e.jsx(t.Item,{name:"drawerAmount",label:"Tổng tiền trong két",children:e.jsx(l,{style:{width:"100%"},formatter:n=>`${n}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:n=>n.replace(/\$\s?|(,*)/g,""),disabled:!0})}),e.jsxs("div",{style:{marginTop:"20px",textAlign:"center"},children:[e.jsx(C,{level:3,children:T(N)}),e.jsx(W,{type:"secondary",children:"Tổng tiền đầu ca"})]})]})})]}),e.jsx(z,{}),e.jsx(t.Item,{children:e.jsxs(K,{children:[e.jsx(g,{onClick:M,children:"Quay lại"}),e.jsx(g,{type:"primary",onClick:R,loading:V,children:"Mở ca làm việc"})]})})]});case 2:return e.jsx(u,{children:e.jsx($,{status:"success",title:"Mở ca làm việc thành công!",subTitle:`Mã ca: ${h?.shiftId||"N/A"} - Thời gian bắt đầu: ${q(h?.startTime).format("DD/MM/YYYY HH:mm:ss")}`,extra:[e.jsx(g,{type:"primary",onClick:k,icon:e.jsx(G,{}),children:"Bắt đầu bán hàng"},"console")],children:e.jsxs(m,{title:"Thông tin ca làm việc",children:[e.jsx(m.Item,{label:"Nhân viên",children:h?.cashier}),e.jsx(m.Item,{label:"Máy POS",children:h?.posTerminal}),e.jsx(m.Item,{label:"Quầy thu ngân",children:h?.register}),e.jsx(m.Item,{label:"Tiền đầu ca",children:T(h?.startAmount)}),e.jsx(m.Item,{label:"Trạng thái",children:e.jsx("span",{style:{color:"#52c41a"},children:"Đang hoạt động"})})]})})});default:return null}};return e.jsx("div",{style:{maxWidth:1e3,margin:"0 auto"},children:e.jsxs(u,{children:[e.jsx(C,{level:2,style:{textAlign:"center",margin:"0 0 24px 0"},children:"Mở ca làm việc"}),e.jsxs(w,{current:x,style:{marginBottom:24},children:[e.jsx(v,{title:"Thông tin ca",description:"Nhập thông tin ca làm việc"}),e.jsx(v,{title:"Khai báo tiền",description:"Khai báo tiền đầu ca"}),e.jsx(v,{title:"Hoàn thành",description:"Xác nhận thông tin"})]}),e.jsx(t,{form:j,layout:"vertical",initialValues:{shiftType:"morning",drawerAmount:0},children:F()})]})})};export{_ as default};
