import{j as e}from"./index-DPVYnWcF.js";import{u as Ie,r as l}from"./vendor-DD54NZMZ.js";import{z as r,a as o,O as be,aW as Se,au as Te,ae as q,f as u,e as N,C as i,T as Ye,l as O,B as x,ag as we,aj as $e,a1 as Re,ay as Ve,I as ze,$ as L,ah as U,ai as Be,af as Ne,y as W,M as Oe,D as Le,a5 as Z,g as T,k as Y,aI as Ee,v as He,aX as Pe,Q as Fe,ab as J,aY as ee,p as Ae,u as se,E as Ke,_ as D,s as g,m as f,r as Xe,aT as Ge,am as Qe,al as _e,H as C,an as qe,ak as Ue}from"./antd-pmzi8FkM.js";const{Title:te,Text:p}=Ye,{Search:We}=ze,{Option:h}=L,{TabPane:ne}=se,tt=()=>{const w=Ie(),[E,m]=l.useState(!0),[j,v]=l.useState([]),[ae,H]=l.useState([]),[c,P]=l.useState([]),[y,$]=l.useState(""),[I,F]=l.useState("all"),[k,A]=l.useState("all"),[re,b]=l.useState(!1),[s,le]=l.useState(null),[ie,R]=l.useState(!1),[V,K]=l.useState(null);l.useEffect(()=>{m(!0),setTimeout(()=>{const t=ce();v(t),H(t),m(!1)},1500)},[]);const ce=()=>{const t=["active","inactive","new"],n=["Bronze","Silver","Gold","Platinum",null],a=["male","female","other"];return["Nguyễn Văn An","Trần Thị Bình","Lê Minh Cường","Phạm Thị Diễm","Hoàng Văn Em","Đỗ Thị Phương","Ngô Văn Giang","Vũ Thị Hà","Đinh Văn Indra","Bùi Thị Kim","Lý Văn Long","Mai Thị Minh","Phan Văn Nam","Đặng Thị Oanh","Huỳnh Văn Phúc","Chu Thị Quỳnh"].map((M,d)=>{const fe=d+1,pe=M.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"").toLowerCase()+"@gmail.com",B=r().subtract(Math.floor(Math.random()*365),"days").format("YYYY-MM-DD"),ve=t[Math.floor(Math.random()*t.length)],ye=n[Math.floor(Math.random()*n.length)],ke=a[Math.floor(Math.random()*a.length)],Me=`0${Math.floor(Math.random()*1e9).toString().padStart(9,"0")}`,_=Math.floor(Math.random()*20),De=Math.floor(Math.random()*5e7)+5e5,Ce=Math.floor(Math.random()*1e3);return{id:fe,name:M,email:pe,phone:Me,gender:ke,status:ve,membership:ye,createdDate:B,lastOrderDate:_>0?r(B).add(Math.floor(Math.random()*r().diff(r(B),"days")),"days").format("YYYY-MM-DD"):null,orders:_,totalSpent:De,points:Ce,address:"Hòa Bình, Việt Nam",notes:Math.random()>.7?"Khách hàng VIP, ưu tiên hỗ trợ nhanh":""}})};l.useEffect(()=>{let t=[...j];y&&(t=t.filter(n=>n.name.toLowerCase().includes(y.toLowerCase())||n.email.toLowerCase().includes(y.toLowerCase())||n.phone.includes(y))),I!=="all"&&(t=t.filter(n=>n.status===I)),k!=="all"&&(k==="none"?t=t.filter(n=>!n.membership):t=t.filter(n=>n.membership===k)),H(t)},[y,I,k,j]);const oe={selectedRowKeys:c,onChange:t=>P(t)},he=t=>{K(t),R(!0)},de=()=>{m(!0),setTimeout(()=>{v(t=>t.filter(n=>n.id!==V.id)),g.success(`Đã xóa khách hàng: ${V.name}`),R(!1),K(null),m(!1)},1e3)},S=t=>{if(c.length===0){g.warning("Vui lòng chọn ít nhất một khách hàng");return}m(!0),setTimeout(()=>{switch(t){case"delete":v(n=>n.filter(a=>!c.includes(a.id))),g.success(`Đã xóa ${c.length} khách hàng`);break;case"active":v(n=>n.map(a=>c.includes(a.id)?{...a,status:"active"}:a)),g.success(`Đã kích hoạt ${c.length} khách hàng`);break;case"inactive":v(n=>n.map(a=>c.includes(a.id)?{...a,status:"inactive"}:a)),g.success(`Đã vô hiệu hóa ${c.length} khách hàng`);break;case"export":g.success("Đã xuất file Excel với dữ liệu đã chọn");break}P([]),m(!1)},1e3)},xe=t=>{le(t),b(!0)},z=t=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t),ue=t=>e.jsxs(o,{children:[e.jsx(o.Item,{icon:e.jsx(qe,{}),onClick:()=>xe(t),children:"Xem chi tiết"},"view"),e.jsx(o.Item,{icon:e.jsx(Ue,{}),onClick:()=>w(`/admin/customers/edit/${t.id}`),children:"Chỉnh sửa"},"edit"),e.jsx(o.Divider,{}),e.jsx(o.Item,{icon:e.jsx(q,{}),danger:!0,onClick:()=>he(t),children:"Xóa"},"delete")]}),X=t=>{switch(t){case"active":return e.jsx(C,{color:"green",children:"Hoạt động"});case"inactive":return e.jsx(C,{color:"red",children:"Vô hiệu"});case"new":return e.jsx(C,{color:"blue",children:"Mới"});default:return e.jsx(C,{children:"Unknown"})}},G=t=>{if(!t)return e.jsx(p,{type:"secondary",children:"Chưa có"});let n="";switch(t){case"Bronze":n="#cd7f32";break;case"Silver":n="#c0c0c0";break;case"Gold":n="#ffd700";break;case"Platinum":n="#e5e4e2";break;default:n="#999"}return e.jsx(C,{color:n,style:{color:t==="Gold"?"#5c4d00":void 0},children:t})},me=[{title:"Khách hàng",dataIndex:"name",key:"name",render:(t,n)=>e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(Z,{icon:e.jsx(T,{}),style:{backgroundColor:n.gender==="female"?"#ff7875":n.gender==="male"?"#1890ff":"#722ed1",marginRight:"8px"}}),e.jsxs("div",{children:[e.jsx("div",{children:t}),e.jsx("div",{style:{fontSize:"12px",color:"rgba(0, 0, 0, 0.45)"},children:n.email})]})]})},{title:"Điện thoại",dataIndex:"phone",key:"phone"},{title:"Đơn hàng",dataIndex:"orders",key:"orders",sorter:(t,n)=>t.orders-n.orders,render:t=>e.jsx(Qe,{count:t,showZero:!0,style:{backgroundColor:t>0?"#1890ff":"#d9d9d9"}})},{title:"Tổng chi tiêu",dataIndex:"totalSpent",key:"totalSpent",sorter:(t,n)=>t.totalSpent-n.totalSpent,render:t=>z(t)},{title:"Ngày tạo",dataIndex:"createdDate",key:"createdDate",sorter:(t,n)=>r(t.createdDate).unix()-r(n.createdDate).unix(),render:t=>r(t).format("DD/MM/YYYY")},{title:"Lần mua cuối",dataIndex:"lastOrderDate",key:"lastOrderDate",sorter:(t,n)=>t.lastOrderDate?n.lastOrderDate?r(t.lastOrderDate).unix()-r(n.lastOrderDate).unix():-1:1,render:t=>t?r(t).format("DD/MM/YYYY"):e.jsx(p,{type:"secondary",children:"Chưa mua"})},{title:"Hạng thành viên",dataIndex:"membership",key:"membership",render:t=>G(t)},{title:"Trạng thái",dataIndex:"status",key:"status",render:t=>X(t)},{title:"Thao tác",key:"action",render:(t,n)=>e.jsx(U,{overlay:ue(n),trigger:["click"],children:e.jsx(x,{type:"text",icon:e.jsx(_e,{}),onClick:a=>a.preventDefault()})})}],je=e.jsxs(o,{children:[e.jsx(o.Item,{icon:e.jsx(be,{}),onClick:()=>S("active"),children:"Kích hoạt đã chọn"},"active"),e.jsx(o.Item,{icon:e.jsx(Se,{}),onClick:()=>S("inactive"),children:"Vô hiệu hóa đã chọn"},"inactive"),e.jsx(o.Divider,{}),e.jsx(o.Item,{icon:e.jsx(Te,{}),onClick:()=>S("export"),children:"Xuất Excel đã chọn"},"export"),e.jsx(o.Item,{icon:e.jsx(q,{}),danger:!0,onClick:()=>S("delete"),children:"Xóa đã chọn"},"delete")]}),ge=()=>{const t=j.length,n=j.filter(d=>d.status==="active").length,a=j.filter(d=>d.status==="inactive").length,Q=j.filter(d=>d.status==="new").length,M=j.filter(d=>d.orders>0).length;return e.jsxs(N,{gutter:[16,16],children:[e.jsx(i,{xs:12,sm:8,md:6,lg:4,children:e.jsx(u,{size:"small",children:e.jsx(f,{title:"Tổng khách hàng",value:t,prefix:e.jsx(Xe,{})})})}),e.jsx(i,{xs:12,sm:8,md:6,lg:4,children:e.jsx(u,{size:"small",children:e.jsx(f,{title:"Đang hoạt động",value:n,valueStyle:{color:"#52c41a"},prefix:e.jsx(T,{})})})}),e.jsx(i,{xs:12,sm:8,md:6,lg:4,children:e.jsx(u,{size:"small",children:e.jsx(f,{title:"Không hoạt động",value:a,valueStyle:{color:"#cf1322"},prefix:e.jsx(T,{})})})}),e.jsx(i,{xs:12,sm:8,md:6,lg:4,children:e.jsx(u,{size:"small",children:e.jsx(f,{title:"Mới",value:Q,valueStyle:{color:"#1890ff"},prefix:e.jsx(Ge,{})})})}),e.jsx(i,{xs:12,sm:8,md:6,lg:4,children:e.jsx(u,{size:"small",children:e.jsx(f,{title:"Đã mua hàng",value:M,valueStyle:{color:"#722ed1"},prefix:e.jsx(J,{})})})}),e.jsx(i,{xs:12,sm:8,md:6,lg:4,children:e.jsx(u,{size:"small",children:e.jsx(f,{title:"Tỉ lệ mua hàng",value:t?(M/t*100).toFixed(1):0,suffix:"%",precision:1,prefix:e.jsx(ee,{})})})})]})};return e.jsxs("div",{className:"customer-management",children:[e.jsx(u,{bordered:!1,className:"header-card",children:e.jsxs(N,{justify:"space-between",align:"middle",gutter:[24,24],children:[e.jsxs(i,{xs:24,sm:12,children:[e.jsx(te,{level:3,children:"Quản lý khách hàng"}),e.jsx(p,{type:"secondary",children:"Quản lý thông tin và dữ liệu khách hàng"})]}),e.jsx(i,{xs:24,sm:12,children:e.jsxs(O,{wrap:!0,style:{width:"100%",justifyContent:"flex-end"},children:[e.jsx(x,{type:"primary",icon:e.jsx(we,{}),onClick:()=>w("/admin/customers/add"),children:"Thêm khách hàng"}),e.jsx(x,{icon:e.jsx($e,{}),children:"Nhập Excel"}),e.jsx(x,{icon:e.jsx(Re,{}),children:"Xuất Excel"}),e.jsx(x,{icon:e.jsx(Ve,{}),loading:E,onClick:()=>m(!0),children:"Làm mới"})]})})]})}),e.jsx("div",{style:{margin:"24px 0"},children:ge()}),e.jsxs(u,{bordered:!1,children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsxs(N,{gutter:[16,16],align:"middle",children:[e.jsx(i,{xs:24,md:8,children:e.jsx(We,{placeholder:"Tìm khách hàng theo tên, email, SĐT...",allowClear:!0,enterButton:!0,onSearch:t=>$(t),onChange:t=>$(t.target.value)})}),e.jsx(i,{xs:12,md:4,children:e.jsxs(L,{style:{width:"100%"},placeholder:"Lọc theo trạng thái",onChange:t=>F(t),value:I,children:[e.jsx(h,{value:"all",children:"Tất cả trạng thái"}),e.jsx(h,{value:"active",children:"Hoạt động"}),e.jsx(h,{value:"inactive",children:"Vô hiệu"}),e.jsx(h,{value:"new",children:"Mới"})]})}),e.jsx(i,{xs:12,md:4,children:e.jsxs(L,{style:{width:"100%"},placeholder:"Lọc theo hạng thành viên",onChange:t=>A(t),value:k,children:[e.jsx(h,{value:"all",children:"Tất cả hạng"}),e.jsx(h,{value:"Bronze",children:"Bronze"}),e.jsx(h,{value:"Silver",children:"Silver"}),e.jsx(h,{value:"Gold",children:"Gold"}),e.jsx(h,{value:"Platinum",children:"Platinum"}),e.jsx(h,{value:"none",children:"Chưa có hạng"})]})}),e.jsx(i,{xs:24,md:8,style:{textAlign:"right"},children:e.jsxs(O,{children:[c.length>0&&e.jsxs(p,{type:"secondary",children:["Đã chọn ",c.length," khách hàng"]}),c.length>0&&e.jsx(U,{overlay:je,children:e.jsxs(x,{children:["Thao tác ",e.jsx(Be,{})]})}),e.jsx(x,{icon:e.jsx(Ne,{}),onClick:()=>{$(""),F("all"),A("all")},children:"Xóa bộ lọc"})]})})]})}),e.jsx(W,{rowSelection:oe,columns:me,dataSource:ae,rowKey:"id",loading:E,pagination:{pageSize:10,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}})]}),e.jsxs(Oe,{title:"Xác nhận xóa khách hàng",visible:ie,onOk:de,onCancel:()=>R(!1),okText:"Xóa",cancelText:"Hủy",okButtonProps:{danger:!0},children:[e.jsxs("p",{children:["Bạn có chắc chắn muốn xóa khách hàng ",e.jsx("strong",{children:V?.name}),"?"]}),e.jsx("p",{children:"Hành động này không thể hoàn tác và sẽ xóa tất cả dữ liệu liên quan đến khách hàng này."})]}),e.jsx(Le,{title:"Chi tiết khách hàng",width:500,placement:"right",onClose:()=>b(!1),visible:re,footer:e.jsxs(O,{children:[e.jsx(x,{onClick:()=>{b(!1),w(`/admin/customers/edit/${s?.id}`)},type:"primary",children:"Chỉnh sửa"}),e.jsx(x,{onClick:()=>b(!1),children:"Đóng"})]}),children:s&&e.jsxs("div",{children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"24px"},children:[e.jsx(Z,{size:80,icon:e.jsx(T,{}),style:{backgroundColor:s.gender==="female"?"#ff7875":s.gender==="male"?"#1890ff":"#722ed1"}}),e.jsx(te,{level:4,style:{marginTop:"16px",marginBottom:"0"},children:s.name}),G(s.membership),X(s.status)]}),e.jsx(Y,{orientation:"left",children:"Thông tin liên hệ"}),e.jsxs("p",{children:[e.jsx(Ee,{})," Email: ",e.jsx(p,{copyable:!0,children:s.email})]}),e.jsxs("p",{children:[e.jsx(He,{})," Điện thoại: ",e.jsx(p,{copyable:!0,children:s.phone})]}),e.jsxs("p",{children:[e.jsx(Pe,{})," Địa chỉ: ",s.address]}),e.jsx(Y,{orientation:"left",children:"Thông tin tài khoản"}),e.jsxs("p",{children:[e.jsx(Fe,{})," Ngày tạo: ",r(s.createdDate).format("DD/MM/YYYY")]}),e.jsxs("p",{children:[e.jsx(J,{})," Tổng đơn hàng: ",s.orders]}),e.jsxs("p",{children:[e.jsx(ee,{})," Tổng chi tiêu: ",z(s.totalSpent)]}),e.jsxs("p",{children:[e.jsx(Ae,{})," Điểm tích lũy: ",s.points," điểm"]}),s.notes&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{orientation:"left",children:"Ghi chú"}),e.jsx("p",{children:s.notes})]}),e.jsx(Y,{orientation:"left",children:"Hoạt động gần đây"}),e.jsxs(se,{defaultActiveKey:"orders",children:[e.jsx(ne,{tab:"Đơn hàng",children:s.orders>0?e.jsx(W,{size:"small",pagination:!1,columns:[{title:"Mã đơn",dataIndex:"code",key:"code"},{title:"Ngày",dataIndex:"date",key:"date"},{title:"Giá trị",dataIndex:"value",key:"value",align:"right"}],dataSource:Array(Math.min(s.orders,5)).fill().map((t,n)=>({key:n,code:`ORD-${1e5+n}`,date:r(s.lastOrderDate).subtract(n*15,"days").format("DD/MM/YYYY"),value:z(Math.floor(Math.random()*5e6)+5e5)}))}):e.jsx(Ke,{description:"Chưa có đơn hàng nào"})},"orders"),e.jsx(ne,{tab:"Lịch sử",children:e.jsxs(D,{children:[e.jsxs(D.Item,{color:"green",children:["Tạo tài khoản - ",r(s.createdDate).format("DD/MM/YYYY")]}),s.orders>0&&e.jsxs(D.Item,{color:"blue",children:["Đơn hàng đầu tiên - ",r(s.createdDate).add(5,"days").format("DD/MM/YYYY")]}),s.membership&&e.jsxs(D.Item,{color:"gold",children:["Đạt hạng ",s.membership," - ",r(s.createdDate).add(30,"days").format("DD/MM/YYYY")]}),s.orders>3&&e.jsxs(D.Item,{color:"purple",children:["Lần mua hàng gần nhất - ",r(s.lastOrderDate).format("DD/MM/YYYY")]})]})},"history")]})]})})]})};export{tt as default};
