import{_ as e,a as t,p as r,j as a,b as i,c as n,s as o,d as l,h as s,t as d}from"./polyfills-BjGv5uaK.js";import{S as c,k as h,E as u,u as f,e as v,v as p,N as y,w as g,x as m}from"./vendor-antv-g-lite-BsxRpwbw.js";import{I as x}from"./vendor-antv-g-plugin-image-loader-Dw6KHXGs.js";import{q as b}from"./vendor-antv-util-BIOdtugi.js";import{ap as w,g as C,u as S,D as k,aq as A,ac as O,y as M,e as T}from"./vendor-gl-matrix-DC4KmxQg.js";
/*!
 * @antv/g-plugin-canvas-renderer
 * @description A G plugin of renderer implementation with Canvas2D API
 * @version 2.2.23
 * @date 5/30/2025, 2:55:32 AM
 * @author AntVis
 * @docs https://g.antv.antgroup.com/
 */var R=d("renderState"),B=function(){function e(t){i(this,e),this.removedRBushNodeAABBs=[],this.renderQueue=[],Object.defineProperty(this,R,{writable:!0,value:{restoreStack:[],prevObject:null,currentContext:new Map}}),this.clearFullScreenLastFrame=!1,this.clearFullScreen=!1,this.vpMatrix=T(),this.dprMatrix=T(),this.tmpMat4=T(),this.vec3a=M(),this.vec3b=M(),this.vec3c=M(),this.vec3d=M(),this.canvasRendererPluginOptions=t}return t(e,[{key:"apply",value:function(t,r){var a=this;this.context=t;var i=this.context,n=i.config,s=i.camera,d=i.renderingService,c=i.renderingContext,h=i.rBushRoot,y=i.pathGeneratorFactory,g=n.renderer.getConfig().enableRenderingOptimization;n.renderer.getConfig().enableDirtyCheck=!1,n.renderer.getConfig().enableDirtyRectangleRendering=!1,this.rBush=h,this.pathGeneratorFactory=y;var m=t.contextService,x=c.root.ownerDocument.defaultView,b=function(e){var t=e.target.rBushNode;t.aabb&&a.removedRBushNodeAABBs.push(t.aabb)},w=function(e){var t=e.target.rBushNode;t.aabb&&a.removedRBushNodeAABBs.push(t.aabb)};d.hooks.init.tap(e.tag,function(){x.addEventListener(u.UNMOUNTED,b),x.addEventListener(u.CULLED,w);var e=m.getDPR(),t=n.width,r=n.height,i=m.getContext();a.clearRect(i,0,0,t*e,r*e,n.background)}),d.hooks.destroy.tap(e.tag,function(){x.removeEventListener(u.UNMOUNTED,b),x.removeEventListener(u.CULLED,w),a.renderQueue=[],a.removedRBushNodeAABBs=[],o(a,R)[R]={restoreStack:[],prevObject:null,currentContext:null}}),d.hooks.beginFrame.tap(e.tag,function(){var e,t=m.getContext(),r=m.getDPR(),i=n.width,o=n.height,l=a.canvasRendererPluginOptions,s=l.dirtyObjectNumThreshold,c=l.dirtyObjectRatioThreshold,h=d.getStats(),u=h.total,f=h.rendered,v=f/u;a.clearFullScreen=a.clearFullScreenLastFrame||!(null!==(e=x.context.renderingPlugins[1])&&void 0!==e&&e.isFirstTimeRenderingFinished)||d.disableDirtyRectangleRendering()||f>s&&v>c,t&&("function"==typeof t.resetTransform?t.resetTransform():t.setTransform(1,0,0,1,0,0),a.clearFullScreen&&a.clearRect(t,0,0,i*r,o*r,n.background))});var A=function(e,t){for(var i=[e];i.length>0;){var n,l=i.pop();l.isVisible()&&!l.isCulled()&&(g?a.renderDisplayObjectOptimized(l,t,a.context,o(a,R)[R],r):a.renderDisplayObject(l,t,a.context,o(a,R)[R],r));for(var s=(null===(n=l.sortable)||void 0===n||null===(n=n.sorted)||void 0===n?void 0:n.length)>0?l.sortable.sorted:l.childNodes,d=s.length-1;d>=0;d--)i.push(s[d])}};d.hooks.endFrame.tap(e.tag,function(){if(0!==c.root.childNodes.length){g=n.renderer.getConfig().enableRenderingOptimization,o(a,R)[R]={restoreStack:[],prevObject:null,currentContext:o(a,R)[R].currentContext},o(a,R)[R].currentContext.clear(),a.clearFullScreenLastFrame=!1;var e=m.getContext(),t=m.getDPR();if(C(a.dprMatrix,[t,t,1]),S(a.vpMatrix,a.dprMatrix,s.getOrthoMatrix()),a.clearFullScreen)g?(e.save(),A(c.root,e),e.restore()):A(c.root,e),a.removedRBushNodeAABBs=[];else{var i=a.safeMergeAABB.apply(a,[a.mergeDirtyAABBs(a.renderQueue)].concat(l(a.removedRBushNodeAABBs.map(function(e){var t=e.minX,r=e.minY,a=e.maxX,i=e.maxY,n=new f;return n.setMinMax([t,r,0],[a,i,0]),n}))));if(a.removedRBushNodeAABBs=[],f.isEmpty(i))return void(a.renderQueue=[]);var d=a.convertAABB2Rect(i),h=d.x,u=d.y,y=d.width,b=d.height,w=k(a.vec3a,[h,u,0],a.vpMatrix),O=k(a.vec3b,[h+y,u,0],a.vpMatrix),M=k(a.vec3c,[h,u+b,0],a.vpMatrix),T=k(a.vec3d,[h+y,u+b,0],a.vpMatrix),B=Math.min(w[0],O[0],T[0],M[0]),D=Math.min(w[1],O[1],T[1],M[1]),N=Math.max(w[0],O[0],T[0],M[0]),E=Math.max(w[1],O[1],T[1],M[1]),P=Math.floor(B),F=Math.floor(D),L=Math.ceil(N-B),j=Math.ceil(E-D);e.save(),a.clearRect(e,P,F,L,j,n.background),e.beginPath(),e.rect(P,F,L,j),e.clip(),e.setTransform(a.vpMatrix[0],a.vpMatrix[1],a.vpMatrix[4],a.vpMatrix[5],a.vpMatrix[12],a.vpMatrix[13]),n.renderer.getConfig().enableDirtyRectangleRenderingDebug&&x.dispatchEvent(new v(p.DIRTY_RECTANGLE,{dirtyRect:{x:P,y:F,width:L,height:j}})),a.searchDirtyObjects(i).sort(function(e,t){return e.sortable.renderOrder-t.sortable.renderOrder}).forEach(function(t){t&&t.isVisible()&&!t.isCulled()&&a.renderDisplayObject(t,e,a.context,o(a,R)[R],r)}),e.restore(),a.renderQueue.forEach(function(e){a.saveDirtyAABB(e)}),a.renderQueue=[]}o(a,R)[R].restoreStack.forEach(function(){e.restore()}),o(a,R)[R].restoreStack=[]}else a.clearFullScreenLastFrame=!0}),d.hooks.render.tap(e.tag,function(e){a.clearFullScreen||a.renderQueue.push(e)})}},{key:"clearRect",value:function(e,t,r,a,i,n){e.clearRect(t,r,a,i),n&&(e.fillStyle=n,e.fillRect(t,r,a,i))}},{key:"renderDisplayObjectOptimized",value:function(e,t,r,a,i){var n=e.nodeName,l=!1,s=this.context.styleRendererFactory[n],d=this.pathGeneratorFactory[n],h=e.parsedStyle.clipPath;if(h){(!a.prevObject||!A(h.getWorldTransform(),a.prevObject.getWorldTransform()))&&(this.applyWorldTransform(t,h),a.prevObject=null);var u=this.pathGeneratorFactory[h.nodeName];u&&(t.save(),l=!0,t.beginPath(),u(t,h.parsedStyle),t.closePath(),t.clip())}if(s){(!a.prevObject||!A(e.getWorldTransform(),a.prevObject.getWorldTransform()))&&this.applyWorldTransform(t,e);var f=!a.prevObject;if(!f){var v=a.prevObject.nodeName;f=n===c.TEXT?v!==c.TEXT:n===c.IMAGE?v!==c.IMAGE:v===c.TEXT||v===c.IMAGE}s.applyStyleToContext(t,e,f,a),a.prevObject=e}d&&(t.beginPath(),d(t,e.parsedStyle),n!==c.LINE&&n!==c.PATH&&n!==c.POLYLINE&&t.closePath()),s&&s.drawToContext(t,e,o(this,R)[R],this,i),l&&t.restore(),e.renderable.dirty=!1}},{key:"renderDisplayObject",value:function(e,t,r,a,i){var n=e.nodeName,o=a.restoreStack[a.restoreStack.length-1];!o||e.compareDocumentPosition(o)&y.DOCUMENT_POSITION_CONTAINS||(t.restore(),a.restoreStack.pop());var l=this.context.styleRendererFactory[n],s=this.pathGeneratorFactory[n],d=e.parsedStyle.clipPath;if(d){this.applyWorldTransform(t,d);var h=this.pathGeneratorFactory[d.nodeName];h&&(t.save(),a.restoreStack.push(e),t.beginPath(),h(t,d.parsedStyle),t.closePath(),t.clip())}l&&(this.applyWorldTransform(t,e),t.save(),this.applyAttributesToContext(t,e)),s&&(t.beginPath(),s(t,e.parsedStyle),n!==c.LINE&&n!==c.PATH&&n!==c.POLYLINE&&t.closePath()),l&&(l.render(t,e.parsedStyle,e,r,this,i),t.restore()),e.renderable.dirty=!1}},{key:"applyAttributesToContext",value:function(e,t){var r=t.parsedStyle,a=r.stroke,i=r.fill,n=r.opacity,o=r.lineDash,l=r.lineDashOffset;o&&e.setLineDash(o),b(l)||(e.lineDashOffset=l),b(n)||(e.globalAlpha*=n),b(a)||Array.isArray(a)||a.isNone||(e.strokeStyle=t.attributes.stroke),b(i)||Array.isArray(i)||i.isNone||(e.fillStyle=t.attributes.fill)}},{key:"convertAABB2Rect",value:function(e){var t=e.getMin(),r=e.getMax(),a=Math.floor(t[0]),i=Math.floor(t[1]);return{x:a,y:i,width:Math.ceil(r[0])-a,height:Math.ceil(r[1])-i}}},{key:"mergeDirtyAABBs",value:function(e){var t=new f;return e.forEach(function(e){var r=e.getRenderBounds();t.add(r);var a=e.renderable.dirtyRenderBounds;a&&t.add(a)}),t}},{key:"searchDirtyObjects",value:function(e){var t=e.getMin(),r=s(t,2),a=r[0],i=r[1],n=e.getMax(),o=s(n,2),l=o[0],d=o[1];return this.rBush.search({minX:a,minY:i,maxX:l,maxY:d}).map(function(e){return e.displayObject})}},{key:"saveDirtyAABB",value:function(e){var t=e.renderable;t.dirtyRenderBounds||(t.dirtyRenderBounds=new f);var r=e.getRenderBounds();r&&t.dirtyRenderBounds.update(r.center,r.halfExtents)}},{key:"applyWorldTransform",value:function(e,t,r){r?(O(this.tmpMat4,t.getLocalTransform()),S(this.tmpMat4,r,this.tmpMat4),S(this.tmpMat4,this.vpMatrix,this.tmpMat4)):(O(this.tmpMat4,t.getWorldTransform()),S(this.tmpMat4,this.vpMatrix,this.tmpMat4)),e.setTransform(this.tmpMat4[0],this.tmpMat4[1],this.tmpMat4[4],this.tmpMat4[5],this.tmpMat4[12],this.tmpMat4[13])}},{key:"safeMergeAABB",value:function(){for(var e=new f,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return r.forEach(function(t){e.add(t)}),e}}])}();function D(e,t,r,a,i,n,o){var l,s;if("rect"===e.image.nodeName){var d=e.image.parsedStyle,c=d.width,h=d.height;s=a.contextService.getDPR();var u=a.config.offscreenCanvas;(l=n.offscreenCanvasCreator.getOrCreateCanvas(u)).width=c*s,l.height=h*s;var f=n.offscreenCanvasCreator.getOrCreateContext(u),v={restoreStack:[],prevObject:null,currentContext:new Map};e.image.forEach(function(e){i.renderDisplayObject(e,f,a,v,n)}),v.restoreStack.forEach(function(){f.restore()})}return o.getOrCreatePatternSync(t,e,r,l,s,t.getGeometryBounds().min,function(){t.renderable.dirty=!0,a.renderingService.dirtify()})}function N(e,t,a,i){var n;if(e.type===m.LinearGradient||e.type===m.RadialGradient){var o=t.getGeometryBounds(),l=o&&2*o.halfExtents[0]||1,s=o&&2*o.halfExtents[1]||1,d=o&&o.min||[0,0];n=i.getOrCreateGradient(r(r({type:e.type},e.value),{},{min:d,width:l,height:s}),a)}return n}B.tag="CanvasRenderer";var E=["shadowBlur","shadowOffsetX","shadowOffsetY"],P=["lineCap","lineJoin","miterLimit"],F={globalAlpha:1,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",filter:"none",globalCompositeOperation:"source-over",strokeStyle:"#000",strokeOpacity:1,lineWidth:1,lineDash:[],lineDashOffset:0,lineCap:"butt",lineJoin:"miter",miterLimit:10,fillStyle:"#000",fillOpacity:1},L={};function j(e,t,r,a){var i=a.has(t)?a.get(t):F[t];return i!==r&&("lineDash"===t?e.setLineDash(r):e[t]=r,a.set(t,r)),i}var I=function(){return t(function e(t){i(this,e),this.imagePool=t},[{key:"applyAttributesToContext",value:function(e,t){}},{key:"render",value:function(e,t,r,a,i,n){}},{key:"applyCommonStyleToContext",value:function(e,t,r,a){var i=r?L:a.prevObject.parsedStyle,n=t.parsedStyle;(r||n.opacity!==i.opacity)&&j(e,"globalAlpha",b(n.opacity)?F.globalAlpha:n.opacity,a.currentContext),(r||n.blend!==i.blend)&&j(e,"globalCompositeOperation",b(n.blend)?F.globalCompositeOperation:n.blend,a.currentContext)}},{key:"applyStrokeFillStyleToContext",value:function(e,t,r,a){var i=r?L:a.prevObject.parsedStyle,n=t.parsedStyle,o=n.lineWidth,l=void 0===o?F.lineWidth:o,s=n.fill&&!n.fill.isNone;if(n.stroke&&!n.stroke.isNone&&l>0){if(r||t.attributes.stroke!==a.prevObject.attributes.stroke)j(e,"strokeStyle",b(n.stroke)||Array.isArray(n.stroke)||n.stroke.isNone?F.strokeStyle:t.attributes.stroke,a.currentContext);(r||n.lineWidth!==i.lineWidth)&&j(e,"lineWidth",b(n.lineWidth)?F.lineWidth:n.lineWidth,a.currentContext),(r||n.lineDash!==i.lineDash)&&j(e,"lineDash",n.lineDash||F.lineDash,a.currentContext),(r||n.lineDashOffset!==i.lineDashOffset)&&j(e,"lineDashOffset",b(n.lineDashOffset)?F.lineDashOffset:n.lineDashOffset,a.currentContext);for(var d=0;d<P.length;d++){var c=P[d];(r||n[c]!==i[c])&&j(e,c,b(n[c])?F[c]:n[c],a.currentContext)}}s&&(r||t.attributes.fill!==a.prevObject.attributes.fill)&&j(e,"fillStyle",b(n.fill)||Array.isArray(n.fill)||n.fill.isNone?F.fillStyle:t.attributes.fill,a.currentContext)}},{key:"applyStyleToContext",value:function(e,t,r,a){var i=t.nodeName;this.applyCommonStyleToContext(e,t,r,a),i===c.IMAGE||this.applyStrokeFillStyleToContext(e,t,r,a)}},{key:"applyShadowAndFilterStyleToContext",value:function(e,t,r,a){var i=t.parsedStyle;if(r){j(e,"shadowColor",i.shadowColor.toString(),a.currentContext);for(var n=0;n<E.length;n++){var o=E[n];j(e,o,i[o]||F[o],a.currentContext)}}i.filter&&i.filter.length&&j(e,"filter",t.attributes.filter,a.currentContext)}},{key:"clearShadowAndFilterStyleForContext",value:function(e,t,r,a){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(t){j(e,"shadowColor",F.shadowColor,a.currentContext);for(var n=0;n<E.length;n++){var o=E[n];j(e,o,F[o],a.currentContext)}}if(r)if(t&&i){var l=e.filter;!b(l)&&l.indexOf("drop-shadow")>-1&&j(e,"filter",l.replace(/drop-shadow\([^)]*\)/,"").trim()||F.filter,a.currentContext)}else j(e,"filter",F.filter,a.currentContext)}},{key:"fillToContext",value:function(e,t,r,a,i){var n=this,o=t.parsedStyle,l=o.fill,s=o.fillRule,d=null;if(Array.isArray(l)&&l.length>0)l.forEach(function(a){var i=j(e,"fillStyle",N(a,t,e,n.imagePool),r.currentContext);d=null!=d?d:i,s?e.fill(s):e.fill()});else{if(g(l)){var c=D(l,t,e,t.ownerDocument.defaultView.context,a,i,this.imagePool);c&&(e.fillStyle=c,d=!0)}s?e.fill(s):e.fill()}null!==d&&j(e,"fillStyle",d,r.currentContext)}},{key:"strokeToContext",value:function(e,t,r,a,i){var n=this,o=t.parsedStyle.stroke,l=null;if(Array.isArray(o)&&o.length>0)o.forEach(function(a){var i=j(e,"strokeStyle",N(a,t,e,n.imagePool),r.currentContext);l=null!=l?l:i,e.stroke()});else{if(g(o)){var s=D(o,t,e,t.ownerDocument.defaultView.context,a,i,this.imagePool);if(s){var d=j(e,"strokeStyle",s,r.currentContext);l=null!=l?l:d}}e.stroke()}null!==l&&j(e,"strokeStyle",l,r.currentContext)}},{key:"drawToContext",value:function(e,t,r,a,i){var n,o=t.nodeName,l=t.parsedStyle,s=l.opacity,d=void 0===s?F.globalAlpha:s,h=l.fillOpacity,u=void 0===h?F.fillOpacity:h,f=l.strokeOpacity,v=void 0===f?F.strokeOpacity:f,p=l.lineWidth,y=void 0===p?F.lineWidth:p,g=l.fill&&!l.fill.isNone,m=l.stroke&&!l.stroke.isNone&&y>0;if(g||m){var x=!b(l.shadowColor)&&l.shadowBlur>0,w="inner"===l.shadowType,C=0===(null===(n=l.fill)||void 0===n?void 0:n.alpha),S=!(!l.filter||!l.filter.length),k=x&&m&&(o===c.PATH||o===c.LINE||o===c.POLYLINE||C||w),A=null;if(g)k||this.applyShadowAndFilterStyleToContext(e,t,x,r),A=j(e,"globalAlpha",d*u,r.currentContext),this.fillToContext(e,t,r,a,i),k||this.clearShadowAndFilterStyleForContext(e,x,S,r);if(m){var O=!1,M=j(e,"globalAlpha",d*v,r.currentContext);if(A=g?A:M,k&&(this.applyShadowAndFilterStyleToContext(e,t,x,r),O=!0,w)){var T=e.globalCompositeOperation;e.globalCompositeOperation="source-atop",this.strokeToContext(e,t,r,a,i),e.globalCompositeOperation=T,this.clearShadowAndFilterStyleForContext(e,x,S,r,!0)}this.strokeToContext(e,t,r,a,i),O&&this.clearShadowAndFilterStyleForContext(e,x,S,r)}null!==A&&j(e,"globalAlpha",A,r.currentContext)}}}])}(),W=function(){function r(){return i(this,r),n(this,r,arguments)}return e(r,I),t(r,[{key:"render",value:function(e,t,r,a,i,n){var o=t.fill,l=t.fillRule,s=t.opacity,d=void 0===s?1:s,h=t.fillOpacity,u=void 0===h?1:h,f=t.stroke,v=t.strokeOpacity,p=void 0===v?1:v,y=t.lineWidth,g=void 0===y?1:y,m=t.lineCap,x=t.lineJoin,w=t.shadowType,C=t.shadowColor,S=t.shadowBlur,k=t.filter,A=t.miterLimit,O=o&&!o.isNone,M=f&&!f.isNone&&g>0,T=0===(null==o?void 0:o.alpha),R=!(!k||!k.length),B=!b(C)&&S>0,D=r.nodeName,N="inner"===w,E=M&&B&&(D===c.PATH||D===c.LINE||D===c.POLYLINE||T||N);O&&(e.globalAlpha=d*u,E||G(r,e,B),Y(e,r,o,l,a,i,n,this.imagePool),E||this.clearShadowAndFilter(e,R,B)),M&&(e.globalAlpha=d*p,e.lineWidth=g,b(A)||(e.miterLimit=A),b(m)||(e.lineCap=m),b(x)||(e.lineJoin=x),E&&(N&&(e.globalCompositeOperation="source-atop"),G(r,e,!0),N&&(X(e,r,f,a,i,n,this.imagePool),e.globalCompositeOperation=F.globalCompositeOperation,this.clearShadowAndFilter(e,R,!0))),X(e,r,f,a,i,n,this.imagePool))}},{key:"clearShadowAndFilter",value:function(e,t,r){if(r&&(e.shadowColor="transparent",e.shadowBlur=0),t){var a=e.filter;!b(a)&&a.indexOf("drop-shadow")>-1&&(e.filter=a.replace(/drop-shadow\([^)]*\)/,"").trim()||"none")}}}])}();function G(e,t,r){var a=e.parsedStyle,i=a.filter,n=a.shadowColor,o=a.shadowBlur,l=a.shadowOffsetX,s=a.shadowOffsetY;i&&i.length&&(t.filter=e.style.filter),r&&(t.shadowColor=n.toString(),t.shadowBlur=o||0,t.shadowOffsetX=l||0,t.shadowOffsetY=s||0)}function Y(e,t,r,a,i,n,o,l){var s=arguments.length>8&&void 0!==arguments[8]&&arguments[8];Array.isArray(r)?r.forEach(function(r){e.fillStyle=N(r,t,e,l),s||(a?e.fill(a):e.fill())}):(g(r)&&(e.fillStyle=D(r,t,e,i,n,o,l)),s||(a?e.fill(a):e.fill()))}function X(e,t,r,a,i,n,o){var l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Array.isArray(r)?r.forEach(function(r){e.strokeStyle=N(r,t,e,o),l||e.stroke()}):(g(r)&&(e.strokeStyle=D(r,t,e,a,i,n,o)),l||e.stroke())}var z=function(){function r(){return i(this,r),n(this,r,arguments)}return e(r,W),t(r,[{key:"renderDownSampled",value:function(e,t,r,a){var i=a.src,n=a.imageCache;n.downSampled?e.drawImage(n.downSampled,Math.floor(a.drawRect[0]),Math.floor(a.drawRect[1]),Math.ceil(a.drawRect[2]),Math.ceil(a.drawRect[3])):this.imagePool.createDownSampledImage(i,r).then(function(){r.ownerDocument&&(r.renderable.dirty=!0,r.ownerDocument.defaultView.context.renderingService.dirtify())}).catch(function(e){})}},{key:"renderTile",value:function(e,t,r,a){var i=a.src,n=a.imageCache,o=a.imageRect,l=a.drawRect,s=n.size,d=e.getTransform(),c=d.a,h=d.b,u=d.c,f=d.d,v=d.e,p=d.f;if(e.resetTransform(),null!=n&&n.gridSize){for(var y=[s[0]/o[2],s[1]/o[3]],g=[n.tileSize[0]/y[0],n.tileSize[1]/y[1]],m=[Math.floor((l[0]-o[0])/g[0]),Math.ceil((l[0]+l[2]-o[0])/g[0])],x=m[0],b=m[1],w=[Math.floor((l[1]-o[1])/g[1]),Math.ceil((l[1]+l[3]-o[1])/g[1])],C=w[1],S=w[0];S<=C;S++)for(var k=x;k<=b;k++){var A=n.tiles[S][k];if(A){var O=[Math.floor(o[0]+A.tileX*g[0]),Math.floor(o[1]+A.tileY*g[1]),Math.ceil(g[0]),Math.ceil(g[1])];e.drawImage(A.data,O[0],O[1],O[2],O[3])}}e.setTransform(c,h,u,f,v,p)}else this.imagePool.createImageTiles(i,[],function(){r.ownerDocument&&(r.renderable.dirty=!0,r.ownerDocument.defaultView.context.renderingService.dirtify())},r).catch(function(e){})}},{key:"render",value:function(e,t,a){var i=t.x,n=void 0===i?0:i,o=t.y,l=void 0===o?0:o,d=t.width,c=t.height,h=t.src,u=t.shadowColor,f=t.shadowBlur,v=this.imagePool.getImageSync(h,a),p=null==v?void 0:v.img,y=d,g=c;if(p){var m,C,S,A,O,T,R,B,D,N,E,P,F,L,j,I,W,Y,X,z,V;y||(y=p.width),g||(g=p.height),G(a,e,!b(u)&&f>0);try{var H=a.ownerDocument.defaultView.getContextService().getDomElement(),U=H.width,Q=H.height,J=e.getTransform(),_=J.a,q=J.b,K=J.c,Z=J.d,$=J.e,ee=J.f,te=w(_,K,0,0,q,Z,0,0,0,0,1,0,$,ee,0,1),re=(I=[n,l,y,g],W=te,Y=k(M(),[I[0],I[1],0],W),X=k(M(),[I[0]+I[2],I[1],0],W),z=k(M(),[I[0],I[1]+I[3],0],W),V=k(M(),[I[0]+I[2],I[1]+I[3],0],W),[Math.min(Y[0],X[0],z[0],V[0]),Math.min(Y[1],X[1],z[1],V[1]),Math.max(Y[0],X[0],z[0],V[0])-Math.min(Y[0],X[0],z[0],V[0]),Math.max(Y[1],X[1],z[1],V[1])-Math.min(Y[1],X[1],z[1],V[1])]),ae=(m=re,C=s([0,0,U,Q],4),S=C[0],A=C[1],O=C[2],T=C[3],R=s(m,4),B=R[0],D=R[1],N=R[2],E=R[3],P=Math.max(S,B),F=Math.max(A,D),L=Math.min(S+O,B+N),j=Math.min(A+T,D+E),L<=P||j<=F?null:[P,F,L-P,j-F]);if(!ae)return;if(!a.ownerDocument.defaultView.getConfig().enableLargeImageOptimization)return void r.renderFull(e,t,a,{image:p,drawRect:[n,l,y,g]});if(re[2]/v.size[0]<(v.downSamplingRate||.5))return void this.renderDownSampled(e,t,a,{src:h,imageCache:v,drawRect:[n,l,y,g]});if(!x.isSupportTile)return void r.renderFull(e,t,a,{image:p,drawRect:[n,l,y,g]});this.renderTile(e,t,a,{src:h,imageCache:v,imageRect:re,drawRect:ae})}catch(ie){}}}},{key:"drawToContext",value:function(e,t,r,a,i){this.render(e,t.parsedStyle,t)}}],[{key:"renderFull",value:function(e,t,r,a){e.drawImage(a.image,Math.floor(a.drawRect[0]),Math.floor(a.drawRect[1]),Math.ceil(a.drawRect[2]),Math.ceil(a.drawRect[3]))}}])}(),V=function(){function r(){return i(this,r),n(this,r,arguments)}return e(r,W),t(r,[{key:"render",value:function(e,t,r,a,i,n){r.getBounds();var o=t.lineWidth,l=void 0===o?1:o,s=t.textAlign,d=void 0===s?"start":s,c=t.textBaseline,h=void 0===c?"alphabetic":c,u=t.lineJoin,f=void 0===u?"miter":u,v=t.miterLimit,p=void 0===v?10:v,y=t.letterSpacing,g=void 0===y?0:y,m=t.stroke,x=t.fill,w=t.fillRule,C=t.fillOpacity,S=void 0===C?1:C,k=t.strokeOpacity,A=void 0===k?1:k,O=t.opacity,M=void 0===O?1:O,T=t.metrics,R=t.x,B=void 0===R?0:R,D=t.y,N=void 0===D?0:D,E=t.dx,P=t.dy,F=t.shadowColor,L=t.shadowBlur,j=T.font,I=T.lines,W=T.height,Y=T.lineHeight,X=T.lineMetrics;e.font=j,e.lineWidth=l,e.textAlign="middle"===d?"center":d;var z=h;"alphabetic"===z&&(z="bottom"),e.lineJoin=f,b(p)||(e.miterLimit=p);var V=N;"middle"===h?V+=-W/2-Y/2:"bottom"===h||"alphabetic"===h||"ideographic"===h?V+=-W:"top"!==h&&"hanging"!==h||(V+=-Y);var H=B+(E||0);V+=P||0,1===I.length&&("bottom"===z?(z="middle",V-=.5*W):"top"===z&&(z="middle",V+=.5*W)),e.textBaseline=z,G(r,e,!b(F)&&L>0);for(var U=0;U<I.length;U++){var Q=l/2+H;V+=Y,b(m)||m.isNone||!l||this.drawLetterSpacing(e,r,I[U],X[U],d,Q,V,g,x,w,S,m,A,M,!0,a,i,n),b(x)||this.drawLetterSpacing(e,r,I[U],X[U],d,Q,V,g,x,w,S,m,A,M,!1,a,i,n)}}},{key:"drawLetterSpacing",value:function(e,t,r,a,i,n,o,l,s,d,c,h,u,f,v,p,y,g){if(0!==l){var m=e.textAlign;e.textAlign="left";var x=n;"center"===i||"middle"===i?x=n-a.width/2:"right"!==i&&"end"!==i||(x=n-a.width);for(var b=Array.from(r),w=e.measureText(r).width,C=0,S=0;S<b.length;++S){var k=b[S];v?this.strokeText(e,t,k,x,o,h,u,p,y,g):this.fillText(e,t,k,x,o,s,d,c,f,p,y,g),x+=w-(C=e.measureText(r.substring(S+1)).width)+l,w=C}e.textAlign=m}else v?this.strokeText(e,t,r,n,o,h,u,p,y,g):this.fillText(e,t,r,n,o,s,d,c,f,p,y,g)}},{key:"fillText",value:function(e,t,r,a,i,n,o,l,s,d,c,h){var u;Y(e,t,n,o,d,c,h,this.imagePool,!0);var f=!b(l)&&1!==l;f&&(u=e.globalAlpha,e.globalAlpha=l*s),e.fillText(r,a,i),f&&(e.globalAlpha=u)}},{key:"strokeText",value:function(e,t,r,a,i,n,o,l,s,d){var c;X(e,t,n,l,s,d,this.imagePool,!0);var h=!b(o)&&1!==o;h&&(c=e.globalAlpha,e.globalAlpha=o),e.strokeText(r,a,i),h&&(e.globalAlpha=c)}},{key:"drawToContext",value:function(e,t,r,a,i){this.render(e,t.parsedStyle,t,t.ownerDocument.defaultView.context,a,i)}}])}(),H=function(){function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,o),(e=n(this,o)).name="canvas-renderer",e.options=t,e}return e(o,h),t(o,[{key:"init",value:function(){var e,t=r({dirtyObjectNumThreshold:500,dirtyObjectRatioThreshold:.8},this.options),i=this.context.imagePool,n=new W(i),o=(a(a(a(a(a(a(a(a(a(a(e={},c.CIRCLE,n),c.ELLIPSE,n),c.RECT,n),c.IMAGE,new z(i)),c.TEXT,new V(i)),c.LINE,n),c.POLYLINE,n),c.POLYGON,n),c.PATH,n),c.GROUP,void 0),a(a(a(e,c.HTML,void 0),c.MESH,void 0),c.FRAGMENT,void 0));this.context.defaultStyleRendererFactory=o,this.context.styleRendererFactory=o,this.addRenderingPlugin(new B(t))}},{key:"destroy",value:function(){this.removeAllRenderingPlugins(),delete this.context.defaultStyleRendererFactory,delete this.context.styleRendererFactory}}])}();export{H as P};
