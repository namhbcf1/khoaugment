import{u as W,j as e}from"./index-D0cJwDsb.js";import{u as L,r as d}from"./vendor-DD54NZMZ.js";import{f as c}from"./formatters-zHPZYAEt.js";import{F as a,f as j,T as Z,Y as V,z as v,s as y,W as J,Z as h,B as f,aE as U,bs as _,A as ee,e as T,C as s,as as i,k as S,I,l as te,S as ne,m as u,bt as se,q as P,bb as ae,$ as re}from"./antd-pmzi8FkM.js";import"./utils-Db1EesZb.js";const{Title:ie,Text:$,Paragraph:xe}=Z,{Step:k}=V,{Option:ue}=re,pe=()=>{const[p]=a.useForm(),Y=L(),{user:w}=W(),[M,b]=d.useState(!1),[g,D]=d.useState(0),[n,N]=d.useState(null),[le,R]=d.useState(0),[A,O]=d.useState(0),[x,E]=d.useState(0),[l,H]=d.useState({5e5:0,2e5:0,1e5:0,5e4:0,2e4:0,1e4:0,5e3:0,2e3:0,1e3:0,coins:0}),[F,C]=d.useState("idle");d.useEffect(()=>{(async()=>{b(!0);try{await new Promise(Q=>setTimeout(Q,800));const r={shiftId:"SHIFT-235689",cashier:w?.name||"Nguyễn Văn A",cashierId:w?.id||"STAFF-001",posTerminal:"POS-01",register:"REGISTER-01",startTime:new Date(Date.now()-288e5).toISOString(),endTime:null,startAmount:5e6,status:"active",sales:{totalOrders:48,totalSales:2385e4,cashPayments:15e6,cardPayments:45e5,momoPayments:25e5,vnpayPayments:185e4,returns:2,returnAmount:45e4,discounts:75e4},transactions:[{id:"TXN-001",type:"sale",amount:85e4,paymentMethod:"cash",time:"09:15",orderId:"ORD-001"},{id:"TXN-002",type:"sale",amount:125e4,paymentMethod:"card",time:"09:45",orderId:"ORD-002"},{id:"TXN-003",type:"sale",amount:75e4,paymentMethod:"momo",time:"10:20",orderId:"ORD-003"},{id:"TXN-004",type:"return",amount:-25e4,paymentMethod:"cash",time:"11:05",orderId:"ORD-004"},{id:"TXN-005",type:"sale",amount:235e4,paymentMethod:"cash",time:"12:30",orderId:"ORD-005"}]};N(r);const m=r.startAmount+r.sales.cashPayments-r.sales.returnAmount;O(m),p.setFieldsValue({shiftId:r.shiftId,posTerminal:r.posTerminal,register:r.register,startTime:v(r.startTime).format("DD/MM/YYYY HH:mm"),startAmount:r.startAmount,expectedDrawerAmount:m})}catch(r){console.error("Error fetching shift data:",r),y.error("Không thể tải dữ liệu ca làm việc!")}finally{b(!1)}})()},[p,w]),d.useEffect(()=>{let t=0;Object.entries(l).forEach(([r,m])=>{r==="coins"?t+=m:t+=parseInt(r)*m}),R(t),E(t-A),p.setFieldsValue({drawerAmount:t,discrepancy:t-A})},[l,A,p]);const o=(t,r)=>{H(m=>({...m,[t]:r}))},B=()=>{p.validateFields().then(()=>{D(g+1)}).catch(t=>{console.error("Validate Failed:",t)})},X=()=>{D(g-1)},z=async t=>{b(!0);try{await new Promise(m=>setTimeout(m,1500));const r={...n,endTime:new Date().toISOString(),drawerAmount:t.drawerAmount,expectedDrawerAmount:t.expectedDrawerAmount,discrepancy:t.discrepancy,note:t.note,status:"closed",denominations:l};N(r),D(g+1),y.success("Đóng ca làm việc thành công!")}catch(r){console.error("Error ending shift:",r),y.error("Có lỗi xảy ra khi đóng ca làm việc!")}finally{b(!1)}},K=async()=>{C("printing");try{await new Promise(t=>setTimeout(t,1500)),y.success("Đã in báo cáo ca làm việc!"),C("success")}catch(t){console.error("Error printing report:",t),y.error("Có lỗi xảy ra khi in báo cáo!"),C("error")}},G=()=>{Y("/cashier")},q=()=>{switch(g){case 0:return e.jsx(j,{title:"Thông tin ca làm việc",children:M?e.jsxs("div",{style:{textAlign:"center",padding:"30px"},children:[e.jsx(ne,{size:"large"}),e.jsx("div",{style:{marginTop:"16px"},children:"Đang tải thông tin ca làm việc..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs(T,{gutter:[16,16],children:[e.jsx(s,{span:12,children:e.jsx(a.Item,{name:"shiftId",label:"Mã ca làm việc",children:e.jsx(I,{disabled:!0})})}),e.jsx(s,{span:12,children:e.jsx(a.Item,{name:"startTime",label:"Thời gian bắt đầu",children:e.jsx(I,{disabled:!0})})}),e.jsx(s,{span:12,children:e.jsx(a.Item,{name:"posTerminal",label:"Máy POS",children:e.jsx(I,{disabled:!0})})}),e.jsx(s,{span:12,children:e.jsx(a.Item,{name:"register",label:"Quầy thu ngân",children:e.jsx(I,{disabled:!0})})})]}),e.jsx(S,{orientation:"left",children:"Thống kê doanh thu"}),e.jsxs(T,{gutter:16,children:[e.jsx(s,{span:6,children:e.jsx(u,{title:"Tổng đơn hàng",value:n?.sales?.totalOrders,prefix:e.jsx(se,{})})}),e.jsx(s,{span:6,children:e.jsx(u,{title:"Tổng doanh thu",value:c(n?.sales?.totalSales),prefix:e.jsx(P,{}),valueStyle:{color:"#3f8600"}})}),e.jsx(s,{span:6,children:e.jsx(u,{title:"Đơn hoàn trả",value:n?.sales?.returns,prefix:e.jsx(ae,{}),valueStyle:{color:"#cf1322"}})}),e.jsx(s,{span:6,children:e.jsx(u,{title:"Tiền hoàn trả",value:c(n?.sales?.returnAmount),prefix:e.jsx(P,{}),valueStyle:{color:"#cf1322"}})})]}),e.jsx(S,{orientation:"left",children:"Thống kê theo phương thức thanh toán"}),e.jsxs(T,{gutter:16,children:[e.jsx(s,{span:6,children:e.jsx(u,{title:"Tiền mặt",value:c(n?.sales?.cashPayments)})}),e.jsx(s,{span:6,children:e.jsx(u,{title:"Thẻ",value:c(n?.sales?.cardPayments)})}),e.jsx(s,{span:6,children:e.jsx(u,{title:"MoMo",value:c(n?.sales?.momoPayments)})}),e.jsx(s,{span:6,children:e.jsx(u,{title:"VNPay",value:c(n?.sales?.vnpayPayments)})})]}),e.jsx(S,{}),e.jsx(a.Item,{children:e.jsx(f,{type:"primary",onClick:B,children:"Tiếp tục"})})]})});case 1:return e.jsxs(j,{title:"Kiểm kê tiền mặt",children:[e.jsx(ee,{message:"Hướng dẫn kiểm kê tiền",description:"Vui lòng đếm và nhập chính xác số lượng của từng mệnh giá tiền trong két. Hệ thống sẽ tự động tính toán số tiền chênh lệch.",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsxs(T,{gutter:[16,16],children:[e.jsx(s,{span:16,children:e.jsx(j,{title:"Chi tiết mệnh giá",size:"small",children:e.jsxs(T,{gutter:[16,16],children:[e.jsx(s,{span:8,children:e.jsx(a.Item,{label:"500,000 VND",children:e.jsx(i,{min:0,value:l[5e5],onChange:t=>o("500000",t),style:{width:"100%"}})})}),e.jsx(s,{span:8,children:e.jsx(a.Item,{label:"200,000 VND",children:e.jsx(i,{min:0,value:l[2e5],onChange:t=>o("200000",t),style:{width:"100%"}})})}),e.jsx(s,{span:8,children:e.jsx(a.Item,{label:"100,000 VND",children:e.jsx(i,{min:0,value:l[1e5],onChange:t=>o("100000",t),style:{width:"100%"}})})}),e.jsx(s,{span:8,children:e.jsx(a.Item,{label:"50,000 VND",children:e.jsx(i,{min:0,value:l[5e4],onChange:t=>o("50000",t),style:{width:"100%"}})})}),e.jsx(s,{span:8,children:e.jsx(a.Item,{label:"20,000 VND",children:e.jsx(i,{min:0,value:l[2e4],onChange:t=>o("20000",t),style:{width:"100%"}})})}),e.jsx(s,{span:8,children:e.jsx(a.Item,{label:"10,000 VND",children:e.jsx(i,{min:0,value:l[1e4],onChange:t=>o("10000",t),style:{width:"100%"}})})}),e.jsx(s,{span:8,children:e.jsx(a.Item,{label:"5,000 VND",children:e.jsx(i,{min:0,value:l[5e3],onChange:t=>o("5000",t),style:{width:"100%"}})})}),e.jsx(s,{span:8,children:e.jsx(a.Item,{label:"2,000 VND",children:e.jsx(i,{min:0,value:l[2e3],onChange:t=>o("2000",t),style:{width:"100%"}})})}),e.jsx(s,{span:8,children:e.jsx(a.Item,{label:"1,000 VND",children:e.jsx(i,{min:0,value:l[1e3],onChange:t=>o("1000",t),style:{width:"100%"}})})}),e.jsx(s,{span:8,children:e.jsx(a.Item,{label:"Tiền xu (VND)",children:e.jsx(i,{min:0,value:l.coins,onChange:t=>o("coins",t),style:{width:"100%"}})})})]})})}),e.jsx(s,{span:8,children:e.jsxs(j,{title:"Kết quả kiểm kê",size:"small",children:[e.jsx(a.Item,{name:"startAmount",label:"Tiền đầu ca",children:e.jsx(i,{style:{width:"100%"},formatter:t=>`${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,""),disabled:!0})}),e.jsx(a.Item,{name:"expectedDrawerAmount",label:"Tiền mặt dự kiến",children:e.jsx(i,{style:{width:"100%"},formatter:t=>`${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,""),disabled:!0})}),e.jsx(a.Item,{name:"drawerAmount",label:"Tiền mặt thực tế",children:e.jsx(i,{style:{width:"100%"},formatter:t=>`${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,""),disabled:!0})}),e.jsx(a.Item,{name:"discrepancy",label:"Chênh lệch",children:e.jsx(i,{style:{width:"100%"},formatter:t=>`${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,""),disabled:!0})}),e.jsx("div",{style:{textAlign:"center",marginTop:16},children:e.jsx($,{type:x===0?"success":x>0?"warning":"danger",strong:!0,style:{fontSize:16},children:x===0?"Khớp đúng":x>0?`Thừa ${c(x)}`:`Thiếu ${c(Math.abs(x))}`})})]})})]}),e.jsx(S,{}),e.jsx(a.Item,{name:"note",label:"Ghi chú",rules:[{required:x!==0,message:"Vui lòng ghi chú lý do chênh lệch!"}],children:e.jsx(I.TextArea,{rows:3,placeholder:x!==0?"Vui lòng giải thích lý do chênh lệch...":"Ghi chú (nếu có)"})}),e.jsx(a.Item,{children:e.jsxs(te,{children:[e.jsx(f,{onClick:X,children:"Quay lại"}),e.jsx(f,{type:"primary",onClick:z,loading:M,children:"Đóng ca làm việc"})]})})]});case 2:return e.jsx(j,{children:e.jsx(J,{status:"success",title:"Đóng ca làm việc thành công!",subTitle:`Mã ca: ${n?.shiftId||"N/A"} - Thời gian kết thúc: ${v().format("DD/MM/YYYY HH:mm:ss")}`,extra:[e.jsx(f,{type:"primary",onClick:K,loading:F==="printing",icon:e.jsx(U,{}),children:"In báo cáo"},"print"),e.jsx(f,{onClick:G,icon:e.jsx(_,{}),children:"Hoàn thành"},"complete")],children:e.jsxs(h,{title:"Thông tin ca làm việc",column:2,children:[e.jsx(h.Item,{label:"Nhân viên",children:n?.cashier}),e.jsx(h.Item,{label:"Máy POS",children:n?.posTerminal}),e.jsx(h.Item,{label:"Thời gian bắt đầu",children:v(n?.startTime).format("DD/MM/YYYY HH:mm")}),e.jsx(h.Item,{label:"Thời gian kết thúc",children:v(n?.endTime).format("DD/MM/YYYY HH:mm")}),e.jsx(h.Item,{label:"Tiền đầu ca",children:c(n?.startAmount)}),e.jsx(h.Item,{label:"Tiền cuối ca",children:c(n?.drawerAmount)}),e.jsx(h.Item,{label:"Tổng doanh thu",children:c(n?.sales?.totalSales)}),e.jsx(h.Item,{label:"Tổng đơn hàng",children:n?.sales?.totalOrders}),n?.discrepancy!==0&&e.jsx(h.Item,{label:"Chênh lệch",span:2,children:e.jsx($,{type:n?.discrepancy>0?"warning":"danger",children:n?.discrepancy>0?`Thừa ${c(n?.discrepancy)}`:`Thiếu ${c(Math.abs(n?.discrepancy))}`})}),n?.note&&e.jsx(h.Item,{label:"Ghi chú",span:2,children:n?.note})]})})});default:return null}};return e.jsx("div",{style:{maxWidth:1e3,margin:"0 auto"},children:e.jsxs(j,{children:[e.jsx(ie,{level:2,style:{textAlign:"center",margin:"0 0 24px 0"},children:"Đóng ca làm việc"}),e.jsxs(V,{current:g,style:{marginBottom:24},children:[e.jsx(k,{title:"Thông tin doanh thu",description:"Thống kê doanh thu"}),e.jsx(k,{title:"Kiểm kê tiền mặt",description:"Đếm tiền trong két"}),e.jsx(k,{title:"Hoàn thành",description:"Xác nhận thông tin"})]}),e.jsx(a,{form:p,layout:"vertical",children:q()})]})})};export{pe as default};
