import{X as e,b as t,c as n,W as a,Y as r,R as o,r as i,g as s,V as c,T as d}from"./vendor-antv-util-BIOdtugi.js";import{aS as l,a2 as u}from"./charts-BOmscTYX.js";import{a as p,P as y}from"./vendor-antv-g2-sYywoIZv.js";const v={field:"value",size:[1,1],round:!1,padding:0,sort:(e,t)=>t.value-e.value,as:["x","y"],ignoreParentValue:!0},f="childNodeCount";function h(i,s){const c=(s=e({},v,s)).as;if(!t(c)||2!==c.length)throw new TypeError('Invalid as: it must be an array with 2 strings (e.g. [ "x", "y" ])!');let d;try{d=function(e){const{field:a,fields:r}=e;if(n(a))return a;if(t(a))return a[0];if(n(r))return r;if(t(r)&&r.length)return r[0];throw new TypeError("Invalid field: it must be a string!")}(s)}catch(g){}const p=(y=i,l().size(s.size).round(s.round).padding(s.padding)(u(y).sum(e=>a(e.children)?s.ignoreParentValue?0:e[d]-r(e.children,(e,t)=>e+t[d],0):e[d]).sort(s.sort)));var y;const h=c[0],m=c[1];return p.each(e=>{var t,n;e[h]=[e.x0,e.x1,e.x1,e.x0],e[m]=[e.y1,e.y1,e.y0,e.y0],e.name=e.name||(null===(t=e.data)||void 0===t?void 0:t.name)||(null===(n=e.data)||void 0===n?void 0:n.label),e.data.name=e.name,["x0","x1","y0","y1"].forEach(t=>{-1===c.indexOf(t)&&delete e[t]})}),function(e){const t=[];if(e&&e.each){let n,a;e.each(e=>{var r,i;e.parent!==n?(n=e.parent,a=0):a+=1;const s=o(((null===(r=e.ancestors)||void 0===r?void 0:r.call(e))||[]).map(e=>t.find(t=>t.name===e.name)||e),({depth:t})=>t>0&&t<e.depth);e.nodeAncestor=s,e[f]=(null===(i=e.children)||void 0===i?void 0:i.length)||0,e.nodeIndex=a,t.push(e)})}else e&&e.eachNode&&e.eachNode(e=>{t.push(e)});return t}(p)}const m="sunburst",g="markType",x="path",b="ancestor-node";const O={id:m,encode:{x:"x",y:"y",key:x,color:b,value:"value"},axis:{x:!1,y:!1},style:{[g]:m,stroke:"#fff",lineWidth:.5,fillOpacity:"fillOpacity",[f]:f,depth:"depth"},state:{active:{zIndex:2,stroke:"#000"},inactive:{zIndex:1,stroke:"#fff"}},legend:!1,interaction:{drillDown:!0},coordinate:{type:"polar",innerRadius:.2}},j=e=>{const{encode:t,data:n=[]}=e,a=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n}(e,["encode","data"]),r=Object.assign(Object.assign({},a.coordinate),{innerRadius:Math.max(i(a,["coordinate","innerRadius"],.2),1e-5)}),o=Object.assign(Object.assign({},O.encode),t),{value:d}=o,l=function(e){const{data:t,encode:n}=e,{color:a,value:r}=n,o=h(t,{field:r,type:"hierarchy.partition",as:["x","y"]}),i=[];return o.forEach(e=>{var t,n,o,s;if(0===e.depth)return null;let d=e.data.name;const l=[d];let u=Object.assign({},e);for(;u.depth>1;)d=`${null===(t=u.parent.data)||void 0===t?void 0:t.name} / ${d}`,l.unshift(null===(n=u.parent.data)||void 0===n?void 0:n.name),u=u.parent;const p=Object.assign(Object.assign(Object.assign({},c(e.data,[r])),{[x]:d,[b]:u.data.name}),e);a&&a!==b&&(p[a]=e.data[a]||(null===(s=null===(o=e.parent)||void 0===o?void 0:o.data)||void 0===s?void 0:s[a])),i.push(p)}),i.map(e=>{const t=e.x.slice(0,2),n=[e.y[2],e.y[0]];return t[0]===t[1]&&(n[0]=n[1]=(e.y[2]+e.y[0])/2),Object.assign(Object.assign({},e),{x:t,y:n,fillOpacity:Math.pow(.85,e.depth)})})}({encode:o,data:n});return[s({},O,Object.assign(Object.assign({type:"rect",data:l,encode:o,tooltip:{title:"path",items:[e=>({name:d,value:e[d]})]}},a),{coordinate:r}))]};j.props={};var w=function(e,t,n,a){return new(n||(n=Promise))(function(r,o){function i(e){try{c(a.next(e))}catch(t){o(t)}}function s(e){try{c(a.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}c((a=a.apply(e,t||[])).next())})};const E={rootText:"root",style:{fill:"rgba(0, 0, 0, 0.85)",fontSize:12,y:1},active:{fill:"rgba(0, 0, 0, 0.5)"}};function k(e={}){const{breadCrumb:t={},isFixedColor:n=!1}=e,a=s({},E,t);return e=>{const{update:t,setState:r,container:o,view:l,options:u}=e,v=o.ownerDocument,h=p(o).select(`.${y}`).node();const x=u.marks.find(({id:e})=>e===m),{state:O}=x,j=v.createElement("g");h.appendChild(j);const E=(e,o)=>w(this,void 0,void 0,function*(){if(j.removeChildren(),e){const t=v.createElement("text",{style:Object.assign({x:0,text:a.rootText,depth:0},a.style)});j.appendChild(t);let n="";const r=null==e?void 0:e.split(" / ");let o=a.style.y,s=j.getBBox().width;const c=h.getBBox().width,d=r.map((e,t)=>{const r=v.createElement("text",{style:Object.assign(Object.assign({x:s,text:" / "},a.style),{y:o})});j.appendChild(r),s+=r.getBBox().width,n=`${n}${e} / `;const i=v.createElement("text",{name:n.replace(/\s\/\s$/,""),style:Object.assign(Object.assign({text:e,x:s,depth:t+1},a.style),{y:o})});return j.appendChild(i),s+=i.getBBox().width,s>c&&(o=j.getBBox().height,s=0,r.attr({x:s,y:o}),s+=r.getBBox().width,i.attr({x:s,y:o}),s+=i.getBBox().width),i});[t,...d].forEach((e,t)=>{if(t===d.length)return;const n=Object.assign({},e.attributes);e.attr("cursor","pointer"),e.addEventListener("mouseenter",()=>{e.attr(a.active)}),e.addEventListener("mouseleave",()=>{e.attr(n)}),e.addEventListener("click",()=>{E(e.name,i(e,["style","depth"]))})})}r("drillDown",t=>{const{marks:a}=t,r=a.map(t=>{if(t.id!==m&&"rect"!==t.type)return t;const{data:a}=t,r=Object.fromEntries(["color"].map(e=>[e,{domain:l.scale[e].getOptions().domain}])),i=a.filter(t=>{const a=t.path;if(n||(t[b]=a.split(" / ")[o]),!e)return!0;return new RegExp(`^${e}.+`).test(a)});return s({},t,n?{data:i,scale:r}:{data:i})});return Object.assign(Object.assign({},t),{marks:r})}),yield t()}),k=e=>{const t=e.target;if(i(t,["style",g])!==m||"rect"!==i(t,["markType"])||!i(t,["style",f]))return;const n=i(t,["__data__","key"]),a=i(t,["style","depth"]);t.style.cursor="pointer",E(n,a)};h.addEventListener("click",k);const B=d(Object.assign(Object.assign({},O.active),O.inactive)),L=()=>{h.querySelectorAll(".element").filter(e=>i(e,["style",g])===m).forEach(e=>{const t=i(e,["style",f]);if("pointer"!==i(e,["style","cursor"])&&t){e.style.cursor="pointer";const t=c(e.attributes,B);e.addEventListener("mouseenter",()=>{e.attr(O.active)}),e.addEventListener("mouseleave",()=>{e.attr(s(t,O.inactive))})}})};return h.addEventListener("mousemove",L),()=>{j.remove(),h.removeEventListener("click",k),h.removeEventListener("mousemove",L)}}}function B(){return{"interaction.drillDown":k,"mark.sunburst":j}}export{B as p};
