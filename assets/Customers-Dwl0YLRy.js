import{r as e,j as t}from"./react-vendor-D_ybsntB.js";import{e as r}from"./ai-features-Dvk3-MnK.js";import{d as s}from"./datetime-CZsEG1Fw.js";import{P as n}from"./common-components-txC0VjBx.js";import{m as i,B as o,R as a,a as l,C as c,e as d,g as h,I as m,b as j,S as p,T as x,F as g,L as v,l as u,j as y,D as f,t as k,d as _,h as b,f as C,u as T,k as w}from"./antd-core-DVlmEpkB.js";import{H as I,y as P,F as S,p as V,l as L,o as D,bB as Y,ae as z,a7 as M,X as N,ac as H,af as F,V as R,j as B,d as K,I as $,C as Q,q}from"./antd-icons-DMCzxaTm.js";import{P as E}from"./vendor-ant-design-plots-DP6i501V.js";import"./vendor-remix-run-router-UjR1oCxX.js";import"./vendor-prop-types-DQeQIVKZ.js";import"./vendor-fast-equals-51KNnk-7.js";import"./vendor-dnd-core-B9A4u1lA.js";import"./vendor-redux-DjMjAQeN.js";import"./vendor-react-dnd-invariant-3ejajjRq.js";import"./vendor-react-dnd-asap-CbVDrjlw.js";import"./vendor-react-dnd-shallowequal-DKwLR6sW.js";import"./vendor-fast-deep-equal-n3nGrwQy.js";import"./vendor-scheduler-Dmo4AZZp.js";import"./http-ztdpVPaQ.js";import"./admin-pages-CT-0otSU.js";import"./charts-BOmscTYX.js";import"./vendor-internmap-B8oPgqVZ.js";import"./vendor-clsx-BeLtu-UY.js";import"./utils-CXADxxMH.js";import"./vendor-decimal.js-light-DxGkYd4s.js";import"./vendor-tiny-invariant-BM5KeS_Z.js";import"./vendor-victory-vendor-DB58CTWg.js";import"./vendor-crypto-js-DSoR22t1.js";import"./i18n-Bumj-RJR.js";import"./vendor-i18next-browser-languagedetector-F0gxWJsw.js";import"./vendor-rc-util-Cfhh6bGy.js";import"./polyfills-B4r5O4me.js";import"./vendor-ant-design-cssinjs-C7YRSOqU.js";import"./vendor-emotion-hash-DFFAhID7.js";import"./vendor-emotion-unitless-BWzHn38B.js";import"./vendor-stylis-C44NkLFc.js";import"./vendor-ant-design-cssinjs-utils-Z_ZGHKpv.js";import"./vendor-classnames-Bjqz8XQ3.js";import"./vendor-rc-resize-observer-DnkXipSO.js";import"./vendor-resize-observer-polyfill-C7U_o75s.js";import"./vendor-rc-motion-CgrNkiVN.js";import"./vendor-rc-collapse-BuUnFyUq.js";import"./vendor-rc-component-color-picker-D7vz9aAI.js";import"./vendor-ant-design-fast-color-BHo3zH90.js";import"./vendor-rc-overflow-Dz8RHsDo.js";import"./vendor-rc-picker-CgWv_2bo.js";import"./vendor-rc-component-trigger-B5dN-W7a.js";import"./vendor-rc-component-portal-B-ypBxqm.js";import"./vendor-rc-tabs-BwJDg3wn.js";import"./vendor-rc-dropdown-CZ0JW4x5.js";import"./vendor-rc-menu-YCSbwFbq.js";import"./vendor-rc-select-C-imgKkB.js";import"./vendor-rc-virtual-list-1kJCu580.js";import"./vendor-rc-segmented-DxRxYTwA.js";import"./vendor-rc-input-number-V0sWhVt2.js";import"./vendor-rc-component-mini-decimal-4AYFSTmh.js";import"./vendor-rc-input-CfgQgibu.js";import"./vendor-rc-slider-CdAUgrbY.js";import"./vendor-rc-drawer-CfIZZ8r4.js";import"./vendor-rc-field-form-zLN4ynZ6.js";import"./vendor-rc-component-async-validator-B0ws6RHn.js";import"./vendor-rc-image-FcAViups.js";import"./vendor-rc-dialog-CVbglhWq.js";import"./vendor-rc-notification-DBgLjbT1.js";import"./vendor-rc-tooltip-UDagiryc.js";import"./vendor-rc-component-qrcode-B0fCpeCY.js";import"./vendor-rc-rate-BYpgyvg8.js";import"./vendor-rc-steps-DyuNxNH9.js";import"./vendor-rc-switch-672QdYAA.js";import"./vendor-rc-table-BPXMAkvW.js";import"./vendor-rc-component-context-Bh07HgIq.js";import"./vendor-rc-tree-BEpjp_Ur.js";import"./vendor-rc-checkbox-C1_4jhQP.js";import"./vendor-scroll-into-view-if-needed-BuydUqPn.js";import"./vendor-compute-scroll-into-view-Cfyw3hb3.js";import"./vendor-rc-pagination-BepwSdzG.js";import"./vendor-throttle-debounce-w9OM8Bxz.js";import"./vendor-ant-design-colors-BZ2r7Wqn.js";import"./vendor-rc-textarea-5awn-jGw.js";import"./vendor-copy-to-clipboard-1ydfzSJH.js";import"./vendor-toggle-selection-v3K3UlSB.js";import"./vendor-rc-upload-DMmmAkHe.js";import"./vendor-rc-progress-CgK8Nc6A.js";import"./vendor-ant-design-charts-util-D2l6Hs-R.js";import"./vendor-antv-event-emitter-B_sETjLv.js";import"./vendor-antv-g2-extension-plot-ByDryGZ7.js";import"./vendor-antv-util-BIOdtugi.js";import"./vendor-tslib-BRpNZtt8.js";import"./vendor-antv-g2-sYywoIZv.js";import"./vendor-antv-g-camera-api-D5xCKgeg.js";import"./vendor-antv-g-lite-DrII67Nr.js";import"./vendor-eventemitter3-QYUf1tj-.js";import"./vendor-gl-matrix-DC4KmxQg.js";import"./vendor-antv-g-math-eKXG1hIb.js";import"./vendor-antv-g-web-animations-api-CyIt6i3N.js";import"./vendor-antv-g-canvas-CFhHHQFj.js";import"./vendor-antv-g-plugin-canvas-path-generator-CVNLD-z9.js";import"./vendor-antv-g-plugin-canvas-picker-BOqhFghs.js";import"./vendor-antv-g-plugin-canvas-renderer-CY8wHYb_.js";import"./vendor-antv-g-plugin-image-loader-Cv9gb-Q_.js";import"./vendor-antv-g-plugin-dom-interaction-BFQu-fjp.js";import"./vendor-antv-g-plugin-html-renderer-CKtkyHRF.js";import"./vendor-antv-g-plugin-dragndrop-C-fhZn1r.js";import"./vendor-antv-expr-DNWszLhl.js";import"./vendor-antv-scale-WmY3yw3x.js";import"./vendor-fecha-eoCYq76Q.js";import"./vendor-color-string-DlpZsNR2.js";import"./vendor-color-name-BQ5IbGbl.js";import"./vendor-simple-swizzle-CbuEe9Q8.js";import"./vendor-is-arrayish-CLsR9Wfx.js";import"./vendor-antv-component-B7Ic6yCK.js";import"./vendor-antv-vendor-5QXjnyZt.js";import"./vendor-antv-coord-C7ivB7vC.js";import"./vendor-flru-frKw_lgq.js";import"./vendor-pdfast-DvPkUa4Y.js";const{Search:O}=m,{Option:X}=j,{TabPane:A}=h,{Title:G,Text:J}=x,{TextArea:W}=m,U=()=>{const[x,U]=e.useState(!1),[Z,ee]=e.useState([]),[te,re]=e.useState([]),[se,ne]=e.useState({}),[ie,oe]=e.useState(null),[ae,le]=e.useState(!1),[ce,de]=e.useState(!1),[he,me]=e.useState(null),[je,pe]=e.useState(""),[xe,ge]=e.useState("all"),[ve]=i.useForm();e.useEffect(()=>{ue(),ye()},[]),e.useEffect(()=>{fe()},[Z,je,xe]);const ue=async()=>{U(!0);try{const e=await r.get("/customers",{params:{limit:1e3}});e.data.success&&ee(e.data.data.customers||[])}catch(e){ee([{id:1,name:"Nguyễn Văn A",email:"nguyenvana@email.com",phone:"0901234567",address:"123 Nguyễn Huệ, Q1, TP.HCM",segment:"VIP",loyalty_points:1250,total_spent:55e5,total_orders:45,last_order_date:"2024-03-15",created_at:"2024-01-15",is_active:!0},{id:2,name:"Trần Thị B",email:"tranthib@email.com",phone:"0907654321",address:"456 Lê Lợi, Q3, TP.HCM",segment:"Premium",loyalty_points:890,total_spent:32e5,total_orders:28,last_order_date:"2024-03-14",created_at:"2024-02-01",is_active:!0},{id:3,name:"Lê Văn C",email:"levanc@email.com",phone:"0912345678",address:"789 Võ Văn Tần, Q3, TP.HCM",segment:"Regular",loyalty_points:320,total_spent:12e5,total_orders:12,last_order_date:"2024-03-10",created_at:"2024-02-15",is_active:!0}])}finally{U(!1)}},ye=async()=>{try{const e=await r.get("/analytics/customers");e.data.success&&ne(e.data.data)}catch(e){ne({totalCustomers:892,newCustomers:45,vipCustomers:89,premiumCustomers:156,regularCustomers:647,avgLifetimeValue:285e4,avgOrderValue:125e3,retentionRate:78.5,segmentDistribution:[{type:"VIP",value:10,color:"#ff4d4f"},{type:"Premium",value:17.5,color:"#faad14"},{type:"Regular",value:72.5,color:"#52c41a"}]})}},fe=()=>{let e=Z;je&&(e=e.filter(e=>e.name.toLowerCase().includes(je.toLowerCase())||e.email.toLowerCase().includes(je.toLowerCase())||e.phone.includes(je))),"all"!==xe&&(e=e.filter(e=>e.segment===xe)),re(e)},ke=async(e,t,s)=>{try{const n=await r.put(`/customers/${e}/loyalty`,{points:t,action:s});n.data.success&&(w.success("Cập nhật điểm thưởng thành công"),ue(),ie&&ie.id===e&&oe(n.data.data))}catch(n){w.error("Có lỗi xảy ra khi cập nhật điểm thưởng")}},_e=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e),be=e=>{switch(e){case"VIP":return"red";case"Premium":return"gold";case"Regular":return"green";default:return"default"}},Ce=e=>{switch(e){case"VIP":return t.jsx(z,{});case"Premium":return t.jsx(q,{});default:return t.jsx(L,{})}},Te=[{title:"Khách hàng",dataIndex:"name",key:"name",render:(e,r)=>t.jsxs(p,{children:[t.jsx(u,{icon:t.jsx(L,{})}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:500},children:e}),t.jsxs(J,{type:"secondary",style:{fontSize:"12px"},children:["ID: ",r.id]})]})]})},{title:"Liên hệ",key:"contact",render:(e,r)=>t.jsxs("div",{children:[t.jsxs("div",{children:[t.jsx(M,{})," ",r.phone]}),t.jsxs("div",{children:[t.jsx(N,{})," ",r.email]})]})},{title:"Phân khúc",dataIndex:"segment",key:"segment",render:e=>t.jsx(_,{color:be(e),icon:Ce(e),children:e})},{title:"Điểm thưởng",dataIndex:"loyalty_points",key:"loyalty_points",render:e=>t.jsxs(p,{children:[t.jsx(R,{style:{color:"#faad14"}}),e?.toLocaleString()||0]})},{title:"Tổng chi tiêu",dataIndex:"total_spent",key:"total_spent",render:e=>_e(e||0)},{title:"Đơn hàng",dataIndex:"total_orders",key:"total_orders",render:e=>t.jsxs(p,{children:[t.jsx(B,{}),e||0]})},{title:"Lần mua cuối",dataIndex:"last_order_date",key:"last_order_date",render:e=>e?s(e).format("DD/MM/YYYY"):"Chưa có"},{title:"Thao tác",key:"actions",render:(e,n)=>t.jsxs(p,{children:[t.jsx(C,{title:"Xem chi tiết",children:t.jsx(o,{type:"text",icon:t.jsx(K,{}),onClick:()=>(async e=>{oe(e),de(!0);try{const t=await r.get(`/customers/${e.id}`);t.data.success&&oe(t.data.data)}catch(t){}})(n)})}),t.jsx(C,{title:"Chỉnh sửa",children:t.jsx(o,{type:"text",icon:t.jsx($,{}),onClick:()=>{return me(e=n),ve.setFieldsValue({...e,date_of_birth:e.date_of_birth?s(e.date_of_birth):null}),void le(!0);var e}})}),t.jsx(T,{title:"Bạn có chắc chắn muốn xóa khách hàng này?",onConfirm:()=>(async e=>{try{U(!0),(await r.delete(`/customers/${e}`)).data.success&&(w.success("Xóa khách hàng thành công"),ue())}catch(t){w.error("Có lỗi xảy ra khi xóa khách hàng")}finally{U(!1)}})(n.id),okText:"Xóa",cancelText:"Hủy",children:t.jsx(C,{title:"Xóa",children:t.jsx(o,{type:"text",icon:t.jsx(Q,{}),danger:!0})})})]})}],we={data:se.segmentDistribution||[],angleField:"value",colorField:"type",radius:.8,label:{type:"outer",content:"{name} {percentage}"},interactions:[{type:"element-active"}]};return t.jsxs("div",{children:[t.jsx(n,{title:"Quản lý khách hàng",subtitle:"Quản lý thông tin và chương trình khách hàng thân thiết",icon:"user",actions:[t.jsx(o,{icon:t.jsx(I,{}),children:"Import"},"import"),t.jsx(o,{icon:t.jsx(P,{}),children:"Export"},"export"),t.jsx(o,{type:"primary",icon:t.jsx(S,{}),onClick:()=>{me(null),ve.resetFields(),le(!0)},children:"Thêm khách hàng"},"add")]}),t.jsxs("div",{style:{padding:"0 24px 24px"},children:[t.jsxs(a,{gutter:[16,16],style:{marginBottom:24},children:[t.jsx(l,{xs:24,sm:12,lg:6,children:t.jsx(c,{children:t.jsx(d,{title:"Tổng khách hàng",value:se.totalCustomers,prefix:t.jsx(V,{})})})}),t.jsx(l,{xs:24,sm:12,lg:6,children:t.jsx(c,{children:t.jsx(d,{title:"Khách hàng mới",value:se.newCustomers,prefix:t.jsx(L,{}),suffix:"tháng này"})})}),t.jsx(l,{xs:24,sm:12,lg:6,children:t.jsx(c,{children:t.jsx(d,{title:"Giá trị trung bình",value:se.avgLifetimeValue,formatter:e=>_e(e),prefix:t.jsx(D,{})})})}),t.jsx(l,{xs:24,sm:12,lg:6,children:t.jsx(c,{children:t.jsx(d,{title:"Tỷ lệ giữ chân",value:se.retentionRate,suffix:"%",prefix:t.jsx(Y,{})})})})]}),t.jsxs(h,{defaultActiveKey:"list",children:[t.jsxs(A,{tab:"Danh sách khách hàng",children:[t.jsx(c,{style:{marginBottom:16},children:t.jsxs(a,{gutter:[16,16],align:"middle",children:[t.jsx(l,{xs:24,sm:12,lg:8,children:t.jsx(O,{placeholder:"Tìm kiếm khách hàng...",value:je,onChange:e=>pe(e.target.value),allowClear:!0})}),t.jsx(l,{xs:24,sm:12,lg:4,children:t.jsxs(j,{value:xe,onChange:ge,style:{width:"100%"},children:[t.jsx(X,{value:"all",children:"Tất cả phân khúc"}),t.jsx(X,{value:"VIP",children:"VIP"}),t.jsx(X,{value:"Premium",children:"Premium"}),t.jsx(X,{value:"Regular",children:"Regular"})]})}),t.jsx(l,{xs:24,sm:24,lg:12,children:t.jsx(p,{style:{float:"right"},children:t.jsxs(J,{type:"secondary",children:["Hiển thị ",te.length," / ",Z.length," khách hàng"]})})})]})}),t.jsx(c,{children:t.jsx(g,{columns:Te,dataSource:te,rowKey:"id",loading:x,pagination:{pageSize:20,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} của ${e} khách hàng`}})})]},"list"),t.jsx(A,{tab:"Phân tích khách hàng",children:t.jsxs(a,{gutter:[16,16],children:[t.jsx(l,{xs:24,lg:12,children:t.jsx(c,{title:"Phân khúc khách hàng",children:t.jsx(E,{...we,height:300})})}),t.jsx(l,{xs:24,lg:12,children:t.jsx(c,{title:"Top khách hàng VIP",children:t.jsx(v,{dataSource:Z.filter(e=>"VIP"===e.segment).slice(0,10),renderItem:e=>t.jsx(v.Item,{children:t.jsx(v.Item.Meta,{avatar:t.jsx(u,{icon:t.jsx(z,{}),style:{backgroundColor:"#ff4d4f"}}),title:e.name,description:t.jsxs(p,{direction:"vertical",size:"small",children:[t.jsxs(J,{children:["Tổng chi tiêu: ",_e(e.total_spent)]}),t.jsxs(J,{children:["Điểm thưởng: ",e.loyalty_points?.toLocaleString()]})]})})})})})})]})},"analytics")]}),t.jsx(y,{title:he?"Chỉnh sửa khách hàng":"Thêm khách hàng mới",open:ae,onCancel:()=>le(!1),footer:null,width:600,children:t.jsxs(i,{form:ve,layout:"vertical",onFinish:async e=>{try{U(!0);const t={...e,date_of_birth:e.date_of_birth?e.date_of_birth.format("YYYY-MM-DD"):null};if(he){(await r.put(`/customers/${he.id}`,t)).data.success&&(w.success("Cập nhật khách hàng thành công"),ue())}else{(await r.post("/customers",t)).data.success&&(w.success("Tạo khách hàng thành công"),ue())}le(!1),ve.resetFields()}catch(t){w.error("Có lỗi xảy ra khi lưu khách hàng")}finally{U(!1)}},style:{marginTop:16},children:[t.jsx(a,{gutter:16,children:t.jsx(l,{span:24,children:t.jsx(i.Item,{name:"name",label:"Tên khách hàng",rules:[{required:!0,message:"Vui lòng nhập tên khách hàng"}],children:t.jsx(m,{placeholder:"Nhập tên khách hàng"})})})}),t.jsxs(a,{gutter:16,children:[t.jsx(l,{span:12,children:t.jsx(i.Item,{name:"phone",label:"Số điện thoại",rules:[{pattern:/^[0-9+\-\s()]+$/,message:"Số điện thoại không hợp lệ"}],children:t.jsx(m,{placeholder:"Nhập số điện thoại"})})}),t.jsx(l,{span:12,children:t.jsx(i.Item,{name:"email",label:"Email",rules:[{type:"email",message:"Email không hợp lệ"}],children:t.jsx(m,{placeholder:"Nhập email"})})})]}),t.jsx(a,{gutter:16,children:t.jsx(l,{span:24,children:t.jsx(i.Item,{name:"address",label:"Địa chỉ",children:t.jsx(W,{placeholder:"Nhập địa chỉ",rows:3})})})}),t.jsxs(a,{gutter:16,children:[t.jsx(l,{span:12,children:t.jsx(i.Item,{name:"date_of_birth",label:"Ngày sinh",children:t.jsx(f,{placeholder:"Chọn ngày sinh",style:{width:"100%"},format:"DD/MM/YYYY"})})}),t.jsx(l,{span:12,children:t.jsx(i.Item,{name:"gender",label:"Giới tính",children:t.jsxs(j,{placeholder:"Chọn giới tính",children:[t.jsx(X,{value:"male",children:"Nam"}),t.jsx(X,{value:"female",children:"Nữ"}),t.jsx(X,{value:"other",children:"Khác"})]})})})]}),t.jsx(a,{gutter:16,children:t.jsx(l,{span:24,children:t.jsx(i.Item,{name:"segment",label:"Phân khúc khách hàng",initialValue:"Regular",children:t.jsxs(j,{children:[t.jsx(X,{value:"Regular",children:"Khách hàng thường"}),t.jsx(X,{value:"Premium",children:"Khách hàng Premium"}),t.jsx(X,{value:"VIP",children:"Khách hàng VIP"})]})})})}),t.jsxs(a,{gutter:16,style:{marginTop:24},children:[t.jsx(l,{span:12,children:t.jsx(o,{size:"large",block:!0,onClick:()=>le(!1),children:"Hủy"})}),t.jsx(l,{span:12,children:t.jsx(o,{type:"primary",size:"large",block:!0,htmlType:"submit",loading:x,children:he?"Cập nhật":"Tạo mới"})})]})]})}),t.jsx(k,{title:"Chi tiết khách hàng",placement:"right",onClose:()=>de(!1),open:ce,width:600,children:ie&&t.jsxs("div",{children:[t.jsxs(c,{style:{marginBottom:16},children:[t.jsxs(a,{align:"middle",gutter:16,children:[t.jsx(l,{children:t.jsx(u,{size:64,icon:t.jsx(L,{})})}),t.jsxs(l,{flex:1,children:[t.jsx(G,{level:4,style:{margin:0},children:ie.name}),t.jsxs(p,{children:[t.jsx(_,{color:be(ie.segment),icon:Ce(ie.segment),children:ie.segment}),t.jsxs(J,{type:"secondary",children:["ID: ",ie.id]})]})]})]}),t.jsx(b,{}),t.jsxs(a,{gutter:[16,16],children:[t.jsx(l,{span:12,children:t.jsxs(p,{direction:"vertical",size:"small",children:[t.jsx(J,{type:"secondary",children:"Liên hệ"}),t.jsxs("div",{children:[t.jsx(M,{})," ",ie.phone]}),t.jsxs("div",{children:[t.jsx(N,{})," ",ie.email]}),t.jsxs("div",{children:[t.jsx(H,{})," ",ie.address]})]})}),t.jsx(l,{span:12,children:t.jsxs(p,{direction:"vertical",size:"small",children:[t.jsx(J,{type:"secondary",children:"Thống kê"}),t.jsxs("div",{children:["Tổng chi tiêu: ",t.jsx(J,{strong:!0,children:_e(ie.total_spent||0)})]}),t.jsxs("div",{children:["Tổng đơn hàng: ",t.jsx(J,{strong:!0,children:ie.total_orders||0})]}),t.jsxs("div",{children:["Điểm thưởng: ",t.jsx(J,{strong:!0,style:{color:"#faad14"},children:ie.loyalty_points?.toLocaleString()||0})]})]})})]})]}),t.jsx(c,{title:"Quản lý điểm thưởng",style:{marginBottom:16},children:t.jsxs(p,{children:[t.jsx(o,{type:"primary",icon:t.jsx(F,{}),onClick:()=>{y.confirm({title:"Thêm điểm thưởng",content:t.jsx("div",{children:t.jsx("p",{children:"Thêm 100 điểm thưởng cho khách hàng?"})}),onOk:()=>ke(ie.id,100,"add")})},children:"Thêm điểm"}),t.jsx(o,{icon:t.jsx(R,{}),onClick:()=>{y.confirm({title:"Trừ điểm thưởng",content:t.jsx("div",{children:t.jsx("p",{children:"Trừ 50 điểm thưởng từ khách hàng?"})}),onOk:()=>ke(ie.id,50,"subtract")})},children:"Trừ điểm"})]})}),t.jsx(c,{title:"Đơn hàng gần đây",children:t.jsx(v,{dataSource:ie.recent_orders||[],renderItem:e=>t.jsxs(v.Item,{children:[t.jsx(v.Item.Meta,{title:`Đơn hàng #${e.order_number}`,description:t.jsxs(p,{direction:"vertical",size:"small",children:[t.jsxs(J,{children:["Tổng tiền: ",_e(e.total)]}),t.jsx(J,{type:"secondary",children:s(e.created_at).format("DD/MM/YYYY HH:mm")})]})}),t.jsx(_,{color:"completed"===e.status?"green":"orange",children:"completed"===e.status?"Hoàn thành":"Đang xử lý"})]})})})]})})]})]})};export{U as default};
