import{a as te,j as e}from"./index-CI5lv9mG.js";import{r as l}from"./vendor-DD54NZMZ.js";import{f as m}from"./formatters-zHPZYAEt.js";import{e as u,C as r,f as S,E as se,y as B,l as p,T as ae,k as D,$ as G,as as $,B as h,ac as re,ae as z,aq as ce,n as ie,H as E,I as oe,J as le,bD as de,b5 as R,s as c,aF as he,ag as me}from"./antd-pmzi8FkM.js";import"./utils-Db1EesZb.js";class ue{constructor(){this.connected=!1,this.callbacks=[],this.mockScannerInterval=null,this.testBarcodes=["8900001","8900002","8900003","8900004","8900005"]}connect(){return this.connected||(console.log("Connecting to barcode scanner..."),setTimeout(()=>{this.connected=!0,console.log("Barcode scanner connected successfully")},500)),!0}disconnect(){return this.connected?(console.log("Disconnecting from barcode scanner..."),this.connected=!1,this.mockScannerInterval&&(clearInterval(this.mockScannerInterval),this.mockScannerInterval=null),console.log("Barcode scanner disconnected"),!0):!1}onScan(a){if(typeof a!="function")throw new Error("Callback must be a function");return this.callbacks.push(a),this.callbacks.length-1}offScan(a){return a<0||a>=this.callbacks.length?!1:(this.callbacks.splice(a,1),!0)}mockScan(a){if(!this.connected){console.warn("Cannot scan: scanner not connected");return}console.log(`Mock scan: ${a}`),this.callbacks.forEach(s=>{try{s(a)}catch(f){console.error("Error in barcode scan callback:",f)}})}startDemo(a=5e3){this.mockScannerInterval&&clearInterval(this.mockScannerInterval),this.connect(),this.mockScannerInterval=setInterval(()=>{const s=Math.floor(Math.random()*this.testBarcodes.length);this.mockScan(this.testBarcodes[s])},a),console.log("Demo mode started")}stopDemo(){this.mockScannerInterval&&(clearInterval(this.mockScannerInterval),this.mockScannerInterval=null,console.log("Demo mode stopped"))}}const g=new ue,{Title:ve,Text:y}=ae,{Search:pe}=oe,{Option:A}=G,Ce=({onCheckout:j,onCustomerSelect:a})=>{const{items:s,addItem:f,removeItem:L,updateQuantity:q,clearCart:M,applyDiscount:Q,totalAmount:k,totalItems:K,totalDiscount:v,netAmount:C}=te(),[P,I]=l.useState(""),[xe,ge]=l.useState(""),[o,V]=l.useState("percent"),[x,X]=l.useState(0),[N,H]=l.useState([]),[d,_]=l.useState(!1),[F,b]=l.useState(!1);l.useEffect(()=>{const n=t=>{c.info(`Đã quét mã: ${t}`),T(t)};return d?(g.connect(),g.onScan(n)):g.disconnect(),()=>{g.disconnect()}},[d]);const O=[{id:"1",name:"Laptop Dell XPS 13",price:25e6,barcode:"8900001",inStock:15},{id:"2",name:"Chuột không dây Logitech",price:45e4,barcode:"8900002",inStock:45},{id:"3",name:"Bàn phím cơ AKKO",price:12e5,barcode:"8900003",inStock:23},{id:"4",name:"Tai nghe Sony WH-1000XM4",price:45e5,barcode:"8900004",inStock:8},{id:"5",name:"Màn hình LG 27 inch 4K",price:65e5,barcode:"8900005",inStock:12}],T=n=>{b(!0),I(n),setTimeout(()=>{const t=O.filter(i=>i.barcode===n||i.name.toLowerCase().includes(n.toLowerCase()));H(t),b(!1),d&&t.length===1&&w(t[0])},500)},w=n=>{if(n.inStock<=0){c.error(`Sản phẩm ${n.name} đã hết hàng!`);return}f({id:n.id,name:n.name,price:n.price,quantity:1,discount:0,maxQuantity:n.inStock}),c.success(`Đã thêm ${n.name} vào giỏ hàng`)},J=(n,t)=>{const i=s.find(ne=>ne.id===n);if(i){if(t<=0){c.error("Số lượng phải lớn hơn 0");return}t>i.maxQuantity&&(c.warning(`Chỉ còn ${i.maxQuantity} sản phẩm trong kho!`),t=i.maxQuantity),q(n,t)}},W=()=>{if(x<0){c.error("Giá trị chiết khấu không hợp lệ");return}if(o==="percent"&&x>100){c.error("Giá trị chiết khấu không được vượt quá 100%");return}if(o==="amount"&&x>k){c.error("Giá trị chiết khấu không được vượt quá tổng số tiền");return}Q({type:o,value:x}),c.success("Đã áp dụng chiết khấu")},U=()=>{M(),c.info("Đã xóa giỏ hàng")},Y=()=>{if(s.length===0){c.error("Giỏ hàng trống!");return}typeof j=="function"&&j({items:s,totalAmount:k,totalDiscount:v,netAmount:C})},Z=[{title:"Sản phẩm",dataIndex:"name",key:"name",ellipsis:!0},{title:"Đơn giá",dataIndex:"price",key:"price",render:n=>m(n),width:120},{title:"SL",dataIndex:"quantity",key:"quantity",width:80,render:(n,t)=>e.jsx($,{min:1,max:t.maxQuantity,value:n,onChange:i=>J(t.id,i),size:"small"})},{title:"Thành tiền",key:"total",width:120,render:(n,t)=>m(t.price*t.quantity)},{title:"",key:"action",width:60,render:(n,t)=>e.jsx(p,{children:e.jsx(he,{title:"Xóa sản phẩm này?",onConfirm:()=>L(t.id),okText:"Xóa",cancelText:"Hủy",children:e.jsx(h,{type:"text",danger:!0,icon:e.jsx(z,{}),size:"small"})})})}],ee=[{title:"Sản phẩm",dataIndex:"name",key:"name",ellipsis:!0},{title:"Giá",dataIndex:"price",key:"price",render:n=>m(n),width:120},{title:"Tồn kho",dataIndex:"inStock",key:"inStock",width:80,render:n=>e.jsx(E,{color:n>0?"green":"red",children:n})},{title:"",key:"action",width:60,render:(n,t)=>e.jsx(h,{type:"primary",size:"small",icon:e.jsx(me,{}),onClick:()=>w(t),disabled:t.inStock<=0,children:"Thêm"})}];return e.jsx("div",{className:"cart-manager",children:e.jsxs(u,{gutter:[16,16],children:[e.jsx(r,{xs:24,md:16,children:e.jsxs(S,{title:e.jsxs(p,{children:[e.jsx(ie,{}),e.jsx("span",{children:"Giỏ hàng"}),e.jsxs(E,{color:"blue",children:[K," sản phẩm"]})]}),extra:e.jsxs(p,{children:[e.jsx(h,{type:"primary",danger:!0,icon:e.jsx(z,{}),onClick:()=>U(),disabled:s.length===0,children:"Xóa giỏ hàng"}),e.jsx(h,{type:"primary",icon:e.jsx(ce,{}),disabled:s.length===0,children:"Lưu giỏ hàng"})]}),children:[s.length===0?e.jsx(se,{description:"Giỏ hàng trống"}):e.jsx(B,{columns:Z,dataSource:s.map(n=>({...n,key:n.id})),pagination:!1,size:"small",scroll:{y:300}}),e.jsx("div",{style:{marginTop:16},children:e.jsx(u,{justify:"end",children:e.jsx(r,{xs:24,md:12,lg:8,children:e.jsx(S,{size:"small",children:e.jsxs(p,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(u,{justify:"space-between",children:[e.jsx(r,{children:"Tổng tiền:"}),e.jsx(r,{children:e.jsx(y,{strong:!0,children:m(k)})})]}),e.jsxs(u,{justify:"space-between",children:[e.jsx(r,{children:"Chiết khấu:"}),e.jsx(r,{children:e.jsxs(y,{type:"danger",children:["- ",m(v)]})})]}),e.jsx(D,{style:{margin:"8px 0"}}),e.jsxs(u,{justify:"space-between",children:[e.jsx(r,{children:e.jsx(y,{strong:!0,children:"Thành tiền:"})}),e.jsx(r,{children:e.jsx(y,{strong:!0,style:{fontSize:18},children:m(C)})})]}),e.jsx(D,{style:{margin:"8px 0"}}),e.jsxs(u,{gutter:8,children:[e.jsx(r,{span:8,children:e.jsxs(G,{value:o,onChange:V,style:{width:"100%"},size:"small",children:[e.jsx(A,{value:"percent",children:"%"}),e.jsx(A,{value:"amount",children:"VND"})]})}),e.jsx(r,{span:10,children:e.jsx($,{min:0,max:o==="percent"?100:void 0,value:x,onChange:X,style:{width:"100%"},size:"small",addonAfter:o==="percent"?"%":void 0,formatter:o==="amount"?n=>`${n}`.replace(/\B(?=(\d{3})+(?!\d))/g,","):void 0,parser:o==="amount"?n=>n.replace(/\$\s?|(,*)/g,""):void 0})}),e.jsx(r,{span:6,children:e.jsx(h,{type:"primary",size:"small",icon:e.jsx(re,{}),onClick:W,style:{width:"100%"},disabled:s.length===0,children:"Áp dụng"})})]}),e.jsx(h,{type:"primary",block:!0,size:"large",onClick:Y,disabled:s.length===0,style:{marginTop:16},children:"Thanh toán"})]})})})})})]})}),e.jsx(r,{xs:24,md:8,children:e.jsx(S,{title:e.jsxs(p,{children:[e.jsx(R,{}),e.jsx("span",{children:"Tìm kiếm sản phẩm"})]}),extra:e.jsx(le,{title:d?"Tắt máy quét":"Bật máy quét",children:e.jsx(h,{type:d?"primary":"default",icon:d?e.jsx(de,{}):e.jsx(R,{}),onClick:()=>_(!d)})}),children:e.jsxs(p,{direction:"vertical",style:{width:"100%"},children:[e.jsx(pe,{placeholder:"Nhập tên hoặc mã vạch",enterButton:"Tìm kiếm",value:P,onChange:n=>I(n.target.value),onSearch:T,loading:F,allowClear:!0}),e.jsx(B,{columns:ee,dataSource:N.map(n=>({...n,key:n.id})),pagination:!1,size:"small",scroll:{y:300},locale:{emptyText:"Không có sản phẩm"}})]})})})]})})};export{Ce as default};
