import{j as e}from"./index-CI5lv9mG.js";import{r as m,u as pe}from"./vendor-DD54NZMZ.js";import{z as c,e as N,C as o,f as j,m as g,ab as je,Q as k,O as I,aD as E,I as G,x as ye,$ as S,a0 as fe,B as d,af as ve,l as y,a1 as Se,aE as Te,ag as Me,y as v,D as be,T as Ce,u as Z,s as D,an as ke,ak as Ie,aF as De,ae as Ye,H as U,Z as h,k as X,_ as q,A as $e,ad as B,aA as Q,ay as we}from"./antd-pmzi8FkM.js";import"./utils-Db1EesZb.js";const{Title:Ne,Text:p}=Ce,{RangePicker:Re}=fe,{TabPane:He}=Z,{Option:a}=S,Be=()=>{const[T,M]=m.useState([]),[J,Y]=m.useState(!0),[$,K]=m.useState(""),[r,L]=m.useState({status:"all",dateRange:null,paymentStatus:"all"}),[l,w]=m.useState(null),[W,R]=m.useState(!1),[b,ee]=m.useState({total:0,pending:0,completed:0,canceled:0,revenue:0}),H=pe();m.useEffect(()=>{(async()=>{Y(!0);try{setTimeout(()=>{const n=te();M(n);const s={total:n.length,pending:n.filter(i=>i.status==="pending").length,completed:n.filter(i=>i.status==="completed").length,canceled:n.filter(i=>i.status==="canceled").length,revenue:n.reduce((i,u)=>u.status!=="canceled"?i+u.totalAmount:i,0)};ee(s),Y(!1)},1e3)}catch(n){console.error("Failed to fetch orders:",n),D.error("Failed to load orders. Please try again."),Y(!1)}})()},[]);const te=()=>{const t=["pending","processing","shipped","completed","canceled"],n=["paid","pending","refunded","failed"],s=["cash","credit_card","bank_transfer","ewallet"];return Array.from({length:50},(i,u)=>{const C=c().subtract(Math.floor(Math.random()*30),"days"),A=t[Math.floor(Math.random()*t.length)],F=n[Math.floor(Math.random()*n.length)],f=Math.floor(Math.random()*10)+1,V=Math.floor(Math.random()*5e5)+1e4,ge=f*V;return{id:`ORD-${1e3+u}`,customer:{id:`CUST-${100+Math.floor(Math.random()*500)}`,name:`Khách hàng ${u+1}`,phone:`0${Math.floor(Math.random()*1e9)}`,email:`customer${u+1}@example.com`},date:C.format("YYYY-MM-DD HH:mm:ss"),status:A,totalItems:f,totalAmount:ge,paymentMethod:s[Math.floor(Math.random()*s.length)],paymentStatus:F,shipping:{method:"standard",address:"Hoà Bình, Việt Nam",cost:Math.floor(Math.random()*5e4)+15e3},items:Array.from({length:f},(Oe,P)=>({id:`ITEM-${1e3+P}`,name:`Sản phẩm ${P+1}`,sku:`SKU-${1e3+P}`,price:V,quantity:1}))}})},ne=T.filter(t=>{const n=$.toLowerCase(),s=t.id.toLowerCase().includes(n)||t.customer.name.toLowerCase().includes(n)||t.customer.phone.includes($)||t.customer.email.toLowerCase().includes(n),i=r.status==="all"||t.status===r.status,u=r.paymentStatus==="all"||t.paymentStatus===r.paymentStatus;let C=!0;if(r.dateRange&&r.dateRange[0]&&r.dateRange[1]){const A=c(t.date),F=r.dateRange[0].startOf("day"),f=r.dateRange[1].endOf("day");C=A.isBetween(F,f,void 0,"[]")}return s&&i&&u&&C}),se=t=>{w(t),R(!0)},ae=(t,n)=>{M(T.map(s=>s.id===t?{...s,status:n}:s)),D.success(`Cập nhật trạng thái đơn hàng ${t} thành ${n}`)},le=(t,n)=>{M(T.map(s=>s.id===t?{...s,paymentStatus:n}:s)),D.success(`Cập nhật trạng thái thanh toán đơn hàng ${t} thành ${n}`)},ie=t=>{M(T.filter(n=>n.id!==t)),D.success(`Đã xoá đơn hàng ${t}`)},O=t=>{const n={pending:{color:"gold",icon:e.jsx(k,{}),text:"Đang xử lý"},processing:{color:"blue",icon:e.jsx(we,{spin:!0}),text:"Đang chuẩn bị"},shipped:{color:"cyan",icon:e.jsx(Q,{}),text:"Đang giao hàng"},completed:{color:"green",icon:e.jsx(I,{}),text:"Hoàn thành"},canceled:{color:"red",icon:e.jsx(B,{}),text:"Đã huỷ"}},s=n[t]||n.pending;return e.jsx(U,{color:s.color,icon:s.icon,children:s.text})},_=t=>{const n={paid:{color:"green",icon:e.jsx(I,{}),text:"Đã thanh toán"},pending:{color:"gold",icon:e.jsx(k,{}),text:"Chờ thanh toán"},refunded:{color:"blue",icon:e.jsx(E,{}),text:"Đã hoàn tiền"},failed:{color:"red",icon:e.jsx(B,{}),text:"Thanh toán thất bại"}},s=n[t]||n.pending;return e.jsx(U,{color:s.color,icon:s.icon,children:s.text})},he=t=>({cash:"Tiền mặt",credit_card:"Thẻ tín dụng",bank_transfer:"Chuyển khoản",ewallet:"Ví điện tử"})[t]||t,x=t=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t),re=[{title:"Mã đơn hàng",dataIndex:"id",key:"id",render:t=>e.jsx("a",{children:t})},{title:"Khách hàng",dataIndex:"customer",key:"customer",render:t=>e.jsxs("div",{children:[e.jsx("div",{children:t.name}),e.jsx("div",{style:{fontSize:"12px",color:"#888"},children:t.phone})]})},{title:"Ngày",dataIndex:"date",key:"date",sorter:(t,n)=>c(t.date).unix()-c(n.date).unix()},{title:"Tổng tiền",dataIndex:"totalAmount",key:"totalAmount",render:t=>x(t),sorter:(t,n)=>t.totalAmount-n.totalAmount},{title:"Trạng thái",dataIndex:"status",key:"status",render:t=>O(t),filters:[{text:"Đang xử lý",value:"pending"},{text:"Đang chuẩn bị",value:"processing"},{text:"Đang giao hàng",value:"shipped"},{text:"Hoàn thành",value:"completed"},{text:"Đã huỷ",value:"canceled"}],onFilter:(t,n)=>n.status===t},{title:"Thanh toán",dataIndex:"paymentStatus",key:"paymentStatus",render:t=>_(t),filters:[{text:"Đã thanh toán",value:"paid"},{text:"Chờ thanh toán",value:"pending"},{text:"Đã hoàn tiền",value:"refunded"},{text:"Thất bại",value:"failed"}],onFilter:(t,n)=>n.paymentStatus===t},{title:"Thao tác",key:"action",render:(t,n)=>e.jsxs(y,{size:"small",children:[e.jsx(d,{type:"primary",size:"small",icon:e.jsx(ke,{}),onClick:()=>se(n),children:"Xem"}),e.jsx(d,{size:"small",icon:e.jsx(Ie,{}),onClick:()=>H(`/admin/orders/edit/${n.id}`),children:"Sửa"}),e.jsx(De,{title:"Bạn có chắc chắn muốn xoá đơn hàng này?",onConfirm:()=>ie(n.id),okText:"Xoá",cancelText:"Huỷ",placement:"left",children:e.jsx(d,{type:"primary",danger:!0,size:"small",icon:e.jsx(Ye,{}),children:"Xoá"})})]})}],ce=()=>{L({status:"all",dateRange:null,paymentStatus:"all"}),K("")},oe=t=>{K(t)},z=(t,n)=>{L({...r,[t]:n})},de=[{key:"details",tab:"Chi tiết",content:t=>e.jsxs(e.Fragment,{children:[e.jsxs(h,{bordered:!0,column:2,size:"small",children:[e.jsx(h.Item,{label:"Mã đơn hàng",span:2,children:e.jsx(p,{strong:!0,children:t.id})}),e.jsx(h.Item,{label:"Ngày đặt hàng",children:t.date}),e.jsx(h.Item,{label:"Trạng thái đơn hàng",children:O(t.status)}),e.jsx(h.Item,{label:"Trạng thái thanh toán",children:_(t.paymentStatus)}),e.jsx(h.Item,{label:"Phương thức thanh toán",children:he(t.paymentMethod)})]}),e.jsx(X,{orientation:"left",children:"Thông tin khách hàng"}),e.jsxs(h,{bordered:!0,column:2,size:"small",children:[e.jsx(h.Item,{label:"Tên khách hàng",children:t.customer.name}),e.jsx(h.Item,{label:"Mã khách hàng",children:t.customer.id}),e.jsx(h.Item,{label:"Số điện thoại",children:t.customer.phone}),e.jsx(h.Item,{label:"Email",children:t.customer.email})]}),e.jsx(X,{orientation:"left",children:"Thông tin giao hàng"}),e.jsxs(h,{bordered:!0,column:1,size:"small",children:[e.jsx(h.Item,{label:"Phương thức giao hàng",children:t.shipping.method==="standard"?"Giao hàng tiêu chuẩn":t.shipping.method}),e.jsx(h.Item,{label:"Địa chỉ giao hàng",children:t.shipping.address}),e.jsx(h.Item,{label:"Phí giao hàng",children:x(t.shipping.cost)})]})]})},{key:"items",tab:"Sản phẩm",content:t=>e.jsx(v,{dataSource:t.items,rowKey:"id",pagination:!1,columns:[{title:"Sản phẩm",dataIndex:"name",key:"name"},{title:"SKU",dataIndex:"sku",key:"sku"},{title:"Giá",dataIndex:"price",key:"price",render:n=>x(n)},{title:"Số lượng",dataIndex:"quantity",key:"quantity"},{title:"Thành tiền",key:"total",render:(n,s)=>x(s.price*s.quantity)}],summary:()=>e.jsxs(v.Summary.Row,{children:[e.jsx(v.Summary.Cell,{index:0,colSpan:4,align:"right",children:e.jsx(p,{strong:!0,children:"Tổng tiền sản phẩm:"})}),e.jsx(v.Summary.Cell,{index:1,children:e.jsx(p,{strong:!0,children:x(t.totalAmount-t.shipping.cost)})})]})})},{key:"timeline",tab:"Lịch sử",content:t=>{const n=[{time:c(t.date).format("YYYY-MM-DD HH:mm:ss"),status:"Đơn hàng được tạo",user:"Khách hàng"},{time:c(t.date).add(1,"hours").format("YYYY-MM-DD HH:mm:ss"),status:"Đơn hàng được xác nhận",user:"Nhân viên"}];return(t.status==="processing"||t.status==="shipped"||t.status==="completed")&&n.push({time:c(t.date).add(2,"hours").format("YYYY-MM-DD HH:mm:ss"),status:"Đang chuẩn bị hàng",user:"Nhân viên kho"}),(t.status==="shipped"||t.status==="completed")&&n.push({time:c(t.date).add(1,"days").format("YYYY-MM-DD HH:mm:ss"),status:"Đã giao cho đơn vị vận chuyển",user:"Nhân viên kho"}),t.status==="completed"&&n.push({time:c(t.date).add(3,"days").format("YYYY-MM-DD HH:mm:ss"),status:"Giao hàng thành công",user:"Đơn vị vận chuyển"}),t.status==="canceled"&&n.push({time:c(t.date).add(5,"hours").format("YYYY-MM-DD HH:mm:ss"),status:"Đơn hàng bị huỷ",user:"Khách hàng"}),e.jsx(q,{mode:"left",children:n.map((s,i)=>e.jsxs(q.Item,{label:s.time,color:i===n.length-1?"green":"blue",dot:i===n.length-1?ue(s.status):null,children:[e.jsx("div",{children:e.jsx(p,{strong:!0,children:s.status})}),e.jsx("div",{children:e.jsxs(p,{type:"secondary",children:["Thực hiện bởi: ",s.user]})})]},i))})}},{key:"notes",tab:"Ghi chú",content:t=>e.jsxs("div",{children:[e.jsx($e,{message:"Ghi chú đơn hàng",description:"Khách hàng không lấy hoá đơn VAT. Giao hàng trong giờ hành chính.",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(G.TextArea,{rows:4,placeholder:"Thêm ghi chú mới...",style:{marginBottom:16}}),e.jsx(d,{type:"primary",children:"Lưu ghi chú"})]})}],ue=t=>t.includes("thành công")?e.jsx(I,{style:{fontSize:"16px"}}):t.includes("huỷ")?e.jsx(B,{style:{fontSize:"16px"}}):t.includes("giao")?e.jsx(Q,{style:{fontSize:"16px"}}):e.jsx(k,{style:{fontSize:"16px"}}),me=t=>{l&&(ae(l.id,t),w({...l,status:t}))},xe=t=>{l&&(le(l.id,t),w({...l,paymentStatus:t}))};return e.jsxs("div",{className:"order-management",children:[e.jsxs(N,{gutter:[16,16],style:{marginBottom:16},children:[e.jsx(o,{xs:24,sm:12,md:6,children:e.jsx(j,{children:e.jsx(g,{title:"Tổng đơn hàng",value:b.total,prefix:e.jsx(je,{}),valueStyle:{color:"#1890ff"}})})}),e.jsx(o,{xs:24,sm:12,md:6,children:e.jsx(j,{children:e.jsx(g,{title:"Đơn hàng đang xử lý",value:b.pending,prefix:e.jsx(k,{}),valueStyle:{color:"#faad14"}})})}),e.jsx(o,{xs:24,sm:12,md:6,children:e.jsx(j,{children:e.jsx(g,{title:"Đơn hàng hoàn thành",value:b.completed,prefix:e.jsx(I,{}),valueStyle:{color:"#52c41a"}})})}),e.jsx(o,{xs:24,sm:12,md:6,children:e.jsx(j,{children:e.jsx(g,{title:"Tổng doanh thu",value:b.revenue,formatter:t=>x(t),prefix:e.jsx(E,{}),valueStyle:{color:"#722ed1"}})})})]}),e.jsx(j,{style:{marginBottom:16},children:e.jsxs(N,{gutter:[16,16],align:"middle",children:[e.jsx(o,{xs:24,md:6,children:e.jsx(G,{placeholder:"Tìm kiếm đơn hàng...",value:$,onChange:t=>oe(t.target.value),allowClear:!0,prefix:e.jsx(ye,{})})}),e.jsx(o,{xs:24,md:6,children:e.jsxs(S,{style:{width:"100%"},placeholder:"Trạng thái đơn hàng",value:r.status,onChange:t=>z("status",t),children:[e.jsx(a,{value:"all",children:"Tất cả trạng thái"}),e.jsx(a,{value:"pending",children:"Đang xử lý"}),e.jsx(a,{value:"processing",children:"Đang chuẩn bị"}),e.jsx(a,{value:"shipped",children:"Đang giao hàng"}),e.jsx(a,{value:"completed",children:"Hoàn thành"}),e.jsx(a,{value:"canceled",children:"Đã huỷ"})]})}),e.jsx(o,{xs:24,md:6,children:e.jsxs(S,{style:{width:"100%"},placeholder:"Trạng thái thanh toán",value:r.paymentStatus,onChange:t=>z("paymentStatus",t),children:[e.jsx(a,{value:"all",children:"Tất cả thanh toán"}),e.jsx(a,{value:"paid",children:"Đã thanh toán"}),e.jsx(a,{value:"pending",children:"Chờ thanh toán"}),e.jsx(a,{value:"refunded",children:"Đã hoàn tiền"}),e.jsx(a,{value:"failed",children:"Thanh toán thất bại"})]})}),e.jsx(o,{xs:24,md:6,children:e.jsx(Re,{style:{width:"100%"},value:r.dateRange,onChange:t=>z("dateRange",t),format:"DD/MM/YYYY"})}),e.jsx(o,{xs:24,md:24,children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{type:"primary",icon:e.jsx(ve,{}),onClick:ce,children:"Xoá bộ lọc"}),e.jsxs(y,{children:[e.jsx(d,{icon:e.jsx(Se,{}),children:"Xuất danh sách"}),e.jsx(d,{icon:e.jsx(Te,{}),children:"In danh sách"}),e.jsx(d,{type:"primary",icon:e.jsx(Me,{}),onClick:()=>H("/admin/orders/new"),children:"Tạo đơn hàng mới"})]})]})})]})}),e.jsx(j,{children:e.jsx(v,{columns:re,dataSource:ne,rowKey:"id",loading:J,pagination:{pageSize:10,showSizeChanger:!0,showTotal:t=>`Tổng ${t} đơn hàng`}})}),e.jsx(be,{title:l?e.jsxs(y,{align:"center",children:[e.jsx("span",{children:`Đơn hàng: ${l.id}`}),O(l.status)]}):"Chi tiết đơn hàng",width:720,open:W,onClose:()=>R(!1),extra:e.jsxs(y,{children:[e.jsx(d,{onClick:()=>R(!1),children:"Đóng"}),e.jsx(d,{type:"primary",onClick:()=>H(`/admin/orders/edit/${l?.id}`),children:"Chỉnh sửa"})]}),children:l&&e.jsxs(e.Fragment,{children:[e.jsxs(N,{gutter:[0,16],style:{marginBottom:16},children:[e.jsx(o,{span:24,children:e.jsxs(y,{size:"large",children:[e.jsx(g,{title:"Tổng giá trị",value:x(l.totalAmount),valueStyle:{color:"#1890ff"}}),e.jsx(g,{title:"Số lượng sản phẩm",value:l.totalItems,valueStyle:{color:"#52c41a"}}),e.jsx(g,{title:"Ngày đặt hàng",value:c(l.date).format("DD/MM/YYYY"),valueStyle:{color:"#722ed1"}})]})}),e.jsx(o,{span:24,children:e.jsxs(y,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(p,{strong:!0,children:"Cập nhật trạng thái:"}),e.jsxs(S,{style:{width:200,marginLeft:16},value:l.status,onChange:me,children:[e.jsx(a,{value:"pending",children:"Đang xử lý"}),e.jsx(a,{value:"processing",children:"Đang chuẩn bị"}),e.jsx(a,{value:"shipped",children:"Đang giao hàng"}),e.jsx(a,{value:"completed",children:"Hoàn thành"}),e.jsx(a,{value:"canceled",children:"Đã huỷ"})]})]}),e.jsxs("div",{children:[e.jsx(p,{strong:!0,children:"Cập nhật thanh toán:"}),e.jsxs(S,{style:{width:200,marginLeft:16},value:l.paymentStatus,onChange:xe,children:[e.jsx(a,{value:"pending",children:"Chờ thanh toán"}),e.jsx(a,{value:"paid",children:"Đã thanh toán"}),e.jsx(a,{value:"refunded",children:"Đã hoàn tiền"}),e.jsx(a,{value:"failed",children:"Thanh toán thất bại"})]})]})]})})]}),e.jsx(Z,{defaultActiveKey:"details",children:de.map(t=>e.jsx(He,{tab:t.tab,children:t.content(l)},t.key))})]})})]})};export{Be as default};
